!function(e){var n={},t=e.indexOf("#");e.substring(e.indexOf("?")).replace(/([^?=&]+)(=([^&]+))?/g,function(e,t,i,r){n[t]=r}),n.boolean=function(e,t){return n.hasOwnProperty(e)?"false"!==n[e]:t},n.float=function(e,t){var i=parseFloat(n[e]);return i!=i?t:i},n.int=function(e,t){var i=parseInt(n[e],10);return i!=i?t:i},n.hash=-1==t?void 0:e.substring(t+1),n.setUrl=arguments.callee,window.url=n}(location.href),function(f,R){var t,i,v=typeof R,e=f.location,m=f.document,r=m.documentElement,n=f.jQuery,o=f.$,a={},u=[],s="1.10.1",E=u.concat,l=u.push,c=u.slice,h=u.indexOf,p=a.toString,g=a.hasOwnProperty,d=s.trim,we=function(e,t){return new we.fn.init(e,t,i)},y=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,T=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,x=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,b=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,H=/^[\],:{}\s]*$/,_=/(?:^|:|,)(?:\s*\[)+/g,S=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,M=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,C=/^-ms-/,A=/-([\da-z])/gi,L=function(e,t){return t.toUpperCase()},P=function(e){(m.addEventListener||"load"===e.type||"complete"===m.readyState)&&(D(),we.ready())},D=function(){m.addEventListener?(m.removeEventListener("DOMContentLoaded",P,!1),f.removeEventListener("load",P,!1)):(m.detachEvent("onreadystatechange",P),f.detachEvent("onload",P))};function F(e){var t=e.length,i=we.type(e);return!we.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===i||"function"!==i&&(0===t||"number"==typeof t&&0<t&&t-1 in e)))}we.fn=we.prototype={jquery:s,constructor:we,init:function(e,t,i){var r,n;if(!e)return this;if("string"==typeof e){if(!(r="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&3<=e.length?[null,e,null]:x.exec(e))||!r[1]&&t)return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof we?t[0]:t,we.merge(this,we.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:m,!0)),b.test(r[1])&&we.isPlainObject(t))for(r in t)we.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}if((n=m.getElementById(r[2]))&&n.parentNode){if(n.id!==r[2])return i.find(e);this.length=1,this[0]=n}return this.context=m,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):we.isFunction(e)?i.ready(e):(e.selector!==R&&(this.selector=e.selector,this.context=e.context),we.makeArray(e,this))},selector:"",length:0,toArray:function(){return c.call(this)},get:function(e){return null==e?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=we.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return we.each(this,e,t)},ready:function(e){return we.ready.promise().done(e),this},slice:function(){return this.pushStack(c.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(e<0?t:0);return this.pushStack(0<=i&&i<t?[this[i]]:[])},map:function(i){return this.pushStack(we.map(this,function(e,t){return i.call(e,t,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:l,sort:[].sort,splice:[].splice},we.fn.init.prototype=we.fn,we.extend=we.fn.extend=function(){var e,t,i,r,n,o,a=arguments[0]||{},s=1,l=arguments.length,h=!1;for("boolean"==typeof a&&(h=a,a=arguments[1]||{},s=2),"object"==typeof a||we.isFunction(a)||(a={}),l===s&&(a=this,--s);s<l;s++)if(null!=(n=arguments[s]))for(r in n)e=a[r],a!==(i=n[r])&&(h&&i&&(we.isPlainObject(i)||(t=we.isArray(i)))?(t?(t=!1,o=e&&we.isArray(e)?e:[]):o=e&&we.isPlainObject(e)?e:{},a[r]=we.extend(h,o,i)):i!==R&&(a[r]=i));return a},we.extend({expando:"jQuery"+(s+Math.random()).replace(/\D/g,""),noConflict:function(e){return f.$===we&&(f.$=o),e&&f.jQuery===we&&(f.jQuery=n),we},isReady:!1,readyWait:1,holdReady:function(e){e?we.readyWait++:we.ready(!0)},ready:function(e){if(!0===e?!--we.readyWait:!we.isReady){if(!m.body)return setTimeout(we.ready);(we.isReady=!0)!==e&&0<--we.readyWait||(t.resolveWith(m,[we]),we.fn.trigger&&we(m).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===we.type(e)},isArray:Array.isArray||function(e){return"array"===we.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?a[p.call(e)]||"object":typeof e},isPlainObject:function(e){var t;if(!e||"object"!==we.type(e)||e.nodeType||we.isWindow(e))return!1;try{if(e.constructor&&!g.call(e,"constructor")&&!g.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}if(we.support.ownLast)for(t in e)return g.call(e,t);for(t in e);return t===R||g.call(e,t)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,i){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(i=t,t=!1),t=t||m;var r=b.exec(e),n=!i&&[];return r?[t.createElement(r[1])]:(r=we.buildFragment([e],t,n),n&&we(n).remove(),we.merge([],r.childNodes))},parseJSON:function(e){return f.JSON&&f.JSON.parse?f.JSON.parse(e):null===e?e:"string"==typeof e&&(e=we.trim(e))&&H.test(e.replace(S,"@").replace(M,"]").replace(_,""))?new Function("return "+e)():void we.error("Invalid JSON: "+e)},parseXML:function(e){var t;if(!e||"string"!=typeof e)return null;try{f.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e))}catch(e){t=R}return t&&t.documentElement&&!t.getElementsByTagName("parsererror").length||we.error("Invalid XML: "+e),t},noop:function(){},globalEval:function(e){e&&we.trim(e)&&(f.execScript||function(e){f.eval.call(f,e)})(e)},camelCase:function(e){return e.replace(C,"ms-").replace(A,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,i){var r=0,n=e.length,o=F(e);if(i){if(o)for(;r<n&&!1!==t.apply(e[r],i);r++);else for(r in e)if(!1===t.apply(e[r],i))break}else if(o)for(;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:d&&!d.call("\ufeffÂ ")?function(e){return null==e?"":d.call(e)}:function(e){return null==e?"":(e+"").replace(T,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(F(Object(e))?we.merge(i,"string"==typeof e?[e]:e):l.call(i,e)),i},inArray:function(e,t,i){var r;if(t){if(h)return h.call(t,e,i);for(r=t.length,i=i?i<0?Math.max(0,r+i):i:0;i<r;i++)if(i in t&&t[i]===e)return i}return-1},merge:function(e,t){var i=t.length,r=e.length,n=0;if("number"==typeof i)for(;n<i;n++)e[r++]=t[n];else for(;t[n]!==R;)e[r++]=t[n++];return e.length=r,e},grep:function(e,t,i){var r=[],n=0,o=e.length;for(i=!!i;n<o;n++)i!==!!t(e[n],n)&&r.push(e[n]);return r},map:function(e,t,i){var r,n=0,o=e.length,a=[];if(F(e))for(;n<o;n++)null!=(r=t(e[n],n,i))&&(a[a.length]=r);else for(n in e)null!=(r=t(e[n],n,i))&&(a[a.length]=r);return E.apply([],a)},guid:1,proxy:function(e,t){var i,r,n;return"string"==typeof t&&(n=e[t],t=e,e=n),we.isFunction(e)?(i=c.call(arguments,2),(r=function(){return e.apply(t||this,i.concat(c.call(arguments)))}).guid=e.guid=e.guid||we.guid++,r):R},access:function(e,t,i,r,n,o,a){var s=0,l=e.length,h=null==i;if("object"===we.type(i))for(s in n=!0,i)we.access(e,t,s,i[s],!0,o,a);else if(r!==R&&(n=!0,we.isFunction(r)||(a=!0),h&&(a?(t.call(e,r),t=null):(h=t,t=function(e,t,i){return h.call(we(e),i)})),t))for(;s<l;s++)t(e[s],i,a?r:r.call(e[s],s,t(e[s],i)));return n?e:h?t.call(e):l?t(e[0],i):o},now:function(){return(new Date).getTime()},swap:function(e,t,i,r){var n,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];for(o in n=i.apply(e,r||[]),t)e.style[o]=a[o];return n}}),we.ready.promise=function(e){if(!t)if(t=we.Deferred(),"complete"===m.readyState)setTimeout(we.ready);else if(m.addEventListener)m.addEventListener("DOMContentLoaded",P,!1),f.addEventListener("load",P,!1);else{m.attachEvent("onreadystatechange",P),f.attachEvent("onload",P);var i=!1;try{i=null==f.frameElement&&m.documentElement}catch(e){}i&&i.doScroll&&function t(){if(!we.isReady){try{i.doScroll("left")}catch(e){return setTimeout(t,50)}D(),we.ready()}}()}return t.promise(e)},we.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){a["[object "+t+"]"]=t.toLowerCase()}),i=we(m),function(i,n){var e,f,x,b,o,r,m,R,h,E,w,a,v,g,s,c,y,H="sizzle"+-new Date,T=i.document,_=0,u=0,l=oe(),p=oe(),d=oe(),S=!1,M=function(){return 0},C=typeof n,A={}.hasOwnProperty,t=[],L=t.pop,P=t.push,D=t.push,F=t.slice,N=t.indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(this[t]===e)return t;return-1},U="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="[\\x20\\t\\r\\n\\f]",k="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",z=k.replace("w","w#"),V="\\["+B+"*("+k+")"+B+"*(?:([*^$|!~]?=)"+B+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+z+")|)|)"+B+"*\\]",I=":("+k+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+V.replace(3,8)+")*)|.*)\\)|)",O=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),j=new RegExp("^"+B+"*,"+B+"*"),G=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),W=new RegExp(B+"*[+~]"),q=new RegExp("="+B+"*([^\\]'\"]*)"+B+"*\\]","g"),X=new RegExp(I),Y=new RegExp("^"+z+"$"),K={ID:new RegExp("^#("+k+")"),CLASS:new RegExp("^\\.("+k+")"),TAG:new RegExp("^("+k.replace("w","w*")+")"),ATTR:new RegExp("^"+V),PSEUDO:new RegExp("^"+I),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+U+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},$=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Z=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,ee=/'|\\/g,te=new RegExp("\\\\([\\da-f]{1,6}"+B+"?|("+B+")|.)","ig"),ie=function(e,t,i){var r="0x"+t-65536;return r!=r||i?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{D.apply(t=F.call(T.childNodes),T.childNodes),t[T.childNodes.length].nodeType}catch(e){D={apply:t.length?function(e,t){P.apply(e,F.call(t))}:function(e,t){for(var i=e.length,r=0;e[i++]=t[r++];);e.length=i-1}}}function re(e,t,i,r){var n,o,a,s,l,h,c,u,p,d;if((t?t.ownerDocument||t:T)!==w&&E(t),i=i||[],!e||"string"!=typeof e)return i;if(1!==(s=(t=t||w).nodeType)&&9!==s)return[];if(v&&!r){if(n=Q.exec(e))if(a=n[1]){if(9===s){if(!(o=t.getElementById(a))||!o.parentNode)return i;if(o.id===a)return i.push(o),i}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&y(t,o)&&o.id===a)return i.push(o),i}else{if(n[2])return D.apply(i,t.getElementsByTagName(e)),i;if((a=n[3])&&f.getElementsByClassName&&t.getElementsByClassName)return D.apply(i,t.getElementsByClassName(a)),i}if(f.qsa&&(!g||!g.test(e))){if(u=c=H,p=t,d=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(h=Ee(e),(c=t.getAttribute("id"))?u=c.replace(ee,"\\$&"):t.setAttribute("id",u),u="[id='"+u+"'] ",l=h.length;l--;)h[l]=u+ve(h[l]);p=W.test(e)&&t.parentNode||t,d=h.join(",")}if(d)try{return D.apply(i,p.querySelectorAll(d)),i}catch(e){}finally{c||t.removeAttribute("id")}}}return function(e,t,i,r){var n,o,a,s,l,h=Ee(e);if(!r&&1===h.length){if(2<(o=h[0]=h[0].slice(0)).length&&"ID"===(a=o[0]).type&&f.getById&&9===t.nodeType&&v&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ie),t)||[])[0]))return i;e=e.slice(o.shift().value.length)}for(n=K.needsContext.test(e)?0:o.length;n--&&(a=o[n],!b.relative[s=a.type]);)if((l=b.find[s])&&(r=l(a.matches[0].replace(te,ie),W.test(o[0].type)&&t.parentNode||t))){if(o.splice(n,1),!(e=r.length&&ve(o)))return D.apply(i,r),i;break}}return m(e,h)(r,t,!v,i,W.test(e)),i}(e.replace(O,"$1"),t,i,r)}function ne(e){return $.test(e+"")}function oe(){var r=[];return function e(t,i){return r.push(t+=" ")>b.cacheLength&&delete e[r.shift()],e[t]=i}}function ae(e){return e[H]=!0,e}function se(e){var t=w.createElement("div");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function le(e,t,i){for(var r,n=(e=e.split("|")).length,o=i?null:t;n--;)(r=b.attrHandle[e[n]])&&r!==t||(b.attrHandle[e[n]]=o)}function he(e,t){var i=e.getAttributeNode(t);return i&&i.specified?i.value:!0===e[t]?t.toLowerCase():null}function ce(e,t){return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}function ue(e){if("input"===e.nodeName.toLowerCase())return e.defaultValue}function pe(e,t){var i=t&&e,r=i&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||1<<31)-(~e.sourceIndex||1<<31);if(r)return r;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function fe(i){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===i}}function me(a){return ae(function(o){return o=+o,ae(function(e,t){for(var i,r=a([],e.length,o),n=r.length;n--;)e[i=r[n]]&&(e[i]=!(t[i]=e[i]))})})}for(e in r=re.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},f=re.support={},E=re.setDocument=function(e){var l=e?e.ownerDocument||e:T,t=l.parentWindow;return l!==w&&9===l.nodeType&&l.documentElement?(a=(w=l).documentElement,v=!r(l),t&&t.frameElement&&t.attachEvent("onbeforeunload",function(){E()}),f.attributes=se(function(e){return e.innerHTML="<a href='#'></a>",le("type|href|height|width",ce,"#"===e.firstChild.getAttribute("href")),le(U,he,null==e.getAttribute("disabled")),e.className="i",!e.getAttribute("className")}),f.input=se(function(e){return e.innerHTML="<input>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}),le("value",ue,f.attributes&&f.input),f.getElementsByTagName=se(function(e){return e.appendChild(l.createComment("")),!e.getElementsByTagName("*").length}),f.getElementsByClassName=se(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),f.getById=se(function(e){return a.appendChild(e).id=H,!l.getElementsByName||!l.getElementsByName(H).length}),f.getById?(b.find.ID=function(e,t){if(typeof t.getElementById!==C&&v){var i=t.getElementById(e);return i&&i.parentNode?[i]:[]}},b.filter.ID=function(e){var t=e.replace(te,ie);return function(e){return e.getAttribute("id")===t}}):(delete b.find.ID,b.filter.ID=function(e){var i=e.replace(te,ie);return function(e){var t=typeof e.getAttributeNode!==C&&e.getAttributeNode("id");return t&&t.value===i}}),b.find.TAG=f.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==C)return t.getElementsByTagName(e)}:function(e,t){var i,r=[],n=0,o=t.getElementsByTagName(e);if("*"===e){for(;i=o[n++];)1===i.nodeType&&r.push(i);return r}return o},b.find.CLASS=f.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==C&&v)return t.getElementsByClassName(e)},s=[],g=[],(f.qsa=ne(l.querySelectorAll))&&(se(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||g.push("\\["+B+"*(?:value|"+U+")"),e.querySelectorAll(":checked").length||g.push(":checked")}),se(function(e){var t=l.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&g.push("[*^$]="+B+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||g.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),g.push(",.*:")})),(f.matchesSelector=ne(c=a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&se(function(e){f.disconnectedMatch=c.call(e,"div"),c.call(e,"[s!='']:x"),s.push("!=",I)}),g=g.length&&new RegExp(g.join("|")),s=s.length&&new RegExp(s.join("|")),y=ne(a.contains)||a.compareDocumentPosition?function(e,t){var i=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(i.contains?i.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},f.sortDetached=se(function(e){return 1&e.compareDocumentPosition(l.createElement("div"))}),M=a.compareDocumentPosition?function(e,t){if(e===t)return S=!0,0;var i=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t);return i?1&i||!f.sortDetached&&t.compareDocumentPosition(e)===i?e===l||y(T,e)?-1:t===l||y(T,t)?1:h?N.call(h,e)-N.call(h,t):0:4&i?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var i,r=0,n=e.parentNode,o=t.parentNode,a=[e],s=[t];if(e===t)return S=!0,0;if(!n||!o)return e===l?-1:t===l?1:n?-1:o?1:h?N.call(h,e)-N.call(h,t):0;if(n===o)return pe(e,t);for(i=e;i=i.parentNode;)a.unshift(i);for(i=t;i=i.parentNode;)s.unshift(i);for(;a[r]===s[r];)r++;return r?pe(a[r],s[r]):a[r]===T?-1:s[r]===T?1:0},l):w},re.matches=function(e,t){return re(e,null,null,t)},re.matchesSelector=function(e,t){if((e.ownerDocument||e)!==w&&E(e),t=t.replace(q,"='$1']"),f.matchesSelector&&v&&(!s||!s.test(t))&&(!g||!g.test(t)))try{var i=c.call(e,t);if(i||f.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(e){}return 0<re(t,w,null,[e]).length},re.contains=function(e,t){return(e.ownerDocument||e)!==w&&E(e),y(e,t)},re.attr=function(e,t){(e.ownerDocument||e)!==w&&E(e);var i=b.attrHandle[t.toLowerCase()],r=i&&A.call(b.attrHandle,t.toLowerCase())?i(e,t,!v):n;return r===n?f.attributes||!v?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null:r},re.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},re.uniqueSort=function(e){var t,i=[],r=0,n=0;if(S=!f.detectDuplicates,h=!f.sortStable&&e.slice(0),e.sort(M),S){for(;t=e[n++];)t===e[n]&&(r=i.push(n));for(;r--;)e.splice(i[r],1)}return e},o=re.getText=function(e){var t,i="",r=0,n=e.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=o(e)}else if(3===n||4===n)return e.nodeValue}else for(;t=e[r];r++)i+=o(t);return i},b=re.selectors={cacheLength:50,createPseudo:ae,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ie),e[3]=(e[4]||e[5]||"").replace(te,ie),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||re.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&re.error(e[0]),e},PSEUDO:function(e){var t,i=!e[5]&&e[2];return K.CHILD.test(e[0])?null:(e[3]&&e[4]!==n?e[2]=e[4]:i&&X.test(i)&&(t=Ee(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ie).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=l[e+" "];return t||(t=new RegExp("(^|"+B+")"+e+"("+B+"|$)"))&&l(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==C&&e.getAttribute("class")||"")})},ATTR:function(i,r,n){return function(e){var t=re.attr(e,i);return null==t?"!="===r:!r||(t+="","="===r?t===n:"!="===r?t!==n:"^="===r?n&&0===t.indexOf(n):"*="===r?n&&-1<t.indexOf(n):"$="===r?n&&t.slice(-n.length)===n:"~="===r?-1<(" "+t+" ").indexOf(n):"|="===r&&(t===n||t.slice(0,n.length+1)===n+"-"))}},CHILD:function(d,e,t,f,m){var E="nth"!==d.slice(0,3),v="last"!==d.slice(-4),g="of-type"===e;return 1===f&&0===m?function(e){return!!e.parentNode}:function(e,t,i){var r,n,o,a,s,l,h=E!==v?"nextSibling":"previousSibling",c=e.parentNode,u=g&&e.nodeName.toLowerCase(),p=!i&&!g;if(c){if(E){for(;h;){for(o=e;o=o[h];)if(g?o.nodeName.toLowerCase()===u:1===o.nodeType)return!1;l=h="only"===d&&!l&&"nextSibling"}return!0}if(l=[v?c.firstChild:c.lastChild],v&&p){for(s=(r=(n=c[H]||(c[H]={}))[d]||[])[0]===_&&r[1],a=r[0]===_&&r[2],o=s&&c.childNodes[s];o=++s&&o&&o[h]||(a=s=0)||l.pop();)if(1===o.nodeType&&++a&&o===e){n[d]=[_,s,a];break}}else if(p&&(r=(e[H]||(e[H]={}))[d])&&r[0]===_)a=r[1];else for(;(o=++s&&o&&o[h]||(a=s=0)||l.pop())&&((g?o.nodeName.toLowerCase()!==u:1!==o.nodeType)||!++a||(p&&((o[H]||(o[H]={}))[d]=[_,a]),o!==e)););return(a-=m)===f||a%f==0&&0<=a/f}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||re.error("unsupported pseudo: "+e);return a[H]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?ae(function(e,t){for(var i,r=a(e,o),n=r.length;n--;)e[i=N.call(e,r[n])]=!(t[i]=r[n])}):function(e){return a(e,0,t)}):a}},pseudos:{not:ae(function(e){var r=[],n=[],s=m(e.replace(O,"$1"));return s[H]?ae(function(e,t,i,r){for(var n,o=s(e,null,r,[]),a=e.length;a--;)(n=o[a])&&(e[a]=!(t[a]=n))}):function(e,t,i){return r[0]=e,s(r,null,i,n),!n.pop()}}),has:ae(function(t){return function(e){return 0<re(t,e).length}}),contains:ae(function(t){return function(e){return-1<(e.textContent||e.innerText||o(e)).indexOf(t)}}),lang:ae(function(i){return Y.test(i||"")||re.error("unsupported lang: "+i),i=i.replace(te,ie).toLowerCase(),function(e){var t;do{if(t=v?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===i||0===t.indexOf(i+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=i.location&&i.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===w.activeElement&&(!w.hasFocus||w.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if("@"<e.nodeName||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:me(function(){return[0]}),last:me(function(e,t){return[t-1]}),eq:me(function(e,t,i){return[i<0?i+t:i]}),even:me(function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e}),odd:me(function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e}),lt:me(function(e,t,i){for(var r=i<0?i+t:i;0<=--r;)e.push(r);return e}),gt:me(function(e,t,i){for(var r=i<0?i+t:i;++r<t;)e.push(r);return e})}},{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=fe(e);function Ee(e,t){var i,r,n,o,a,s,l,h=p[e+" "];if(h)return t?0:h.slice(0);for(a=e,s=[],l=b.preFilter;a;){for(o in i&&!(r=j.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(n=[])),i=!1,(r=G.exec(a))&&(i=r.shift(),n.push({value:i,type:r[0].replace(O," ")}),a=a.slice(i.length)),b.filter)!(r=K[o].exec(a))||l[o]&&!(r=l[o](r))||(i=r.shift(),n.push({value:i,type:o,matches:r}),a=a.slice(i.length));if(!i)break}return t?a.length:a?re.error(e):p(e,s).slice(0)}function ve(e){for(var t=0,i=e.length,r="";t<i;t++)r+=e[t].value;return r}function ge(s,e,t){var l=e.dir,h=t&&"parentNode"===l,c=u++;return e.first?function(e,t,i){for(;e=e[l];)if(1===e.nodeType||h)return s(e,t,i)}:function(e,t,i){var r,n,o,a=_+" "+c;if(i){for(;e=e[l];)if((1===e.nodeType||h)&&s(e,t,i))return!0}else for(;e=e[l];)if(1===e.nodeType||h)if((n=(o=e[H]||(e[H]={}))[l])&&n[0]===a){if(!0===(r=n[1])||r===x)return!0===r}else if((n=o[l]=[a])[1]=s(e,t,i)||x,!0===n[1])return!0}}function ye(n){return 1<n.length?function(e,t,i){for(var r=n.length;r--;)if(!n[r](e,t,i))return!1;return!0}:n[0]}function Te(e,t,i,r,n){for(var o,a=[],s=0,l=e.length,h=null!=t;s<l;s++)(o=e[s])&&(i&&!i(o,r,n)||(a.push(o),h&&t.push(s)));return a}function xe(d,f,m,E,v,e){return E&&!E[H]&&(E=xe(E)),v&&!v[H]&&(v=xe(v,e)),ae(function(e,t,i,r){var n,o,a,s=[],l=[],h=t.length,c=e||function(e,t,i){for(var r=0,n=t.length;r<n;r++)re(e,t[r],i);return i}(f||"*",i.nodeType?[i]:i,[]),u=!d||!e&&f?c:Te(c,s,d,i,r),p=m?v||(e?d:h||E)?[]:t:u;if(m&&m(u,p,i,r),E)for(n=Te(p,l),E(n,[],i,r),o=n.length;o--;)(a=n[o])&&(p[l[o]]=!(u[l[o]]=a));if(e){if(v||d){if(v){for(n=[],o=p.length;o--;)(a=p[o])&&n.push(u[o]=a);v(null,p=[],n,r)}for(o=p.length;o--;)(a=p[o])&&-1<(n=v?N.call(e,a):s[o])&&(e[n]=!(t[n]=a))}}else p=Te(p===t?p.splice(h,p.length):p),v?v(null,t,p,r):D.apply(t,p)})}function be(e){for(var r,t,i,n=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,l=ge(function(e){return e===r},a,!0),h=ge(function(e){return-1<N.call(r,e)},a,!0),c=[function(e,t,i){return!o&&(i||t!==R)||((r=t).nodeType?l(e,t,i):h(e,t,i))}];s<n;s++)if(t=b.relative[e[s].type])c=[ge(ye(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[H]){for(i=++s;i<n&&!b.relative[e[i].type];i++);return xe(1<s&&ye(c),1<s&&ve(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(O,"$1"),t,s<i&&be(e.slice(s,i)),i<n&&be(e=e.slice(i)),i<n&&ve(e))}c.push(t)}return ye(c)}function Re(){}m=re.compile=function(e,t){var i,E,v,g,y,T,r,n=[],o=[],a=d[e+" "];if(!a){for(t||(t=Ee(e)),i=t.length;i--;)(a=be(t[i]))[H]?n.push(a):o.push(a);a=d(e,(E=o,y=(g=0)<(v=n).length,T=0<E.length,r=function(e,t,i,r,n){var o,a,s,l=[],h=0,c="0",u=e&&[],p=null!=n,d=R,f=e||T&&b.find.TAG("*",n&&t.parentNode||t),m=_+=null==d?1:Math.random()||.1;for(p&&(R=t!==w&&t,x=g);null!=(o=f[c]);c++){if(T&&o){for(a=0;s=E[a++];)if(s(o,t,i)){r.push(o);break}p&&(_=m,x=++g)}y&&((o=!s&&o)&&h--,e&&u.push(o))}if(h+=c,y&&c!==h){for(a=0;s=v[a++];)s(u,l,t,i);if(e){if(0<h)for(;c--;)u[c]||l[c]||(l[c]=L.call(r));l=Te(l)}D.apply(r,l),p&&!e&&0<l.length&&1<h+v.length&&re.uniqueSort(r)}return p&&(_=m,R=d),u},y?ae(r):r))}return a},b.pseudos.nth=b.pseudos.eq,Re.prototype=b.filters=b.pseudos,b.setFilters=new Re,f.sortStable=H.split("").sort(M).join("")===H,E(),[0,0].sort(M),f.detectDuplicates=S,we.find=re,we.expr=re.selectors,we.expr[":"]=we.expr.pseudos,we.unique=re.uniqueSort,we.text=re.getText,we.isXMLDoc=re.isXML,we.contains=re.contains}(f);var N={};we.Callbacks=function(n){var e,i;n="string"==typeof n?N[n]||(i=N[e=n]={},we.each(e.match(w)||[],function(e,t){i[t]=!0}),i):we.extend({},n);var r,t,o,a,s,l,h=[],c=!n.once&&[],u=function(e){for(t=n.memory&&e,o=!0,s=l||0,l=0,a=h.length,r=!0;h&&s<a;s++)if(!1===h[s].apply(e[0],e[1])&&n.stopOnFalse){t=!1;break}r=!1,h&&(c?c.length&&u(c.shift()):t?h=[]:p.disable())},p={add:function(){if(h){var e=h.length;!function r(e){we.each(e,function(e,t){var i=we.type(t);"function"===i?n.unique&&p.has(t)||h.push(t):t&&t.length&&"string"!==i&&r(t)})}(arguments),r?a=h.length:t&&(l=e,u(t))}return this},remove:function(){return h&&we.each(arguments,function(e,t){for(var i;-1<(i=we.inArray(t,h,i));)h.splice(i,1),r&&(i<=a&&a--,i<=s&&s--)}),this},has:function(e){return e?-1<we.inArray(e,h):!(!h||!h.length)},empty:function(){return h=[],a=0,this},disable:function(){return h=c=t=R,this},disabled:function(){return!h},lock:function(){return c=R,t||p.disable(),this},locked:function(){return!c},fireWith:function(e,t){return t=[e,(t=t||[]).slice?t.slice():t],!h||o&&!c||(r?c.push(t):u(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!o}};return p},we.extend({Deferred:function(e){var a=[["resolve","done",we.Callbacks("once memory"),"resolved"],["reject","fail",we.Callbacks("once memory"),"rejected"],["notify","progress",we.Callbacks("memory")]],n="pending",s={state:function(){return n},always:function(){return l.done(arguments).fail(arguments),this},then:function(){var o=arguments;return we.Deferred(function(n){we.each(a,function(e,t){var i=t[0],r=we.isFunction(o[e])&&o[e];l[t[1]](function(){var e=r&&r.apply(this,arguments);e&&we.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[i+"With"](this===s?n.promise():this,r?[e]:arguments)})}),o=null}).promise()},promise:function(e){return null!=e?we.extend(e,s):s}},l={};return s.pipe=s.then,we.each(a,function(e,t){var i=t[2],r=t[3];s[t[1]]=i.add,r&&i.add(function(){n=r},a[1^e][2].disable,a[2][2].lock),l[t[0]]=function(){return l[t[0]+"With"](this===l?s:this,arguments),this},l[t[0]+"With"]=i.fireWith}),s.promise(l),e&&e.call(l,l),l},when:function(e){var n,t,i,r=0,o=c.call(arguments),a=o.length,s=1!==a||e&&we.isFunction(e.promise)?a:0,l=1===s?e:we.Deferred(),h=function(t,i,r){return function(e){i[t]=this,r[t]=1<arguments.length?c.call(arguments):e,r===n?l.notifyWith(i,r):--s||l.resolveWith(i,r)}};if(1<a)for(n=new Array(a),t=new Array(a),i=new Array(a);r<a;r++)o[r]&&we.isFunction(o[r].promise)?o[r].promise().done(h(r,i,o)).fail(l.reject).progress(h(r,t,n)):--s;return s||l.resolveWith(i,o),l.promise()}}),we.support=function(o){var e,t,i,r,n,a,s,l,h,c=m.createElement("div");if(c.setAttribute("className","t"),c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=c.getElementsByTagName("*")||[],!(t=c.getElementsByTagName("a")[0])||!t.style||!e.length)return o;a=(r=m.createElement("select")).appendChild(m.createElement("option")),i=c.getElementsByTagName("input")[0],t.style.cssText="top:1px;float:left;opacity:.5",o.getSetAttribute="t"!==c.className,o.leadingWhitespace=3===c.firstChild.nodeType,o.tbody=!c.getElementsByTagName("tbody").length,o.htmlSerialize=!!c.getElementsByTagName("link").length,o.style=/top/.test(t.getAttribute("style")),o.hrefNormalized="/a"===t.getAttribute("href"),o.opacity=/^0.5/.test(t.style.opacity),o.cssFloat=!!t.style.cssFloat,o.checkOn=!!i.value,o.optSelected=a.selected,o.enctype=!!m.createElement("form").enctype,o.html5Clone="<:nav></:nav>"!==m.createElement("nav").cloneNode(!0).outerHTML,o.inlineBlockNeedsLayout=!1,o.shrinkWrapBlocks=!1,o.pixelPosition=!1,o.deleteExpando=!0,o.noCloneEvent=!0,o.reliableMarginRight=!0,o.boxSizingReliable=!0,i.checked=!0,o.noCloneChecked=i.cloneNode(!0).checked,r.disabled=!0,o.optDisabled=!a.disabled;try{delete c.test}catch(e){o.deleteExpando=!1}for(h in(i=m.createElement("input")).setAttribute("value",""),o.input=""===i.getAttribute("value"),i.value="t",i.setAttribute("type","radio"),o.radioValue="t"===i.value,i.setAttribute("checked","t"),i.setAttribute("name","t"),(n=m.createDocumentFragment()).appendChild(i),o.appendChecked=i.checked,o.checkClone=n.cloneNode(!0).cloneNode(!0).lastChild.checked,c.attachEvent&&(c.attachEvent("onclick",function(){o.noCloneEvent=!1}),c.cloneNode(!0).click()),{submit:!0,change:!0,focusin:!0})c.setAttribute(s="on"+h,"t"),o[h+"Bubbles"]=s in f||!1===c.attributes[s].expando;for(h in c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",o.clearCloneStyle="content-box"===c.style.backgroundClip,we(o))break;return o.ownLast="0"!==h,we(function(){var e,t,i,r="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",n=m.getElementsByTagName("body")[0];n&&((e=m.createElement("div")).style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",n.appendChild(e).appendChild(c),c.innerHTML="<table><tr><td></td><td>t</td></tr></table>",(i=c.getElementsByTagName("td"))[0].style.cssText="padding:0;margin:0;border:0;display:none",l=0===i[0].offsetHeight,i[0].style.display="",i[1].style.display="none",o.reliableHiddenOffsets=l&&0===i[0].offsetHeight,c.innerHTML="",c.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",we.swap(n,null!=n.style.zoom?{zoom:1}:{},function(){o.boxSizing=4===c.offsetWidth}),f.getComputedStyle&&(o.pixelPosition="1%"!==(f.getComputedStyle(c,null)||{}).top,o.boxSizingReliable="4px"===(f.getComputedStyle(c,null)||{width:"4px"}).width,(t=c.appendChild(m.createElement("div"))).style.cssText=c.style.cssText=r,t.style.marginRight=t.style.width="0",c.style.width="1px",o.reliableMarginRight=!parseFloat((f.getComputedStyle(t,null)||{}).marginRight)),typeof c.style.zoom!==v&&(c.innerHTML="",c.style.cssText=r+"width:1px;padding:1px;display:inline;zoom:1",o.inlineBlockNeedsLayout=3===c.offsetWidth,c.style.display="block",c.innerHTML="<div></div>",c.firstChild.style.width="5px",o.shrinkWrapBlocks=3!==c.offsetWidth,o.inlineBlockNeedsLayout&&(n.style.zoom=1)),n.removeChild(e),e=c=i=t=null)}),e=r=n=a=t=i=null,o}({});var U=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,B=/([A-Z])/g;function k(e,t,i,r){if(we.acceptData(e)){var n,o,a=we.expando,s=e.nodeType,l=s?we.cache:e,h=s?e[a]:e[a]&&a;if(h&&l[h]&&(r||l[h].data)||i!==R||"string"!=typeof t)return h||(h=s?e[a]=u.pop()||we.guid++:a),l[h]||(l[h]=s?{}:{toJSON:we.noop}),"object"!=typeof t&&"function"!=typeof t||(r?l[h]=we.extend(l[h],t):l[h].data=we.extend(l[h].data,t)),o=l[h],r||(o.data||(o.data={}),o=o.data),i!==R&&(o[we.camelCase(t)]=i),"string"==typeof t?null==(n=o[t])&&(n=o[we.camelCase(t)]):n=o,n}}function z(e,t,i){if(we.acceptData(e)){var r,n,o=e.nodeType,a=o?we.cache:e,s=o?e[we.expando]:we.expando;if(a[s]){if(t&&(r=i?a[s]:a[s].data)){n=(t=we.isArray(t)?t.concat(we.map(t,we.camelCase)):t in r?[t]:(t=we.camelCase(t))in r?[t]:t.split(" ")).length;for(;n--;)delete r[t[n]];if(i?!I(r):!we.isEmptyObject(r))return}(i||(delete a[s].data,I(a[s])))&&(o?we.cleanData([e],!0):we.support.deleteExpando||a!=a.window?delete a[s]:a[s]=null)}}}function V(e,t,i){if(i===R&&1===e.nodeType){var r="data-"+t.replace(B,"-$1").toLowerCase();if("string"==typeof(i=e.getAttribute(r))){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:U.test(i)?we.parseJSON(i):i)}catch(e){}we.data(e,t,i)}else i=R}return i}function I(e){var t;for(t in e)if(("data"!==t||!we.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}we.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return!!(e=e.nodeType?we.cache[e[we.expando]]:e[we.expando])&&!I(e)},data:function(e,t,i){return k(e,t,i)},removeData:function(e,t){return z(e,t)},_data:function(e,t,i){return k(e,t,i,!0)},_removeData:function(e,t){return z(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&we.noData[e.nodeName.toLowerCase()];return!t||!0!==t&&e.getAttribute("classid")===t}}),we.fn.extend({data:function(e,t){var i,r,n=null,o=0,a=this[0];if(e===R){if(this.length&&(n=we.data(a),1===a.nodeType&&!we._data(a,"parsedAttrs"))){for(i=a.attributes;o<i.length;o++)0===(r=i[o].name).indexOf("data-")&&V(a,r=we.camelCase(r.slice(5)),n[r]);we._data(a,"parsedAttrs",!0)}return n}return"object"==typeof e?this.each(function(){we.data(this,e)}):1<arguments.length?this.each(function(){we.data(this,e,t)}):a?V(a,e,we.data(a,e)):null},removeData:function(e){return this.each(function(){we.removeData(this,e)})}}),we.extend({queue:function(e,t,i){var r;if(e)return t=(t||"fx")+"queue",r=we._data(e,t),i&&(!r||we.isArray(i)?r=we._data(e,t,we.makeArray(i)):r.push(i)),r||[]},dequeue:function(e,t){t=t||"fx";var i=we.queue(e,t),r=i.length,n=i.shift(),o=we._queueHooks(e,t);"inprogress"===n&&(n=i.shift(),r--),n&&("fx"===t&&i.unshift("inprogress"),delete o.stop,n.call(e,function(){we.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return we._data(e,i)||we._data(e,i,{empty:we.Callbacks("once memory").add(function(){we._removeData(e,t+"queue"),we._removeData(e,i)})})}}),we.fn.extend({queue:function(t,i){var e=2;return"string"!=typeof t&&(i=t,t="fx",e--),arguments.length<e?we.queue(this[0],t):i===R?this:this.each(function(){var e=we.queue(this,t,i);we._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&we.dequeue(this,t)})},dequeue:function(e){return this.each(function(){we.dequeue(this,e)})},delay:function(r,e){return r=we.fx&&we.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var i=setTimeout(e,r);t.stop=function(){clearTimeout(i)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,r=1,n=we.Deferred(),o=this,a=this.length,s=function(){--r||n.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=R),e=e||"fx";a--;)(i=we._data(o[a],e+"queueHooks"))&&i.empty&&(r++,i.empty.add(s));return s(),n.promise(t)}});var O,j,G=/[\t\r\n\f]/g,W=/\r/g,q=/^(?:input|select|textarea|button|object)$/i,X=/^(?:a|area)$/i,Y=/^(?:checked|selected)$/i,K=we.support.getSetAttribute,$=we.support.input;we.fn.extend({attr:function(e,t){return we.access(this,we.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){we.removeAttr(this,e)})},prop:function(e,t){return we.access(this,we.prop,e,t,1<arguments.length)},removeProp:function(e){return e=we.propFix[e]||e,this.each(function(){try{this[e]=R,delete this[e]}catch(e){}})},addClass:function(t){var e,i,r,n,o,a=0,s=this.length,l="string"==typeof t&&t;if(we.isFunction(t))return this.each(function(e){we(this).addClass(t.call(this,e,this.className))});if(l)for(e=(t||"").match(w)||[];a<s;a++)if(r=1===(i=this[a]).nodeType&&(i.className?(" "+i.className+" ").replace(G," "):" ")){for(o=0;n=e[o++];)r.indexOf(" "+n+" ")<0&&(r+=n+" ");i.className=we.trim(r)}return this},removeClass:function(t){var e,i,r,n,o,a=0,s=this.length,l=0===arguments.length||"string"==typeof t&&t;if(we.isFunction(t))return this.each(function(e){we(this).removeClass(t.call(this,e,this.className))});if(l)for(e=(t||"").match(w)||[];a<s;a++)if(r=1===(i=this[a]).nodeType&&(i.className?(" "+i.className+" ").replace(G," "):"")){for(o=0;n=e[o++];)for(;0<=r.indexOf(" "+n+" ");)r=r.replace(" "+n+" "," ");i.className=t?we.trim(r):""}return this},toggleClass:function(o,a){var s=typeof o,l="boolean"==typeof a;return we.isFunction(o)?this.each(function(e){we(this).toggleClass(o.call(this,e,this.className,a),a)}):this.each(function(){if("string"===s)for(var e,t=0,i=we(this),r=a,n=o.match(w)||[];e=n[t++];)r=l?r:!i.hasClass(e),i[r?"addClass":"removeClass"](e);else s!==v&&"boolean"!==s||(this.className&&we._data(this,"__className__",this.className),this.className=this.className||!1===o?"":we._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",i=0,r=this.length;i<r;i++)if(1===this[i].nodeType&&0<=(" "+this[i].className+" ").replace(G," ").indexOf(t))return!0;return!1},val:function(i){var e,r,n,t=this[0];return arguments.length?(n=we.isFunction(i),this.each(function(e){var t;1===this.nodeType&&(null==(t=n?i.call(this,e,we(this).val()):i)?t="":"number"==typeof t?t+="":we.isArray(t)&&(t=we.map(t,function(e){return null==e?"":e+""})),(r=we.valHooks[this.type]||we.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&r.set(this,t,"value")!==R||(this.value=t))})):t?(r=we.valHooks[t.type]||we.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&(e=r.get(t,"value"))!==R?e:"string"==typeof(e=t.value)?e.replace(W,""):null==e?"":e:void 0}}),we.extend({valHooks:{option:{get:function(e){var t=we.find.attr(e,"value");return null!=t?t:e.text}},select:{get:function(e){for(var t,i,r=e.options,n=e.selectedIndex,o="select-one"===e.type||n<0,a=o?null:[],s=o?n+1:r.length,l=n<0?s:o?n:0;l<s;l++)if(((i=r[l]).selected||l===n)&&(we.support.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!we.nodeName(i.parentNode,"optgroup"))){if(t=we(i).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var i,r,n=e.options,o=we.makeArray(t),a=n.length;a--;)((r=n[a]).selected=0<=we.inArray(we(r).val(),o))&&(i=!0);return i||(e.selectedIndex=-1),o}}},attr:function(e,t,i){var r,n,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return typeof e.getAttribute===v?we.prop(e,t,i):(1===o&&we.isXMLDoc(e)||(t=t.toLowerCase(),r=we.attrHooks[t]||(we.expr.match.bool.test(t)?j:O)),i===R?r&&"get"in r&&null!==(n=r.get(e,t))?n:null==(n=we.find.attr(e,t))?R:n:null!==i?r&&"set"in r&&(n=r.set(e,i,t))!==R?n:(e.setAttribute(t,i+""),i):void we.removeAttr(e,t))},removeAttr:function(e,t){var i,r,n=0,o=t&&t.match(w);if(o&&1===e.nodeType)for(;i=o[n++];)r=we.propFix[i]||i,we.expr.match.bool.test(i)?$&&K||!Y.test(i)?e[r]=!1:e[we.camelCase("default-"+i)]=e[r]=!1:we.attr(e,i,""),e.removeAttribute(K?i:r)},attrHooks:{type:{set:function(e,t){if(!we.support.radioValue&&"radio"===t&&we.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},propFix:{for:"htmlFor",class:"className"},prop:function(e,t,i){var r,n,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return(1!==o||!we.isXMLDoc(e))&&(t=we.propFix[t]||t,n=we.propHooks[t]),i!==R?n&&"set"in n&&(r=n.set(e,i,t))!==R?r:e[t]=i:n&&"get"in n&&null!==(r=n.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=we.find.attr(e,"tabindex");return t?parseInt(t,10):q.test(e.nodeName)||X.test(e.nodeName)&&e.href?0:-1}}}}),j={set:function(e,t,i){return!1===t?we.removeAttr(e,i):$&&K||!Y.test(i)?e.setAttribute(!K&&we.propFix[i]||i,i):e[we.camelCase("default-"+i)]=e[i]=!0,i}},we.each(we.expr.match.bool.source.match(/\w+/g),function(e,t){var o=we.expr.attrHandle[t]||we.find.attr;we.expr.attrHandle[t]=$&&K||!Y.test(t)?function(e,t,i){var r=we.expr.attrHandle[t],n=i?R:(we.expr.attrHandle[t]=R)!=o(e,t,i)?t.toLowerCase():null;return we.expr.attrHandle[t]=r,n}:function(e,t,i){return i?R:e[we.camelCase("default-"+t)]?t.toLowerCase():null}}),$&&K||(we.attrHooks.value={set:function(e,t,i){if(!we.nodeName(e,"input"))return O&&O.set(e,t,i);e.defaultValue=t}}),K||(O={set:function(e,t,i){var r=e.getAttributeNode(i);return r||e.setAttributeNode(r=e.ownerDocument.createAttribute(i)),r.value=t+="","value"===i||t===e.getAttribute(i)?t:R}},we.expr.attrHandle.id=we.expr.attrHandle.name=we.expr.attrHandle.coords=function(e,t,i){var r;return i?R:(r=e.getAttributeNode(t))&&""!==r.value?r.value:null},we.valHooks.button={get:function(e,t){var i=e.getAttributeNode(t);return i&&i.specified?i.value:R},set:O.set},we.attrHooks.contenteditable={set:function(e,t,i){O.set(e,""!==t&&t,i)}},we.each(["width","height"],function(e,i){we.attrHooks[i]={set:function(e,t){if(""===t)return e.setAttribute(i,"auto"),t}}})),we.support.hrefNormalized||we.each(["href","src"],function(e,t){we.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),we.support.style||(we.attrHooks.style={get:function(e){return e.style.cssText||R},set:function(e,t){return e.style.cssText=t+""}}),we.support.optSelected||(we.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),we.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){we.propFix[this.toLowerCase()]=this}),we.support.enctype||(we.propFix.enctype="encoding"),we.each(["radio","checkbox"],function(){we.valHooks[this]={set:function(e,t){if(we.isArray(t))return e.checked=0<=we.inArray(we(e).val(),t)}},we.support.checkOn||(we.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Q=/^(?:input|select|textarea)$/i,Z=/^key/,J=/^(?:mouse|contextmenu)|click/,ee=/^(?:focusinfocus|focusoutblur)$/,te=/^([^.]*)(?:\.(.+)|)$/;function ie(){return!0}function re(){return!1}function ne(){try{return m.activeElement}catch(e){}}we.event={global:{},add:function(e,t,i,r,n){var o,a,s,l,h,c,u,p,d,f,m,E=we._data(e);if(E){for(i.handler&&(i=(l=i).handler,n=l.selector),i.guid||(i.guid=we.guid++),(a=E.events)||(a=E.events={}),(c=E.handle)||((c=E.handle=function(e){return typeof we===v||e&&we.event.triggered===e.type?R:we.event.dispatch.apply(c.elem,arguments)}).elem=e),s=(t=(t||"").match(w)||[""]).length;s--;)d=m=(o=te.exec(t[s])||[])[1],f=(o[2]||"").split(".").sort(),d&&(h=we.event.special[d]||{},d=(n?h.delegateType:h.bindType)||d,h=we.event.special[d]||{},u=we.extend({type:d,origType:m,data:r,handler:i,guid:i.guid,selector:n,needsContext:n&&we.expr.match.needsContext.test(n),namespace:f.join(".")},l),(p=a[d])||((p=a[d]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(e,r,f,c)||(e.addEventListener?e.addEventListener(d,c,!1):e.attachEvent&&e.attachEvent("on"+d,c))),h.add&&(h.add.call(e,u),u.handler.guid||(u.handler.guid=i.guid)),n?p.splice(p.delegateCount++,0,u):p.push(u),we.event.global[d]=!0);e=null}},remove:function(e,t,i,r,n){var o,a,s,l,h,c,u,p,d,f,m,E=we.hasData(e)&&we._data(e);if(E&&(c=E.events)){for(h=(t=(t||"").match(w)||[""]).length;h--;)if(d=m=(s=te.exec(t[h])||[])[1],f=(s[2]||"").split(".").sort(),d){for(u=we.event.special[d]||{},p=c[d=(r?u.delegateType:u.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=o=p.length;o--;)a=p[o],!n&&m!==a.origType||i&&i.guid!==a.guid||s&&!s.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(p.splice(o,1),a.selector&&p.delegateCount--,u.remove&&u.remove.call(e,a));l&&!p.length&&(u.teardown&&!1!==u.teardown.call(e,f,E.handle)||we.removeEvent(e,d,E.handle),delete c[d])}else for(d in c)we.event.remove(e,d+t[h],i,r,!0);we.isEmptyObject(c)&&(delete E.handle,we._removeData(e,"events"))}},trigger:function(e,t,i,r){var n,o,a,s,l,h,c,u=[i||m],p=g.call(e,"type")?e.type:e,d=g.call(e,"namespace")?e.namespace.split("."):[];if(a=h=i=i||m,3!==i.nodeType&&8!==i.nodeType&&!ee.test(p+we.event.triggered)&&(0<=p.indexOf(".")&&(p=(d=p.split(".")).shift(),d.sort()),o=p.indexOf(":")<0&&"on"+p,(e=e[we.expando]?e:new we.Event(p,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=d.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=R,e.target||(e.target=i),t=null==t?[e]:we.makeArray(t,[e]),l=we.event.special[p]||{},r||!l.trigger||!1!==l.trigger.apply(i,t))){if(!r&&!l.noBubble&&!we.isWindow(i)){for(s=l.delegateType||p,ee.test(s+p)||(a=a.parentNode);a;a=a.parentNode)u.push(a),h=a;h===(i.ownerDocument||m)&&u.push(h.defaultView||h.parentWindow||f)}for(c=0;(a=u[c++])&&!e.isPropagationStopped();)e.type=1<c?s:l.bindType||p,(n=(we._data(a,"events")||{})[e.type]&&we._data(a,"handle"))&&n.apply(a,t),(n=o&&a[o])&&we.acceptData(a)&&n.apply&&!1===n.apply(a,t)&&e.preventDefault();if(e.type=p,!r&&!e.isDefaultPrevented()&&(!l._default||!1===l._default.apply(u.pop(),t))&&we.acceptData(i)&&o&&i[p]&&!we.isWindow(i)){(h=i[o])&&(i[o]=null),we.event.triggered=p;try{i[p]()}catch(e){}we.event.triggered=R,h&&(i[o]=h)}return e.result}},dispatch:function(e){e=we.event.fix(e);var t,i,r,n,o,a,s=c.call(arguments),l=(we._data(this,"events")||{})[e.type]||[],h=we.event.special[e.type]||{};if((s[0]=e).delegateTarget=this,!h.preDispatch||!1!==h.preDispatch.call(this,e)){for(a=we.event.handlers.call(this,e,l),t=0;(n=a[t++])&&!e.isPropagationStopped();)for(e.currentTarget=n.elem,o=0;(r=n.handlers[o++])&&!e.isImmediatePropagationStopped();)e.namespace_re&&!e.namespace_re.test(r.namespace)||(e.handleObj=r,e.data=r.data,(i=((we.event.special[r.origType]||{}).handle||r.handler).apply(n.elem,s))!==R&&!1===(e.result=i)&&(e.preventDefault(),e.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,e),e.result}},handlers:function(e,t){var i,r,n,o,a=[],s=t.delegateCount,l=e.target;if(s&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(!0!==l.disabled||"click"!==e.type)){for(n=[],o=0;o<s;o++)n[i=(r=t[o]).selector+" "]===R&&(n[i]=r.needsContext?0<=we(i,this).index(l):we.find(i,this,null,[l]).length),n[i]&&n.push(r);n.length&&a.push({elem:l,handlers:n})}return s<t.length&&a.push({elem:this,handlers:t.slice(s)}),a},fix:function(e){if(e[we.expando])return e;var t,i,r,n=e.type,o=e,a=this.fixHooks[n];for(a||(this.fixHooks[n]=a=J.test(n)?this.mouseHooks:Z.test(n)?this.keyHooks:{}),r=a.props?this.props.concat(a.props):this.props,e=new we.Event(o),t=r.length;t--;)e[i=r[t]]=o[i];return e.target||(e.target=o.srcElement||m),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,a.filter?a.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var i,r,n,o=t.button,a=t.fromElement;return null==e.pageX&&null!=t.clientX&&(n=(r=e.target.ownerDocument||m).documentElement,i=r.body,e.pageX=t.clientX+(n&&n.scrollLeft||i&&i.scrollLeft||0)-(n&&n.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(n&&n.scrollTop||i&&i.scrollTop||0)-(n&&n.clientTop||i&&i.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?t.toElement:a),e.which||o===R||(e.which=1&o?1:2&o?3:4&o?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ne()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===ne()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(we.nodeName(this,"input")&&"checkbox"===this.type&&this.click)return this.click(),!1},_default:function(e){return we.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==R&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,i,r){var n=we.extend(new we.Event,i,{type:e,isSimulated:!0,originalEvent:{}});r?we.event.trigger(n,null,t):we.event.dispatch.call(t,n),n.isDefaultPrevented()&&i.preventDefault()}},we.removeEvent=m.removeEventListener?function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1)}:function(e,t,i){var r="on"+t;e.detachEvent&&(typeof e[r]===v&&(e[r]=null),e.detachEvent(r,i))},we.Event=function(e,t){if(!(this instanceof we.Event))return new we.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||!1===e.returnValue||e.getPreventDefault&&e.getPreventDefault()?ie:re):this.type=e,t&&we.extend(this,t),this.timeStamp=e&&e.timeStamp||we.now(),this[we.expando]=!0},we.Event.prototype={isDefaultPrevented:re,isPropagationStopped:re,isImmediatePropagationStopped:re,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=ie,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=ie,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=ie,this.stopPropagation()}},we.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,n){we.event.special[e]={delegateType:n,bindType:n,handle:function(e){var t,i=e.relatedTarget,r=e.handleObj;return i&&(i===this||we.contains(this,i))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=n),t}}}),we.support.submitBubbles||(we.event.special.submit={setup:function(){if(we.nodeName(this,"form"))return!1;we.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,i=we.nodeName(t,"input")||we.nodeName(t,"button")?t.form:R;i&&!we._data(i,"submitBubbles")&&(we.event.add(i,"submit._submit",function(e){e._submit_bubble=!0}),we._data(i,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&we.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(we.nodeName(this,"form"))return!1;we.event.remove(this,"._submit")}}),we.support.changeBubbles||(we.event.special.change={setup:function(){if(Q.test(this.nodeName))return"checkbox"!==this.type&&"radio"!==this.type||(we.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),we.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),we.event.simulate("change",this,e,!0)})),!1;we.event.add(this,"beforeactivate._change",function(e){var t=e.target;Q.test(t.nodeName)&&!we._data(t,"changeBubbles")&&(we.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||we.event.simulate("change",this.parentNode,e,!0)}),we._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type)return e.handleObj.handler.apply(this,arguments)},teardown:function(){return we.event.remove(this,"._change"),!Q.test(this.nodeName)}}),we.support.focusinBubbles||we.each({focus:"focusin",blur:"focusout"},function(e,t){var i=0,r=function(e){we.event.simulate(t,e.target,we.event.fix(e),!0)};we.event.special[t]={setup:function(){0==i++&&m.addEventListener(e,r,!0)},teardown:function(){0==--i&&m.removeEventListener(e,r,!0)}}}),we.fn.extend({on:function(e,t,i,r,n){var o,a;if("object"==typeof e){for(o in"string"!=typeof t&&(i=i||t,t=R),e)this.on(o,t,i,e[o],n);return this}if(null==i&&null==r?(r=t,i=t=R):null==r&&("string"==typeof t?(r=i,i=R):(r=i,i=t,t=R)),!1===r)r=re;else if(!r)return this;return 1===n&&(a=r,(r=function(e){return we().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=we.guid++)),this.each(function(){we.event.add(this,e,r,i,t)})},one:function(e,t,i,r){return this.on(e,t,i,r,1)},off:function(e,t,i){var r,n;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,we(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}return!1!==t&&"function"!=typeof t||(i=t,t=R),!1===i&&(i=re),this.each(function(){we.event.remove(this,e,i,t)})},trigger:function(e,t){return this.each(function(){we.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];if(i)return we.event.trigger(e,t,i,!0)}});var oe=/^.[^:#\[\.,]*$/,ae=/^(?:parents|prev(?:Until|All))/,se=we.expr.match.needsContext,le={children:!0,contents:!0,next:!0,prev:!0};function he(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function ce(e,i,r){if(we.isFunction(i))return we.grep(e,function(e,t){return!!i.call(e,t,e)!==r});if(i.nodeType)return we.grep(e,function(e){return e===i!==r});if("string"==typeof i){if(oe.test(i))return we.filter(i,e,r);i=we.filter(i,e)}return we.grep(e,function(e){return 0<=we.inArray(e,i)!==r})}function ue(e){var t=pe.split("|"),i=e.createDocumentFragment();if(i.createElement)for(;t.length;)i.createElement(t.pop());return i}we.fn.extend({find:function(e){var t,i=[],r=this,n=r.length;if("string"!=typeof e)return this.pushStack(we(e).filter(function(){for(t=0;t<n;t++)if(we.contains(r[t],this))return!0}));for(t=0;t<n;t++)we.find(e,r[t],i);return(i=this.pushStack(1<n?we.unique(i):i)).selector=this.selector?this.selector+" "+e:e,i},has:function(e){var t,i=we(e,this),r=i.length;return this.filter(function(){for(t=0;t<r;t++)if(we.contains(this,i[t]))return!0})},not:function(e){return this.pushStack(ce(this,e||[],!0))},filter:function(e){return this.pushStack(ce(this,e||[],!1))},is:function(e){return!!ce(this,"string"==typeof e&&se.test(e)?we(e):e||[],!1).length},closest:function(e,t){for(var i,r=0,n=this.length,o=[],a=se.test(e)||"string"!=typeof e?we(e,t||this.context):0;r<n;r++)for(i=this[r];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(a?-1<a.index(i):1===i.nodeType&&we.find.matchesSelector(i,e))){i=o.push(i);break}return this.pushStack(1<o.length?we.unique(o):o)},index:function(e){return e?"string"==typeof e?we.inArray(this[0],we(e)):we.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var i="string"==typeof e?we(e,t):we.makeArray(e&&e.nodeType?[e]:e),r=we.merge(this.get(),i);return this.pushStack(we.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),we.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return we.dir(e,"parentNode")},parentsUntil:function(e,t,i){return we.dir(e,"parentNode",i)},next:function(e){return he(e,"nextSibling")},prev:function(e){return he(e,"previousSibling")},nextAll:function(e){return we.dir(e,"nextSibling")},prevAll:function(e){return we.dir(e,"previousSibling")},nextUntil:function(e,t,i){return we.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return we.dir(e,"previousSibling",i)},siblings:function(e){return we.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return we.sibling(e.firstChild)},contents:function(e){return we.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:we.merge([],e.childNodes)}},function(r,n){we.fn[r]=function(e,t){var i=we.map(this,n,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(i=we.filter(t,i)),1<this.length&&(le[r]||(i=we.unique(i)),ae.test(r)&&(i=i.reverse())),this.pushStack(i)}}),we.extend({filter:function(e,t,i){var r=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?we.find.matchesSelector(r,e)?[r]:[]:we.find.matches(e,we.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,t,i){for(var r=[],n=e[t];n&&9!==n.nodeType&&(i===R||1!==n.nodeType||!we(n).is(i));)1===n.nodeType&&r.push(n),n=n[t];return r},sibling:function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i}});var pe="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",de=/ jQuery\d+="(?:null|\d+)"/g,fe=new RegExp("<(?:"+pe+")[\\s/>]","i"),me=/^\s+/,Ee=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ve=/<([\w:]+)/,ge=/<tbody/i,ye=/<|&#?\w+;/,Te=/<(?:script|style|link)/i,xe=/^(?:checkbox|radio)$/i,be=/checked\s*(?:[^=]|=\s*.checked.)/i,Re=/^$|\/(?:java|ecma)script/i,He=/^true\/(.*)/,_e=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Se={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:we.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Me=ue(m).appendChild(m.createElement("div"));function Ce(e,t){return we.nodeName(e,"table")&&we.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function Ae(e){return e.type=(null!==we.find.attr(e,"type"))+"/"+e.type,e}function Le(e){var t=He.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Pe(e,t){for(var i,r=0;null!=(i=e[r]);r++)we._data(i,"globalEval",!t||we._data(t[r],"globalEval"))}function De(e,t){if(1===t.nodeType&&we.hasData(e)){var i,r,n,o=we._data(e),a=we._data(t,o),s=o.events;if(s)for(i in delete a.handle,a.events={},s)for(r=0,n=s[i].length;r<n;r++)we.event.add(t,i,s[i][r]);a.data&&(a.data=we.extend({},a.data))}}function Fe(e,t){var i,r,n;if(1===t.nodeType){if(i=t.nodeName.toLowerCase(),!we.support.noCloneEvent&&t[we.expando]){for(r in(n=we._data(t)).events)we.removeEvent(t,r,n.handle);t.removeAttribute(we.expando)}"script"===i&&t.text!==e.text?(Ae(t).text=e.text,Le(t)):"object"===i?(t.parentNode&&(t.outerHTML=e.outerHTML),we.support.html5Clone&&e.innerHTML&&!we.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===i&&xe.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===i?t.defaultSelected=t.selected=e.defaultSelected:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}}function Ne(e,t){var i,r,n=0,o=typeof e.getElementsByTagName!==v?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==v?e.querySelectorAll(t||"*"):R;if(!o)for(o=[],i=e.childNodes||e;null!=(r=i[n]);n++)!t||we.nodeName(r,t)?o.push(r):we.merge(o,Ne(r,t));return t===R||t&&we.nodeName(e,t)?we.merge([e],o):o}function Ue(e){xe.test(e.type)&&(e.defaultChecked=e.checked)}Se.optgroup=Se.option,Se.tbody=Se.tfoot=Se.colgroup=Se.caption=Se.thead,Se.th=Se.td,we.fn.extend({text:function(e){return we.access(this,function(e){return e===R?we.text(this):this.empty().append((this[0]&&this[0].ownerDocument||m).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ce(this,e).appendChild(e)})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Ce(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var i,r=e?we.filter(e,this):this,n=0;null!=(i=r[n]);n++)t||1!==i.nodeType||we.cleanData(Ne(i)),i.parentNode&&(t&&we.contains(i.ownerDocument,i)&&Pe(Ne(i,"script")),i.parentNode.removeChild(i));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&we.cleanData(Ne(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&we.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return we.clone(this,e,t)})},html:function(e){return we.access(this,function(e){var t=this[0]||{},i=0,r=this.length;if(e===R)return 1===t.nodeType?t.innerHTML.replace(de,""):R;if("string"==typeof e&&!Te.test(e)&&(we.support.htmlSerialize||!fe.test(e))&&(we.support.leadingWhitespace||!me.test(e))&&!Se[(ve.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Ee,"<$1></$2>");try{for(;i<r;i++)1===(t=this[i]||{}).nodeType&&(we.cleanData(Ne(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var r=we.map(this,function(e){return[e.nextSibling,e.parentNode]}),n=0;return this.domManip(arguments,function(e){var t=r[n++],i=r[n++];i&&(t&&t.parentNode!==i&&(t=this.nextSibling),we(this).remove(),i.insertBefore(e,t))},!0),n?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(i,r,n){i=E.apply([],i);var e,t,o,a,s,l,h=0,c=this.length,u=this,p=c-1,d=i[0],f=we.isFunction(d);if(f||!(c<=1||"string"!=typeof d||we.support.checkClone)&&be.test(d))return this.each(function(e){var t=u.eq(e);f&&(i[0]=d.call(this,e,t.html())),t.domManip(i,r,n)});if(c&&(e=(l=we.buildFragment(i,this[0].ownerDocument,!1,!n&&this)).firstChild,1===l.childNodes.length&&(l=e),e)){for(o=(a=we.map(Ne(l,"script"),Ae)).length;h<c;h++)t=l,h!==p&&(t=we.clone(t,!0,!0),o&&we.merge(a,Ne(t,"script"))),r.call(this[h],t,h);if(o)for(s=a[a.length-1].ownerDocument,we.map(a,Le),h=0;h<o;h++)t=a[h],Re.test(t.type||"")&&!we._data(t,"globalEval")&&we.contains(s,t)&&(t.src?we._evalUrl(t.src):we.globalEval((t.text||t.textContent||t.innerHTML||"").replace(_e,"")));l=e=null}return this}}),we.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){we.fn[e]=function(e){for(var t,i=0,r=[],n=we(e),o=n.length-1;i<=o;i++)t=i===o?this:this.clone(!0),we(n[i])[a](t),l.apply(r,t.get());return this.pushStack(r)}}),we.extend({clone:function(e,t,i){var r,n,o,a,s,l=we.contains(e.ownerDocument,e);if(we.support.html5Clone||we.isXMLDoc(e)||!fe.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Me.innerHTML=e.outerHTML,Me.removeChild(o=Me.firstChild)),!(we.support.noCloneEvent&&we.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||we.isXMLDoc(e)))for(r=Ne(o),s=Ne(e),a=0;null!=(n=s[a]);++a)r[a]&&Fe(n,r[a]);if(t)if(i)for(s=s||Ne(e),r=r||Ne(o),a=0;null!=(n=s[a]);a++)De(n,r[a]);else De(e,o);return 0<(r=Ne(o,"script")).length&&Pe(r,!l&&Ne(e,"script")),r=s=n=null,o},buildFragment:function(e,t,i,r){for(var n,o,a,s,l,h,c,u=e.length,p=ue(t),d=[],f=0;f<u;f++)if((o=e[f])||0===o)if("object"===we.type(o))we.merge(d,o.nodeType?[o]:o);else if(ye.test(o)){for(s=s||p.appendChild(t.createElement("div")),l=(ve.exec(o)||["",""])[1].toLowerCase(),c=Se[l]||Se._default,s.innerHTML=c[1]+o.replace(Ee,"<$1></$2>")+c[2],n=c[0];n--;)s=s.lastChild;if(!we.support.leadingWhitespace&&me.test(o)&&d.push(t.createTextNode(me.exec(o)[0])),!we.support.tbody)for(n=(o="table"!==l||ge.test(o)?"<table>"!==c[1]||ge.test(o)?0:s:s.firstChild)&&o.childNodes.length;n--;)we.nodeName(h=o.childNodes[n],"tbody")&&!h.childNodes.length&&o.removeChild(h);for(we.merge(d,s.childNodes),s.textContent="";s.firstChild;)s.removeChild(s.firstChild);s=p.lastChild}else d.push(t.createTextNode(o));for(s&&p.removeChild(s),we.support.appendChecked||we.grep(Ne(d,"input"),Ue),f=0;o=d[f++];)if((!r||-1===we.inArray(o,r))&&(a=we.contains(o.ownerDocument,o),s=Ne(p.appendChild(o),"script"),a&&Pe(s),i))for(n=0;o=s[n++];)Re.test(o.type||"")&&i.push(o);return s=null,p},cleanData:function(e,t){for(var i,r,n,o,a=0,s=we.expando,l=we.cache,h=we.support.deleteExpando,c=we.event.special;null!=(i=e[a]);a++)if((t||we.acceptData(i))&&(o=(n=i[s])&&l[n])){if(o.events)for(r in o.events)c[r]?we.event.remove(i,r):we.removeEvent(i,r,o.handle);l[n]&&(delete l[n],h?delete i[s]:typeof i.removeAttribute!==v?i.removeAttribute(s):i[s]=null,u.push(n))}},_evalUrl:function(e){return we.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})}}),we.fn.extend({wrapAll:function(t){if(we.isFunction(t))return this.each(function(e){we(this).wrapAll(t.call(this,e))});if(this[0]){var e=we(t,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(i){return we.isFunction(i)?this.each(function(e){we(this).wrapInner(i.call(this,e))}):this.each(function(){var e=we(this),t=e.contents();t.length?t.wrapAll(i):e.append(i)})},wrap:function(t){var i=we.isFunction(t);return this.each(function(e){we(this).wrapAll(i?t.call(this,e):t)})},unwrap:function(){return this.parent().each(function(){we.nodeName(this,"body")||we(this).replaceWith(this.childNodes)}).end()}});var Be,ke,ze,Ve=/alpha\([^)]*\)/i,Ie=/opacity\s*=\s*([^)]*)/,Oe=/^(top|right|bottom|left)$/,je=/^(none|table(?!-c[ea]).+)/,Ge=/^margin/,We=new RegExp("^("+y+")(.*)$","i"),qe=new RegExp("^("+y+")(?!px)[a-z%]+$","i"),Xe=new RegExp("^([+-])=("+y+")","i"),Ye={BODY:"block"},Ke={position:"absolute",visibility:"hidden",display:"block"},$e={letterSpacing:0,fontWeight:400},Qe=["Top","Right","Bottom","Left"],Ze=["Webkit","O","Moz","ms"];function Je(e,t){if(t in e)return t;for(var i=t.charAt(0).toUpperCase()+t.slice(1),r=t,n=Ze.length;n--;)if((t=Ze[n]+i)in e)return t;return r}function et(e,t){return e=t||e,"none"===we.css(e,"display")||!we.contains(e.ownerDocument,e)}function tt(e,t){for(var i,r,n,o=[],a=0,s=e.length;a<s;a++)(r=e[a]).style&&(o[a]=we._data(r,"olddisplay"),i=r.style.display,t?(o[a]||"none"!==i||(r.style.display=""),""===r.style.display&&et(r)&&(o[a]=we._data(r,"olddisplay",ot(r.nodeName)))):o[a]||(n=et(r),(i&&"none"!==i||!n)&&we._data(r,"olddisplay",n?i:we.css(r,"display"))));for(a=0;a<s;a++)(r=e[a]).style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[a]||"":"none"));return e}function it(e,t,i){var r=We.exec(t);return r?Math.max(0,r[1]-(i||0))+(r[2]||"px"):t}function rt(e,t,i,r,n){for(var o=i===(r?"border":"content")?4:"width"===t?1:0,a=0;o<4;o+=2)"margin"===i&&(a+=we.css(e,i+Qe[o],!0,n)),r?("content"===i&&(a-=we.css(e,"padding"+Qe[o],!0,n)),"margin"!==i&&(a-=we.css(e,"border"+Qe[o]+"Width",!0,n))):(a+=we.css(e,"padding"+Qe[o],!0,n),"padding"!==i&&(a+=we.css(e,"border"+Qe[o]+"Width",!0,n)));return a}function nt(e,t,i){var r=!0,n="width"===t?e.offsetWidth:e.offsetHeight,o=ke(e),a=we.support.boxSizing&&"border-box"===we.css(e,"boxSizing",!1,o);if(n<=0||null==n){if(((n=ze(e,t,o))<0||null==n)&&(n=e.style[t]),qe.test(n))return n;r=a&&(we.support.boxSizingReliable||n===e.style[t]),n=parseFloat(n)||0}return n+rt(e,t,i||(a?"border":"content"),r,o)+"px"}function ot(e){var t=m,i=Ye[e];return i||("none"!==(i=at(e,t))&&i||((t=((Be=(Be||we("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement))[0].contentWindow||Be[0].contentDocument).document).write("<!doctype html><html><body>"),t.close(),i=at(e,t),Be.detach()),Ye[e]=i),i}function at(e,t){var i=we(t.createElement(e)).appendTo(t.body),r=we.css(i[0],"display");return i.remove(),r}we.fn.extend({css:function(e,t){return we.access(this,function(e,t,i){var r,n,o={},a=0;if(we.isArray(t)){for(n=ke(e),r=t.length;a<r;a++)o[t[a]]=we.css(e,t[a],!1,n);return o}return i!==R?we.style(e,t,i):we.css(e,t)},e,t,1<arguments.length)},show:function(){return tt(this,!0)},hide:function(){return tt(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:et(this))?we(this).show():we(this).hide()})}}),we.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=ze(e,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:we.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,i,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,o,a,s=we.camelCase(t),l=e.style;if(t=we.cssProps[s]||(we.cssProps[s]=Je(l,s)),a=we.cssHooks[t]||we.cssHooks[s],i===R)return a&&"get"in a&&(n=a.get(e,!1,r))!==R?n:l[t];if(!("string"===(o=typeof i)&&(n=Xe.exec(i))&&(i=(n[1]+1)*n[2]+parseFloat(we.css(e,t)),o="number"),null==i||"number"===o&&isNaN(i)||("number"!==o||we.cssNumber[s]||(i+="px"),we.support.clearCloneStyle||""!==i||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&(i=a.set(e,i,r))===R)))try{l[t]=i}catch(e){}}},css:function(e,t,i,r){var n,o,a,s=we.camelCase(t);return t=we.cssProps[s]||(we.cssProps[s]=Je(e.style,s)),(a=we.cssHooks[t]||we.cssHooks[s])&&"get"in a&&(o=a.get(e,!0,i)),o===R&&(o=ze(e,t,r)),"normal"===o&&t in $e&&(o=$e[t]),""===i||i?(n=parseFloat(o),!0===i||we.isNumeric(n)?n||0:o):o}}),f.getComputedStyle?(ke=function(e){return f.getComputedStyle(e,null)},ze=function(e,t,i){var r,n,o,a=i||ke(e),s=a?a.getPropertyValue(t)||a[t]:R,l=e.style;return a&&(""!==s||we.contains(e.ownerDocument,e)||(s=we.style(e,t)),qe.test(s)&&Ge.test(t)&&(r=l.width,n=l.minWidth,o=l.maxWidth,l.minWidth=l.maxWidth=l.width=s,s=a.width,l.width=r,l.minWidth=n,l.maxWidth=o)),s}):m.documentElement.currentStyle&&(ke=function(e){return e.currentStyle},ze=function(e,t,i){var r,n,o,a=i||ke(e),s=a?a[t]:R,l=e.style;return null==s&&l&&l[t]&&(s=l[t]),qe.test(s)&&!Oe.test(t)&&(r=l.left,(o=(n=e.runtimeStyle)&&n.left)&&(n.left=e.currentStyle.left),l.left="fontSize"===t?"1em":s,s=l.pixelLeft+"px",l.left=r,o&&(n.left=o)),""===s?"auto":s}),we.each(["height","width"],function(e,n){we.cssHooks[n]={get:function(e,t,i){if(t)return 0===e.offsetWidth&&je.test(we.css(e,"display"))?we.swap(e,Ke,function(){return nt(e,n,i)}):nt(e,n,i)},set:function(e,t,i){var r=i&&ke(e);return it(0,t,i?rt(e,n,i,we.support.boxSizing&&"border-box"===we.css(e,"boxSizing",!1,r),r):0)}}}),we.support.opacity||(we.cssHooks.opacity={get:function(e,t){return Ie.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var i=e.style,r=e.currentStyle,n=we.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||i.filter||"";((i.zoom=1)<=t||""===t)&&""===we.trim(o.replace(Ve,""))&&i.removeAttribute&&(i.removeAttribute("filter"),""===t||r&&!r.filter)||(i.filter=Ve.test(o)?o.replace(Ve,n):o+" "+n)}}),we(function(){we.support.reliableMarginRight||(we.cssHooks.marginRight={get:function(e,t){if(t)return we.swap(e,{display:"inline-block"},ze,[e,"marginRight"])}}),!we.support.pixelPosition&&we.fn.position&&we.each(["top","left"],function(e,i){we.cssHooks[i]={get:function(e,t){if(t)return t=ze(e,i),qe.test(t)?we(e).position()[i]+"px":t}}})}),we.expr&&we.expr.filters&&(we.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!we.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||we.css(e,"display"))},we.expr.filters.visible=function(e){return!we.expr.filters.hidden(e)}),we.each({margin:"",padding:"",border:"Width"},function(n,o){we.cssHooks[n+o]={expand:function(e){for(var t=0,i={},r="string"==typeof e?e.split(" "):[e];t<4;t++)i[n+Qe[t]+o]=r[t]||r[t-2]||r[0];return i}},Ge.test(n)||(we.cssHooks[n+o].set=it)});var st=/%20/g,lt=/\[\]$/,ht=/\r?\n/g,ct=/^(?:submit|button|image|reset|file)$/i,ut=/^(?:input|select|textarea|keygen)/i;function pt(i,e,r,n){var t;if(we.isArray(e))we.each(e,function(e,t){r||lt.test(i)?n(i,t):pt(i+"["+("object"==typeof t?e:"")+"]",t,r,n)});else if(r||"object"!==we.type(e))n(i,e);else for(t in e)pt(i+"["+t+"]",e[t],r,n)}we.fn.extend({serialize:function(){return we.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=we.prop(this,"elements");return e?we.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!we(this).is(":disabled")&&ut.test(this.nodeName)&&!ct.test(e)&&(this.checked||!xe.test(e))}).map(function(e,t){var i=we(this).val();return null==i?null:we.isArray(i)?we.map(i,function(e){return{name:t.name,value:e.replace(ht,"\r\n")}}):{name:t.name,value:i.replace(ht,"\r\n")}}).get()}}),we.param=function(e,t){var i,r=[],n=function(e,t){t=we.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(t===R&&(t=we.ajaxSettings&&we.ajaxSettings.traditional),we.isArray(e)||e.jquery&&!we.isPlainObject(e))we.each(e,function(){n(this.name,this.value)});else for(i in e)pt(i,e[i],t,n);return r.join("&").replace(st,"+")},we.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,i){we.fn[i]=function(e,t){return 0<arguments.length?this.on(i,null,e,t):this.trigger(i)}}),we.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,r){return this.on(t,e,i,r)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)}});var dt,ft,mt=we.now(),Et=/\?/,vt=/#.*$/,gt=/([?&])_=[^&]*/,yt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Tt=/^(?:GET|HEAD)$/,xt=/^\/\//,bt=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Rt=we.fn.load,wt={},Ht={},_t="*/".concat("*");try{ft=e.href}catch(e){(ft=m.createElement("a")).href="",ft=ft.href}function St(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var i,r=0,n=e.toLowerCase().match(w)||[];if(we.isFunction(t))for(;i=n[r++];)"+"===i[0]?(i=i.slice(1)||"*",(o[i]=o[i]||[]).unshift(t)):(o[i]=o[i]||[]).push(t)}}function Mt(t,n,o,a){var s={},l=t===Ht;function h(e){var r;return s[e]=!0,we.each(t[e]||[],function(e,t){var i=t(n,o,a);return"string"!=typeof i||l||s[i]?l?!(r=i):void 0:(n.dataTypes.unshift(i),h(i),!1)}),r}return h(n.dataTypes[0])||!s["*"]&&h("*")}function Ct(e,t){var i,r,n=we.ajaxSettings.flatOptions||{};for(r in t)t[r]!==R&&((n[r]?e:i||(i={}))[r]=t[r]);return i&&we.extend(!0,e,i),e}dt=bt.exec(ft.toLowerCase())||[],we.fn.load=function(e,t,i){if("string"!=typeof e&&Rt)return Rt.apply(this,arguments);var r,n,o,a=this,s=e.indexOf(" ");return 0<=s&&(r=e.slice(s,e.length),e=e.slice(0,s)),we.isFunction(t)?(i=t,t=R):t&&"object"==typeof t&&(o="POST"),0<a.length&&we.ajax({url:e,type:o,dataType:"html",data:t}).done(function(e){n=arguments,a.html(r?we("<div>").append(we.parseHTML(e)).find(r):e)}).complete(i&&function(e,t){a.each(i,n||[e.responseText,t,e])}),this},we.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){we.fn[t]=function(e){return this.on(t,e)}}),we.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ft,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(dt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":_t,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":we.parseJSON,"text xml":we.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ct(Ct(e,we.ajaxSettings),t):Ct(we.ajaxSettings,e)},ajaxPrefilter:St(wt),ajaxTransport:St(Ht),ajax:function(e,t){"object"==typeof e&&(t=e,e=R),t=t||{};var i,r,c,u,p,d,f,n,m=we.ajaxSetup({},t),E=m.context||m,v=m.context&&(E.nodeType||E.jquery)?we(E):we.event,g=we.Deferred(),y=we.Callbacks("once memory"),T=m.statusCode||{},o={},a={},x=0,s="canceled",b={readyState:0,getResponseHeader:function(e){var t;if(2===x){if(!n)for(n={};t=yt.exec(u);)n[t[1].toLowerCase()]=t[2];t=n[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===x?u:null},setRequestHeader:function(e,t){var i=e.toLowerCase();return x||(e=a[i]=a[i]||e,o[e]=t),this},overrideMimeType:function(e){return x||(m.mimeType=e),this},statusCode:function(e){var t;if(e)if(x<2)for(t in e)T[t]=[T[t],e[t]];else b.always(e[b.status]);return this},abort:function(e){var t=e||s;return f&&f.abort(t),l(0,t),this}};if(g.promise(b).complete=y.add,b.success=b.done,b.error=b.fail,m.url=((e||m.url||ft)+"").replace(vt,"").replace(xt,dt[1]+"//"),m.type=t.method||t.type||m.method||m.type,m.dataTypes=we.trim(m.dataType||"*").toLowerCase().match(w)||[""],null==m.crossDomain&&(i=bt.exec(m.url.toLowerCase()),m.crossDomain=!(!i||i[1]===dt[1]&&i[2]===dt[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(dt[3]||("http:"===dt[1]?"80":"443")))),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=we.param(m.data,m.traditional)),Mt(wt,m,t,b),2===x)return b;for(r in(d=m.global)&&0==we.active++&&we.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!Tt.test(m.type),c=m.url,m.hasContent||(m.data&&(c=m.url+=(Et.test(c)?"&":"?")+m.data,delete m.data),!1===m.cache&&(m.url=gt.test(c)?c.replace(gt,"$1_="+mt++):c+(Et.test(c)?"&":"?")+"_="+mt++)),m.ifModified&&(we.lastModified[c]&&b.setRequestHeader("If-Modified-Since",we.lastModified[c]),we.etag[c]&&b.setRequestHeader("If-None-Match",we.etag[c])),(m.data&&m.hasContent&&!1!==m.contentType||t.contentType)&&b.setRequestHeader("Content-Type",m.contentType),b.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+_t+"; q=0.01":""):m.accepts["*"]),m.headers)b.setRequestHeader(r,m.headers[r]);if(m.beforeSend&&(!1===m.beforeSend.call(E,b,m)||2===x))return b.abort();for(r in s="abort",{success:1,error:1,complete:1})b[r](m[r]);if(f=Mt(Ht,m,t,b)){b.readyState=1,d&&v.trigger("ajaxSend",[b,m]),m.async&&0<m.timeout&&(p=setTimeout(function(){b.abort("timeout")},m.timeout));try{x=1,f.send(o,l)}catch(e){if(!(x<2))throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,i,r){var n,o,a,s,l,h=t;2!==x&&(x=2,p&&clearTimeout(p),f=R,u=r||"",b.readyState=0<e?4:0,n=200<=e&&e<300||304===e,i&&(s=function(e,t,i){var r,n,o,a,s=e.contents,l=e.dataTypes;for(;"*"===l[0];)l.shift(),n===R&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n)for(a in s)if(s[a]&&s[a].test(n)){l.unshift(a);break}if(l[0]in i)o=l[0];else{for(a in i){if(!l[0]||e.converters[a+" "+l[0]]){o=a;break}r||(r=a)}o=o||r}if(o)return o!==l[0]&&l.unshift(o),i[o]}(m,b,i)),s=function(e,t,i,r){var n,o,a,s,l,h={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)h[a.toLowerCase()]=e.converters[a];o=c.shift();for(;o;)if(e.responseFields[o]&&(i[e.responseFields[o]]=t),!l&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(!(a=h[l+" "+o]||h["* "+o]))for(n in h)if((s=n.split(" "))[1]===o&&(a=h[l+" "+s[0]]||h["* "+s[0]])){!0===a?a=h[n]:!0!==h[n]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}(m,s,b,n),n?(m.ifModified&&((l=b.getResponseHeader("Last-Modified"))&&(we.lastModified[c]=l),(l=b.getResponseHeader("etag"))&&(we.etag[c]=l)),204===e||"HEAD"===m.type?h="nocontent":304===e?h="notmodified":(h=s.state,o=s.data,n=!(a=s.error))):(a=h,!e&&h||(h="error",e<0&&(e=0))),b.status=e,b.statusText=(t||h)+"",n?g.resolveWith(E,[o,h,b]):g.rejectWith(E,[b,h,a]),b.statusCode(T),T=R,d&&v.trigger(n?"ajaxSuccess":"ajaxError",[b,m,n?o:a]),y.fireWith(E,[b,h]),d&&(v.trigger("ajaxComplete",[b,m]),--we.active||we.event.trigger("ajaxStop")))}return b},getJSON:function(e,t,i){return we.get(e,t,i,"json")},getScript:function(e,t){return we.get(e,R,t,"script")}}),we.each(["get","post"],function(e,n){we[n]=function(e,t,i,r){return we.isFunction(t)&&(r=r||i,i=t,t=R),we.ajax({url:e,type:n,dataType:r,data:t,success:i})}}),we.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return we.globalEval(e),e}}}),we.ajaxPrefilter("script",function(e){e.cache===R&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),we.ajaxTransport("script",function(t){if(t.crossDomain){var r,n=m.head||we("head")[0]||m.documentElement;return{send:function(e,i){(r=m.createElement("script")).async=!0,t.scriptCharset&&(r.charset=t.scriptCharset),r.src=t.url,r.onload=r.onreadystatechange=function(e,t){(t||!r.readyState||/loaded|complete/.test(r.readyState))&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),r=null,t||i(200,"success"))},n.insertBefore(r,n.firstChild)},abort:function(){r&&r.onload(R,!0)}}}});var At=[],Lt=/(=)\?(?=&|$)|\?\?/;we.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=At.pop()||we.expando+"_"+mt++;return this[e]=!0,e}}),we.ajaxPrefilter("json jsonp",function(e,t,i){var r,n,o,a=!1!==e.jsonp&&(Lt.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Lt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=we.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Lt,"$1"+r):!1!==e.jsonp&&(e.url+=(Et.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||we.error(r+" was not called"),o[0]},e.dataTypes[0]="json",n=f[r],f[r]=function(){o=arguments},i.always(function(){f[r]=n,e[r]&&(e.jsonpCallback=t.jsonpCallback,At.push(r)),o&&we.isFunction(n)&&n(o[0]),o=n=R}),"script"});var Pt,Dt,Ft=0,Nt=f.ActiveXObject&&function(){var e;for(e in Pt)Pt[e](R,!0)};function Ut(){try{return new f.XMLHttpRequest}catch(e){}}we.ajaxSettings.xhr=f.ActiveXObject?function(){return!this.isLocal&&Ut()||function(){try{return new f.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}()}:Ut,Dt=we.ajaxSettings.xhr(),we.support.cors=!!Dt&&"withCredentials"in Dt,(Dt=we.support.ajax=!!Dt)&&we.ajaxTransport(function(h){var c;if(!h.crossDomain||we.support.cors)return{send:function(e,a){var s,t,l=h.xhr();if(h.username?l.open(h.type,h.url,h.async,h.username,h.password):l.open(h.type,h.url,h.async),h.xhrFields)for(t in h.xhrFields)l[t]=h.xhrFields[t];h.mimeType&&l.overrideMimeType&&l.overrideMimeType(h.mimeType),h.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");try{for(t in e)l.setRequestHeader(t,e[t])}catch(e){}l.send(h.hasContent&&h.data||null),c=function(e,t){var i,r,n,o;try{if(c&&(t||4===l.readyState))if(c=R,s&&(l.onreadystatechange=we.noop,Nt&&delete Pt[s]),t)4!==l.readyState&&l.abort();else{o={},i=l.status,r=l.getAllResponseHeaders(),"string"==typeof l.responseText&&(o.text=l.responseText);try{n=l.statusText}catch(e){n=""}i||!h.isLocal||h.crossDomain?1223===i&&(i=204):i=o.text?200:404}}catch(e){t||a(-1,e)}o&&a(i,n,o,r)},h.async?4===l.readyState?setTimeout(c):(s=++Ft,Nt&&(Pt||(Pt={},we(f).unload(Nt)),Pt[s]=c),l.onreadystatechange=c):c()},abort:function(){c&&c(R,!0)}}});var Bt,kt,zt=/^(?:toggle|show|hide)$/,Vt=new RegExp("^(?:([+-])=|)("+y+")([a-z%]*)$","i"),It=/queueHooks$/,Ot=[function(t,e,i){var r,n,o,a,s,l,h=this,c={},u=t.style,p=t.nodeType&&et(t),d=we._data(t,"fxshow");i.queue||(null==(s=we._queueHooks(t,"fx")).unqueued&&(s.unqueued=0,l=s.empty.fire,s.empty.fire=function(){s.unqueued||l()}),s.unqueued++,h.always(function(){h.always(function(){s.unqueued--,we.queue(t,"fx").length||s.empty.fire()})}));1===t.nodeType&&("height"in e||"width"in e)&&(i.overflow=[u.overflow,u.overflowX,u.overflowY],"inline"===we.css(t,"display")&&"none"===we.css(t,"float")&&(we.support.inlineBlockNeedsLayout&&"inline"!==ot(t.nodeName)?u.zoom=1:u.display="inline-block"));i.overflow&&(u.overflow="hidden",we.support.shrinkWrapBlocks||h.always(function(){u.overflow=i.overflow[0],u.overflowX=i.overflow[1],u.overflowY=i.overflow[2]}));for(r in e)if(n=e[r],zt.exec(n)){if(delete e[r],o=o||"toggle"===n,n===(p?"hide":"show"))continue;c[r]=d&&d[r]||we.style(t,r)}if(!we.isEmptyObject(c))for(r in d?"hidden"in d&&(p=d.hidden):d=we._data(t,"fxshow",{}),o&&(d.hidden=!p),p?we(t).show():h.done(function(){we(t).hide()}),h.done(function(){var e;for(e in we._removeData(t,"fxshow"),c)we.style(t,e,c[e])}),c)a=Wt(p?d[r]:0,r,h),r in d||(d[r]=a.start,p&&(a.end=a.start,a.start="width"===r||"height"===r?1:0))}],jt={"*":[function(e,t){var i=this.createTween(e,t),r=i.cur(),n=Vt.exec(t),o=n&&n[3]||(we.cssNumber[e]?"":"px"),a=(we.cssNumber[e]||"px"!==o&&+r)&&Vt.exec(we.css(i.elem,e)),s=1,l=20;if(a&&a[3]!==o)for(o=o||a[3],n=n||[],a=+r||1;a/=s=s||".5",we.style(i.elem,e,a+o),s!==(s=i.cur()/r)&&1!==s&&--l;);return n&&(a=i.start=+a||+r||0,i.unit=o,i.end=n[1]?a+(n[1]+1)*n[2]:+n[2]),i}]};function Gt(){return setTimeout(function(){Bt=R}),Bt=we.now()}function Wt(e,t,i){for(var r,n=(jt[t]||[]).concat(jt["*"]),o=0,a=n.length;o<a;o++)if(r=n[o].call(i,t,e))return r}function qt(o,e,t){var i,a,r=0,n=Ot.length,s=we.Deferred().always(function(){delete l.elem}),l=function(){if(a)return!1;for(var e=Bt||Gt(),t=Math.max(0,h.startTime+h.duration-e),i=1-(t/h.duration||0),r=0,n=h.tweens.length;r<n;r++)h.tweens[r].run(i);return s.notifyWith(o,[h,i,t]),i<1&&n?t:(s.resolveWith(o,[h]),!1)},h=s.promise({elem:o,props:we.extend({},e),opts:we.extend(!0,{specialEasing:{}},t),originalProperties:e,originalOptions:t,startTime:Bt||Gt(),duration:t.duration,tweens:[],createTween:function(e,t){var i=we.Tween(o,h.opts,e,t,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(i),i},stop:function(e){var t=0,i=e?h.tweens.length:0;if(a)return this;for(a=!0;t<i;t++)h.tweens[t].run(1);return e?s.resolveWith(o,[h,e]):s.rejectWith(o,[h,e]),this}}),c=h.props;for(!function(e,t){var i,r,n,o,a;for(i in e)if(r=we.camelCase(i),n=t[r],o=e[i],we.isArray(o)&&(n=o[1],o=e[i]=o[0]),i!==r&&(e[r]=o,delete e[i]),(a=we.cssHooks[r])&&"expand"in a)for(i in o=a.expand(o),delete e[r],o)i in e||(e[i]=o[i],t[i]=n);else t[r]=n}(c,h.opts.specialEasing);r<n;r++)if(i=Ot[r].call(h,o,c,h.opts))return i;return we.map(c,Wt,h),we.isFunction(h.opts.start)&&h.opts.start.call(o,h),we.fx.timer(we.extend(l,{elem:o,anim:h,queue:h.opts.queue})),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always)}function Xt(e,t,i,r,n){return new Xt.prototype.init(e,t,i,r,n)}function Yt(e,t){var i,r={height:e},n=0;for(t=t?1:0;n<4;n+=2-t)r["margin"+(i=Qe[n])]=r["padding"+i]=e;return t&&(r.opacity=r.width=e),r}function Kt(e){return we.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}we.Animation=we.extend(qt,{tweener:function(e,t){we.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var i,r=0,n=e.length;r<n;r++)i=e[r],jt[i]=jt[i]||[],jt[i].unshift(t)},prefilter:function(e,t){t?Ot.unshift(e):Ot.push(e)}}),((we.Tween=Xt).prototype={constructor:Xt,init:function(e,t,i,r,n,o){this.elem=e,this.prop=i,this.easing=n||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(we.cssNumber[i]?"":"px")},cur:function(){var e=Xt.propHooks[this.prop];return e&&e.get?e.get(this):Xt.propHooks._default.get(this)},run:function(e){var t,i=Xt.propHooks[this.prop];return this.options.duration?this.pos=t=we.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):Xt.propHooks._default.set(this),this}}).init.prototype=Xt.prototype,(Xt.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=we.css(e.elem,e.prop,""))&&"auto"!==t?t:0:e.elem[e.prop]},set:function(e){we.fx.step[e.prop]?we.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[we.cssProps[e.prop]]||we.cssHooks[e.prop])?we.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}}).scrollTop=Xt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},we.each(["toggle","show","hide"],function(e,r){var n=we.fn[r];we.fn[r]=function(e,t,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(Yt(r,!0),e,t,i)}}),we.fn.extend({fadeTo:function(e,t,i,r){return this.filter(et).css("opacity",0).show().end().animate({opacity:t},e,i,r)},animate:function(t,e,i,r){var n=we.isEmptyObject(t),o=we.speed(e,i,r),a=function(){var e=qt(this,we.extend({},t),o);(n||we._data(this,"finish"))&&e.stop(!0)};return a.finish=a,n||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(n,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof n&&(o=e,e=n,n=R),e&&!1!==n&&this.queue(n||"fx",[]),this.each(function(){var e=!0,t=null!=n&&n+"queueHooks",i=we.timers,r=we._data(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&It.test(t)&&a(r[t]);for(t=i.length;t--;)i[t].elem!==this||null!=n&&i[t].queue!==n||(i[t].anim.stop(o),e=!1,i.splice(t,1));!e&&o||we.dequeue(this,n)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=we._data(this),i=t[a+"queue"],r=t[a+"queueHooks"],n=we.timers,o=i?i.length:0;for(t.finish=!0,we.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=n.length;e--;)n[e].elem===this&&n[e].queue===a&&(n[e].anim.stop(!0),n.splice(e,1));for(e=0;e<o;e++)i[e]&&i[e].finish&&i[e].finish.call(this);delete t.finish})}}),we.each({slideDown:Yt("show"),slideUp:Yt("hide"),slideToggle:Yt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){we.fn[e]=function(e,t,i){return this.animate(r,e,t,i)}}),we.speed=function(e,t,i){var r=e&&"object"==typeof e?we.extend({},e):{complete:i||!i&&t||we.isFunction(e)&&e,duration:e,easing:i&&t||t&&!we.isFunction(t)&&t};return r.duration=we.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in we.fx.speeds?we.fx.speeds[r.duration]:we.fx.speeds._default,null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){we.isFunction(r.old)&&r.old.call(this),r.queue&&we.dequeue(this,r.queue)},r},we.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},we.timers=[],we.fx=Xt.prototype.init,we.fx.tick=function(){var e,t=we.timers,i=0;for(Bt=we.now();i<t.length;i++)(e=t[i])()||t[i]!==e||t.splice(i--,1);t.length||we.fx.stop(),Bt=R},we.fx.timer=function(e){e()&&we.timers.push(e)&&we.fx.start()},we.fx.interval=13,we.fx.start=function(){kt||(kt=setInterval(we.fx.tick,we.fx.interval))},we.fx.stop=function(){clearInterval(kt),kt=null},we.fx.speeds={slow:600,fast:200,_default:400},we.fx.step={},we.expr&&we.expr.filters&&(we.expr.filters.animated=function(t){return we.grep(we.timers,function(e){return t===e.elem}).length}),we.fn.offset=function(t){if(arguments.length)return t===R?this:this.each(function(e){we.offset.setOffset(this,t,e)});var e,i,r={top:0,left:0},n=this[0],o=n&&n.ownerDocument;return o?(e=o.documentElement,we.contains(e,n)?(typeof n.getBoundingClientRect!==v&&(r=n.getBoundingClientRect()),i=Kt(o),{top:r.top+(i.pageYOffset||e.scrollTop)-(e.clientTop||0),left:r.left+(i.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}):r):void 0},we.offset={setOffset:function(e,t,i){var r=we.css(e,"position");"static"===r&&(e.style.position="relative");var n,o,a=we(e),s=a.offset(),l=we.css(e,"top"),h=we.css(e,"left"),c={},u={};("absolute"===r||"fixed"===r)&&-1<we.inArray("auto",[l,h])?(n=(u=a.position()).top,o=u.left):(n=parseFloat(l)||0,o=parseFloat(h)||0),we.isFunction(t)&&(t=t.call(e,i,s)),null!=t.top&&(c.top=t.top-s.top+n),null!=t.left&&(c.left=t.left-s.left+o),"using"in t?t.using.call(e,c):a.css(c)}},we.fn.extend({position:function(){if(this[0]){var e,t,i={top:0,left:0},r=this[0];return"fixed"===we.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),we.nodeName(e[0],"html")||(i=e.offset()),i.top+=we.css(e[0],"borderTopWidth",!0),i.left+=we.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-we.css(r,"marginTop",!0),left:t.left-i.left-we.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||r;e&&!we.nodeName(e,"html")&&"static"===we.css(e,"position");)e=e.offsetParent;return e||r})}}),we.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var o=/Y/.test(n);we.fn[t]=function(e){return we.access(this,function(e,t,i){var r=Kt(e);if(i===R)return r?n in r?r[n]:r.document.documentElement[t]:e[t];r?r.scrollTo(o?we(r).scrollLeft():i,o?i:we(r).scrollTop()):e[t]=i},t,e,arguments.length,null)}}),we.each({Height:"height",Width:"width"},function(o,a){we.each({padding:"inner"+o,content:a,"":"outer"+o},function(r,e){we.fn[e]=function(e,t){var i=arguments.length&&(r||"boolean"!=typeof e),n=r||(!0===e||!0===t?"margin":"border");return we.access(this,function(e,t,i){var r;return we.isWindow(e)?e.document.documentElement["client"+o]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+o],r["scroll"+o],e.body["offset"+o],r["offset"+o],r["client"+o])):i===R?we.css(e,t,n):we.style(e,t,i,n)},a,i?e:R,i,null)}})}),we.fn.size=function(){return this.length},we.fn.andSelf=we.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=we:(f.jQuery=f.$=we,"function"==typeof define&&define.amd&&define("jquery",[],function(){return we}))}(window),function(){var e=this,t=e._,a={},n=Array.prototype,i=Object.prototype,r=Function.prototype,s=n.slice,o=n.unshift,h=i.toString,l=i.hasOwnProperty,c=n.forEach,u=n.map,p=n.reduce,d=n.reduceRight,f=n.filter,m=n.every,E=n.some,v=n.indexOf,g=n.lastIndexOf,y=Array.isArray,T=Object.keys,x=r.bind,b=function(e){return new D(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports._=b):e._=b,b.VERSION="1.3.3";var R=b.each=b.forEach=function(e,t,i){if(null!=e)if(c&&e.forEach===c)e.forEach(t,i);else if(e.length===+e.length){for(var r=0,n=e.length;r<n;r++)if(r in e&&t.call(i,e[r],r,e)===a)return}else for(var o in e)if(b.has(e,o)&&t.call(i,e[o],o,e)===a)return};b.map=b.collect=function(e,r,n){var o=[];return null==e?o:u&&e.map===u?e.map(r,n):(R(e,function(e,t,i){o[o.length]=r.call(n,e,t,i)}),e.length===+e.length&&(o.length=e.length),o)},b.reduce=b.foldl=b.inject=function(e,r,n,o){var a=2<arguments.length;if(null==e&&(e=[]),p&&e.reduce===p)return o&&(r=b.bind(r,o)),a?e.reduce(r,n):e.reduce(r);if(R(e,function(e,t,i){a?n=r.call(o,n,e,t,i):(n=e,a=!0)}),!a)throw new TypeError("Reduce of empty array with no initial value");return n},b.reduceRight=b.foldr=function(e,t,i,r){var n=2<arguments.length;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=b.bind(t,r)),n?e.reduceRight(t,i):e.reduceRight(t);var o=b.toArray(e).reverse();return r&&!n&&(t=b.bind(t,r)),n?b.reduce(o,t,i,r):b.reduce(o,t)},b.find=b.detect=function(e,r,n){var o;return w(e,function(e,t,i){if(r.call(n,e,t,i))return o=e,!0}),o},b.filter=b.select=function(e,r,n){var o=[];return null==e?o:f&&e.filter===f?e.filter(r,n):(R(e,function(e,t,i){r.call(n,e,t,i)&&(o[o.length]=e)}),o)},b.reject=function(e,r,n){var o=[];return null==e||R(e,function(e,t,i){r.call(n,e,t,i)||(o[o.length]=e)}),o},b.every=b.all=function(e,r,n){var o=!0;return null==e?o:m&&e.every===m?e.every(r,n):(R(e,function(e,t,i){if(!(o=o&&r.call(n,e,t,i)))return a}),!!o)};var w=b.some=b.any=function(e,r,n){r||(r=b.identity);var o=!1;return null==e?o:E&&e.some===E?e.some(r,n):(R(e,function(e,t,i){if(o||(o=r.call(n,e,t,i)))return a}),!!o)};b.include=b.contains=function(e,t){var i=!1;return null==e?i:v&&e.indexOf===v?-1!=e.indexOf(t):i=w(e,function(e){return e===t})},b.invoke=function(e,t){var i=s.call(arguments,2);return b.map(e,function(e){return(b.isFunction(t)?t||e:e[t]).apply(e,i)})},b.pluck=function(e,t){return b.map(e,function(e){return e[t]})},b.max=function(e,n,o){if(!n&&b.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!n&&b.isEmpty(e))return-1/0;var a={computed:-1/0};return R(e,function(e,t,i){var r=n?n.call(o,e,t,i):e;r>=a.computed&&(a={value:e,computed:r})}),a.value},b.min=function(e,n,o){if(!n&&b.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!n&&b.isEmpty(e))return 1/0;var a={computed:1/0};return R(e,function(e,t,i){var r=n?n.call(o,e,t,i):e;r<a.computed&&(a={value:e,computed:r})}),a.value},b.shuffle=function(e){var r,n=[];return R(e,function(e,t,i){r=Math.floor(Math.random()*(t+1)),n[t]=n[r],n[r]=e}),n},b.sortBy=function(e,t,r){var n=b.isFunction(t)?t:function(e){return e[t]};return b.pluck(b.map(e,function(e,t,i){return{value:e,criteria:n.call(r,e,t,i)}}).sort(function(e,t){var i=e.criteria,r=t.criteria;return void 0===i?1:void 0===r?-1:i<r?-1:r<i?1:0}),"value")},b.groupBy=function(e,t){var r={},n=b.isFunction(t)?t:function(e){return e[t]};return R(e,function(e,t){var i=n(e,t);(r[i]||(r[i]=[])).push(e)}),r},b.sortedIndex=function(e,t,i){i||(i=b.identity);for(var r=0,n=e.length;r<n;){var o=r+n>>1;i(e[o])<i(t)?r=o+1:n=o}return r},b.toArray=function(e){return e?b.isArray(e)?s.call(e):b.isArguments(e)?s.call(e):e.toArray&&b.isFunction(e.toArray)?e.toArray():b.values(e):[]},b.size=function(e){return b.isArray(e)?e.length:b.keys(e).length},b.first=b.head=b.take=function(e,t,i){return null==t||i?e[0]:s.call(e,0,t)},b.initial=function(e,t,i){return s.call(e,0,e.length-(null==t||i?1:t))},b.last=function(e,t,i){return null==t||i?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},b.rest=b.tail=function(e,t,i){return s.call(e,null==t||i?1:t)},b.compact=function(e){return b.filter(e,function(e){return!!e})},b.flatten=function(e,i){return b.reduce(e,function(e,t){return b.isArray(t)?e.concat(i?t:b.flatten(t)):(e[e.length]=t,e)},[])},b.without=function(e){return b.difference(e,s.call(arguments,1))},b.uniq=b.unique=function(r,n,e){var t=e?b.map(r,e):r,o=[];return r.length<3&&(n=!0),b.reduce(t,function(e,t,i){return(n?b.last(e)===t&&e.length:b.include(e,t))||(e.push(t),o.push(r[i])),e},[]),o},b.union=function(){return b.uniq(b.flatten(arguments,!0))},b.intersection=b.intersect=function(e){var i=s.call(arguments,1);return b.filter(b.uniq(e),function(t){return b.every(i,function(e){return 0<=b.indexOf(e,t)})})},b.difference=function(e){var t=b.flatten(s.call(arguments,1),!0);return b.filter(e,function(e){return!b.include(t,e)})},b.zip=function(){for(var e=s.call(arguments),t=b.max(b.pluck(e,"length")),i=new Array(t),r=0;r<t;r++)i[r]=b.pluck(e,""+r);return i},b.indexOf=function(e,t,i){if(null==e)return-1;var r,n;if(i)return e[r=b.sortedIndex(e,t)]===t?r:-1;if(v&&e.indexOf===v)return e.indexOf(t);for(r=0,n=e.length;r<n;r++)if(r in e&&e[r]===t)return r;return-1},b.lastIndexOf=function(e,t){if(null==e)return-1;if(g&&e.lastIndexOf===g)return e.lastIndexOf(t);for(var i=e.length;i--;)if(i in e&&e[i]===t)return i;return-1},b.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=i||1;for(var r=Math.max(Math.ceil((t-e)/i),0),n=0,o=new Array(r);n<r;)o[n++]=e,e+=i;return o};var H=function(){};b.bind=function(i,r){var n,o;if(i.bind===x&&x)return x.apply(i,s.call(arguments,1));if(!b.isFunction(i))throw new TypeError;return o=s.call(arguments,2),n=function(){if(!(this instanceof n))return i.apply(r,o.concat(s.call(arguments)));H.prototype=i.prototype;var e=new H,t=i.apply(e,o.concat(s.call(arguments)));return Object(t)===t?t:e}},b.bindAll=function(t){var e=s.call(arguments,1);return 0==e.length&&(e=b.functions(t)),R(e,function(e){t[e]=b.bind(t[e],t)}),t},b.memoize=function(t,i){var r={};return i||(i=b.identity),function(){var e=i.apply(this,arguments);return b.has(r,e)?r[e]:r[e]=t.apply(this,arguments)}},b.delay=function(e,t){var i=s.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},b.defer=function(e){return b.delay.apply(b,[e,1].concat(s.call(arguments,1)))},b.throttle=function(e,t){var i,r,n,o,a,s,l=b.debounce(function(){a=o=!1},t);return function(){i=this,r=arguments;return n||(n=setTimeout(function(){n=null,a&&e.apply(i,r),l()},t)),o?a=!0:s=e.apply(i,r),l(),o=!0,s}},b.debounce=function(i,r,n){var o;return function(){var e=this,t=arguments;n&&!o&&i.apply(e,t),clearTimeout(o),o=setTimeout(function(){o=null,n||i.apply(e,t)},r)}},b.once=function(e){var t,i=!1;return function(){return i?t:(i=!0,t=e.apply(this,arguments))}},b.wrap=function(t,i){return function(){var e=[t].concat(s.call(arguments,0));return i.apply(this,e)}},b.compose=function(){var i=arguments;return function(){for(var e=arguments,t=i.length-1;0<=t;t--)e=[i[t].apply(this,e)];return e[0]}},b.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},b.keys=T||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var i in e)b.has(e,i)&&(t[t.length]=i);return t},b.values=function(e){return b.map(e,b.identity)},b.functions=b.methods=function(e){var t=[];for(var i in e)b.isFunction(e[i])&&t.push(i);return t.sort()},b.extend=function(i){return R(s.call(arguments,1),function(e){for(var t in e)i[t]=e[t]}),i},b.pick=function(t){var i={};return R(b.flatten(s.call(arguments,1)),function(e){e in t&&(i[e]=t[e])}),i},b.defaults=function(i){return R(s.call(arguments,1),function(e){for(var t in e)null==i[t]&&(i[t]=e[t])}),i},b.clone=function(e){return b.isObject(e)?b.isArray(e)?e.slice():b.extend({},e):e},b.tap=function(e,t){return t(e),e},b.isEqual=function(e,t){return function e(t,i,r){if(t===i)return 0!==t||1/t==1/i;if(null==t||null==i)return t===i;if(t._chain&&(t=t._wrapped),i._chain&&(i=i._wrapped),t.isEqual&&b.isFunction(t.isEqual))return t.isEqual(i);if(i.isEqual&&b.isFunction(i.isEqual))return i.isEqual(t);var n=h.call(t);if(n!=h.call(i))return!1;switch(n){case"[object String]":return t==String(i);case"[object Number]":return t!=+t?i!=+i:0==t?1/t==1/i:t==+i;case"[object Date]":case"[object Boolean]":return+t==+i;case"[object RegExp]":return t.source==i.source&&t.global==i.global&&t.multiline==i.multiline&&t.ignoreCase==i.ignoreCase}if("object"!=typeof t||"object"!=typeof i)return!1;for(var o=r.length;o--;)if(r[o]==t)return!0;r.push(t);var a=0,s=!0;if("[object Array]"==n){if(s=(a=t.length)==i.length)for(;a--&&(s=a in t==a in i&&e(t[a],i[a],r)););}else{if("constructor"in t!="constructor"in i||t.constructor!=i.constructor)return!1;for(var l in t)if(b.has(t,l)&&(a++,!(s=b.has(i,l)&&e(t[l],i[l],r))))break;if(s){for(l in i)if(b.has(i,l)&&!a--)break;s=!a}}return r.pop(),s}(e,t,[])},b.isEmpty=function(e){if(null==e)return!0;if(b.isArray(e)||b.isString(e))return 0===e.length;for(var t in e)if(b.has(e,t))return!1;return!0},b.isElement=function(e){return!(!e||1!=e.nodeType)},b.isArray=y||function(e){return"[object Array]"==h.call(e)},b.isObject=function(e){return e===Object(e)},b.isArguments=function(e){return"[object Arguments]"==h.call(e)},b.isArguments(arguments)||(b.isArguments=function(e){return!(!e||!b.has(e,"callee"))}),b.isFunction=function(e){return"[object Function]"==h.call(e)},b.isString=function(e){return"[object String]"==h.call(e)},b.isNumber=function(e){return"[object Number]"==h.call(e)},b.isFinite=function(e){return b.isNumber(e)&&isFinite(e)},b.isNaN=function(e){return e!=e},b.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==h.call(e)},b.isDate=function(e){return"[object Date]"==h.call(e)},b.isRegExp=function(e){return"[object RegExp]"==h.call(e)},b.isNull=function(e){return null===e},b.isUndefined=function(e){return void 0===e},b.has=function(e,t){return l.call(e,t)},b.noConflict=function(){return e._=t,this},b.identity=function(e){return e},b.times=function(e,t,i){for(var r=0;r<e;r++)t.call(i,r)},b.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},b.result=function(e,t){if(null==e)return null;var i=e[t];return b.isFunction(i)?i.call(e):i},b.mixin=function(t){R(b.functions(t),function(e){N(e,b[e]=t[e])})};var _=0;b.uniqueId=function(e){var t=_++;return e?e+t:t},b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var S=/.^/,M={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var C in M)M[M[C]]=C;var A=/\\|'|\r|\n|\t|\u2028|\u2029/g,L=/\\(\\|'|r|n|t|u2028|u2029)/g,P=function(e){return e.replace(L,function(e,t){return M[t]})};b.template=function(e,t,i){i=b.defaults(i||{},b.templateSettings);var r="__p+='"+e.replace(A,function(e){return"\\"+M[e]}).replace(i.escape||S,function(e,t){return"'+\n_.escape("+P(t)+")+\n'"}).replace(i.interpolate||S,function(e,t){return"'+\n("+P(t)+")+\n'"}).replace(i.evaluate||S,function(e,t){return"';\n"+P(t)+"\n;__p+='"})+"';\n";i.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+r+"return __p;\n";var n=new Function(i.variable||"obj","_",r);if(t)return n(t,b);var o=function(e){return n.call(this,e,b)};return o.source="function("+(i.variable||"obj")+"){\n"+r+"}",o},b.chain=function(e){return b(e).chain()};var D=function(e){this._wrapped=e};b.prototype=D.prototype;var F=function(e,t){return t?b(e).chain():e},N=function(e,t){D.prototype[e]=function(){var e=s.call(arguments);return o.call(e,this._wrapped),F(t.apply(b,e),this._chain)}};b.mixin(b),R(["pop","push","reverse","shift","sort","splice","unshift"],function(i){var r=n[i];D.prototype[i]=function(){var e=this._wrapped;r.apply(e,arguments);var t=e.length;return"shift"!=i&&"splice"!=i||0!==t||delete e[0],F(e,this._chain)}}),R(["concat","join","slice"],function(e){var t=n[e];D.prototype[e]=function(){return F(t.apply(this._wrapped,arguments),this._chain)}}),D.prototype.chain=function(){return this._chain=!0,this},D.prototype.value=function(){return this._wrapped}}.call(this);var Backbone=Backbone||{};!function(){var n=[].slice,l=/\s+/,u=function(e,t,i,r){if(!i)return!0;if("object"==typeof i)for(var n in i)e[t].apply(e,[n,i[n]].concat(r));else{if(!l.test(i))return!0;for(var o=i.split(l),a=0,s=o.length;a<s;a++)e[t].apply(e,[o[a]].concat(r))}},o=function(e,t,i){var r,n=-1,o=t.length;switch(i.length){case 0:for(;++n<o;)(r=t[n]).callback.call(r.ctx);return;case 1:for(;++n<o;)(r=t[n]).callback.call(r.ctx,i[0]);return;case 2:for(;++n<o;)(r=t[n]).callback.call(r.ctx,i[0],i[1]);return;case 3:for(;++n<o;)(r=t[n]).callback.call(r.ctx,i[0],i[1],i[2]);return;default:for(;++n<o;)(r=t[n]).callback.apply(r.ctx,i)}},e=Backbone.Events={on:function(e,t,i){return u(this,"on",e,[t,i])&&t&&(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:i,ctx:i||this})),this},once:function(e,t,i){if(!u(this,"once",e,[t,i])||!t)return this;var r=this,n=_.once(function(){r.off(e,n),t.apply(this,arguments)});return n._callback=t,this.on(e,n,i),this},off:function(e,t,i){var r,n,o,a,s,l,h,c;if(!this._events||!u(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events={},this;for(s=0,l=(a=e?[e]:_.keys(this._events)).length;s<l;s++)if(e=a[s],r=this._events[e]){if(o=[],t||i)for(h=0,c=r.length;h<c;h++)n=r[h],(t&&t!==(n.callback._callback||n.callback)||i&&i!==n.context)&&o.push(n);this._events[e]=o}return this},trigger:function(e){if(!this._events)return this;var t=n.call(arguments,1);if(!u(this,"trigger",e,t))return this;var i=this._events[e],r=this._events.all;return i&&o(0,i,t),r&&o(0,r,arguments),this},listenTo:function(e,t,i){return((this._listeners||(this._listeners={}))[e._listenerId||(e._listenerId=_.uniqueId("l"))]=e).on(t,i||this,this),this},stopListening:function(e,t,i){var r=this._listeners;if(r){if(e)e.off(t,i,this),t||i||delete r[e._listenerId];else{for(var n in r)r[n].off(null,null,this);this._listeners={}}return this}}};e.bind=e.on,e.unbind=e.off}(),function(){for(var o=0,e=["ms","moz","webkit","o"],t=0;t<e.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var i=(new Date).getTime(),r=Math.max(0,16-(i-o)),n=window.setTimeout(function(){e(i+r)},r);return o=i+r,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(){var e=this,t=e.Two||{},c=Math.sin,u=Math.cos,P=Math.atan2,i=Math.sqrt,D=(Math.round,Math.abs),F=Math.PI,N=2*F,p=F/2,r=Math.pow,n={hasEventListeners:_.isFunction(e.addEventListener),bind:function(e,t,i,r){return this.hasEventListeners?e.addEventListener(t,i,!!r):e.attachEvent("on"+t,i),this},unbind:function(e,t,i,r){return this.hasEventListeners?e.removeEventListeners(t,i,!!r):e.detachEvent("on"+t,i),this}},U=e.Two=function(e){var t=_.defaults(e||{},{fullscreen:!1,width:640,height:480,type:U.Types.svg,autostart:!1});if(this.type=t.type,this.renderer=new U[this.type](this),U.Utils.setPlaying.call(this,t.autostart),this.frameCount=0,t.fullscreen){var i=_.bind(a,this);_.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),_.extend(this.renderer.domElement.style,{display:"block",top:0,left:0,right:0,bottom:0,position:"fixed"}),n.bind(window,"resize",i),i()}else this.renderer.setSize(t.width,t.height),this.width=t.width,this.height=t.height;this.scene=new U.Group,this.renderer.add(this.scene),U.Instances.push(this)};_.extend(U,{Array:e.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change"},Resolution:8,Instances:[],noConflict:function(){return e.Two=t,this},Utils:{getComputedMatrix:function(e){for(var t=new U.Matrix,i=e;i&&i._matrix;){var r=i._matrix.elements;t.multiply(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9]),i=i.parent}return t},Curve:{CollinearityEpsilon:r(10,-30),RecursionLimit:16,CuspLimit:0,Tolerance:{distance:.25,angle:0,epsilon:.01}},setPlaying:function(e){return _.defer(_.bind(function(){this.playing=!!e},this)),this},applySvgAttributes:function(e,i){return i.cap="butt",i.join="bevel",_.each(e.attributes,function(e,t){switch(e.nodeName){case"transform":break;case"visibility":i.visible=!!e.nodeValue;break;case"stroke-linecap":i.cap=e.nodeValue;break;case"stroke-linejoin":i.join=e.nodeValue;break;case"stroke-miterlimit":i.miter=e.nodeValue;break;case"stroke-width":i.linewidth=parseFloat(e.nodeValue);break;case"stroke-opacity":case"fill-opacity":i.opacity=e.nodeValue;break;case"fill":i.fill=e.nodeValue;break;case"stroke":i.stroke=e.nodeValue}}),i},read:{svg:function(){return U.Utils.read.g.apply(this,arguments)},g:function(e){var r=new U.Group;return this.add(r),_.each(e.childNodes,function(e){if(e.localName){var t=e.localName.toLowerCase();if(t in U.Utils.read){var i=U.Utils.read[t].call(this,e);r.add(i)}}},this),U.Utils.applySvgAttributes(e,r)},polygon:function(e,t){var i=e.points,r=_.map(_.range(i.numberOfItems),function(e){var t=i.getItem(e);return new U.Vector(t.x,t.y)}),n=new U.Polygon(r,!t).noStroke();return U.Utils.applySvgAttributes(e,n)},polyline:function(e){return U.Utils.read.polygon(e,!0)},path:function(r){var e=r.getAttribute("d"),t=_.flatten(_.map(_.compact(e.split(/M/g)),function(e){var t=_.map(_.compact(e.split(/m/g)),function(e,t){return t<=0?e:"m"+e});return t[0]="M"+t[0],t})),T=(t.length,new U.Vector),x=new U.Vector;return _.map(t,function(e){var v,g=!1,y=!1,t=_.flatten(_.map(e.match(/[a-z][^a-z]*/gi),function(e){var t,i,r,n,o,a,s,l,h,c,u,p,d=e[0],f=d.toLowerCase();switch(v=e.slice(1).trim().split(/[\s,]+|(?=[+\-])/),g=d===f,f){case"z":y=!0;break;case"m":case"l":i=parseFloat(v[0]),r=parseFloat(v[1]),t=new U.Vector(i,r),g&&t.addSelf(T),T.copy(t);break;case"h":case"v":var m="h"===f?"x":"y",E="x"===m?"y":"x";(t=new U.Vector)[m]=parseFloat(v[0]),t[E]=T[E],g&&(t[m]+=T[m]),T.copy(t);break;case"s":case"c":n=T.x,o=T.y,"c"===f?(a=parseFloat(v[0]),s=parseFloat(v[1]),l=parseFloat(v[2]),h=parseFloat(v[3]),c=parseFloat(v[4]),u=parseFloat(v[5])):(p=(new U.Vector).copy(T).subSelf(x),a=parseFloat(p.x),s=parseFloat(p.y),l=parseFloat(v[0]),h=parseFloat(v[1]),c=parseFloat(v[2]),u=parseFloat(v[3])),g&&(a+=n,s+=o,l+=n,h+=o,c+=n,u+=o),t=U.Utils.subdivide(n,o,a,s,l,h,c,u),T.set(c,u),x.set(l,h);break;case"t":case"q":n=T.x,o=T.y,x.isZero()?(a=n,s=o):(a=x.x,o=x.y),"q"===f?(l=parseFloat(v[0]),h=parseFloat(v[1]),c=parseFloat(v[1]),u=parseFloat(v[2])):(p=(new U.Vector).copy(T).subSelf(x),l=parseFloat(p.x),h=parseFloat(p.y),c=parseFloat(v[0]),u=parseFloat(v[1])),g&&(a+=n,s+=o,l+=n,h+=o,c+=n,u+=o),t=U.Utils.subdivide(n,o,a,s,l,h,c,u),T.set(c,u),x.set(l,h);break;case"a":throw new U.Utils.Error("not yet able to interpret Elliptical Arcs.")}return t}));_.isUndefined(t[t.length-1])&&t.pop();var i=new U.Polygon(t,y).noStroke();return U.Utils.applySvgAttributes(r,i)})},circle:function(e){var t=parseFloat(e.getAttribute("cx")),i=parseFloat(e.getAttribute("cy")),n=parseFloat(e.getAttribute("r")),o=U.Resolution,r=_.map(_.range(o),function(e){var t=e/o*N,i=n*u(t),r=n*c(t);return new U.Vector(i,r)},this),a=new U.Polygon(r,!0,!0).noStroke();return a.translation.set(t,i),U.Utils.applySvgAttributes(e,a)},ellipse:function(e){var t=parseFloat(e.getAttribute("cx")),i=parseFloat(e.getAttribute("cy")),n=parseFloat(e.getAttribute("rx")),o=parseFloat(e.getAttribute("ry")),a=U.Resolution,r=_.map(_.range(a),function(e){var t=e/a*N,i=n*u(t),r=o*c(t);return new U.Vector(i,r)},this),s=new U.Polygon(r,!0,!0).noStroke();return s.translation.set(t,i),U.Utils.applySvgAttributes(e,s)},rect:function(e){var t=parseFloat(e.getAttribute("x")),i=parseFloat(e.getAttribute("y")),r=parseFloat(e.getAttribute("width"))/2,n=parseFloat(e.getAttribute("height"))/2,o=[new U.Vector(r,n),new U.Vector(-r,n),new U.Vector(-r,-n),new U.Vector(r,-n)],a=new U.Polygon(o,!0).noStroke();return a.translation.set(t+r,i+n),U.Utils.applySvgAttributes(e,a)},line:function(e){var t=parseFloat(e.getAttribute("x1")),i=parseFloat(e.getAttribute("y1")),r=(parseFloat(e.getAttribute("x2"))-t)/2,n=(parseFloat(e.getAttribute("y2"))-i)/2,o=[new U.Vector(-r,-n),new U.Vector(r,n)],a=new U.Polygon(o).noFill();return a.translation.set(t+r,i+n),U.Utils.applySvgAttributes(e,a)}},subdivide:function(e,t,i,r,n,o,a,s,l){var h,c,u=U.Utils.Curve.CollinearityEpsilon,p=U.Utils.Curve.RecursionLimit,d=U.Utils.Curve.CuspLimit,f=U.Utils.Curve.Tolerance;if(p<(l=l||0))return[];var m=(e+i)/2,E=(t+r)/2,v=(i+n)/2,g=(r+o)/2,y=(n+a)/2,T=(o+s)/2,x=(m+v)/2,b=(E+g)/2,R=(v+y)/2,w=(g+T)/2,H=(x+R)/2,_=(b+w)/2,S=a-e,M=s-t,C=D((i-a)*M-(r-s)*S),A=D((n-a)*M-(o-s)*S);if(0<l){if(u<C&&u<A&&(C+A)*(C+A)<=f.distance*(S*S+M*M)){if(f.angle<f.epsilon)return[new U.Vector(H,_)];var L=P(o-r,n-i);if(h=D(L-P(r-t,i-e)),c=D(P(s-o,a-n)-L),F<=h&&(h=N-h),F<=c&&(c=N-c),h+c<f.angle)return[new U.Vector(H,_)];if(0!==d){if(d<h)return[new U.Vector(i,r)];if(d<c)return[new U.Vector(n,o)]}}}else if(u<C)if(C*C<=f.distance*(S*S+M*M)){if(f.angle<f.epsilon)return[new U.Vector(H,_)];if(h=D(P(o-r,n-i)-P(r-t,i-e)),F<=h&&(h=N-h),h<f.angle)return[new U.Vector(i,r),new U.Vector(n,o)];if(0!==d&&d<h)return[new U.Vector(i,r)]}else if(u<A){if(A*A<=f.distance*(S*S+M*M)){if(f.angle<f.epsilon)return[new U.Vector(H,_)];if(h=D(P(s-o,a-n)-P(o-r,n-i)),F<=h&&(h=N-h),h<f.angle)return[new U.Vector(i,r),new U.Vector(n,o)];if(0!==d&&d<h)return[new U.Vector2(n,o)]}}else if((S=H-(e+a)/2)*S+(M=_-(t+s)/2)*M<=f.distance)return[new U.Vector(H,_)];return U.Utils.subdivide(e,t,m,E,x,b,H,_,l+1).concat(U.Utils.subdivide(H,_,R,w,y,T,a,s,l+1))},getCurveFromPoints:function(e,t){for(var i=[],r=e.length,n=r-1,o=0;o<r;o++){var a=e[o],s={x:a.x,y:a.y};i.push(s);var l=t?E(o-1,r):Math.max(o-1,0),h=t?E(o+1,r):Math.min(o+1,n),c=e[l],u=s,p=e[h];m(c,u,p),u.u.x||u.u.y||(u.u.x=u.x,u.u.y=u.y),u.v.x||u.v.y||(u.v.x=u.x,u.v.y=u.y)}return i},getControlPoints:function(e,t,i){var r,n,o=f(e,t),a=f(i,t),s=d(e,t),l=d(i,t),h=(o+a)/2;return s<1e-4||l<1e-4?(t.u={x:t.x,y:t.y},t.v={x:t.x,y:t.y}):(s*=.33,l*=.33,a<o?h+=p:h-=p,r={x:t.x+u(h)*s,y:t.y+c(h)*s},h-=F,n={x:t.x+u(h)*l,y:t.y+c(h)*l},t.u=r,t.v=n),t},angleBetween:function(e,t){var i=e.x-t.x,r=e.y-t.y;return P(r,i)},distanceBetweenSquared:function(e,t){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r},distanceBetween:function(e,t){return i(o(e,t))},mod:function(e,t){for(;e<0;)e+=t;return e%t},Error:function(e){this.name="two.js",this.message=e}}}),U.Utils.Error.prototype=new Error,U.Utils.Error.prototype.constructor=U.Utils.Error;var d=U.Utils.distanceBetween,o=U.Utils.distanceBetweenSquared,f=U.Utils.angleBetween,m=U.Utils.getControlPoints,E=(U.Utils.getCurveFromPoints,U.Utils.solveSegmentIntersection,U.Utils.decoupleShapes,U.Utils.mod);function a(){var e=document.body.getBoundingClientRect(),t=this.width=e.width,i=this.height=e.height;this.renderer.setSize(t,i),this.trigger(U.Events.resize,t,i)}_.extend(U.prototype,Backbone.Events,{appendTo:function(e){return e.appendChild(this.renderer.domElement),this},play:function(){return U.Utils.setPlaying.call(this,!0),this.trigger(U.Events.play)},pause:function(){return this.playing=!1,this.trigger(U.Events.pause)},update:function(){return _.defer(_.bind(function(){var e=!!this._lastFrame,t=(window.performance&&window.performance.now?window.performance:Date).now();this.frameCount++,e&&(this.timeDelta=parseFloat((t-this._lastFrame).toFixed(3))),this._lastFrame=t;var i=this.width,r=this.height,n=this.renderer;i===n.width&&r===n.height||n.setSize(i,r),this.trigger(U.Events.update,this.frameCount,this.timeDelta),this.render()},this)),this},render:function(){return this.renderer.render(),this.trigger(U.Events.render,this.frameCount)},add:function(e){var t=e;return _.isArray(e)||(t=_.toArray(arguments)),this.scene.add(t),this},remove:function(e){var t=e;return _.isArray(e)||(t=_.toArray(arguments)),this.scene.remove(t),this},clear:function(){return _.each(this.scene.children,function(e){e.remove()}),this},makeLine:function(e,t,i,r){var n=(i-e)/2,o=(r-t)/2,a=[new U.Vector(-n,-o),new U.Vector(n,o)],s=new U.Polygon(a).noFill();return s.translation.set(e+n,t+o),this.scene.add(s),s},makeRectangle:function(e,t,i,r){var n=i/2,o=r/2,a=[new U.Vector(n,o),new U.Vector(-n,o),new U.Vector(-n,-o),new U.Vector(n,-o)],s=new U.Polygon(a,!0);return s.translation.set(e,t),this.scene.add(s),s},makeCircle:function(e,t,i){return this.makeEllipse(e,t,i,i)},makeEllipse:function(e,t,n,o){var a=U.Resolution,i=_.map(_.range(a),function(e){var t=e/a*N,i=n*u(t),r=o*c(t);return new U.Vector(i,r)},this),r=new U.Polygon(i,!0,!0);return r.translation.set(e,t),this.scene.add(r),r},makeCurve:function(e){var t=arguments.length,i=e;if(!_.isArray(e)){i=[];for(var r=0;r<t;r+=2){var n=arguments[r];if(!_.isNumber(n))break;var o=arguments[r+1];i.push(new U.Vector(n,o))}}var a=arguments[t-1],s=new U.Polygon(i,!(_.isBoolean(a)?a:void 0),!0),l=s.getBoundingClientRect(),h=l.left+l.width/2,c=l.top+l.height/2;return _.each(s.vertices,function(e){e.x-=h,e.y-=c}),s.translation.set(h,c),this.scene.add(s),s},makePolygon:function(e){var t=arguments.length,i=e;if(!_.isArray(e)){i=[];for(var r=0;r<t;r+=2){var n=arguments[r];if(!_.isNumber(n))break;var o=arguments[r+1];i.push(new U.Vector(n,o))}}var a=arguments[t-1],s=new U.Polygon(i,!(_.isBoolean(a)?a:void 0));return s.center(),this.scene.add(s),s},makeGroup:function(e){var t=e;_.isArray(e)||(t=_.toArray(arguments));var i=new U.Group;return this.scene.add(i),i.add(t),i},interpret:function(e){var t=e.tagName.toLowerCase();if(!(t in U.Utils.read))return null;var i=U.Utils.read[t].call(this,e);return this.add(i),i}}),function(){_.each(U.Instances,function(e){e.playing&&e.update()}),requestAnimationFrame(arguments.callee)}(),"function"==typeof define&&define.amd?define(function(){return U}):"undefined"!=typeof module&&module.exports&&(module.exports=U)}(),function(){var e=Two.Vector=function(e,t){this.x=e||0,this.y=t||0};_.extend(e,{MakeGetterSetter:function(e,t,i){var r="_"+t;Object.defineProperty(e,t,{get:function(){return this[r]},set:function(e){this[r]=e,this.trigger(Two.Events.change,t)}}),e[r]=i}}),_.extend(e.prototype,Backbone.Events,{set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new e(this.x,this.y)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this},multiplySelf:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){return this.normalize().multiplyScalar(e)},equals:function(e){return this.distanceTo(e)<1e-4},lerp:function(e,t){var i=(e.x-this.x)*t+this.x,r=(e.y-this.y)*t+this.y;return this.set(i,r)},isZero:function(){return this.length()<1e-4}});var t={set:function(e,t){return this._x=e,this._y=t,this.trigger(Two.Events.change)},copy:function(e){return this._x=e.x,this._y=e.y,this.trigger(Two.Events.change)},clear:function(){return this._x=0,this._y=0,this.trigger(Two.Events.change)},clone:function(){return new e(this._x,this._y)},add:function(e,t){return this._x=e.x+t.x,this._y=e.y+t.y,this.trigger(Two.Events.change)},addSelf:function(e){return this._x+=e.x,this._y+=e.y,this.trigger(Two.Events.change)},sub:function(e,t){return this._x=e.x-t.x,this._y=e.y-t.y,this.trigger(Two.Events.change)},subSelf:function(e){return this._x-=e.x,this._y-=e.y,this.trigger(Two.Events.change)},multiplySelf:function(e){return this._x*=e.x,this._y*=e.y,this.trigger(Two.Events.change)},multiplyScalar:function(e){return this._x*=e,this._y*=e,this.trigger(Two.Events.change)},divideScalar:function(e){return e?(this._x/=e,this._y/=e,this.trigger(Two.Events.change)):this.clear()},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this._x*e.x+this._y*e.y},lengthSquared:function(){return this._x*this._x+this._y*this._y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this._x-e.x,i=this._y-e.y;return t*t+i*i},setLength:function(e){return this.normalize().multiplyScalar(e)},equals:function(e){return this.distanceTo(e)<1e-4},lerp:function(e,t){var i=(e.x-this._x)*t+this._x,r=(e.y-this._y)*t+this._y;return this.set(i,r)},isZero:function(){return this.length()<1e-4}};Two.Vector.prototype.bind=Two.Vector.prototype.on=function(){return this._bound||(Two.Vector.MakeGetterSetter(this,"x",this.x),Two.Vector.MakeGetterSetter(this,"y",this.y),_.extend(this,t),this._bound=!0),Backbone.Events.bind.apply(this,arguments),this}}(),function(){_.range(6);var r=Math.cos,n=Math.sin,o=Math.tan,e=Two.Matrix=function(e,t,i,r,n,o){this.elements=new Two.Array(9);var a=e;_.isArray(a)||(a=_.toArray(arguments)),this.identity().set(a)};_.extend(e,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(e,t){if(t.length<=3){var i=t[0]||0,r=t[1]||0,n=t[2]||0,o=e;return{x:o[0]*i+o[1]*r+o[2]*n,y:o[3]*i+o[4]*r+o[5]*n,z:o[6]*i+o[7]*r+o[8]*n}}var a=e[0],s=e[1],l=e[2],h=e[3],c=e[4],u=e[5],p=e[6],d=e[7],f=e[8],m=t[0],E=t[1],v=t[2],g=t[3],y=t[4],T=t[5],x=t[6],b=t[7],R=t[8];return[a*m+s*g+l*x,a*E+s*y+l*b,a*v+s*T+l*R,h*m+c*g+u*x,h*E+c*y+u*b,h*v+c*T+u*R,p*m+d*g+f*x,p*E+d*y+f*b,p*v+d*T+f*R]}}),_.extend(e.prototype,Backbone.Events,{set:function(e,t,i,r,n,o){var a=e;arguments.length;return _.isArray(a)||(a=_.toArray(arguments)),_.each(a,function(e,t){_.isNumber(e)&&(this.elements[t]=e)},this),this.trigger(Two.Events.change)},identity:function(){return this.set(e.Identity),this},multiply:function(i,e,t,r,n,o,a,s,l){var h=arguments,c=h.length;if(c<=1)return _.each(this.elements,function(e,t){this.elements[t]=e*i},this),this.trigger(Two.Events.change);if(c<=3)return i=i||0,e=e||0,t=t||0,{x:(n=this.elements)[0]*i+n[1]*e+n[2]*t,y:n[3]*i+n[4]*e+n[5]*t,z:n[6]*i+n[7]*e+n[8]*t};var u=this.elements,p=h;return A0=u[0],A1=u[1],A2=u[2],A3=u[3],A4=u[4],A5=u[5],A6=u[6],A7=u[7],A8=u[8],B0=p[0],B1=p[1],B2=p[2],B3=p[3],B4=p[4],B5=p[5],B6=p[6],B7=p[7],B8=p[8],this.elements[0]=A0*B0+A1*B3+A2*B6,this.elements[1]=A0*B1+A1*B4+A2*B7,this.elements[2]=A0*B2+A1*B5+A2*B8,this.elements[3]=A3*B0+A4*B3+A5*B6,this.elements[4]=A3*B1+A4*B4+A5*B7,this.elements[5]=A3*B2+A4*B5+A5*B8,this.elements[6]=A6*B0+A7*B3+A8*B6,this.elements[7]=A6*B1+A7*B4+A8*B7,this.elements[8]=A6*B2+A7*B5+A8*B8,this.trigger(Two.Events.change)},inverse:function(e){var t=this.elements,i=(e=e||new Two.Matrix,t[0]),r=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],h=t[7],c=t[8],u=c*a-s*h,p=-c*o+s*l,d=h*o-a*l,f=i*u+r*p+n*d;return f?(f=1/f,e.elements[0]=u*f,e.elements[1]=(-c*r+n*h)*f,e.elements[2]=(s*r-n*a)*f,e.elements[3]=p*f,e.elements[4]=(c*i-n*l)*f,e.elements[5]=(-s*i+n*o)*f,e.elements[6]=d*f,e.elements[7]=(-h*i+r*l)*f,e.elements[8]=(a*i-r*o)*f,e):null},scale:function(e,t){return arguments.length<=1&&(t=e),this.multiply(e,0,0,0,t,0,0,0,1)},rotate:function(e){var t=r(e),i=n(e);return this.multiply(t,-i,0,i,t,0,0,0,1)},translate:function(e,t){return this.multiply(1,0,e,0,1,t,0,0,1)},skewX:function(e){var t=o(e);return this.multiply(1,t,0,0,1,0,0,0,1)},skewY:function(e){var t=o(e);return this.multiply(1,0,0,t,1,0,0,0,1)},toString:function(){return this.toArray().join(" ")},toArray:function(e){var t=this.elements,i=parseFloat(t[0].toFixed(3)),r=parseFloat(t[1].toFixed(3)),n=parseFloat(t[2].toFixed(3)),o=parseFloat(t[3].toFixed(3)),a=parseFloat(t[4].toFixed(3)),s=parseFloat(t[5].toFixed(3));return e?[i,o,parseFloat(t[6].toFixed(3)),r,a,parseFloat(t[7].toFixed(3)),n,s,parseFloat(t[8].toFixed(3))]:[i,o,r,a,n,s]},clone:function(){var e=this.elements[0],t=this.elements[1],r=this.elements[2],n=this.elements[3],o=this.elements[4],a=this.elements[5];return g=this.elements[6],h=this.elements[7],i=this.elements[8],new Two.Matrix(e,t,r,n,o,a,g,h,i)}})}(),function(){var i=Two.Utils.getCurveFromPoints,v=Two.Utils.mod,g={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(e,t){var i=e,r=document.createElementNS(this.ns,i);return"svg"===i&&(t=_.defaults(t||{},{version:this.version})),_.isObject(t)&&this.setAttributes(r,t),r},setAttributes:function(i,e){return _.each(e,function(e,t){i.setAttribute(t,e)},this),this},removeAttributes:function(e,t){return _.each(t,function(e){this.removeAttribute(e)},e),this},toString:function(e,d,t){var f=e.length,m=f-1;if(!t)return _.map(e,function(e,t){var i;return i=t<=0?"M":"L",i+=" "+e.x.toFixed(3)+" "+e.y.toFixed(3),m<=t&&d&&(i+=" Z"),i}).join(" ");var E=i(e,d);return _.map(E,function(e,t){var i,r=d?v(t-1,f):Math.max(t-1,0),n=d?v(t+1,f):Math.min(t+1,m),o=E[r],a=E[n],s=o.v.x.toFixed(3),l=o.v.y.toFixed(3),h=e.u.x.toFixed(3),c=e.u.y.toFixed(3),u=e.x.toFixed(3),p=e.y.toFixed(3);return i=t<=0?"M "+u+" "+p:"C "+s+" "+l+" "+h+" "+c+" "+u+" "+p,m<=t&&d&&(i+=" C "+(s=e.v.x.toFixed(3))+" "+(l=e.v.y.toFixed(3))+" "+(h=a.u.x.toFixed(3))+" "+(c=a.u.y.toFixed(3))+" "+(u=a.x.toFixed(3))+" "+(p=a.y.toFixed(3)),i+=" Z"),i}).join(" ")}},y=Two[Two.Types.svg]=function(){this.count=0,this.domElement=g.createElement("svg"),this.elements=[],this.domElement.style.visibility="hidden",this.unveil=_.once(_.bind(function(){this.domElement.style.visibility="visible"},this))};function s(e){var t={},i=e.id,r=e.translation,n=e.rotation,o=e.scale,a=e.stroke,s=e.linewidth,l=e.fill,h=e.opacity,c=e.visible,u=e.cap,p=e.join,d=e.miter,f=e.curved,m=e.closed,E=e.vertices;return i&&(t.id=y.Identifier+i),r&&_.isNumber(o)&&_.isNumber(n)&&(t.transform="matrix("+e._matrix.toString()+")"),a&&(t.stroke=a),l&&(t.fill=l),h&&(t["stroke-opacity"]=t["fill-opacity"]=h),t.visibility=c?"visible":"hidden",u&&(t["stroke-linecap"]=u),p&&(t["stroke-linejoin"]=p),d&&(t["stroke-miterlimit"]=d),s&&(t["stroke-width"]=s),E&&(t.d=g.toString(E,m,f)),t}_.extend(y,{Identifier:"two-",Utils:g}),_.extend(y.prototype,Backbone.Events,{setSize:function(e,t){return this.width=e,this.height=t,g.setAttributes(this.domElement,{width:e,height:t}),this},add:function(e){arguments.length;var t=e,o=this.elements,a=this.domElement;return _.isArray(e)||(t=_.map(arguments,function(e){return e})),_.each(t,function(e){var t,i,r,n=e instanceof Two.Group;_.isUndefined(e.id)&&(e.id=_.uniqueId()),n?(i="g",_.isUndefined(e.parent)&&(e.parent=this,e.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this))),delete(r=s(e)).stroke,delete r.fill,delete r["fill-opacity"],delete r["stroke-opacity"],delete r["stroke-linecap"],delete r["stroke-linejoin"],delete r["stroke-miterlimit"],delete r["stroke-width"]):(i="path",r=s(e)),t=g.createElement(i,r),a.appendChild(t),o.push(t)},this),this},getElementById:function(e){var t=this.elements;for(var i in t){var r=t[i];if(r.getAttribute("id").replace(y.Identifier,"")==e)return r}return null},update:function(e,t,i,r,n){var o=this.getElementById(e);switch(t){case Two.Properties.hierarchy:_.each(i,function(e){o.appendChild(this.getElementById(e))},this);break;case Two.Properties.demotion:_.each(i,function(e){o.removeChild(this.getElementById(e))},this);break;default:!function(e,t,i,r,n){switch(t){case"matrix":t="transform",i="matrix("+i.toString()+")";break;case"visible":t="visibility",i=i?"visible":"hidden";break;case"cap":t="stroke-linecap";break;case"join":t="stroke-linejoin";break;case"miter":t="stroke-miterlimit";break;case"linewidth":t="stroke-width";break;case"vertices":t="d",i=g.toString(i,r,n);break;case"opacity":return g.setAttributes(e,{"stroke-opacity":i,"fill-opacity":i})}e.setAttribute(t,i)}(o,t,i,r,n)}return this},render:function(){return this.unveil(),this}})}(),function(){var r=Two.Utils.getCurveFromPoints,g=Two.Utils.mod,e=function(e){_.each(e,function(e,t){this[t]=e},this),this.children={}};_.extend(e.prototype,{appendChild:function(e){var t=e.parent,i=e.id;return _.isUndefined(t)||delete t.children[i],(this.children[i]=e).parent=this},removeChild:function(e){return delete this.children[e.id],this},render:function(t){var e=this.matrix;return t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),_.each(this.children,function(e){e.render(t)}),t.restore(),this}});var t=function(e){_.each(e,function(e,t){this[t]=e},this)};_.extend(t.prototype,{render:function(p){var e=this.matrix,t=this.stroke,i=this.linewidth,r=this.fill,n=this.opacity,o=this.visible,a=this.cap,s=this.join,l=this.miter,d=this.curved,f=this.closed,m=this.commands,E=m.length,v=E-1;if(!o)return this;p.save(),e&&p.transform(e[0],e[1],e[2],e[3],e[4],e[5]),r&&(p.fillStyle=r),t&&(p.strokeStyle=t),i&&(p.lineWidth=i),l&&(p.miterLimit=l),s&&(p.lineJoin=s),a&&(p.lineCap=a),_.isNumber(n)&&(p.globalAlpha=n),p.beginPath(),_.each(m,function(e,t){var i=e.x.toFixed(3),r=e.y.toFixed(3);if(d){var n=f?g(t-1,E):Math.max(t-1,0),o=f?g(t+1,E):Math.min(t+1,v),a=m[n],s=m[o],l=a.v.x.toFixed(3),h=a.v.y.toFixed(3),c=e.u.x.toFixed(3),u=e.u.y.toFixed(3);t<=0?p.moveTo(i,r):(p.bezierCurveTo(l,h,c,u,i,r),v<=t&&f&&(l=e.v.x.toFixed(3),h=e.v.y.toFixed(3),c=s.u.x.toFixed(3),u=s.u.y.toFixed(3),i=s.x.toFixed(3),r=s.y.toFixed(3),p.bezierCurveTo(l,h,c,u,i,r)))}else t<=0?p.moveTo(i,r):p.lineTo(i,r)}),f&&!d&&p.closePath(),p.fill(),p.stroke(),p.restore()}});var m={toArray:function(e,t,i){e.length;return t?r(e,i):_.map(e,function(e,t){return{x:e.x,y:e.y}})}},i=Two[Two.Types.canvas]=function(){this.count=0,this.domElement=document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.elements={},this.stage=null};_.extend(i,{}),_.extend(i,{Group:e,Element:t,getStyles:function(e){var t={},i=e.id,r=e._matrix,n=e.stroke,o=e.linewidth,a=e.fill,s=e.opacity,l=e.visible,h=e.cap,c=e.join,u=e.miter,p=e.curved,d=e.closed,f=e.vertices;i&&(t.id=i);_.isObject(r)&&(t.matrix=r.toArray());n&&(t.stroke=n);a&&(t.fill=a);_.isNumber(s)&&(t.opacity=s);h&&(t.cap=h);c&&(t.join=c);u&&(t.miter=u);o&&(t.linewidth=o);f&&(t.commands=m.toArray(f,p,d));return t.visible=!!l,t.curved=!!p,t.closed=!!d,t},setStyles:function(e,t,i,r,n){switch(t){case"matrix":t="matrix",i=i.toArray();break;case"vertices":t="commands",e.curved=n,e.closed=r,i=m.toArray(i,e.curved,e.closed)}e[t]=i},Utils:m}),_.extend(i.prototype,Backbone.Events,{setSize:function(e,t){return this.width=this.domElement.width=e,this.height=this.domElement.height=t,_.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"}),this},add:function(e){var t=Object.getPrototypeOf(this);constructor=t.constructor;arguments.length;var i=e,o=this.elements,a=(this.domElement,constructor.Group),s=constructor.Element,l=constructor.getStyles;return _.isArray(e)||(i=_.map(arguments,function(e){return e})),_.each(i,function(e){var t,i,r=e instanceof Two.Group,n=_.isNull(this.stage);_.isUndefined(e.id)&&(e.id=_.uniqueId()),r?(delete(i=l.call(this,e)).stroke,delete i.fill,delete i.opacity,delete i.cap,delete i.join,delete i.miter,delete i.linewidth,t=new a(i),n&&(this.stage=t,(this.stage.object=e).parent=this,e.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this)))):t=new s(l.call(this,e)),o[t.id]=t,n||this.stage.appendChild(t)},this),this},update:function(e,t,i,r,n,o){var a=Object.getPrototypeOf(this).constructor,s=this.elements,l=s[e];switch(t){case Two.Properties.hierarchy:_.each(i,function(e){l.appendChild(s[e])});break;case Two.Properties.demotion:_.each(i,function(e){l.removeChild(s[e]),this.elements[e]=null},this);break;default:a.setStyles.call(this,l,t,i,r,n,o)}return this},render:function(){return _.isNull(this.stage)||(this.ctx.clearRect(0,0,this.width,this.height),this.stage.render(this.ctx)),this}})}(),function(){var r=Two[Two.Types.canvas],n=Two.Matrix.Multiply,m=Two[Two.Types.canvas].Utils.toArray,x=Two.Utils.mod,e=function(e){r.Group.call(this,e)};_.extend(e.prototype,r.Group.prototype,{appendChild:function(){return r.Group.prototype.appendChild.apply(this,arguments),this.updateMatrix(),this},updateTexture:function(t){return _.each(this.children,function(e){e.updateTexture(t)}),this},updateMatrix:function(e){var t=e&&e._matrix||this.parent&&this.parent._matrix,i=e&&e._scale||this.parent&&this.parent._scale;return t&&(this._matrix=n(this.matrix,t),this._scale=this.scale*i,_.each(this.children,function(e){e.updateMatrix(this)},this)),this},render:function(t,i){_.each(this.children,function(e){e.render(t,i)})}});var E=function(e){r.Element.call(this,e)};_.extend(E.prototype,r.Element.prototype,{updateMatrix:function(e){var t=e&&e._matrix||this.parent&&this.parent._matrix,i=e&&e._scale||this.parent&&this.parent._scale;return t&&(this._matrix=n(this.matrix,t),this._scale=this.scale*i),this},updateTexture:function(e){return v.updateTexture(e,this),this},render:function(e,t){return this.visible&&this.opacity&&this.buffer&&(e.bindBuffer(e.ARRAY_BUFFER,this.textureCoordsBuffer),e.vertexAttribPointer(t.textureCoords,2,e.FLOAT,!1,0,0),e.bindTexture(e.TEXTURE_2D,this.texture),e.uniformMatrix3fv(t.matrix,!1,this._matrix),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.vertexAttribPointer(t.position,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,6)),this}});var v={canvas:document.createElement("canvas"),uv:new Two.Array([0,0,1,0,0,1,0,1,1,0,1,1]),getBoundingClientRect:function(e,t,l){var h=1/0,c=-1/0,u=1/0,p=-1/0;return _.each(e,function(e,t){var i,r,n,o,a=e.x,s=e.y;u=Math.min(s,u),h=Math.min(a,h),c=Math.max(a,c),p=Math.max(s,p),l&&(i=e.u.x,r=e.u.y,n=e.v.x,o=e.v.y,u=Math.min(r,o,u),h=Math.min(i,n,h),c=Math.max(i,n,c),p=Math.max(r,o,p))}),_.isNumber(t)&&(u-=t,h-=t,c+=t,p+=t),{top:u,left:h,right:c,bottom:p,width:c-h,height:p-u,centroid:{x:-h,y:-u}}},getTriangles:function(e){var t=e.top,i=e.left,r=e.right,n=e.bottom;return new Two.Array([i,t,r,t,i,n,i,n,r,t,r,n])},updateCanvas:function(e){var p=e.commands,t=this.canvas,d=this.ctx,f=e._scale,i=e.stroke,r=e.linewidth*f,n=e.fill,o=e.opacity,a=e.cap,s=e.join,l=e.miter,m=e.curved,E=e.closed,v=p.length,g=v-1;t.width=Math.max(Math.ceil(e.rect.width*f),1),t.height=Math.max(Math.ceil(e.rect.height*f),1);var h=e.rect.centroid,y=h.x*f,T=h.y*f;d.clearRect(0,0,t.width,t.height),n&&(d.fillStyle=n),i&&(d.strokeStyle=i),r&&(d.lineWidth=r),l&&(d.miterLimit=l),s&&(d.lineJoin=s),a&&(d.lineCap=a),_.isNumber(o)&&(d.globalAlpha=o),d.beginPath(),_.each(p,function(e,t){var i=(e.x*f+y).toFixed(3),r=(e.y*f+T).toFixed(3);if(m){var n=E?x(t-1,v):Math.max(t-1,0),o=E?x(t+1,v):Math.min(t+1,g),a=p[n],s=p[o],l=(a.v.x*f+y).toFixed(3),h=(a.v.y*f+T).toFixed(3),c=(e.u.x*f+y).toFixed(3),u=(e.u.y*f+T).toFixed(3);t<=0?d.moveTo(i,r):(d.bezierCurveTo(l,h,c,u,i,r),g<=t&&E&&(l=(e.v.x*f+y).toFixed(3),h=(e.v.y*f+T).toFixed(3),c=(s.u.x*f+y).toFixed(3),u=(s.u.y*f+T).toFixed(3),i=(s.x*f+y).toFixed(3),r=(s.y*f+T).toFixed(3),d.bezierCurveTo(l,h,c,u,i,r)))}else t<=0?d.moveTo(i,r):d.lineTo(i,r)}),E&&!m&&d.closePath(),d.fill(),d.stroke()},updateTexture:function(e,t){this.updateCanvas(t),t.texture&&e.deleteTexture(t.texture),e.bindBuffer(e.ARRAY_BUFFER,t.textureCoordsBuffer),t.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),this.canvas.width<=0||this.canvas.height<=0||e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(e,t,i){_.isObject(t.buffer)&&e.deleteBuffer(t.buffer),t.buffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t.buffer),e.enableVertexAttribArray(i.position),e.bufferData(e.ARRAY_BUFFER,t.triangles,e.STATIC_DRAW),_.isObject(t.textureCoordsBuffer)&&e.deleteBuffer(t.textureCoordsBuffer),t.textureCoordsBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t.textureCoordsBuffer),e.enableVertexAttribArray(i.textureCoords),e.bufferData(e.ARRAY_BUFFER,this.uv,e.STATIC_DRAW)},program:{create:function(t,e){var i=t.createProgram();if(_.each(e,function(e){t.attachShader(i,e)}),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw error=t.getProgramInfoLog(i),t.deleteProgram(i),new Two.Utils.Error("unable to link program: "+error);return i}},shaders:{create:function(e,t,i){var r=e.createShader(e[i]);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var n=e.getShaderInfoLog(r);throw e.deleteShader(r),new Two.Utils.Error("unable to compile shader "+r+": "+n)}return r},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:["attribute vec2 a_position;","attribute vec2 a_textureCoords;","","uniform mat3 u_matrix;","uniform vec2 u_resolution;","","varying vec2 v_textureCoords;","","void main() {","   vec2 projected = (u_matrix * vec3(a_position, 1)).xy;","   vec2 normal = projected / u_resolution;","   vec2 clipspace = (normal * 2.0) - 1.0;","","   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);","   v_textureCoords = a_textureCoords;","}"].join("\n"),fragment:["precision mediump float;","","uniform sampler2D u_image;","varying vec2 v_textureCoords;","","void main() {","  gl_FragColor = texture2D(u_image, v_textureCoords);","}"].join("\n")}};v.ctx=v.canvas.getContext("2d");var t=Two[Two.Types.webgl]=function(e){this.count=0,this.domElement=document.createElement("canvas"),this.elements=[],this.stage=null;var t=_.defaults(e||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1}),i=this.ctx=this.domElement.getContext("webgl",t)||this.domElement.getContext("experimental-webgl",t);if(!this.ctx)throw new Two.Utils.Error("unable to create a webgl context. Try using another renderer.");var r=v.shaders.create(i,v.shaders.vertex,v.shaders.types.vertex),n=v.shaders.create(i,v.shaders.fragment,v.shaders.types.fragment);this.program=v.program.create(i,[r,n]),i.useProgram(this.program),this.program.position=i.getAttribLocation(this.program,"a_position"),this.program.matrix=i.getUniformLocation(this.program,"u_matrix"),this.program.textureCoords=i.getAttribLocation(this.program,"a_textureCoords"),i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)};function s(e,t){var i=Math.min(e.top,t.top),r=Math.min(e.left,t.left),n=Math.max(e.right,t.right),o=Math.max(e.bottom,t.bottom);return{top:i,left:r,right:n,bottom:o,width:n-r,height:o-i,centroid:{x:-r,y:-i}}}_.extend(t,{Group:e,Element:E,getStyles:function(e){var t={},i=e.id,r=e._matrix,n=e.stroke,o=e.linewidth,a=e.fill,s=e.opacity,l=e.visible,h=e.cap,c=e.join,u=e.miter,p=e.curved,d=e.closed,f=e.vertices;i&&(t.id=i);_.isObject(r)&&(t.matrix=t._matrix=r.toArray(!0),t.scale=t._scale=1);n&&(t.stroke=n);a&&(t.fill=a);_.isNumber(s)&&(t.opacity=s);h&&(t.cap=h);c&&(t.join=c);u&&(t.miter=u);o&&(t.linewidth=o);f&&(t.vertices=m(f,p,d),t.commands=t.vertices,t.rect=v.getBoundingClientRect(t.commands,t.linewidth,t.curved),t.triangles=v.getTriangles(t.rect));t.visible=!!l,t.curved=!!p,t.closed=!!d,e instanceof Two.Polygon&&(v.updateBuffer(this.ctx,t,this.program),E.prototype.updateTexture.call(t,this.ctx));return t},setStyles:function(e,t,i,r,n,o){var a=!1;/matrix/.test(t)?(e[t]=i.toArray(!0),_.isNumber(r)&&(a=e.scale!==r,e.scale=r),e.updateMatrix()):/(stroke|fill|opacity|cap|join|miter|linewidth)/.test(t)?(e[t]=i,e.rect=s(v.getBoundingClientRect(e.commands,e.linewidth,e.curved),e.rect),e.triangles=v.getTriangles(e.rect),v.updateBuffer(this.ctx,e,this.program),a=!0):"vertices"===t?(_.isUndefined(r)||(e.closed=r),_.isUndefined(n)||(e.curved=n),o?e.commands=m(i,e.curved,e.closed):(e.vertices=m(i,e.curved,e.closed),e.commands=e.vertices),e.rect=s(v.getBoundingClientRect(e.vertices,e.linewidth,e.curved),e.rect),e.triangles=v.getTriangles(e.rect),v.updateBuffer(this.ctx,e,this.program),a=!0):e[t]=i;a&&e.updateTexture(this.ctx)}}),_.extend(t.prototype,Backbone.Events,r.prototype,{setSize:function(e,t){r.prototype.setSize.apply(this,arguments),this.ctx.viewport(0,0,e,t);var i=this.ctx.getUniformLocation(this.program,"u_resolution");return this.ctx.uniform2f(i,e,t),this},render:function(){return _.isNull(this.stage)||this.stage.render(this.ctx,this.program),this}})}(),function(){var i=Two.Shape=function(e){this._matrix=new Two.Matrix;var t=this._updateMatrix=_.debounce(_.bind(function(){var e=this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation);this.trigger(Two.Events.change,this.id,"matrix",e,this.scale)},this),0);if(this._rotation=0,Object.defineProperty(this,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,t()}}),this._scale="scale",Object.defineProperty(this,"scale",{get:function(){return this._scale},set:function(e){this._scale=e,t()}}),this.translation=new Two.Vector,this.rotation=0,this.scale=1,this.translation.bind(Two.Events.change,t),e)return this;i.MakeGetterSetter(this,i.Properties),this.fill="#fff",this.stroke="#000",this.linewidth=1,this.opacity=1,this.visible=!0,this.cap="round",this.join="round",this.miter=1};_.extend(i,{Properties:["fill","stroke","linewidth","opacity","visible","cap","join","miter"],MakeGetterSetter:function(e,t){_.isArray(t)||(t=[t]),_.each(t,function(t){var i="_"+t;Object.defineProperty(e,t,{get:function(){return this[i]},set:function(e){this[i]=e,this.trigger(Two.Events.change,this.id,t,e,this)}})})}}),_.extend(i.prototype,Backbone.Events,{addTo:function(e){return e.add(this),this},noFill:function(){return this.fill="transparent",this},noStroke:function(){return this.stroke="transparent",this},clone:function(){var t=new i;return t.translation.copy(this.translation),_.each(i.Properties,function(e){t[e]=this[e]},this),this}})}(),function(){var r=Two.Group=function(e){Two.Shape.call(this,!0),delete this.stroke,delete this.fill,delete this.linewidth,delete this.opacity,delete this.cap,delete this.join,delete this.miter,r.MakeGetterSetter(this,Two.Shape.Properties),this.children={}};_.extend(r,{MakeGetterSetter:function(t,e){_.isArray(e)||(e=[e]),_.each(e,function(i){var e="_"+i;Object.defineProperty(t,i,{get:function(){return this[e]},set:function(t){this[e]=t,_.each(this.children,function(e){e[i]=t})}})})}}),_.extend(r.prototype,Two.Shape.prototype,{clone:function(t){t=t||this.parent;var e=_.map(this.children,function(e){return e.clone(t)}),i=new r;return t.add(i),i.add(e),i.translation.copy(this.translation),i.rotation=this.rotation,i.scale=this.scale,i},center:function(){var t=this.getBoundingClientRect();return t.centroid={x:t.left+t.width/2,y:t.top+t.height/2},_.each(this.children,function(e){e.translation.subSelf(t.centroid)}),this.translation.copy(t.centroid),this},add:function(e){arguments.length;var t=e,r=this.children,n=this.parent,o=[];_.isArray(e)||(t=_.toArray(arguments));var a=_.bind(function(e,t,i,r,n,o){this.trigger(Two.Events.change,e,t,i,r,n,o)},this);return _.each(t,function(e){var t=e.id,i=e.parent;_.isUndefined(t)&&(n.add(e),t=e.id),_.isUndefined(r[t])&&(i&&delete i.children[t],(r[t]=e).parent=this,e.unbind(Two.Events.change).bind(Two.Events.change,a),o.push(t))},this),0<o.length&&this.trigger(Two.Events.change,this.id,Two.Properties.hierarchy,o),this},remove:function(e){var t=arguments.length,i=e,r=this.children,n=this.parent,o=[];return t<=0&&n?n.remove(this):(_.isArray(e)||(i=_.toArray(arguments)),_.each(i,function(e){var t=e.id;e.children;t in r&&(delete r[t],e.unbind(Two.Events.change),o.push(t))}),0<o.length&&this.trigger(Two.Events.change,this.id,Two.Properties.demotion,o)),this},getBoundingClientRect:function(e){var i=1/0,r=-1/0,n=1/0,o=-1/0;_.each(this.children,function(e){var t=e.getBoundingClientRect();n&&i&&r&&o&&(n=Math.min(t.top,n),i=Math.min(t.left,i),r=Math.max(t.right,r),o=Math.max(t.bottom,o))},this);var t=e?this._matrix:Two.Utils.getComputedMatrix(this),a=t.multiply(i,n,1),s=t.multiply(r,o,1);return{top:a.y,left:a.x,right:s.x,bottom:s.y,width:s.x-a.x,height:s.y-a.y}},noFill:function(){return _.each(this.children,function(e){e.noFill()}),this},noStroke:function(){return _.each(this.children,function(e){e.noStroke()}),this}})}(),function(){var i=Math.min,r=Math.max,d=Math.round,n=Two.Polygon=function(e,s,l){Two.Shape.call(this),s=!!s,l=!!l;var h=0,c=1,u=!1,p=e.slice(0),t=_.debounce(_.bind(function(e){var t,i,r,n;if(u){t=this.vertices.length,i=d(h*(n=t-1)),r=d(c*n),p.length=0;for(var o=i;o<r+1;o++){var a=this.vertices[o];p.push(new Two.Vector(a.x,a.y))}}this.trigger(Two.Events.change,this.id,"vertices",p,s,l,u),u=!1},this),0);Object.defineProperty(this,"closed",{get:function(){return s},set:function(e){s=!!e,t()}}),Object.defineProperty(this,"curved",{get:function(){return l},set:function(e){l=!!e,t()}}),Object.defineProperty(this,"beginning",{get:function(){return h},set:function(e){h=i(r(e,0),1),u=!0,t()}}),Object.defineProperty(this,"ending",{get:function(){return c},set:function(e){c=i(r(e,0),1),u=!0,t()}}),this.vertices=e.slice(0),_.each(this.vertices,function(e){e.bind(Two.Events.change,t)},this),t()};_.extend(n.prototype,Two.Shape.prototype,{clone:function(){var e=_.map(this.vertices,function(e){return new Two.Vector(e.x,e.y)}),t=new n(e,this.closed,this.curved);return _.each(Two.Shape.Properties,function(e){t[e]=this[e]},this),t.translation.copy(this.translation),t.rotation=this.rotation,t.scale=this.scale,t},center:function(){var t=this.getBoundingClientRect();return t.centroid={x:t.left+t.width/2,y:t.top+t.height/2},_.each(this.vertices,function(e){e.subSelf(t.centroid)}),this.translation.addSelf(t.centroid),this},remove:function(){return this.parent&&this.parent.remove(this),this},getBoundingClientRect:function(e){var t=this.linewidth,r=1/0,n=-1/0,o=1/0,a=-1/0;_.each(this.vertices,function(e){var t=e.x,i=e.y;o=Math.min(i,o),r=Math.min(t,r),n=Math.max(t,n),a=Math.max(i,a)}),o-=t,r-=t,n+=t,a+=t;var i=e?this._matrix:Two.Utils.getComputedMatrix(this),s=i.multiply(r,o,1),l=i.multiply(n,a,1);return{top:s.y,left:s.x,right:l.x,bottom:l.y,width:l.x-s.x,height:l.y-s.y}}})}(),function(e){var t=e.noise={};function i(e,t,i){this.x=e,this.y=t,this.z=i}i.prototype.dot2=function(e,t){return this.x*e+this.y*t},i.prototype.dot3=function(e,t,i){return this.x*e+this.y*t+this.z*i};var r=[new i(1,1,0),new i(-1,1,0),new i(1,-1,0),new i(-1,-1,0),new i(1,0,1),new i(-1,0,1),new i(1,0,-1),new i(-1,0,-1),new i(0,1,1),new i(0,-1,1),new i(0,1,-1),new i(0,-1,-1)],n=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],F=new Array(512),N=new Array(512);t.seed=function(e){0<e&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var i;i=1&t?n[t]^255&e:n[t]^e>>8&255,F[t]=F[t+256]=i,N[t]=N[t+256]=r[i%12]}},t.seed(0);var T=.5*(Math.sqrt(3)-1),x=(3-Math.sqrt(3))/6,U=1/6;function v(e){return e*e*e*(e*(6*e-15)+10)}function g(e,t,i){return(1-i)*e+i*t}t.simplex2=function(e,t){var i,r,n=(e+t)*T,o=Math.floor(e+n),a=Math.floor(t+n),s=(o+a)*x,l=e-o+s,h=t-a+s;h<l?(i=1,r=0):(i=0,r=1);var c=l-i+x,u=h-r+x,p=l-1+2*x,d=h-1+2*x,f=N[(o&=255)+F[a&=255]],m=N[o+i+F[a+r]],E=N[o+1+F[a+1]],v=.5-l*l-h*h,g=.5-c*c-u*u,y=.5-p*p-d*d;return 70*((v<0?0:(v*=v)*v*f.dot2(l,h))+(g<0?0:(g*=g)*g*m.dot2(c,u))+(y<0?0:(y*=y)*y*E.dot2(p,d)))},t.simplex3=function(e,t,i){var r,n,o,a,s,l,h=(e+t+i)*(1/3),c=Math.floor(e+h),u=Math.floor(t+h),p=Math.floor(i+h),d=(c+u+p)*U,f=e-c+d,m=t-u+d,E=i-p+d;m<=f?E<=m?(s=a=r=1,l=o=n=0):E<=f?(s=o=n=0,l=a=r=1):(s=n=r=0,l=a=o=1):m<E?(a=n=r=0,l=s=o=1):f<E?(a=o=r=0,l=s=n=1):(s=a=n=1,l=o=r=0);var v=f-r+U,g=m-n+U,y=E-o+U,T=f-a+2*U,x=m-s+2*U,b=E-l+2*U,R=f-1+.5,w=m-1+.5,H=E-1+.5,_=N[(c&=255)+F[(u&=255)+F[p&=255]]],S=N[c+r+F[u+n+F[p+o]]],M=N[c+a+F[u+s+F[p+l]]],C=N[c+1+F[u+1+F[p+1]]],A=.5-f*f-m*m-E*E,L=.5-v*v-g*g-y*y,P=.5-T*T-x*x-b*b,D=.5-R*R-w*w-H*H;return 32*((A<0?0:(A*=A)*A*_.dot3(f,m,E))+(L<0?0:(L*=L)*L*S.dot3(v,g,y))+(P<0?0:(P*=P)*P*M.dot3(T,x,b))+(D<0?0:(D*=D)*D*C.dot3(R,w,H)))},t.perlin2=function(e,t){var i=Math.floor(e),r=Math.floor(t);e-=i,t-=r;var n=N[(i&=255)+F[r&=255]].dot2(e,t),o=N[i+F[r+1]].dot2(e,t-1),a=N[i+1+F[r]].dot2(e-1,t),s=N[i+1+F[r+1]].dot2(e-1,t-1),l=v(e);return g(g(n,a,l),g(o,s,l),v(t))},t.perlin3=function(e,t,i){var r=Math.floor(e),n=Math.floor(t),o=Math.floor(i);e-=r,t-=n,i-=o;var a=N[(r&=255)+F[(n&=255)+F[o&=255]]].dot3(e,t,i),s=N[r+F[n+F[o+1]]].dot3(e,t,i-1),l=N[r+F[n+1+F[o]]].dot3(e,t-1,i),h=N[r+F[n+1+F[o+1]]].dot3(e,t-1,i-1),c=N[r+1+F[n+F[o]]].dot3(e-1,t,i),u=N[r+1+F[n+F[o+1]]].dot3(e-1,t,i-1),p=N[r+1+F[n+1+F[o]]].dot3(e-1,t-1,i),d=N[r+1+F[n+1+F[o+1]]].dot3(e-1,t-1,i-1),f=v(e),m=v(t),E=v(i);return g(g(g(a,c,f),g(s,u,f),E),g(g(l,p,f),g(h,d,f),E),m)}}(this);var SimplexNoise=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};SimplexNoise.prototype.dot=function(e,t,i){return e[0]*t+e[1]*i},SimplexNoise.prototype.noise=function(e,t){var i,r,n=(e+t)*(.5*(Math.sqrt(3)-1)),o=Math.floor(e+n),a=Math.floor(t+n),s=(3-Math.sqrt(3))/6,l=(o+a)*s,h=e-(o-l),c=t-(a-l);c<h?(i=1,r=0):(i=0,r=1);var u=h-i+s,p=c-r+s,d=h-1+2*s,f=c-1+2*s,m=255&o,E=255&a,v=this.perm[m+this.perm[E]]%12,g=this.perm[m+i+this.perm[E+r]]%12,y=this.perm[m+1+this.perm[E+1]]%12,T=.5-h*h-c*c,x=.5-u*u-p*p,b=.5-d*d-f*f;return 70*((T<0?0:(T*=T)*T*this.dot(this.grad3[v],h,c))+(x<0?0:(x*=x)*x*this.dot(this.grad3[g],u,p))+(b<0?0:(b*=b)*b*this.dot(this.grad3[y],d,f)))},SimplexNoise.prototype.noise3d=function(e,t,i){var r,n,o,a,s,l,h=(e+t+i)*(1/3),c=Math.floor(e+h),u=Math.floor(t+h),p=Math.floor(i+h),d=1/6,f=(c+u+p)*d,m=e-(c-f),E=t-(u-f),v=i-(p-f);E<=m?v<=E?(s=a=r=1,l=o=n=0):v<=m?(s=o=n=0,l=a=r=1):(s=n=r=0,l=a=o=1):E<v?(a=n=r=0,l=s=o=1):m<v?(a=o=r=0,l=s=n=1):(s=a=n=1,l=o=r=0);var g=m-r+d,y=E-n+d,T=v-o+d,x=m-a+2*d,b=E-s+2*d,R=v-l+2*d,w=m-1+.5,H=E-1+.5,_=v-1+.5,S=255&c,M=255&u,C=255&p,A=this.perm[S+this.perm[M+this.perm[C]]]%12,L=this.perm[S+r+this.perm[M+n+this.perm[C+o]]]%12,P=this.perm[S+a+this.perm[M+s+this.perm[C+l]]]%12,D=this.perm[S+1+this.perm[M+1+this.perm[C+1]]]%12,F=.6-m*m-E*E-v*v,N=.6-g*g-y*y-T*T,U=.6-x*x-b*b-R*R,B=.6-w*w-H*H-_*_;return 32*((F<0?0:(F*=F)*F*this.dot(this.grad3[A],m,E,v))+(N<0?0:(N*=N)*N*this.dot(this.grad3[L],g,y,T))+(U<0?0:(U*=U)*U*this.dot(this.grad3[P],x,b,R))+(B<0?0:(B*=B)*B*this.dot(this.grad3[D],w,H,_)))},function(i,a,n){"use strict";var o="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,s=function(){var e=a.createElement("video"),t={request:["requestFullscreen","webkitRequestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen"],exit:["exitFullscreen","webkitExitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen"],enabled:["fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled"],element:["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"],change:["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],error:["fullscreenerror","webkitfullscreenerror","mozfullscreenerror","MSFullscreenError"]},i={};for(var r in t)for(var n=0,o=t[r].length;n<o;n++)if(t[r][n]in e||t[r][n]in a||"on"+t[r][n]in a){i[r]=t[r][n];break}return i}();function r(e){var t=null;if("VIDEO"===e.tagName)t=e;else{var i=e.getElementsByTagName("video");i[0]&&(t=i[0])}return t}var l=null,h=null,c=function(){},u=[],p=-1<navigator.userAgent.indexOf("Android")&&-1<navigator.userAgent.indexOf("Chrome");function d(t){var i=r(t);if(i&&i.webkitEnterFullscreen){try{i.readyState<i.HAVE_METADATA?(i.addEventListener("loadedmetadata",function e(){i.removeEventListener("loadedmetadata",e,!1),i.webkitEnterFullscreen(),h=!!i.getAttribute("controls")},!1),i.load()):(i.webkitEnterFullscreen(),h=!!i.getAttribute("controls")),l=i}catch(e){return v("not_supported",t)}return!0}return v(void 0===s.request?"not_supported":"not_enabled",t)}function f(){g.element||(E(),e())}function e(){n&&"webkitfullscreenchange"===s.change&&i.removeEventListener("resize",f,!1)}var m=function(e){var t=u[u.length-1];(e!==t.element&&e!==l||!t.hasEntered)&&("VIDEO"===e.tagName&&(l=e),1===u.length&&g.onenter(g.element),t.enter.call(t.element,e||t.element),t.hasEntered=!0)},E=function(){l&&!h&&(l.setAttribute("controls","controls"),l.removeAttribute("controls")),h=l=null;var e=u.pop();e&&(e.exit.call(e.element),g.element||(u.forEach(function(e){e.exit.call(e.element)}),u=[],g.onexit()))},v=function(e,t){if(0<u.length){var i=u.pop();t=t||i.element,i.error.call(t,e),g.onerror(t,e)}},g={request:function(t,e,i,r){if(t=t||a.body,u.push({element:t,enter:e||c,exit:i||c,error:r||c}),void 0===s.request)return d(t);if(n&&!1===a[s.enabled])return d(t);if(p)return d(t);if(n&&void 0===s.enabled)return s.enabled="webkitFullscreenEnabled",t[s.request](),void setTimeout(function(){a[s.element]?a[s.enabled]=!0:(a[s.enabled]=!1,d(t))},250);try{/5\.1[\.\d]* Safari/.test(navigator.userAgent)?t[s.request]():t[s.request](o&&Element.ALLOW_KEYBOARD_INPUT),setTimeout(function(){a[s.element]||v(n?"not_enabled":"not_allowed",t)},100)}catch(e){v("not_enabled",t)}},exit:function(){e(),a[s.exit]()},toggle:function(e,t,i,r){g.element?g.exit():g.request(e,t,i,r)},videoEnabled:function(e){if(g.enabled)return!0;var t=r(e=e||a.body);return!(!t||void 0===t.webkitSupportsFullscreen)&&(t.readyState<t.HAVE_METADATA?"maybe":t.webkitSupportsFullscreen)},onenter:c,onexit:c,onchange:c,onerror:c};try{Object.defineProperties(g,{element:{enumerable:!0,get:function(){return l&&l.webkitDisplayingFullscreen?l:a[s.element]||null}},enabled:{enumerable:!0,get:function(){return"webkitCancelFullScreen"===s.exit&&!n||!p&&(a[s.enabled]||!1)}}})}catch(e){g.element=null,g.enabled=!1}s.change&&a.addEventListener(s.change,function(e){if(g.onchange(g.element),g.element){var t=u[u.length-2];t&&t.element===g.element?E():(m(g.element),n&&"webkitfullscreenchange"===s.change&&i.addEventListener("resize",f,!1))}else E()},!1),a.addEventListener("webkitbeginfullscreen",function(e){u.push({element:e.srcElement,enter:c,exit:c,error:c}),g.onchange(e.srcElement),m(e.srcElement)},!0),a.addEventListener("webkitendfullscreen",function(e){g.onchange(e.srcElement),E(e.srcElement)},!0),s.error&&a.addEventListener(s.error,function(e){v("not_allowed")},!1),i.BigScreen=g}(window,document,self!==top);var THREE=THREE||{REVISION:"58"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},THREE.extend=function(e,t){if(Object.keys)for(var i=Object.keys(t),r=0,n=i.length;r<n;r++){var o=i[r];Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}else{var a={}.hasOwnProperty;for(var o in t)a.call(t,o)&&(e[o]=t[o])}return e},function(){for(var n=0,e=["ms","moz","webkit","o"],t=0;t<e.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(e){var t=Date.now(),i=Math.max(0,16-(t-n)),r=window.setTimeout(function(){e(t+i)},i);return n=t+i,r}),window.cancelAnimationFrame=window.cancelAnimationFrame||function(e){window.clearTimeout(e)}}(),THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.Color=function(e){return void 0!==e&&this.set(e),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){return e instanceof THREE.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(e,t,i){if(0===t)this.r=this.g=this.b=i;else{var r=function(e,t,i){return i<0&&(i+=1),1<i&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e},n=i<=.5?i*(1+t):i+t-i*t,o=2*i-n;this.r=r(o,n,e+1/3),this.g=r(o,n,e),this.b=r(o,n,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(e)){var t=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(e)){t=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(THREE.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var h={h:0,s:0,l:0};return function(){var e,t,i=this.r,r=this.g,n=this.b,o=Math.max(i,r,n),a=Math.min(i,r,n),s=(a+o)/2;if(a===o)t=e=0;else{var l=o-a;switch(t=s<=.5?l/(o+a):l/(2-o-a),o){case i:e=(r-n)/l+(r<n?6:0);break;case r:e=(n-i)/l+2;break;case n:e=(i-r)/l+4}e/=6}return h.h=e,h.s=t,h.l=s,h}}(),getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=i,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,t){var i=Math.cos(e.x/2),r=Math.cos(e.y/2),n=Math.cos(e.z/2),o=Math.sin(e.x/2),a=Math.sin(e.y/2),s=Math.sin(e.z/2);return void 0===t||"XYZ"===t?(this.x=o*r*n+i*a*s,this.y=i*a*n-o*r*s,this.z=i*r*s+o*a*n,this.w=i*r*n-o*a*s):"YXZ"===t?(this.x=o*r*n+i*a*s,this.y=i*a*n-o*r*s,this.z=i*r*s-o*a*n,this.w=i*r*n+o*a*s):"ZXY"===t?(this.x=o*r*n-i*a*s,this.y=i*a*n+o*r*s,this.z=i*r*s+o*a*n,this.w=i*r*n-o*a*s):"ZYX"===t?(this.x=o*r*n-i*a*s,this.y=i*a*n+o*r*s,this.z=i*r*s-o*a*n,this.w=i*r*n+o*a*s):"YZX"===t?(this.x=o*r*n+i*a*s,this.y=i*a*n+o*r*s,this.z=i*r*s-o*a*n,this.w=i*r*n-o*a*s):"XZY"===t&&(this.x=o*r*n-i*a*s,this.y=i*a*n-o*r*s,this.z=i*r*s+o*a*n,this.w=i*r*n+o*a*s),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(i),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],a=i[1],s=i[5],l=i[9],h=i[2],c=i[6],u=i[10],p=r+s+u;return 0<p?(t=.5/Math.sqrt(p+1),this.w=.25/t,this.x=(c-l)*t,this.y=(o-h)*t,this.z=(a-n)*t):s<r&&u<r?(t=2*Math.sqrt(1+r-s-u),this.w=(c-l)/t,this.x=.25*t,this.y=(n+a)/t,this.z=(o+h)/t):u<s?(t=2*Math.sqrt(1+s-r-u),this.w=(o-h)/t,this.x=(n+a)/t,this.y=.25*t,this.z=(l+c)/t):(t=2*Math.sqrt(1+u-r-s),this.w=(a-n)/t,this.x=(o+h)/t,this.y=(l+c)/t,this.z=.25*t),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,r=e.y,n=e.z,o=e.w,a=t.x,s=t.y,l=t.z,h=t.w;return this.x=i*h+o*a+r*l-n*s,this.y=r*h+o*s+n*a-i*l,this.z=n*h+o*l+i*s-r*a,this.w=o*h-i*a-r*s-n*l,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var i=this.x,r=this.y,n=this.z,o=this.w,a=o*e.w+i*e.x+r*e.y+n*e.z;if(a<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,a=-a):this.copy(e),1<=a)return this.w=o,this.x=i,this.y=r,this.z=n,this;var s=Math.acos(a),l=Math.sqrt(1-a*a);if(Math.abs(l)<.001)return this.w=.5*(o+this.w),this.x=.5*(i+this.x),this.y=.5*(r+this.y),this.z=.5*(n+this.z),this;var h=Math.sin((1-t)*s)/l,c=Math.sin(t*s)/l;return this.w=o*h+this.w*c,this.x=i*h+this.x*c,this.y=r*h+this.y*c,this.z=n*h+this.z*c,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}},THREE.Quaternion.slerp=function(e,t,i,r){return i.copy(e).slerp(t,r)},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r+n[12],this.y=n[1]*t+n[5]*i+n[9]*r+n[13],this.z=n[2]*t+n[6]*i+n[10]*r+n[14],this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*i,h=s*i+a*t-n*r,c=s*r+n*i-o*t,u=-n*t-o*i-a*r;return this.x=l*s+u*-n+h*-a-c*-o,this.y=h*s+u*-o+c*-n-l*-a,this.z=c*s+u*-a+l*-o-h*-n,this},transformDirection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):(this.x=0,this.y=0,this.z=0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},setEulerFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,n=r[0],o=r[4],a=r[8],s=r[1],l=r[5],h=r[9],c=r[2],u=r[6],p=r[10];return void 0===t||"XYZ"===t?(this.y=Math.asin(i(a)),Math.abs(a)<.99999?(this.x=Math.atan2(-h,p),this.z=Math.atan2(-o,n)):(this.x=Math.atan2(u,l),this.z=0)):"YXZ"===t?(this.x=Math.asin(-i(h)),Math.abs(h)<.99999?(this.y=Math.atan2(a,p),this.z=Math.atan2(s,l)):(this.y=Math.atan2(-c,n),this.z=0)):"ZXY"===t?(this.x=Math.asin(i(u)),Math.abs(u)<.99999?(this.y=Math.atan2(-c,p),this.z=Math.atan2(-o,l)):(this.y=0,this.z=Math.atan2(s,n))):"ZYX"===t?(this.y=Math.asin(-i(c)),Math.abs(c)<.99999?(this.x=Math.atan2(u,p),this.z=Math.atan2(s,n)):(this.x=0,this.z=Math.atan2(-o,l))):"YZX"===t?(this.z=Math.asin(i(s)),Math.abs(s)<.99999?(this.x=Math.atan2(-h,l),this.y=Math.atan2(-c,n)):(this.x=0,this.y=Math.atan2(a,p))):"XZY"===t&&(this.z=Math.asin(-i(o)),Math.abs(o)<.99999?(this.x=Math.atan2(u,l),this.y=Math.atan2(a,n)):(this.x=Math.atan2(-h,p),this.y=0)),this},setEulerFromQuaternion:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.x*e.x,n=e.y*e.y,o=e.z*e.z,a=e.w*e.w;return void 0===t||"XYZ"===t?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),a-r-n+o),this.y=Math.asin(i(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),a+r-n-o)):"YXZ"===t?(this.x=Math.asin(i(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),a-r-n+o),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),a-r+n-o)):"ZXY"===t?(this.x=Math.asin(i(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),a-r-n+o),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),a-r+n-o)):"ZYX"===t?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),a-r-n+o),this.y=Math.asin(i(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),a+r-n-o)):"YZX"===t?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),a-r+n-o),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),a+r-n-o),this.z=Math.asin(i(2*(e.x*e.y+e.z*e.w)))):"XZY"===t&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),a-r+n-o),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),a+r-n-o),this.z=Math.asin(i(2*(e.z*e.w-e.x*e.y)))),this},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=r,this},getColumnFromMatrix:function(e,t){var i=4*e,r=t.elements;return this.x=r[i],this.y=r[i+1],this.z=r[i+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.extend(THREE.Vector3.prototype,{applyEuler:function(){var r=new THREE.Quaternion;return function(e,t){var i=r.setFromEuler(e,t);return this.applyQuaternion(i),this}}(),applyAxisAngle:function(){var r=new THREE.Quaternion;return function(e,t){var i=r.setFromAxisAngle(e,t);return this.applyQuaternion(i),this}}(),projectOnVector:function(){var i=new THREE.Vector3;return function(e){i.copy(e).normalize();var t=this.dot(i);return this.copy(i).multiplyScalar(t)}}(),projectOnPlane:function(){var t=new THREE.Vector3;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new THREE.Vector3;return function(e){return t.copy(this).projectOnVector(e).multiplyScalar(2),this.subVectors(t,this)}}()}),THREE.Vector4=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*n,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*n,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*n,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*n,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.x=0,this.y=0,this.z=0,this.w=1),this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,n,o=e.elements,a=o[0],s=o[4],l=o[8],h=o[1],c=o[5],u=o[9],p=o[2],d=o[6],f=o[10];if(Math.abs(s-h)<.01&&Math.abs(l-p)<.01&&Math.abs(u-d)<.01){if(Math.abs(s+h)<.1&&Math.abs(l+p)<.1&&Math.abs(u+d)<.1&&Math.abs(a+c+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,E=(c+1)/2,v=(f+1)/2,g=(s+h)/4,y=(l+p)/4,T=(u+d)/4;return E<m&&v<m?m<.01?(i=0,n=r=.707106781):(r=g/(i=Math.sqrt(m)),n=y/i):v<E?E<.01?(r=0,n=i=.707106781):(i=g/(r=Math.sqrt(E)),n=T/r):v<.01?(r=i=.707106781,n=0):(i=y/(n=Math.sqrt(v)),r=T/n),this.set(i,r,n,t),this}var x=Math.sqrt((d-u)*(d-u)+(l-p)*(l-p)+(h-s)*(h-s));return Math.abs(x)<.001&&(x=1),this.x=(d-u)/x,this.y=(l-p)/x,this.z=(h-s)/x,this.w=Math.acos((a+c+f-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Line3=function(e,t){this.start=void 0!==e?e:new THREE.Vector3,this.end=void 0!==t?t:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new THREE.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var n=new THREE.Vector3,o=new THREE.Vector3;return function(e,t){n.subVectors(e,this.start),o.subVectors(this.end,this.start);var i=o.dot(o),r=o.dot(n)/i;return t&&(r=THREE.Math.clamp(r,0,1)),r}}(),closestPointToPoint:function(e,t,i){var r=this.closestPointToPointParameter(e,t),n=i||new THREE.Vector3;return this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}},THREE.Box2=function(e,t){this.min=void 0!==e?e:new THREE.Vector2(1/0,1/0),this.max=void 0!==t?t:new THREE.Vector2(-1/0,-1/0)},THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,r=e.length;i<r;i++)(t=e[i]).x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var r=new THREE.Vector2;return function(e,t){var i=r.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e){return new THREE.Vector2((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new THREE.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var t=new THREE.Vector2;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}},THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new THREE.Vector3(-1/0,-1/0,-1/0)},THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,r=e.length;i<r;i++)(t=e[i]).x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var r=new THREE.Vector3;return function(e,t){var i=r.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e){return new THREE.Vector3((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new THREE.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var t=new THREE.Vector3;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var i=new THREE.Vector3;return function(e){var t=e||new THREE.Sphere;return t.center=this.center(),t.radius=.5*this.size(i).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var t=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(e){return t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(t),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}},THREE.Matrix3=function(e,t,i,r,n,o,a,s,l){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,i||0,r||0,void 0!==n?n:1,o||0,a||0,s||0,void 0!==l?l:1)},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,i,r,n,o,a,s,l){var h=this.elements;return h[0]=e,h[3]=t,h[6]=i,h[1]=r,h[4]=n,h[7]=o,h[2]=a,h[5]=s,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var r=new THREE.Vector3;return function(e){for(var t=0,i=e.length;t<i;t+=3)r.x=e[t],r.y=e[t+1],r.z=e[t+2],r.applyMatrix3(this),e[t]=r.x,e[t+1]=r.y,e[t+2]=r.z;return e}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],h=e[8];return t*o*h-t*a*l-i*n*h+i*a*s+r*n*l-r*o*s},getInverse:function(e,t){var i=e.elements,r=this.elements;r[0]=i[10]*i[5]-i[6]*i[9],r[1]=-i[10]*i[1]+i[2]*i[9],r[2]=i[6]*i[1]-i[2]*i[5],r[3]=-i[10]*i[4]+i[6]*i[8],r[4]=i[10]*i[0]-i[2]*i[8],r[5]=-i[6]*i[0]+i[2]*i[4],r[6]=i[9]*i[4]-i[5]*i[8],r[7]=-i[9]*i[0]+i[1]*i[8],r[8]=i[5]*i[0]-i[1]*i[4];var n=i[0]*r[0]+i[1]*r[3]+i[2]*r[6];if(0===n){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new THREE.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},THREE.Matrix4=function(e,t,i,r,n,o,a,s,l,h,c,u,p,d,f,m){var E=this.elements=new Float32Array(16);E[0]=void 0!==e?e:1,E[4]=t||0,E[8]=i||0,E[12]=r||0,E[1]=n||0,E[5]=void 0!==o?o:1,E[9]=a||0,E[13]=s||0,E[2]=l||0,E[6]=h||0,E[10]=void 0!==c?c:1,E[14]=u||0,E[3]=p||0,E[7]=d||0,E[11]=f||0,E[15]=void 0!==m?m:1},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,i,r,n,o,a,s,l,h,c,u,p,d,f,m){var E=this.elements;return E[0]=e,E[4]=t,E[8]=i,E[12]=r,E[1]=n,E[5]=o,E[9]=a,E[13]=s,E[2]=l,E[6]=h,E[10]=c,E[14]=u,E[3]=p,E[7]=d,E[11]=f,E[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractRotation:function(){var a=new THREE.Vector3;return function(e){var t=this.elements,i=e.elements,r=1/a.set(i[0],i[1],i[2]).length(),n=1/a.set(i[4],i[5],i[6]).length(),o=1/a.set(i[8],i[9],i[10]).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,this}}(),setRotationFromEuler:function(e,t){return console.warn("DEPRECATED: Matrix4's .setRotationFromEuler() has been deprecated in favor of makeRotationFromEuler.  Please update your code."),this.makeRotationFromEuler(e,t)},makeRotationFromEuler:function(e,t){var i=this.elements,r=e.x,n=e.y,o=e.z,a=Math.cos(r),s=Math.sin(r),l=Math.cos(n),h=Math.sin(n),c=Math.cos(o),u=Math.sin(o);if(void 0===t||"XYZ"===t){var p=a*c,d=a*u,f=s*c,m=s*u;i[0]=l*c,i[4]=-l*u,i[8]=h,i[1]=d+f*h,i[5]=p-m*h,i[9]=-s*l,i[2]=m-p*h,i[6]=f+d*h,i[10]=a*l}else if("YXZ"===t){var E=l*c,v=l*u,g=h*c,y=h*u;i[0]=E+y*s,i[4]=g*s-v,i[8]=a*h,i[1]=a*u,i[5]=a*c,i[9]=-s,i[2]=v*s-g,i[6]=y+E*s,i[10]=a*l}else if("ZXY"===t){E=l*c,v=l*u,g=h*c,y=h*u;i[0]=E-y*s,i[4]=-a*u,i[8]=g+v*s,i[1]=v+g*s,i[5]=a*c,i[9]=y-E*s,i[2]=-a*h,i[6]=s,i[10]=a*l}else if("ZYX"===t){p=a*c,d=a*u,f=s*c,m=s*u;i[0]=l*c,i[4]=f*h-d,i[8]=p*h+m,i[1]=l*u,i[5]=m*h+p,i[9]=d*h-f,i[2]=-h,i[6]=s*l,i[10]=a*l}else if("YZX"===t){var T=a*l,x=a*h,b=s*l,R=s*h;i[0]=l*c,i[4]=R-T*u,i[8]=b*u+x,i[1]=u,i[5]=a*c,i[9]=-s*c,i[2]=-h*c,i[6]=x*u+b,i[10]=T-R*u}else if("XZY"===t){T=a*l,x=a*h,b=s*l,R=s*h;i[0]=l*c,i[4]=-u,i[8]=h*c,i[1]=T*u+R,i[5]=a*c,i[9]=x*u-b,i[2]=b*u-x,i[6]=s*c,i[10]=R*u+T}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z,o=e.w,a=i+i,s=r+r,l=n+n,h=i*a,c=i*s,u=i*l,p=r*s,d=r*l,f=n*l,m=o*a,E=o*s,v=o*l;return t[0]=1-(p+f),t[4]=c-v,t[8]=u+E,t[1]=c+v,t[5]=1-(h+f),t[9]=d-m,t[2]=u-E,t[6]=d+m,t[10]=1-(h+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var n=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3;return function(e,t,i){var r=this.elements;return a.subVectors(e,t).normalize(),0===a.length()&&(a.z=1),n.crossVectors(i,a).normalize(),0===n.length()&&(a.x+=1e-4,n.crossVectors(i,a).normalize()),o.crossVectors(a,n),r[0]=n.x,r[4]=o.x,r[8]=a.x,r[1]=n.y,r[5]=o.y,r[9]=a.y,r[2]=n.z,r[6]=o.z,r[10]=a.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],h=i[1],c=i[5],u=i[9],p=i[13],d=i[2],f=i[6],m=i[10],E=i[14],v=i[3],g=i[7],y=i[11],T=i[15],x=r[0],b=r[4],R=r[8],w=r[12],H=r[1],_=r[5],S=r[9],M=r[13],C=r[2],A=r[6],L=r[10],P=r[14],D=r[3],F=r[7],N=r[11],U=r[15];return n[0]=o*x+a*H+s*C+l*D,n[4]=o*b+a*_+s*A+l*F,n[8]=o*R+a*S+s*L+l*N,n[12]=o*w+a*M+s*P+l*U,n[1]=h*x+c*H+u*C+p*D,n[5]=h*b+c*_+u*A+p*F,n[9]=h*R+c*S+u*L+p*N,n[13]=h*w+c*M+u*P+p*U,n[2]=d*x+f*H+m*C+E*D,n[6]=d*b+f*_+m*A+E*F,n[10]=d*R+f*S+m*L+E*N,n[14]=d*w+f*M+m*P+E*U,n[3]=v*x+g*H+y*C+T*D,n[7]=v*b+g*_+y*A+T*F,n[11]=v*R+g*S+y*L+T*N,n[15]=v*w+g*M+y*P+T*U,this},multiplyToArray:function(e,t,i){var r=this.elements;return this.multiplyMatrices(e,t),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var r=new THREE.Vector3;return function(e){for(var t=0,i=e.length;t<i;t+=3)r.x=e[t],r.y=e[t+1],r.z=e[t+2],r.applyProjection(this),e[t]=r.x,e[t+1]=r.y,e[t+2]=r.z;return e}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],a=e[5],s=e[9],l=e[13],h=e[2],c=e[6],u=e[10],p=e[14];return e[3]*(+n*s*c-r*l*c-n*a*u+i*l*u+r*a*p-i*s*p)+e[7]*(+t*s*p-t*l*u+n*o*u-r*o*p+r*l*h-n*s*h)+e[11]*(+t*l*c-t*a*p-n*o*c+i*o*p+n*a*h-i*l*h)+e[15]*(-r*a*h-t*s*c+t*a*u+r*o*c-i*o*u+i*s*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var t=new THREE.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var e=this.elements;return t.set(e[12],e[13],e[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[4],a=r[8],s=r[12],l=r[1],h=r[5],c=r[9],u=r[13],p=r[2],d=r[6],f=r[10],m=r[14],E=r[3],v=r[7],g=r[11],y=r[15];i[0]=c*m*v-u*f*v+u*d*g-h*m*g-c*d*y+h*f*y,i[4]=s*f*v-a*m*v-s*d*g+o*m*g+a*d*y-o*f*y,i[8]=a*u*v-s*c*v+s*h*g-o*u*g-a*h*y+o*c*y,i[12]=s*c*d-a*u*d-s*h*f+o*u*f+a*h*m-o*c*m,i[1]=u*f*E-c*m*E-u*p*g+l*m*g+c*p*y-l*f*y,i[5]=a*m*E-s*f*E+s*p*g-n*m*g-a*p*y+n*f*y,i[9]=s*c*E-a*u*E-s*l*g+n*u*g+a*l*y-n*c*y,i[13]=a*u*p-s*c*p+s*l*f-n*u*f-a*l*m+n*c*m,i[2]=h*m*E-u*d*E+u*p*v-l*m*v-h*p*y+l*d*y,i[6]=s*d*E-o*m*E-s*p*v+n*m*v+o*p*y-n*d*y,i[10]=o*u*E-s*h*E+s*l*v-n*u*v-o*l*y+n*h*y,i[14]=s*h*p-o*u*p-s*l*d+n*u*d+o*l*m-n*h*m,i[3]=c*d*E-h*f*E-c*p*v+l*f*v+h*p*g-l*d*g,i[7]=o*f*E-a*d*E+a*p*v-n*f*v-o*p*g+n*d*g,i[11]=a*h*E-o*c*E-a*l*v+n*c*v+o*l*g-n*h*g,i[15]=o*c*p-a*h*p+a*l*d-n*c*d-o*l*f+n*h*f;var T=r[0]*i[0]+r[1]*i[4]+r[2]*i[8]+r[3]*i[12];if(0==T){var x="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(x);return console.warn(x),this.identity(),this}return this.multiplyScalar(1/T),this},translate:function(e){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(e){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(e){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(e){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,r)))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,a=e.y,s=e.z,l=n*o,h=n*a;return this.set(l*o+i,l*a-r*s,l*s+r*a,0,l*a+r*s,h*a+i,h*s-r*o,0,l*s-r*a,h*s+r*o,n*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return console.warn("DEPRECATED: Matrix4's .compose() has been deprecated in favor of makeFromPositionQuaternionScale. Please update your code."),this.makeFromPositionQuaternionScale(e,t,i)},makeFromPositionQuaternionScale:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},makeFromPositionEulerScale:function(e,t,i,r){return this.makeRotationFromEuler(t,i),this.scale(r),this.setPosition(e),this},makeFrustum:function(e,t,i,r,n,o){var a=this.elements,s=2*n/(t-e),l=2*n/(r-i),h=(t+e)/(t-e),c=(r+i)/(r-i),u=-(o+n)/(o-n),p=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,i,r){var n=i*Math.tan(THREE.Math.degToRad(.5*e)),o=-n,a=o*t,s=n*t;return this.makeFrustum(a,s,o,n,i,r)},makeOrthographic:function(e,t,i,r,n,o){var a=this.elements,s=t-e,l=i-r,h=o-n,c=(t+e)/s,u=(i+r)/l,p=(o+n)/h;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2/l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2/h,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},THREE.extend(THREE.Matrix4.prototype,{decompose:function(){var n=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Matrix4;return function(e,t,i){var r=this.elements;return n.set(r[0],r[1],r[2]),o.set(r[4],r[5],r[6]),a.set(r[8],r[9],r[10]),e=e instanceof THREE.Vector3?e:new THREE.Vector3,t=t instanceof THREE.Quaternion?t:new THREE.Quaternion,(i=i instanceof THREE.Vector3?i:new THREE.Vector3).x=n.length(),i.y=o.length(),i.z=a.length(),e.x=r[12],e.y=r[13],e.z=r[14],s.copy(this),s.elements[0]/=i.x,s.elements[1]/=i.x,s.elements[2]/=i.x,s.elements[4]/=i.y,s.elements[5]/=i.y,s.elements[6]/=i.y,s.elements[8]/=i.z,s.elements[9]/=i.z,s.elements[10]/=i.z,t.setFromRotationMatrix(s),[e,t,i]}}()}),THREE.Ray=function(e,t){this.origin=void 0!==e?e:new THREE.Vector3,this.direction=void 0!==t?t:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new THREE.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var t=new THREE.Vector3;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(e,t){var i=t||new THREE.Vector3;i.subVectors(e,this.origin);var r=i.dot(this.direction);return i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var i=new THREE.Vector3;return function(e){var t=i.subVectors(e,this.origin).dot(this.direction);return i.copy(this.direction).multiplyScalar(t).add(this.origin),i.distanceTo(e)}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){return 0!=e.normal.dot(this.direction)||0==e.distanceToPoint(this.origin)},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0==t?0==e.distanceToPoint(this.origin)?0:void 0:-(this.origin.dot(e.normal)+e.constant)/t},intersectPlane:function(e,t){var i=this.distanceToPlane(e);if(void 0!==i)return this.at(i,t)},applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}},THREE.Sphere=function(e,t){this.center=void 0!==e?e:new THREE.Vector3,this.radius=void 0!==t?t:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromCenterAndPoints:function(e,t){for(var i=0,r=0,n=t.length;r<n;r++){var o=e.distanceToSquared(t[r]);i=Math.max(i,o)}return this.center=e,this.radius=Math.sqrt(i),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),r=t||new THREE.Vector3;return r.copy(e),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new THREE.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}},THREE.Frustum=function(e,t,i,r,n,o){this.planes=[void 0!==e?e:new THREE.Plane,void 0!==t?t:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==n?n:new THREE.Plane,void 0!==o?o:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,i,r,n,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(o),this},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],h=i[6],c=i[7],u=i[8],p=i[9],d=i[10],f=i[11],m=i[12],E=i[13],v=i[14],g=i[15];return t[0].setComponents(a-r,c-s,f-u,g-m).normalize(),t[1].setComponents(a+r,c+s,f+u,g+m).normalize(),t[2].setComponents(a+n,c+l,f+p,g+E).normalize(),t[3].setComponents(a-n,c-l,f-p,g-E).normalize(),t[4].setComponents(a-o,c-h,f-d,g-v).normalize(),t[5].setComponents(a+o,c+h,f+d,g+v).normalize(),this},intersectsObject:function(){var o=new THREE.Vector3;return function(e){var t=e.matrixWorld,i=this.planes,r=-e.geometry.boundingSphere.radius*t.getMaxScaleOnAxis();o.getPositionFromMatrix(t);for(var n=0;n<6;n++){if(i[n].distanceToPoint(o)<r)return!1}return!0}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(i)<r)return!1}return!0},containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}},THREE.Plane=function(e,t){this.normal=void 0!==e?e:new THREE.Vector3(1,0,0),this.constant=void 0!==t?t:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var n=new THREE.Vector3,o=new THREE.Vector3;return function(e,t,i){var r=n.subVectors(i,t).cross(o.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e);return(t||new THREE.Vector3).copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&0<i||i<0&&0<t},intersectLine:function(){var a=new THREE.Vector3;return function(e,t){var i=t||new THREE.Vector3,r=e.delta(a),n=this.normal.dot(r);if(0==n)return 0==this.distanceToPoint(e.start)?i.copy(e.start):void 0;var o=-(e.start.dot(this.normal)+this.constant)/n;return o<0||1<o?void 0:i.copy(r).multiplyScalar(o).add(e.start)}}(),coplanarPoint:function(e){return(e||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var n=new THREE.Vector3,o=new THREE.Vector3;return function(e,t){t=t||(new THREE.Matrix3).getNormalMatrix(e);var i=n.copy(this.normal).applyMatrix3(t),r=this.coplanarPoint(o);return r.applyMatrix4(e),this.setFromNormalAndCoplanarPoint(i,r),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}},THREE.Math={clamp:function(e,t,i){return e<t?t:i<e?i:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},smoothstep:function(e,t,i){return e<=t?0:i<=e?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:i<=e?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:0<e?1:0},degToRad:function(){var t=Math.PI/180;return function(e){return e*t}}(),radToDeg:function(){var t=180/Math.PI;return function(e){return e*t}}()},THREE.Spline=function(e){this.points=e;var t,i,r,n,o,a,s,l,h,c=[],u={x:0,y:0,z:0};function p(e,t,i,r,n,o,a){var s=.5*(i-e),l=.5*(r-t);return(2*(t-i)+s+l)*a+(-3*(t-i)-2*s-l)*o+s*n+t}this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return t=(this.points.length-1)*e,i=Math.floor(t),r=t-i,c[0]=0===i?i:i-1,c[1]=i,c[2]=i>this.points.length-2?this.points.length-1:i+1,c[3]=i>this.points.length-3?this.points.length-1:i+2,a=this.points[c[0]],s=this.points[c[1]],l=this.points[c[2]],h=this.points[c[3]],o=r*(n=r*r),u.x=p(a.x,s.x,l.x,h.x,r,n,o),u.y=p(a.y,s.y,l.y,h.y,r,n,o),u.z=p(a.z,s.z,l.z,h.z,r,n,o),u},this.getControlPointsArray=function(){var e,t,i=this.points.length,r=[];for(e=0;e<i;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,i,r,n,o=0,a=0,s=0,l=new THREE.Vector3,h=new THREE.Vector3,c=[],u=0;for(c[0]=0,e||(e=100),r=this.points.length*e,l.copy(this.points[0]),t=1;t<r;t++)i=t/r,n=this.getPoint(i),h.copy(n),u+=h.distanceTo(l),l.copy(n),o=(this.points.length-1)*i,(a=Math.floor(o))!=s&&(c[a]=u,s=a);return c[c.length]=u,{chunks:c,total:u}},this.reparametrizeByArcLength=function(e){var t,i,r,n,o,a,s,l,h=[],c=new THREE.Vector3,u=this.getLength();for(h.push(c.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(a=u.chunks[t]-u.chunks[t-1],s=Math.ceil(e*a/u.total),n=(t-1)/(this.points.length-1),o=t/(this.points.length-1),i=1;i<s-1;i++)r=n+i*(1/s)*(o-n),l=this.getPoint(r),h.push(c.copy(l).clone());h.push(c.copy(this.points[t]).clone())}this.points=h}},THREE.Triangle=function(e,t,i){this.a=void 0!==e?e:new THREE.Vector3,this.b=void 0!==t?t:new THREE.Vector3,this.c=void 0!==i?i:new THREE.Vector3},THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(e,t,i,r){var n=r||new THREE.Vector3;n.subVectors(i,t),a.subVectors(e,t),n.cross(a);var o=n.lengthSq();return 0<o?n.multiplyScalar(1/Math.sqrt(o)):n.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var m=new THREE.Vector3,E=new THREE.Vector3,v=new THREE.Vector3;return function(e,t,i,r,n){m.subVectors(r,t),E.subVectors(i,t),v.subVectors(e,t);var o=m.dot(m),a=m.dot(E),s=m.dot(v),l=E.dot(E),h=E.dot(v),c=o*l-a*a,u=n||new THREE.Vector3;if(0==c)return u.set(-2,-1,-1);var p=1/c,d=(l*s-a*h)*p,f=(o*h-a*s)*p;return u.set(1-d-f,f,d)}}(),THREE.Triangle.containsPoint=function(){var o=new THREE.Vector3;return function(e,t,i,r){var n=THREE.Triangle.barycoordFromPoint(e,t,i,r,o);return 0<=n.x&&0<=n.y&&n.x+n.y<=1}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}},THREE.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},THREE.UV=function(e,t){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new THREE.Vector2(e,t)},THREE.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners,r=i[e].indexOf(t);-1!==r&&i[e].splice(r,1)}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=0,r=t.length;i<r;i++)t[i].call(this,e)}}}},function(T){T.Raycaster=function(e,t,i,r){this.ray=new T.Ray(e,t),0<this.ray.direction.lengthSq()&&this.ray.direction.normalize(),this.near=i||0,this.far=r||1/0};var x=new T.Sphere,b=new T.Ray,R=new T.Plane,w=new T.Vector3,H=new T.Vector3,_=new T.Matrix4,o=function(e,t){return e.distance-t.distance},S=function(e,t,i){if(e instanceof T.Particle){if(H.getPositionFromMatrix(e.matrixWorld),(r=t.ray.distanceToPoint(H))>e.scale.x)return i;i.push({distance:r,point:e.position,face:null,object:e})}else if(e instanceof T.LOD){H.getPositionFromMatrix(e.matrixWorld);var r=t.ray.origin.distanceTo(H);S(e.getObjectForDistance(r),t,i)}else if(e instanceof T.Mesh){if(H.getPositionFromMatrix(e.matrixWorld),x.set(H,e.geometry.boundingSphere.radius*e.matrixWorld.getMaxScaleOnAxis()),!t.ray.isIntersectionSphere(x))return i;var n,o,a,s,l=e.geometry,h=l.vertices,c=e.material instanceof T.MeshFaceMaterial,u=!0===c?e.material.materials:null,p=e.material.side,d=t.precision;_.getInverse(e.matrixWorld),b.copy(t.ray).applyMatrix4(_);for(var f=0,m=l.faces.length;f<m;f++){var E=l.faces[f],v=!0===c?u[E.materialIndex]:e.material;if(void 0!==v){R.setFromNormalAndCoplanarPoint(E.normal,h[E.a]);var g=b.distanceToPlane(R);if(!(Math.abs(g)<d||g<0)){if((p=v.side)!==T.DoubleSide){var y=b.direction.dot(R.normal);if(!(p===T.FrontSide?y<0:0<y))continue}if(!(g<t.near||g>t.far)){if(w=b.at(g,w),E instanceof T.Face3){if(n=h[E.a],o=h[E.b],a=h[E.c],!T.Triangle.containsPoint(w,n,o,a))continue}else{if(!(E instanceof T.Face4))throw Error("face type not supported");if(n=h[E.a],o=h[E.b],a=h[E.c],s=h[E.d],!T.Triangle.containsPoint(w,n,o,s)&&!T.Triangle.containsPoint(w,o,a,s))continue}i.push({distance:g,point:t.ray.at(g),face:E,faceIndex:f,object:e})}}}}}},a=function(e,t,i){for(var r=e.getDescendants(),n=0,o=r.length;n<o;n++)S(r[n],t,i)};T.Raycaster.prototype.precision=1e-4,T.Raycaster.prototype.set=function(e,t){this.ray.set(e,t),0<this.ray.direction.length()&&this.ray.direction.normalize()},T.Raycaster.prototype.intersectObject=function(e,t){var i=[];return!0===t&&a(e,this,i),S(e,this,i),i.sort(o),i},T.Raycaster.prototype.intersectObjects=function(e,t){for(var i=[],r=0,n=e.length;r<n;r++)S(e[r],this,i),!0===t&&a(e[r],this,i);return i.sort(o),i}}(THREE),THREE.Object3D=function(){this.id=THREE.Object3DIdCount++,this.name="",this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.eulerOrder=THREE.Object3D.defaultEulerOrder,this.scale=new THREE.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(){var t=new THREE.Matrix4;return function(e){this.matrix.multiplyMatrices(e,this.matrix),this.position.getPositionFromMatrix(this.matrix),this.scale.getScaleFromMatrix(this.matrix),t.extractRotation(this.matrix),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(t):this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}(),rotateOnAxis:function(){var i=new THREE.Quaternion,r=new THREE.Quaternion;return function(e,t){return i.setFromAxisAngle(e,t),!0===this.useQuaternion?this.quaternion.multiply(i):(r.setFromEuler(this.rotation,this.eulerOrder),r.multiply(i),this.rotation.setEulerFromQuaternion(r,this.eulerOrder)),this}}(),translateOnAxis:function(){var i=new THREE.Vector3;return function(e,t){return i.copy(e),!0===this.useQuaternion?i.applyQuaternion(this.quaternion):i.applyEuler(this.rotation,this.eulerOrder),this.position.add(i.multiplyScalar(t)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var t=new THREE.Vector3(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new THREE.Vector3(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new THREE.Vector3(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new THREE.Matrix4;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new THREE.Matrix4;return function(e){t.lookAt(e,this.position,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(t):this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}(),add:function(e){if(e!==this){if(e instanceof THREE.Object3D){void 0!==e.parent&&e.parent.remove(e),(e.parent=this).children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__addObject(e)}}else console.warn("THREE.Object3D.add: An object can't be added as a child of itself.")},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){e.parent=void 0,this.children.splice(t,1);for(var i=this;void 0!==i.parent;)i=i.parent;void 0!==i&&i instanceof THREE.Scene&&i.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,i=this.children.length;t<i;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i];if(n.id===e)return n;if(!0===t&&void 0!==(n=n.getObjectById(e,t)))return n}},getObjectByName:function(e,t){for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i];if(n.name===e)return n;if(!0===t&&void 0!==(n=n.getObjectByName(e,t)))return n}},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,i=this.children.length;t<i;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){!1===this.useQuaternion?this.matrix.makeFromPositionEulerScale(this.position,this.rotation,this.eulerOrder,this.scale):this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e=!(this.matrixWorldNeedsUpdate=!1));for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)},clone:function(e){void 0===e&&(e=new THREE.Object3D),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation instanceof THREE.Vector3&&e.rotation.copy(this.rotation),e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData));for(var t=0;t<this.children.length;t++){var i=this.children[t];e.add(i.clone())}return e}},THREE.Object3D.defaultEulerOrder="XYZ",THREE.Object3DIdCount=0,THREE.Projector=function(){var N,U,B,k,z,V,I,O,j,G,W,q,t=[],i=0,X=[],r=0,n=[],o=0,a=[],s=0,l=[],h=0,c=[],u=0,Y={objects:[],sprites:[],lights:[],elements:[]},K=new THREE.Vector3,$=new THREE.Vector4,Q=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),Z=new THREE.Box3,J=new Array(3),ee=new Array(4),te=new THREE.Matrix4,ie=new THREE.Matrix4,re=new THREE.Matrix4,ne=new THREE.Matrix3,oe=new THREE.Matrix3,ae=new THREE.Vector3,se=new THREE.Frustum,le=new THREE.Vector4,he=new THREE.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),ie.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(ie)},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),ie.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(ie)},this.pickingRay=function(e,t){e.z=-1;var i=new THREE.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(i,t),i.sub(e).normalize(),new THREE.Raycaster(e,i)};function ce(){if(U===i){var e=new THREE.RenderableObject;return t.push(e),i++,U++,e}return t[U++]}function ue(){if(k===r){var e=new THREE.RenderableVertex;return X.push(e),r++,k++,e}return X[k++]}function pe(){if(V===o){var e=new THREE.RenderableFace3;return n.push(e),o++,V++,e}return n[V++]}function de(){if(I===s){var e=new THREE.RenderableFace4;return a.push(e),s++,I++,e}return a[I++]}function fe(){if(j===h){var e=new THREE.RenderableLine;return l.push(e),h++,j++,e}return l[j++]}function me(){if(W===u){var e=new THREE.RenderableParticle;return c.push(e),u++,W++,e}return c[W++]}function Ee(e,t){return t.z-e.z}function ve(e,t){var i=0,r=1,n=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return 0<=n&&0<=o&&0<=a&&0<=s||!(n<0&&o<0||a<0&&s<0)&&(n<0?i=Math.max(i,n/(n-o)):o<0&&(r=Math.min(r,n/(n-o))),a<0?i=Math.max(i,a/(a-s)):s<0&&(r=Math.min(r,a/(a-s))),!(r<i)&&(e.lerp(t,i),t.lerp(e,1-r),!0))}this.projectScene=function(e,t,i,r){var n,o,a,s,l,h,c,u,p,d,f,m,E,v,g,y,T,x,b,R,w,H,_,S,M,C,A=!1;for(W=j=I=V=0,!(Y.elements.length=0)===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),te.copy(t.matrixWorldInverse.getInverse(t.matrixWorld)),ie.multiplyMatrices(t.projectionMatrix,te),oe.getNormalMatrix(te),se.setFromMatrix(ie),n=0,o=(Y=function(e,t){U=0,Y.objects.length=0,Y.sprites.length=0,Y.lights.length=0;var n=function(e){for(var t=0,i=e.children.length;t<i;t++){var r=e.children[t];!1!==r.visible&&(r instanceof THREE.Light?Y.lights.push(r):r instanceof THREE.Mesh||r instanceof THREE.Line?!1!==r.frustumCulled&&!0!==se.intersectsObject(r)||(null!==((N=ce()).object=r).renderDepth?N.z=r.renderDepth:(K.getPositionFromMatrix(r.matrixWorld),K.applyProjection(ie),N.z=K.z),Y.objects.push(N)):r instanceof THREE.Sprite||r instanceof THREE.Particle?(null!==((N=ce()).object=r).renderDepth?N.z=r.renderDepth:(K.getPositionFromMatrix(r.matrixWorld),K.applyProjection(ie),N.z=K.z),Y.sprites.push(N)):(null!==((N=ce()).object=r).renderDepth?N.z=r.renderDepth:(K.getPositionFromMatrix(r.matrixWorld),K.applyProjection(ie),N.z=K.z),Y.objects.push(N)),n(r))}};return n(e),!0===t&&Y.objects.sort(Ee),Y}(e,i)).objects.length;n<o;n++)if(E=Y.objects[n].object,q=E.matrixWorld,k=0,E instanceof THREE.Mesh){for(g=(v=E.geometry).vertices,y=v.faces,b=v.faceVertexUvs,ne.getNormalMatrix(q),C=!0===(M=E.material instanceof THREE.MeshFaceMaterial)?E.material:null,a=0,s=g.length;a<s;a++)(B=ue()).positionWorld.copy(g[a]).applyMatrix4(q),B.positionScreen.copy(B.positionWorld).applyMatrix4(ie),B.positionScreen.x/=B.positionScreen.w,B.positionScreen.y/=B.positionScreen.w,B.positionScreen.z/=B.positionScreen.w,B.visible=!(B.positionScreen.x<-1||1<B.positionScreen.x||B.positionScreen.y<-1||1<B.positionScreen.y||B.positionScreen.z<-1||1<B.positionScreen.z);for(l=0,h=y.length;l<h;l++){T=y[l];var L=!0===M?C.materials[T.materialIndex]:E.material;if(void 0!==L){var P=L.side;if(T instanceof THREE.Face3){if(w=X[T.a],H=X[T.b],_=X[T.c],J[0]=w.positionScreen,J[1]=H.positionScreen,J[2]=_.positionScreen,!0!==w.visible&&!0!==H.visible&&!0!==_.visible&&!Q.isIntersectionBox(Z.setFromPoints(J)))continue;if(A=(_.positionScreen.x-w.positionScreen.x)*(H.positionScreen.y-w.positionScreen.y)-(_.positionScreen.y-w.positionScreen.y)*(H.positionScreen.x-w.positionScreen.x)<0,P!==THREE.DoubleSide&&A!==(P===THREE.FrontSide))continue;(z=pe()).v1.copy(w),z.v2.copy(H),z.v3.copy(_)}else if(T instanceof THREE.Face4){if(w=X[T.a],H=X[T.b],_=X[T.c],S=X[T.d],ee[0]=w.positionScreen,ee[1]=H.positionScreen,ee[2]=_.positionScreen,ee[3]=S.positionScreen,!0!==w.visible&&!0!==H.visible&&!0!==_.visible&&!0!==S.visible&&!Q.isIntersectionBox(Z.setFromPoints(ee)))continue;if(A=(S.positionScreen.x-w.positionScreen.x)*(H.positionScreen.y-w.positionScreen.y)-(S.positionScreen.y-w.positionScreen.y)*(H.positionScreen.x-w.positionScreen.x)<0||(H.positionScreen.x-_.positionScreen.x)*(S.positionScreen.y-_.positionScreen.y)-(H.positionScreen.y-_.positionScreen.y)*(S.positionScreen.x-_.positionScreen.x)<0,P!==THREE.DoubleSide&&A!==(P===THREE.FrontSide))continue;(z=de()).v1.copy(w),z.v2.copy(H),z.v3.copy(_),z.v4.copy(S)}for(z.normalModel.copy(T.normal),!1!==A||P!==THREE.BackSide&&P!==THREE.DoubleSide||z.normalModel.negate(),z.normalModel.applyMatrix3(ne).normalize(),z.normalModelView.copy(z.normalModel).applyMatrix3(oe),z.centroidModel.copy(T.centroid).applyMatrix4(q),c=0,u=(x=T.vertexNormals).length;c<u;c++){var D=z.vertexNormalsModel[c];D.copy(x[c]),!1!==A||P!==THREE.BackSide&&P!==THREE.DoubleSide||D.negate(),D.applyMatrix3(ne).normalize(),z.vertexNormalsModelView[c].copy(D).applyMatrix3(oe)}for(z.vertexNormalsLength=x.length,p=0,d=b.length;p<d;p++)if(void 0!==(R=b[p][l]))for(f=0,m=R.length;f<m;f++)z.uvs[p][f]=R[f];z.color=T.color,z.material=L,ae.copy(z.centroidModel).applyProjection(ie),z.z=ae.z,Y.elements.push(z)}}}else if(E instanceof THREE.Line){re.multiplyMatrices(ie,q),g=E.geometry.vertices,(w=ue()).positionScreen.copy(g[0]).applyMatrix4(re);var F=E.type===THREE.LinePieces?2:1;for(a=1,s=g.length;a<s;a++)(w=ue()).positionScreen.copy(g[a]).applyMatrix4(re),0<(a+1)%F||(H=X[k-2],le.copy(w.positionScreen),he.copy(H.positionScreen),!0===ve(le,he)&&(le.multiplyScalar(1/le.w),he.multiplyScalar(1/he.w),(O=fe()).v1.positionScreen.copy(le),O.v2.positionScreen.copy(he),O.z=Math.max(le.z,he.z),O.material=E.material,E.material.vertexColors===THREE.VertexColors&&(O.vertexColors[0].copy(E.geometry.colors[a]),O.vertexColors[1].copy(E.geometry.colors[a-1])),Y.elements.push(O)))}for(n=0,o=Y.sprites.length;n<o;n++)E=Y.sprites[n].object,q=E.matrixWorld,E instanceof THREE.Particle&&($.set(q.elements[12],q.elements[13],q.elements[14],1),$.applyMatrix4(ie),$.z/=$.w,0<$.z&&$.z<1&&((G=me()).object=E,G.x=$.x/$.w,G.y=$.y/$.w,G.z=$.z,G.rotation=E.rotation.z,G.scale.x=E.scale.x*Math.abs(G.x-($.x+t.projectionMatrix.elements[0])/($.w+t.projectionMatrix.elements[12])),G.scale.y=E.scale.y*Math.abs(G.y-($.y+t.projectionMatrix.elements[5])/($.w+t.projectionMatrix.elements[13])),G.material=E.material,Y.elements.push(G)));return!0===r&&Y.elements.sort(Ee),Y}},THREE.Face3=function(e,t,i,r,n,o){this.a=e,this.b=t,this.c=i,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=n instanceof THREE.Color?n:new THREE.Color,this.vertexColors=n instanceof Array?n:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0,this.centroid=new THREE.Vector3},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e,t,i=new THREE.Face3(this.a,this.b,this.c);for(i.normal.copy(this.normal),i.color.copy(this.color),i.centroid.copy(this.centroid),i.materialIndex=this.materialIndex,e=0,t=this.vertexNormals.length;e<t;e++)i.vertexNormals[e]=this.vertexNormals[e].clone();for(e=0,t=this.vertexColors.length;e<t;e++)i.vertexColors[e]=this.vertexColors[e].clone();for(e=0,t=this.vertexTangents.length;e<t;e++)i.vertexTangents[e]=this.vertexTangents[e].clone();return i}},THREE.Face4=function(e,t,i,r,n,o,a){this.a=e,this.b=t,this.c=i,this.d=r,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=o instanceof THREE.Color?o:new THREE.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=void 0!==a?a:0,this.centroid=new THREE.Vector3},THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var e,t,i=new THREE.Face4(this.a,this.b,this.c,this.d);for(i.normal.copy(this.normal),i.color.copy(this.color),i.centroid.copy(this.centroid),i.materialIndex=this.materialIndex,e=0,t=this.vertexNormals.length;e<t;e++)i.vertexNormals[e]=this.vertexNormals[e].clone();for(e=0,t=this.vertexColors.length;e<t;e++)i.vertexColors[e]=this.vertexColors[e].clone();for(e=0,t=this.vertexTangents.length;e<t;e++)i.vertexTangents[e]=this.vertexTangents[e].clone();return i}},THREE.Geometry=function(){this.id=THREE.GeometryIdCount++,this.name="",this.vertices=[],this.colors=[],this.normals=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,applyMatrix:function(e){for(var t=(new THREE.Matrix3).getNormalMatrix(e),i=0,r=this.vertices.length;i<r;i++){this.vertices[i].applyMatrix4(e)}for(i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(var o=0,a=n.vertexNormals.length;o<a;o++)n.vertexNormals[o].applyMatrix3(t).normalize();n.centroid.applyMatrix4(e)}},computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;e<t;e++)(i=this.faces[e]).centroid.set(0,0,0),i instanceof THREE.Face3?(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.divideScalar(3)):i instanceof THREE.Face4&&(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.add(this.vertices[i.d]),i.centroid.divideScalar(4))},computeFaceNormals:function(){for(var e=new THREE.Vector3,t=new THREE.Vector3,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],o=this.vertices[n.a],a=this.vertices[n.b],s=this.vertices[n.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,i,r,n,o,a;if(void 0===this.__tmpVertices){for(this.__tmpVertices=new Array(this.vertices.length),a=this.__tmpVertices,t=0,i=this.vertices.length;t<i;t++)a[t]=new THREE.Vector3;for(r=0,n=this.faces.length;r<n;r++)(o=this.faces[r])instanceof THREE.Face3?o.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:o instanceof THREE.Face4&&(o.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else for(a=this.__tmpVertices,t=0,i=this.vertices.length;t<i;t++)a[t].set(0,0,0);if(e){var s,l,h,c,u=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Vector3;for(r=0,n=this.faces.length;r<n;r++)(o=this.faces[r])instanceof THREE.Face3?(s=this.vertices[o.a],l=this.vertices[o.b],h=this.vertices[o.c],u.subVectors(h,l),p.subVectors(s,l),u.cross(p),a[o.a].add(u),a[o.b].add(u),a[o.c].add(u)):o instanceof THREE.Face4&&(s=this.vertices[o.a],l=this.vertices[o.b],h=this.vertices[o.c],c=this.vertices[o.d],d.subVectors(c,l),p.subVectors(s,l),d.cross(p),a[o.a].add(d),a[o.b].add(d),a[o.d].add(d),f.subVectors(c,h),m.subVectors(l,h),f.cross(m),a[o.b].add(f),a[o.c].add(f),a[o.d].add(f))}else for(r=0,n=this.faces.length;r<n;r++)(o=this.faces[r])instanceof THREE.Face3?(a[o.a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal)):o instanceof THREE.Face4&&(a[o.a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal),a[o.d].add(o.normal));for(t=0,i=this.vertices.length;t<i;t++)a[t].normalize();for(r=0,n=this.faces.length;r<n;r++)(o=this.faces[r])instanceof THREE.Face3?(o.vertexNormals[0].copy(a[o.a]),o.vertexNormals[1].copy(a[o.b]),o.vertexNormals[2].copy(a[o.c])):o instanceof THREE.Face4&&(o.vertexNormals[0].copy(a[o.a]),o.vertexNormals[1].copy(a[o.b]),o.vertexNormals[2].copy(a[o.c]),o.vertexNormals[3].copy(a[o.d]))},computeMorphNormals:function(){var e,t,i,r,n;for(i=0,r=this.faces.length;i<r;i++)for((n=this.faces[i]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var o=new THREE.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(i=0,r=this.faces.length;i<r;i++)n=this.faces[i],l=new THREE.Vector3,h=n instanceof THREE.Face3?{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3}:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3},a.push(l),s.push(h)}var l,h,c=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,r=this.faces.length;i<r;i++)n=this.faces[i],l=c.faceNormals[i],h=c.vertexNormals[i],l.copy(n.normal),n instanceof THREE.Face3?(h.a.copy(n.vertexNormals[0]),h.b.copy(n.vertexNormals[1]),h.c.copy(n.vertexNormals[2])):(h.a.copy(n.vertexNormals[0]),h.b.copy(n.vertexNormals[1]),h.c.copy(n.vertexNormals[2]),h.d.copy(n.vertexNormals[3]))}for(i=0,r=this.faces.length;i<r;i++)(n=this.faces[i]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeTangents:function(){var e,t,i,r,n,o,a,s,l,h,c,u,p,d,f,m,E,v,g,y,T,x,b,R,w,H,_,S=[],M=[],C=new THREE.Vector3,A=new THREE.Vector3,L=new THREE.Vector3,P=new THREE.Vector3,D=new THREE.Vector3;for(i=0,r=this.vertices.length;i<r;i++)S[i]=new THREE.Vector3,M[i]=new THREE.Vector3;function F(e,t,i,r,n,o,a){l=e.vertices[t],h=e.vertices[i],c=e.vertices[r],u=s[n],p=s[o],d=s[a],f=h.x-l.x,m=c.x-l.x,E=h.y-l.y,v=c.y-l.y,g=h.z-l.z,y=c.z-l.z,T=p.x-u.x,x=d.x-u.x,b=p.y-u.y,R=d.y-u.y,w=1/(T*R-x*b),C.set((R*f-b*m)*w,(R*E-b*v)*w,(R*g-b*y)*w),A.set((T*m-x*f)*w,(T*v-x*E)*w,(T*y-x*g)*w),S[t].add(C),S[i].add(C),S[r].add(C),M[t].add(A),M[i].add(A),M[r].add(A)}for(e=0,t=this.faces.length;e<t;e++)a=this.faces[e],s=this.faceVertexUvs[0][e],a instanceof THREE.Face3?F(this,a.a,a.b,a.c,0,1,2):a instanceof THREE.Face4&&(F(this,a.a,a.b,a.d,0,1,3),F(this,a.b,a.c,a.d,1,2,3));var N=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++)for(a=this.faces[e],n=0;n<a.vertexNormals.length;n++)D.copy(a.vertexNormals[n]),o=a[N[n]],H=S[o],L.copy(H),L.sub(D.multiplyScalar(D.dot(H))).normalize(),P.crossVectors(a.vertexNormals[n],H),_=P.dot(M[o])<0?-1:1,a.vertexTangents[n]=new THREE.Vector4(L.x,L.y,L.z,_);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,r=t.length;i<r;i++)0<i&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},mergeVertices:function(){var e,t,i,r,n,o,a,s,l,h={},c=[],u=[],p=Math.pow(10,4);for(this.__tmpVertices=void 0,i=0,r=this.vertices.length;i<r;i++)e=this.vertices[i],void 0===h[t=[Math.round(e.x*p),Math.round(e.y*p),Math.round(e.z*p)].join("_")]?(h[t]=i,c.push(this.vertices[i]),u[i]=c.length-1):u[i]=u[h[t]];var d=[];for(i=0,r=this.faces.length;i<r;i++)if((n=this.faces[i])instanceof THREE.Face3){n.a=u[n.a],n.b=u[n.b],n.c=u[n.c],o=[n.a,n.b,n.c];for(var f=-1,m=0;m<3;m++)if(o[m]==o[(m+1)%3]){f=m,d.push(i);break}}else if(n instanceof THREE.Face4){n.a=u[n.a],n.b=u[n.b],n.c=u[n.c],n.d=u[n.d],o=[n.a,n.b,n.c,n.d];for(f=-1,m=0;m<4;m++)o[m]==o[(m+1)%4]&&(0<=f&&d.push(i),f=m);if(0<=f){o.splice(f,1);var E=new THREE.Face3(o[0],o[1],o[2],n.normal,n.color,n.materialIndex);for(a=0,s=this.faceVertexUvs.length;a<s;a++)(l=this.faceVertexUvs[a][i])&&l.splice(f,1);n.vertexNormals&&0<n.vertexNormals.length&&(E.vertexNormals=n.vertexNormals,E.vertexNormals.splice(f,1)),n.vertexColors&&0<n.vertexColors.length&&(E.vertexColors=n.vertexColors,E.vertexColors.splice(f,1)),this.faces[i]=E}}for(i=d.length-1;0<=i;i--)for(this.faces.splice(i,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(i,1);var v=this.vertices.length-c.length;return this.vertices=c,v},clone:function(){for(var e=new THREE.Geometry,t=this.vertices,i=0,r=t.length;i<r;i++)e.vertices.push(t[i].clone());var n=this.faces;for(i=0,r=n.length;i<r;i++)e.faces.push(n[i].clone());var o=this.faceVertexUvs[0];for(i=0,r=o.length;i<r;i++){for(var a=o[i],s=[],l=0,h=a.length;l<h;l++)s.push(new THREE.Vector2(a[l].x,a[l].y));e.faceVertexUvs[0].push(s)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.GeometryIdCount=0,THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++,this.attributes={},this.dynamic=!1,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[]},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,applyMatrix:function(e){var t,i;(this.attributes.position&&(t=this.attributes.position.array),this.attributes.normal&&(i=this.attributes.normal.array),void 0!==t&&(e.multiplyVector3Array(t),this.verticesNeedUpdate=!0),void 0!==i)&&((new THREE.Matrix3).getNormalMatrix(e).multiplyVector3Array(i),this.normalizeNormals(),this.normalsNeedUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.attributes.position.array;if(e){var t,i,r,n=this.boundingBox;3<=e.length&&(n.min.x=n.max.x=e[0],n.min.y=n.max.y=e[1],n.min.z=n.max.z=e[2]);for(var o=3,a=e.length;o<a;o+=3)t=e[o],i=e[o+1],r=e[o+2],t<n.min.x?n.min.x=t:t>n.max.x&&(n.max.x=t),i<n.min.y?n.min.y=i:i>n.max.y&&(n.max.y=i),r<n.min.z?n.min.z=r:r>n.max.z&&(n.max.z=r)}void 0!==e&&0!==e.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var e=this.attributes.position.array;if(e){for(var t,i,r,n,o=0,a=0,s=e.length;a<s;a+=3)o<(t=(i=e[a])*i+(r=e[a+1])*r+(n=e[a+2])*n)&&(o=t);this.boundingSphere.radius=Math.sqrt(o)}},computeVertexNormals:function(){if(this.attributes.position){var e,t,i,r,n=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(n),numItems:n};else for(e=0,t=this.attributes.normal.array.length;e<t;e++)this.attributes.normal.array[e]=0;var o,a,s,l,h,c,u=this.attributes.position.array,p=this.attributes.normal.array,d=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Vector3,E=new THREE.Vector3,v=new THREE.Vector3;if(this.attributes.index){var g=this.attributes.index.array,y=this.offsets;for(i=0,r=y.length;i<r;++i){var T=y[i].start,x=y[i].count,b=y[i].index;for(t=(e=T)+x;e<t;e+=3)o=b+g[e],a=b+g[e+1],s=b+g[e+2],l=u[3*o],h=u[3*o+1],c=u[3*o+2],d.set(l,h,c),l=u[3*a],h=u[3*a+1],c=u[3*a+2],f.set(l,h,c),l=u[3*s],h=u[3*s+1],c=u[3*s+2],m.set(l,h,c),E.subVectors(m,f),v.subVectors(d,f),E.cross(v),p[3*o]+=E.x,p[3*o+1]+=E.y,p[3*o+2]+=E.z,p[3*a]+=E.x,p[3*a+1]+=E.y,p[3*a+2]+=E.z,p[3*s]+=E.x,p[3*s+1]+=E.y,p[3*s+2]+=E.z}}else for(e=0,t=u.length;e<t;e+=9)l=u[e],h=u[e+1],c=u[e+2],d.set(l,h,c),l=u[e+3],h=u[e+4],c=u[e+5],f.set(l,h,c),l=u[e+6],h=u[e+7],c=u[e+8],m.set(l,h,c),E.subVectors(m,f),v.subVectors(d,f),E.cross(v),p[e]=E.x,p[e+1]=E.y,p[e+2]=E.z,p[e+3]=E.x,p[e+4]=E.y,p[e+5]=E.z,p[e+6]=E.x,p[e+7]=E.y,p[e+8]=E.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,i,r,n=this.attributes.normal.array,o=0,a=n.length;o<a;o+=3)e=n[o],t=n[o+1],i=n[o+2],r=1/Math.sqrt(e*e+t*t+i*i),n[o]*=r,n[o+1]*=r,n[o+2]*=r},computeTangents:function(){if(void 0!==this.attributes.index&&void 0!==this.attributes.position&&void 0!==this.attributes.normal&&void 0!==this.attributes.uv){var e=this.attributes.index.array,t=this.attributes.position.array,i=this.attributes.normal.array,r=this.attributes.uv.array,n=t.length/3;if(void 0===this.attributes.tangent){var o=4*n;this.attributes.tangent={itemSize:4,array:new Float32Array(o),numItems:o}}for(var a,s,l,h,c,u,p,d,f,m,E,v,g,y,T,x,b,R,w,H,_,S,M,C,A,L,P=this.attributes.tangent.array,D=[],F=[],N=0;N<n;N++)D[N]=new THREE.Vector3,F[N]=new THREE.Vector3;var U,B,k,z,V,I,O,j,G,W,q=new THREE.Vector3,X=new THREE.Vector3,Y=this.offsets;for(k=0,z=Y.length;k<z;++k){var K=Y[k].start,$=Y[k].count,Q=Y[k].index;for(B=(U=K)+$;U<B;U+=3)V=Q+e[U],I=Q+e[U+1],O=Q+e[U+2],G=I,W=O,a=t[3*(j=V)],s=t[3*j+1],l=t[3*j+2],h=t[3*G],c=t[3*G+1],u=t[3*G+2],p=t[3*W],d=t[3*W+1],f=t[3*W+2],m=r[2*j],E=r[2*j+1],v=r[2*G],g=r[2*G+1],y=r[2*W],T=r[2*W+1],x=h-a,b=p-a,R=c-s,w=d-s,H=u-l,_=f-l,L=1/((S=v-m)*(A=T-E)-(M=y-m)*(C=g-E)),q.set((A*x-C*b)*L,(A*R-C*w)*L,(A*H-C*_)*L),X.set((S*b-M*x)*L,(S*w-M*R)*L,(S*_-M*H)*L),D[j].add(q),D[G].add(q),D[W].add(q),F[j].add(X),F[G].add(X),F[W].add(X)}var Z,J,ee,te=new THREE.Vector3,ie=new THREE.Vector3,re=new THREE.Vector3,ne=new THREE.Vector3;for(k=0,z=Y.length;k<z;++k){K=Y[k].start,$=Y[k].count,Q=Y[k].index;for(B=(U=K)+$;U<B;U+=3)V=Q+e[U],I=Q+e[U+1],O=Q+e[U+2],oe(V),oe(I),oe(O)}this.hasTangents=!0,this.tangentsNeedUpdate=!0}else console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function oe(e){re.x=i[3*e],re.y=i[3*e+1],re.z=i[3*e+2],ne.copy(re),J=D[e],te.copy(J),te.sub(re.multiplyScalar(re.dot(J))).normalize(),ie.crossVectors(ne,J),ee=ie.dot(F[e]),Z=ee<0?-1:1,P[4*e]=te.x,P[4*e+1]=te.y,P[4*e+2]=te.z,P[4*e+3]=Z}},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,this.projectionMatrixInverse=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.lookAt=function(){var t=new THREE.Matrix4;return function(e){t.lookAt(this.position,e,this.up),!0===this.useQuaternion?this.quaternion.setFromRotationMatrix(t):this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder)}}(),THREE.OrthographicCamera=function(e,t,i,r,n,o){THREE.Camera.call(this),this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(e,t,i,r){THREE.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*THREE.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,r,n,o){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=r,this.width=n,this.height=o,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(THREE.Math.degToRad(.5*this.fov))*this.near,i=-t,r=e*i,n=e*t,o=Math.abs(n-r),a=Math.abs(t-i);this.projectionMatrix.makeFrustum(r+this.x*o/this.fullWidth,r+(this.x+this.width)*o/this.fullWidth,t-(this.y+this.height)*a/this.fullHeight,t-this.y*a/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.clone=function(e){return void 0===e&&(e=new THREE.Light),THREE.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.clone=function(){var e=new THREE.AmbientLight;return THREE.Light.prototype.clone.call(this,e),e},THREE.AreaLight=function(e,t){THREE.Light.call(this,e),this.normal=new THREE.Vector3(0,-1,0),this.right=new THREE.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},THREE.AreaLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.clone=function(){var e=new THREE.DirectionalLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},THREE.HemisphereLight=function(e,t,i){THREE.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new THREE.Color(t),this.intensity=void 0!==i?i:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.clone=function(){var e=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},THREE.PointLight=function(e,t,i){THREE.Light.call(this,e),this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.clone=function(){var e=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},THREE.SpotLight=function(e,t,i,r,n){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.exponent=void 0!==n?n:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.clone=function(){var e=new THREE.SpotLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},THREE.Loader=function(e){this.showStatus=e,this.statusDomElement=e?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";e.total?t+=(100*e.loaded/e.total).toFixed(0)+"%":t+=(e.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return t.pop(),(t.length<1?".":t.join("/"))+"/"},initMaterials:function(e,t){for(var i=[],r=0;r<e.length;++r)i[r]=THREE.Loader.prototype.createMaterial(e[r],t);return i},needsTangents:function(e){for(var t=0,i=e.length;t<i;t++){if(e[t]instanceof THREE.ShaderMaterial)return!0}return!1},createMaterial:function(e,f){var m=this;function E(e){var t=Math.log(e)/Math.LN2;return Math.floor(t)==t}function v(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function t(e,t,i,r,n,o,a){var s,l,h,c=/\.dds$/i.test(i),u=f+"/"+i;if(c){var p=THREE.ImageUtils.loadCompressedTexture(u);e[t]=p}else{p=document.createElement("canvas");e[t]=new THREE.Texture(p)}if(e[t].sourceFile=i,r&&(e[t].repeat.set(r[0],r[1]),1!==r[0]&&(e[t].wrapS=THREE.RepeatWrapping),1!==r[1]&&(e[t].wrapT=THREE.RepeatWrapping)),n&&e[t].offset.set(n[0],n[1]),o){var d={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==d[o[0]]&&(e[t].wrapS=d[o[0]]),void 0!==d[o[1]]&&(e[t].wrapT=d[o[1]])}a&&(e[t].anisotropy=a),c||(s=e[t],l=u,(h=new Image).onload=function(){if(E(this.width)&&E(this.height))s.image=this;else{var e=v(this.width),t=v(this.height);s.image.width=e,s.image.height=t,s.image.getContext("2d").drawImage(this,0,0,e,t)}s.needsUpdate=!0},h.crossOrigin=m.crossOrigin,h.src=l)}function i(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var r="MeshLambertMaterial",n={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var o=e.shading.toLowerCase();"phong"===o?r="MeshPhongMaterial":"basic"===o&&(r="MeshBasicMaterial")}if(void 0!==e.blending&&void 0!==THREE[e.blending]&&(n.blending=THREE[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(n.transparent=e.transparent),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.flipSided&&(n.side=THREE.BackSide),void 0!==e.doubleSided&&(n.side=THREE.DoubleSide),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?n.vertexColors=THREE.FaceColors:e.vertexColors&&(n.vertexColors=THREE.VertexColors)),e.colorDiffuse?n.color=i(e.colorDiffuse):e.DbgColor&&(n.color=e.DbgColor),e.colorSpecular&&(n.specular=i(e.colorSpecular)),e.colorAmbient&&(n.ambient=i(e.colorAmbient)),e.transparency&&(n.opacity=e.transparency),e.specularCoef&&(n.shininess=e.specularCoef),e.mapDiffuse&&f&&t(n,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&f&&t(n,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&f&&t(n,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&f&&t(n,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&f&&t(n,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(n.bumpScale=e.mapBumpScale),e.mapNormal){var a=THREE.ShaderLib.normalmap,s=THREE.UniformsUtils.clone(a.uniforms);s.tNormal.value=n.normalMap,e.mapNormalFactor&&s.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),n.map&&(s.tDiffuse.value=n.map,s.enableDiffuse.value=!0),n.specularMap&&(s.tSpecular.value=n.specularMap,s.enableSpecular.value=!0),n.lightMap&&(s.tAO.value=n.lightMap,s.enableAO.value=!0),s.uDiffuseColor.value.setHex(n.color),s.uSpecularColor.value.setHex(n.specular),s.uAmbientColor.value.setHex(n.ambient),s.uShininess.value=n.shininess,void 0!==n.opacity&&(s.uOpacity.value=n.opacity);var l={fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:s,lights:!0,fog:!0},h=new THREE.ShaderMaterial(l);n.transparent&&(h.transparent=!0)}else h=new THREE[r](n);return void 0!==e.DbgName&&(h.name=e.DbgName),h}},THREE.ImageLoader=function(){this.crossOrigin=null},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,load:function(e,t){var i=this;void 0===t&&(t=new Image),t.addEventListener("load",function(){i.dispatchEvent({type:"load",content:t})},!1),t.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),i.crossOrigin&&(t.crossOrigin=i.crossOrigin),t.src=e}},THREE.JSONLoader=function(e){THREE.Loader.call(this,e),this.withCredentials=!1},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.JSONLoader.prototype.load=function(e,t,i){i=i&&"string"==typeof i?i:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,i)},THREE.JSONLoader.prototype.loadAjaxJSON=function(i,r,n,o,a){var s=new XMLHttpRequest,l=0;s.onreadystatechange=function(){if(s.readyState===s.DONE)if(200===s.status||0===s.status){if(s.responseText){var e=JSON.parse(s.responseText),t=i.parse(e,o);n(t.geometry,t.materials)}else console.warn("THREE.JSONLoader: ["+r+"] seems to be unreachable or file there is empty");i.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+r+"] ["+s.status+"]");else s.readyState===s.LOADING?a&&(0===l&&(l=s.getResponseHeader("Content-Length")),a({total:l,loaded:s.responseText.length})):s.readyState===s.HEADERS_RECEIVED&&void 0!==a&&(l=s.getResponseHeader("Content-Length"))},s.open("GET",r,!0),s.withCredentials=this.withCredentials,s.send(null)},THREE.JSONLoader.prototype.parse=function(F,e){var N=new THREE.Geometry,t=void 0!==F.scale?1/F.scale:1;if(function(e){function t(e,t){return e&1<<t}var i,r,n,o,a,s,l,h,c,u,p,d,f,m,E,v,g,y,T,x,b,R,w,H,_,S,M,C=F.faces,A=F.vertices,L=F.normals,P=F.colors,D=0;for(i=0;i<F.uvs.length;i++)F.uvs[i].length&&D++;for(i=0;i<D;i++)N.faceUvs[i]=[],N.faceVertexUvs[i]=[];o=0,a=A.length;for(;o<a;)(x=new THREE.Vector3).x=A[o++]*e,x.y=A[o++]*e,x.z=A[o++]*e,N.vertices.push(x);o=0,a=C.length;for(;o<a;){if(p=C[o++],d=t(p,0),f=t(p,1),m=t(p,2),E=t(p,3),v=t(p,4),g=t(p,5),y=t(p,6),T=t(p,7),d?((b=new THREE.Face4).a=C[o++],b.b=C[o++],b.c=C[o++],b.d=C[o++],s=4):((b=new THREE.Face3).a=C[o++],b.b=C[o++],b.c=C[o++],s=3),f&&(u=C[o++],b.materialIndex=u),n=N.faces.length,m)for(i=0;i<D;i++)H=F.uvs[i],c=C[o++],S=H[2*c],M=H[2*c+1],N.faceUvs[i][n]=new THREE.Vector2(S,M);if(E)for(i=0;i<D;i++){for(H=F.uvs[i],_=[],r=0;r<s;r++)c=C[o++],S=H[2*c],M=H[2*c+1],_[r]=new THREE.Vector2(S,M);N.faceVertexUvs[i][n]=_}if(v&&(h=3*C[o++],(w=new THREE.Vector3).x=L[h++],w.y=L[h++],w.z=L[h],b.normal=w),g)for(i=0;i<s;i++)h=3*C[o++],(w=new THREE.Vector3).x=L[h++],w.y=L[h++],w.z=L[h],b.vertexNormals.push(w);if(y&&(l=C[o++],R=new THREE.Color(P[l]),b.color=R),T)for(i=0;i<s;i++)l=C[o++],R=new THREE.Color(P[l]),b.vertexColors.push(R);N.faces.push(b)}}(t),function(){var e,t,i,r,n,o;if(F.skinWeights)for(e=0,t=F.skinWeights.length;e<t;e+=2)i=F.skinWeights[e],r=F.skinWeights[e+1],0,N.skinWeights.push(new THREE.Vector4(i,r,0,0));if(F.skinIndices)for(e=0,t=F.skinIndices.length;e<t;e+=2)n=F.skinIndices[e],o=F.skinIndices[e+1],0,N.skinIndices.push(new THREE.Vector4(n,o,0,0));N.bones=F.bones,N.animation=F.animation}(),function(e){var t,i,r,n,o,a,s,l,h,c,u;if(void 0!==F.morphTargets)for(o=0,a=F.morphTargets.length;o<a;o++)for(N.morphTargets[o]={},N.morphTargets[o].name=F.morphTargets[o].name,N.morphTargets[o].vertices=[],r=N.morphTargets[o].vertices,n=F.morphTargets[o].vertices,t=0,i=n.length;t<i;t+=3){var p=new THREE.Vector3;p.x=n[t]*e,p.y=n[t+1]*e,p.z=n[t+2]*e,r.push(p)}if(void 0!==F.morphColors)for(o=0,a=F.morphColors.length;o<a;o++)for(N.morphColors[o]={},N.morphColors[o].name=F.morphColors[o].name,N.morphColors[o].colors=[],h=N.morphColors[o].colors,c=F.morphColors[o].colors,s=0,l=c.length;s<l;s+=3)(u=new THREE.Color(16755200)).setRGB(c[s],c[s+1],c[s+2]),h.push(u)}(t),N.computeCentroids(),N.computeFaceNormals(),void 0===F.materials)return{geometry:N};var i=this.initMaterials(F.materials,e);return this.needsTangents(i)&&N.computeTangents(),{geometry:N,materials:i}},THREE.LoadingMonitor=function(){var t=this,i=0,r=0,n=function(e){i++,t.dispatchEvent({type:"progress",loaded:i,total:r}),i===r&&t.dispatchEvent({type:"load"})};this.add=function(e){r++,e.addEventListener("load",n,!1)}},THREE.LoadingMonitor.prototype={constructor:THREE.LoadingMonitor,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent},THREE.GeometryLoader=function(){},THREE.GeometryLoader.prototype={constructor:THREE.GeometryLoader,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,load:function(e){var i=this,t=new XMLHttpRequest;t.addEventListener("load",function(e){var t=i.parse(JSON.parse(e.target.responseText));i.dispatchEvent({type:"load",content:t})},!1),t.addEventListener("progress",function(e){i.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),t.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),t.open("GET",e,!0),t.send(null)},parse:function(e){}},THREE.MaterialLoader=function(){},THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,load:function(e){var i=this,t=new XMLHttpRequest;t.addEventListener("load",function(e){var t=i.parse(JSON.parse(e.target.responseText));i.dispatchEvent({type:"load",content:t})},!1),t.addEventListener("progress",function(e){i.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),t.addEventListener("error",function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),t.open("GET",e,!0),t.send(null)},parse:function(e){var t;switch(e.type){case"MeshBasicMaterial":t=new THREE.MeshBasicMaterial({color:e.color,opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe});break;case"MeshLambertMaterial":t=new THREE.MeshLambertMaterial({color:e.color,ambient:e.ambient,emissive:e.emissive,opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe});break;case"MeshPhongMaterial":t=new THREE.MeshPhongMaterial({color:e.color,ambient:e.ambient,emissive:e.emissive,specular:e.specular,shininess:e.shininess,opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe});break;case"MeshNormalMaterial":t=new THREE.MeshNormalMaterial({opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe});break;case"MeshDepthMaterial":t=new THREE.MeshDepthMaterial({opacity:e.opacity,transparent:e.transparent,wireframe:e.wireframe})}return t}},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.hierarchyHandlerMap={},this.addGeometryHandler("ascii",THREE.JSONLoader)},THREE.SceneLoader.prototype.constructor=THREE.SceneLoader,THREE.SceneLoader.prototype.load=function(t,i){var r=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status||0===n.status){var e=JSON.parse(n.responseText);r.parse(e,i,t)}else console.error("THREE.SceneLoader: Couldn't load ["+t+"] ["+n.status+"]")},n.open("GET",t,!0),n.send(null)},THREE.SceneLoader.prototype.addGeometryHandler=function(e,t){this.geometryHandlerMap[e]={loaderClass:t}},THREE.SceneLoader.prototype.addHierarchyHandler=function(e,t){this.hierarchyHandlerMap[e]={loaderClass:t}},THREE.SceneLoader.prototype.parse=function(e,t,i){var x,b,R,r,n,o,w,H,_,a,s,l,h,S,M=this,c=THREE.Loader.prototype.extractUrlBase(i),C=[],A=e;for(var u in this.geometryHandlerMap){var p=this.geometryHandlerMap[u].loaderClass;this.geometryHandlerMap[u].loaderObject=new p}for(var u in this.hierarchyHandlerMap){p=this.hierarchyHandlerMap[u].loaderClass;this.hierarchyHandlerMap[u].loaderObject=new p}if(s=a=0,S={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},A.transform){var d=A.transform.position,f=A.transform.rotation,m=A.transform.scale;d&&S.scene.position.set(d[0],d[1],d[2]),f&&S.scene.rotation.set(f[0],f[1],f[2]),m&&S.scene.scale.set(m[0],m[1],m[2]),(d||f||m)&&(S.scene.updateMatrix(),S.scene.updateMatrixWorld())}function L(e,t){return"relativeToHTML"==t?e:c+"/"+e}function E(){!function e(t,i){var r,n,o,a,s,l;for(var h in i)if(void 0===S.objects[h]){var c=i[h],u=null;if(c.type&&c.type in M.hierarchyHandlerMap){if(void 0===c.loading){var p={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1},d={};for(var f in c)f in p||(d[f]=c[f]);b=S.materials[c.material],c.loading=!0;var m=M.hierarchyHandlerMap[c.type].loaderObject;m.options?m.load(L(c.url,A.urlBaseType),P(h,t,b,c)):m.load(L(c.url,A.urlBaseType),P(h,t,b,c),d)}}else if(void 0!==c.geometry){if(x=S.geometries[c.geometry]){var E=!1;if(b=S.materials[c.material],E=b instanceof THREE.ShaderMaterial,o=c.position,a=c.rotation,s=c.scale,r=c.matrix,l=c.quaternion,c.material||(b=new THREE.MeshFaceMaterial(S.face_materials[c.geometry])),b instanceof THREE.MeshFaceMaterial&&0===b.materials.length&&(b=new THREE.MeshFaceMaterial(S.face_materials[c.geometry])),b instanceof THREE.MeshFaceMaterial)for(var v=0;v<b.materials.length;v++)E=E||b.materials[v]instanceof THREE.ShaderMaterial;E&&x.computeTangents(),c.skin?u=new THREE.SkinnedMesh(x,b):c.morph?(u=new THREE.MorphAnimMesh(x,b),void 0!==c.duration&&(u.duration=c.duration),void 0!==c.time&&(u.time=c.time),void 0!==c.mirroredLoop&&(u.mirroredLoop=c.mirroredLoop),b.morphNormals&&x.computeMorphNormals()):u=new THREE.Mesh(x,b),u.name=h,r?(u.matrixAutoUpdate=!1,u.matrix.set(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])):(u.position.set(o[0],o[1],o[2]),l?(u.quaternion.set(l[0],l[1],l[2],l[3]),u.useQuaternion=!0):u.rotation.set(a[0],a[1],a[2]),u.scale.set(s[0],s[1],s[2])),u.visible=c.visible,u.castShadow=c.castShadow,u.receiveShadow=c.receiveShadow,t.add(u),S.objects[h]=u}}else"DirectionalLight"===c.type||"PointLight"===c.type||"AmbientLight"===c.type?(H=void 0!==c.color?c.color:16777215,_=void 0!==c.intensity?c.intensity:1,"DirectionalLight"===c.type?(o=c.direction,(w=new THREE.DirectionalLight(H,_)).position.set(o[0],o[1],o[2]),c.target&&(C.push({object:w,targetName:c.target}),w.target=null)):"PointLight"===c.type?(o=c.position,n=c.distance,(w=new THREE.PointLight(H,_,n)).position.set(o[0],o[1],o[2])):"AmbientLight"===c.type&&(w=new THREE.AmbientLight(H)),t.add(w),w.name=h,S.lights[h]=w,S.objects[h]=w):"PerspectiveCamera"===c.type||"OrthographicCamera"===c.type?(o=c.position,a=c.rotation,l=c.quaternion,"PerspectiveCamera"===c.type?R=new THREE.PerspectiveCamera(c.fov,c.aspect,c.near,c.far):"OrthographicCamera"===c.type&&(R=new THREE.OrthographicCamera(c.left,c.right,c.top,c.bottom,c.near,c.far)),R.name=h,R.position.set(o[0],o[1],o[2]),void 0!==l?(R.quaternion.set(l[0],l[1],l[2],l[3]),R.useQuaternion=!0):void 0!==a&&R.rotation.set(a[0],a[1],a[2]),t.add(R),S.cameras[h]=R,S.objects[h]=R):(o=c.position,a=c.rotation,s=c.scale,l=c.quaternion,(u=new THREE.Object3D).name=h,u.position.set(o[0],o[1],o[2]),l?(u.quaternion.set(l[0],l[1],l[2],l[3]),u.useQuaternion=!0):u.rotation.set(a[0],a[1],a[2]),u.scale.set(s[0],s[1],s[2]),u.visible=void 0!==c.visible&&c.visible,t.add(u),S.objects[h]=u,S.empties[h]=u);if(u){if(void 0!==c.userData)for(var g in c.userData){var y=c.userData[g];u.userData[g]=y}if(void 0!==c.groups)for(var v=0;v<c.groups.length;v++){var T=c.groups[v];void 0===S.groups[T]&&(S.groups[T]=[]),S.groups[T].push(h)}void 0!==c.children&&e(u,c.children)}}}(S.scene,A.objects)}function v(o){return function(e,t){var i,r,n;e.name=o,i=e,r=t,n=o,S.geometries[n]=i,S.face_materials[n]=r,E(),a-=1,M.onLoadComplete(),y()}}function P(t,i,r,n){return function(e){(function(e,t,i,r,n){var o=n.position,a=n.rotation,s=n.quaternion,l=n.scale;e.position.set(o[0],o[1],o[2]),s?(e.quaternion.set(s[0],s[1],s[2],s[3]),e.useQuaternion=!0):e.rotation.set(a[0],a[1],a[2]),e.scale.set(l[0],l[1],l[2]),r&&e.traverse(function(e){e.material=r});var h=void 0===n.visible||n.visible;e.traverse(function(e){e.visible=h}),i.add(e),e.name=t,S.objects[t]=e,E()})(e.content?e.content:e.dae?e.scene:e,t,i,r,n),a-=1,M.onLoadComplete(),y()}}function g(i){return function(e,t){e.name=i,S.geometries[i]=e,S.face_materials[i]=t}}function y(){var e={totalModels:l,totalTextures:h,loadedModels:l-a,loadedTextures:h-s};M.callbackProgress(e,S),M.onLoadProgress(),0===a&&0===s&&(!function(){for(var e=0;e<C.length;e++){var t=C[e],i=S.objects[t.targetName];i?t.object.target=i:(t.object.target=new THREE.Object3D,S.scene.add(t.object.target)),t.object.target.userData.targetInverse=t.object}}(),t(S))}var T,D,F,N,U,B,k,z,V,I,O,j=function(e){return function(){s-=e,y(),M.onLoadComplete()}};for(T in A.fogs)"linear"===(D=A.fogs[T]).type?r=new THREE.Fog(0,D.near,D.far):"exp2"===D.type&&(r=new THREE.FogExp2(0,D.density)),o=D.color,r.color.setRGB(o[0],o[1],o[2]),S.fogs[T]=r;for(F in A.geometries)(N=A.geometries[F]).type in this.geometryHandlerMap&&(a+=1,M.onLoadStart());for(U in A.objects)(B=A.objects[U]).type&&B.type in this.hierarchyHandlerMap&&(a+=1,M.onLoadStart());for(F in l=a,A.geometries)if("cube"===(N=A.geometries[F]).type)(x=new THREE.CubeGeometry(N.width,N.height,N.depth,N.widthSegments,N.heightSegments,N.depthSegments)).name=F,S.geometries[F]=x;else if("plane"===N.type)(x=new THREE.PlaneGeometry(N.width,N.height,N.widthSegments,N.heightSegments)).name=F,S.geometries[F]=x;else if("sphere"===N.type)(x=new THREE.SphereGeometry(N.radius,N.widthSegments,N.heightSegments)).name=F,S.geometries[F]=x;else if("cylinder"===N.type)(x=new THREE.CylinderGeometry(N.topRad,N.botRad,N.height,N.radSegs,N.heightSegs)).name=F,S.geometries[F]=x;else if("torus"===N.type)(x=new THREE.TorusGeometry(N.radius,N.tube,N.segmentsR,N.segmentsT)).name=F,S.geometries[F]=x;else if("icosahedron"===N.type)(x=new THREE.IcosahedronGeometry(N.radius,N.subdivisions)).name=F,S.geometries[F]=x;else if(N.type in this.geometryHandlerMap){var G={};for(var W in N)"type"!==W&&"url"!==W&&(G[W]=N[W]);this.geometryHandlerMap[N.type].loaderObject.load(L(N.url,A.urlBaseType),v(F),G)}else if("embedded"===N.type){var q=A.embeds[N.id];if(q.metadata=A.metadata,q){var X=this.geometryHandlerMap.ascii.loaderObject.parse(q,"");g(F)(X.geometry,X.materials)}}for(k in A.textures)if((z=A.textures[k]).url instanceof Array){s+=z.url.length;for(var Y=0;Y<z.url.length;Y++)M.onLoadStart()}else s+=1,M.onLoadStart();for(k in h=s,A.textures){if(void 0!==(z=A.textures[k]).mapping&&void 0!==THREE[z.mapping]&&(z.mapping=new THREE[z.mapping]),z.url instanceof Array){for(var K=z.url.length,$=[],Q=0;Q<K;Q++)$[Q]=L(z.url[Q],A.urlBaseType);n=(Z=/\.dds$/i.test($[0]))?THREE.ImageUtils.loadCompressedTextureCube($,z.mapping,j(K)):THREE.ImageUtils.loadTextureCube($,z.mapping,j(K))}else{var Z=/\.dds$/i.test(z.url),J=L(z.url,A.urlBaseType),ee=j(1);if(n=Z?THREE.ImageUtils.loadCompressedTexture(J,z.mapping,ee):THREE.ImageUtils.loadTexture(J,z.mapping,ee),void 0!==THREE[z.minFilter]&&(n.minFilter=THREE[z.minFilter]),void 0!==THREE[z.magFilter]&&(n.magFilter=THREE[z.magFilter]),z.anisotropy&&(n.anisotropy=z.anisotropy),z.repeat&&(n.repeat.set(z.repeat[0],z.repeat[1]),1!==z.repeat[0]&&(n.wrapS=THREE.RepeatWrapping),1!==z.repeat[1]&&(n.wrapT=THREE.RepeatWrapping)),z.offset&&n.offset.set(z.offset[0],z.offset[1]),z.wrap){var te={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==te[z.wrap[0]]&&(n.wrapS=te[z.wrap[0]]),void 0!==te[z.wrap[1]]&&(n.wrapT=te[z.wrap[1]])}}S.textures[k]=n}for(V in A.materials){for(O in(I=A.materials[V]).parameters)if("envMap"===O||"map"===O||"lightMap"===O||"bumpMap"===O)I.parameters[O]=S.textures[I.parameters[O]];else if("shading"===O)I.parameters[O]="flat"===I.parameters[O]?THREE.FlatShading:THREE.SmoothShading;else if("side"===O)"double"==I.parameters[O]?I.parameters[O]=THREE.DoubleSide:"back"==I.parameters[O]?I.parameters[O]=THREE.BackSide:I.parameters[O]=THREE.FrontSide;else if("blending"===O)I.parameters[O]=I.parameters[O]in THREE?THREE[I.parameters[O]]:THREE.NormalBlending;else if("combine"===O)I.parameters[O]=I.parameters[O]in THREE?THREE[I.parameters[O]]:THREE.MultiplyOperation;else if("vertexColors"===O)"face"==I.parameters[O]?I.parameters[O]=THREE.FaceColors:I.parameters[O]&&(I.parameters[O]=THREE.VertexColors);else if("wrapRGB"===O){var ie=I.parameters[O];I.parameters[O]=new THREE.Vector3(ie[0],ie[1],ie[2])}if(void 0!==I.parameters.opacity&&I.parameters.opacity<1&&(I.parameters.transparent=!0),I.parameters.normalMap){var re=THREE.ShaderLib.normalmap,ne=THREE.UniformsUtils.clone(re.uniforms),oe=I.parameters.color,ae=I.parameters.specular,se=I.parameters.ambient,le=I.parameters.shininess;ne.tNormal.value=S.textures[I.parameters.normalMap],I.parameters.normalScale&&ne.uNormalScale.value.set(I.parameters.normalScale[0],I.parameters.normalScale[1]),I.parameters.map&&(ne.tDiffuse.value=I.parameters.map,ne.enableDiffuse.value=!0),I.parameters.envMap&&(ne.tCube.value=I.parameters.envMap,ne.enableReflection.value=!0,ne.uReflectivity.value=I.parameters.reflectivity),I.parameters.lightMap&&(ne.tAO.value=I.parameters.lightMap,ne.enableAO.value=!0),I.parameters.specularMap&&(ne.tSpecular.value=S.textures[I.parameters.specularMap],ne.enableSpecular.value=!0),I.parameters.displacementMap&&(ne.tDisplacement.value=S.textures[I.parameters.displacementMap],ne.enableDisplacement.value=!0,ne.uDisplacementBias.value=I.parameters.displacementBias,ne.uDisplacementScale.value=I.parameters.displacementScale),ne.uDiffuseColor.value.setHex(oe),ne.uSpecularColor.value.setHex(ae),ne.uAmbientColor.value.setHex(se),ne.uShininess.value=le,I.parameters.opacity&&(ne.uOpacity.value=I.parameters.opacity);var he={fragmentShader:re.fragmentShader,vertexShader:re.vertexShader,uniforms:ne,lights:!0,fog:!0};b=new THREE.ShaderMaterial(he)}else b=new THREE[I.type](I.parameters);b.name=V,S.materials[V]=b}for(V in A.materials)if((I=A.materials[V]).parameters.materials){var ce=[];for(Q=0;Q<I.parameters.materials.length;Q++){var ue=I.parameters.materials[Q];ce.push(S.materials[ue])}S.materials[V].materials=ce}E(),S.cameras&&A.defaults.camera&&(S.currentCamera=S.cameras[A.defaults.camera]),S.fogs&&A.defaults.fog&&(S.scene.fog=S.fogs[A.defaults.fog]),M.callbackSync(S),y()},THREE.TextureLoader=function(){this.crossOrigin=null},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,load:function(e){var t=this,i=new Image;i.addEventListener("load",function(){var e=new THREE.Texture(i);e.needsUpdate=!0,t.dispatchEvent({type:"load",content:e})},!1),i.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),t.crossOrigin&&(i.crossOrigin=t.crossOrigin),i.src=e}},THREE.Material=function(){this.id=THREE.MaterialIdCount++,this.name="",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=!1,this.visible=!0,this.needsUpdate=!0},THREE.Material.prototype={constructor:THREE.Material,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i){if(t in this){var r=this[t];r instanceof THREE.Color?r.set(i):r instanceof THREE.Vector3&&i instanceof THREE.Vector3?r.copy(i):this[t]=i}}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},clone:function(e){return void 0===e&&(e=new THREE.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.clone=function(){var e=new THREE.LineDashedMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.MeshDepthMaterial;return THREE.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.shading=THREE.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},THREE.MeshFaceMaterial.prototype.clone=function(){return new THREE.MeshFaceMaterial(this.materials.slice(0))},THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.ParticleBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleBasicMaterial.prototype.clone=function(){var e=new THREE.ParticleBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.ParticleCanvasMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.ParticleCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleCanvasMaterial.prototype.clone=function(){var e=new THREE.ParticleCanvasMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;return THREE.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=THREE.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=new THREE.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewport=!this.sizeAttenuation,this.alignment=THREE.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1),this.setValues(e),void 0===(e=e||{}).depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===e.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===e.scaleByViewport&&(this.scaleByViewport=!this.sizeAttenuation)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.clone=function(){var e=new THREE.SpriteMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.useScreenCoordinates=this.useScreenCoordinates,e.sizeAttenuation=this.sizeAttenuation,e.scaleByViewport=this.scaleByViewport,e.alignment.copy(this.alignment),e.uvOffset.copy(this.uvOffset),e.uvScale.copy(this.uvScale),e.fog=this.fog,e},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1),THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1),THREE.Texture=function(e,t,i,r,n,o,a,s,l){this.id=THREE.TextureIdCount++,this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==i?i:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==n?n:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:THREE.RGBAFormat,this.type=void 0!==s?s:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,clone:function(e){return void 0===e&&(e=new THREE.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.TextureIdCount=0,THREE.CompressedTexture=function(e,t,i,r,n,o,a,s,l,h,c){THREE.Texture.call(this,null,o,a,s,l,h,r,n,c),this.image={width:t,height:i},this.mipmaps=e,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.DataTexture=function(e,t,i,r,n,o,a,s,l,h,c){THREE.Texture.call(this,null,o,a,s,l,h,r,n,c),this.image={data:e,width:t,height:i}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.Particle=function(e){THREE.Object3D.call(this),this.material=e},THREE.Particle.prototype=Object.create(THREE.Object3D.prototype),THREE.Particle.prototype.clone=function(e){return void 0===e&&(e=new THREE.Particle(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.frustumCulled=!1},THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype),THREE.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new THREE.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,THREE.Object3D.prototype.clone.call(this,e),e},THREE.Line=function(e,t,i){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==i?i:THREE.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.clone=function(e){return void 0===e&&(e=new THREE.Line(this.geometry,this.material,this.type)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.geometry=null,this.material=null,this.setGeometry(e),this.setMaterial(t)},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.setGeometry=function(e){void 0!==e&&(this.geometry=e,null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.updateMorphTargets())},THREE.Mesh.prototype.setMaterial=function(e){this.material=void 0!==e?e:new THREE.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0})},THREE.Mesh.prototype.updateMorphTargets=function(){if(0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.Mesh(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),t=!(this.matrixWorldNeedsUpdate=!1));var i,r=this.children.length;for(i=0;i<r;i++)this.children[i].update(this.skinMatrix,t)},THREE.SkinnedMesh=function(e,t,i){var r,n,o,a,s,l;if(THREE.Mesh.call(this,e,t),this.useVertexTexture=void 0===i||i,this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[],this.geometry&&void 0!==this.geometry.bones){for(r=0;r<this.geometry.bones.length;r++)a=(o=this.geometry.bones[r]).pos,s=o.rotq,l=o.scl,(n=this.addBone()).name=o.name,n.position.set(a[0],a[1],a[2]),n.quaternion.set(s[0],s[1],s[2],s[3]),n.useQuaternion=!0,void 0!==l?n.scale.set(l[0],l[1],l[2]):n.scale.set(1,1,1);for(r=0;r<this.bones.length;r++)o=this.geometry.bones[r],n=this.bones[r],-1===o.parent?this.add(n):this.bones[o.parent].add(n);var h,c=this.bones.length;if(this.useVertexTexture)h=256<c?64:64<c?32:16<c?16:8,this.boneTextureWidth=h,this.boneTextureHeight=h,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1;else this.boneMatrices=new Float32Array(16*c);this.pose()}},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),e=!(this.matrixWorldNeedsUpdate=!1));for(var t=0,i=this.children.length;t<i;t++){var r=this.children[t];r instanceof THREE.Bone?r.update(this.identityMatrix,!1):r.updateMatrixWorld(!0)}if(null==this.boneInverses){this.boneInverses=[];for(var n=0,o=this.bones.length;n<o;n++){var a=new THREE.Matrix4;a.getInverse(this.bones[n].skinMatrix),this.boneInverses.push(a)}}for(n=0,o=this.bones.length;n<o;n++)THREE.SkinnedMesh.offsetMatrix.multiplyMatrices(this.bones[n].skinMatrix,this.boneInverses[n]),THREE.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,16*n);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();i!==1/0?t.multiplyScalar(i):t.set(1)}},THREE.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),THREE.Mesh.prototype.clone.call(this,e),e},THREE.SkinnedMesh.offsetMatrix=new THREE.Matrix4,THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,i=e.animations,r=/([a-z]+)(\d+)/,n=0,o=e.morphTargets.length;n<o;n++){var a=e.morphTargets[n].name.match(r);if(a&&1<a.length){var s=a[1];a[2];i[s]||(i[s]={start:1/0,end:-1/0});var l=i[s];n<l.start&&(l.start=n),n>l.end&&(l.end=n),t||(t=s)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:i}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=(i.end-i.start)/t*1e3,this.time=0):console.warn("animation["+e+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var i=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1);i!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[i]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=i);var r=this.time%t/t;this.directionBackwards&&(r=1-r),this.morphTargetInfluences[this.currentKeyframe]=r,this.morphTargetInfluences[this.lastKeyframe]=1-r},THREE.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,THREE.Mesh.prototype.clone.call(this,e),e},THREE.Ribbon=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.material=t},THREE.Ribbon.prototype=Object.create(THREE.Object3D.prototype),THREE.Ribbon.prototype.clone=function(e){return void 0===e&&(e=new THREE.Ribbon(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.LOD=function(){THREE.Object3D.call(this),this.objects=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=0;i<this.objects.length&&!(t<this.objects[i].distance);i++);this.objects.splice(i,0,{distance:t,object:e}),this.add(e)},THREE.LOD.prototype.getObjectForDistance=function(e){for(var t=1,i=this.objects.length;t<i&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},THREE.LOD.prototype.update=function(){var n=new THREE.Vector3,o=new THREE.Vector3;return function(e){if(1<this.objects.length){n.getPositionFromMatrix(e.matrixWorld),o.getPositionFromMatrix(this.matrixWorld);var t=n.distanceTo(o);this.objects[0].object.visible=!0;for(var i=1,r=this.objects.length;i<r&&t>=this.objects[i].distance;i++)this.objects[i-1].object.visible=!1,this.objects[i].object.visible=!0;for(;i<r;i++)this.objects[i].object.visible=!1}}}(),THREE.LOD.prototype.clone=function(){},THREE.Sprite=function(e){THREE.Object3D.call(this),this.material=void 0!==e?e:new THREE.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.updateMatrix=function(){this.rotation3d.set(0,0,this.rotation),this.quaternion.setFromEuler(this.rotation3d,this.eulerOrder),this.matrix.makeFromPositionQuaternionScale(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},THREE.Sprite.prototype.clone=function(e){return void 0===e&&(e=new THREE.Sprite(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Scene=function(){THREE.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&-1===this.__objects.indexOf(e)){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(var i=0;i<e.children.length;i++)this.__addObject(e.children[i])},THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light)-1!==(t=this.__lights.indexOf(e))&&this.__lights.splice(t,1);else if(!(e instanceof THREE.Camera)){var t;if(-1!==(t=this.__objects.indexOf(e))){this.__objects.splice(t,1),this.__objectsRemoved.push(e);var i=this.__objectsAdded.indexOf(e);-1!==i&&this.__objectsAdded.splice(i,1)}}for(var r=0;r<e.children.length;r++)this.__removeObject(e.children[r])},THREE.Fog=function(e,t,i){this.name="",this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.CanvasRenderer=function(e){console.log("THREE.CanvasRenderer",THREE.REVISION);var g=THREE.Math.smoothstep;e=e||{};var y,T,x,r,n,b,R,w,H,_,S,M,C,A,P,D,F,N,U,B,k,z,V,I,O,j,G,W,q,X,Y,K,$,Q,Z,J,ee,te,ie,re=this,ne=new THREE.Projector,o=void 0!==e.canvas?e.canvas:document.createElement("canvas"),oe=o.getContext("2d"),i=new THREE.Color(0),a=0,s=1,l=0,h=null,c=null,u=null,p=null,d=null,f=null,m=0,ae=new THREE.RenderableVertex,se=new THREE.RenderableVertex,le=new THREE.Color,he=new THREE.Color,ce=new THREE.Color,ue=new THREE.Color,pe=new THREE.Color,de=new THREE.Color,fe=new THREE.Color,me=new THREE.Color,Ee={},ve={},ge=new THREE.Box2,ye=new THREE.Box2,Te=new THREE.Box2,xe=new THREE.Color,be=new THREE.Color,Re=new THREE.Color,we=new THREE.Vector3,t=16;function He(e){s!==e&&(oe.globalAlpha=e,s=e)}function _e(e){l!==e&&(e===THREE.NormalBlending?oe.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?oe.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(oe.globalCompositeOperation="darker"),l=e)}function Se(e){u!==e&&(oe.lineWidth=e,u=e)}function Me(e){p!==e&&(oe.lineCap=e,p=e)}function Ce(e){d!==e&&(oe.lineJoin=e,d=e)}function Ae(e){h!==e&&(oe.strokeStyle=e,h=e)}function Le(e){c!==e&&(oe.fillStyle=e,c=e)}function Pe(e,t){f===e&&m===t||(oe.setLineDash([e,t]),f=e,m=t)}(Q=document.createElement("canvas")).width=Q.height=2,(Z=Q.getContext("2d")).fillStyle="rgba(0,0,0,1)",Z.fillRect(0,0,2,2),J=Z.getImageData(0,0,2,2),ee=J.data,(te=document.createElement("canvas")).width=te.height=t,(ie=te.getContext("2d")).translate(-t/2,-t/2),ie.scale(t,t),t--,void 0===oe.setLineDash&&(void 0!==oe.mozDash?oe.setLineDash=function(e){oe.mozDash=null!==e[0]?e:null}:oe.setLineDash=function(){}),this.domElement=o,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,i){r=e*this.devicePixelRatio,n=t*this.devicePixelRatio,b=Math.floor(r/2),R=Math.floor(n/2),o.width=r,o.height=n,1!==this.devicePixelRatio&&!1!==i&&(o.style.width=e+"px",o.style.height=t+"px"),ge.set(new THREE.Vector2(-b,-R),new THREE.Vector2(b,R)),ye.set(new THREE.Vector2(-b,-R),new THREE.Vector2(b,R)),s=1,l=0,d=p=u=c=h=null},this.setClearColor=function(e,t){i.set(e),a=void 0!==t?t:1,ye.set(new THREE.Vector2(-b,-R),new THREE.Vector2(b,R))},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){oe.setTransform(1,0,0,-1,b,R),!1===ye.empty()&&(ye.intersect(ge),ye.expandByScalar(2),a<1&&oe.clearRect(0|ye.min.x,0|ye.min.y,ye.max.x-ye.min.x|0,ye.max.y-ye.min.y|0),0<a&&(_e(THREE.NormalBlending),He(1),Le("rgba("+Math.floor(255*i.r)+","+Math.floor(255*i.g)+","+Math.floor(255*i.b)+","+a+")"),oe.fillRect(0|ye.min.x,0|ye.min.y,ye.max.x-ye.min.x|0,ye.max.y-ye.min.y|0)),ye.makeEmpty())},this.render=function(e,h){if(h instanceof THREE.Camera!=!1){!0===this.autoClear&&this.clear(),oe.setTransform(1,0,0,-1,b,R),re.info.render.vertices=0,re.info.render.faces=0,y=ne.projectScene(e,h,this.sortObjects,this.sortElements),T=y.elements,x=y.lights,function(){xe.setRGB(0,0,0),be.setRGB(0,0,0),Re.setRGB(0,0,0);for(var e=0,t=x.length;e<t;e++){var i=x[e],r=i.color;i instanceof THREE.AmbientLight?xe.add(r):i instanceof THREE.DirectionalLight?be.add(r):i instanceof THREE.PointLight&&Re.add(r)}}();for(var t=0,i=T.length;t<i;t++){var r=T[t],n=r.material;if(void 0!==n&&!1!==n.visible){if(Te.makeEmpty(),r instanceof THREE.RenderableParticle)(w=r).x*=b,w.y*=R,o(w,r,n);else if(r instanceof THREE.RenderableLine)w=r.v1,H=r.v2,w.positionScreen.x*=b,w.positionScreen.y*=R,H.positionScreen.x*=b,H.positionScreen.y*=R,Te.setFromPoints([w.positionScreen,H.positionScreen]),!0===ge.isIntersectionBox(Te)&&a(w,H,r,n);else if(r instanceof THREE.RenderableFace3){if(w=r.v1,H=r.v2,_=r.v3,w.positionScreen.z<-1||1<w.positionScreen.z)continue;if(H.positionScreen.z<-1||1<H.positionScreen.z)continue;if(_.positionScreen.z<-1||1<_.positionScreen.z)continue;w.positionScreen.x*=b,w.positionScreen.y*=R,H.positionScreen.x*=b,H.positionScreen.y*=R,_.positionScreen.x*=b,_.positionScreen.y*=R,!0===n.overdraw&&(l(w.positionScreen,H.positionScreen),l(H.positionScreen,_.positionScreen),l(_.positionScreen,w.positionScreen)),Te.setFromPoints([w.positionScreen,H.positionScreen,_.positionScreen]),!0===ge.isIntersectionBox(Te)&&u(w,H,_,0,1,2,r,n)}else if(r instanceof THREE.RenderableFace4){if(w=r.v1,H=r.v2,_=r.v3,S=r.v4,w.positionScreen.z<-1||1<w.positionScreen.z)continue;if(H.positionScreen.z<-1||1<H.positionScreen.z)continue;if(_.positionScreen.z<-1||1<_.positionScreen.z)continue;if(S.positionScreen.z<-1||1<S.positionScreen.z)continue;w.positionScreen.x*=b,w.positionScreen.y*=R,H.positionScreen.x*=b,H.positionScreen.y*=R,_.positionScreen.x*=b,_.positionScreen.y*=R,S.positionScreen.x*=b,S.positionScreen.y*=R,ae.positionScreen.copy(H.positionScreen),se.positionScreen.copy(S.positionScreen),!0===n.overdraw&&(l(w.positionScreen,H.positionScreen),l(H.positionScreen,S.positionScreen),l(S.positionScreen,w.positionScreen),l(_.positionScreen,ae.positionScreen),l(_.positionScreen,se.positionScreen)),Te.setFromPoints([w.positionScreen,H.positionScreen,_.positionScreen,S.positionScreen]),!0===ge.isIntersectionBox(Te)&&s(w,H,_,S,ae,se,r,n)}ye.union(Te)}}oe.setTransform(1,0,0,1,0,0)}else console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");function c(e,t,i){for(var r=0,n=x.length;r<n;r++){var o=x[r];if(me.copy(o.color),o instanceof THREE.DirectionalLight){var a=we.getPositionFromMatrix(o.matrixWorld).normalize();if((s=t.dot(a))<=0)continue;s*=o.intensity,i.add(me.multiplyScalar(s))}else if(o instanceof THREE.PointLight){var s;a=we.getPositionFromMatrix(o.matrixWorld);if((s=t.dot(we.subVectors(a,e).normalize()))<=0)continue;if(0==(s*=0==o.distance?1:1-Math.min(e.distanceTo(a)/o.distance,1)))continue;s*=o.intensity,i.add(me.multiplyScalar(s))}}}function o(e,t,i){var r,n,o,a,s,l,h;if(He(i.opacity),_e(i.blending),i instanceof THREE.ParticleBasicMaterial)if(null===i.map){if(o=t.object.scale.x,a=t.object.scale.y,o*=t.scale.x*b,a*=t.scale.y*R,Te.min.set(e.x-o,e.y-a),Te.max.set(e.x+o,e.y+a),!1===ge.isIntersectionBox(Te))return void Te.makeEmpty();Le(i.color.getStyle()),oe.save(),oe.translate(e.x,e.y),oe.rotate(-t.rotation),oe.scale(o,a),oe.fillRect(-1,-1,2,2),oe.restore()}else{if(l=(s=i.map.image).width>>1,h=s.height>>1,r=(o=t.scale.x*b)*l,n=(a=t.scale.y*R)*h,Te.min.set(e.x-r,e.y-n),Te.max.set(e.x+r,e.y+n),!1===ge.isIntersectionBox(Te))return void Te.makeEmpty();oe.save(),oe.translate(e.x,e.y),oe.rotate(-t.rotation),oe.scale(o,-a),oe.translate(-l,-h),oe.drawImage(s,0,0),oe.restore()}else if(i instanceof THREE.ParticleCanvasMaterial){if(r=t.scale.x*b,n=t.scale.y*R,Te.min.set(e.x-r,e.y-n),Te.max.set(e.x+r,e.y+n),!1===ge.isIntersectionBox(Te))return void Te.makeEmpty();Ae(i.color.getStyle()),Le(i.color.getStyle()),oe.save(),oe.translate(e.x,e.y),oe.rotate(-t.rotation),oe.scale(r,n),i.program(oe),oe.restore()}}function a(e,t,i,r){if(He(r.opacity),_e(r.blending),oe.beginPath(),oe.moveTo(e.positionScreen.x,e.positionScreen.y),oe.lineTo(t.positionScreen.x,t.positionScreen.y),r instanceof THREE.LineBasicMaterial){if(Se(r.linewidth),Me(r.linecap),Ce(r.linejoin),r.vertexColors!==THREE.VertexColors)Ae(r.color.getStyle());else{var n=i.vertexColors[0].getStyle(),o=i.vertexColors[1].getStyle();if(n===o)Ae(n);else{try{var a=oe.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,n),a.addColorStop(1,o)}catch(e){a=n}Ae(a)}}oe.stroke(),Te.expandByScalar(2*r.linewidth)}else r instanceof THREE.LineDashedMaterial&&(Se(r.linewidth),Me(r.linecap),Ce(r.linejoin),Ae(r.color.getStyle()),Pe(r.dashSize,r.gapSize),oe.stroke(),Te.expandByScalar(2*r.linewidth),Pe(null,null))}function u(e,t,i,r,n,o,a,s){if(re.info.render.vertices+=3,re.info.render.faces++,He(s.opacity),_e(s.blending),M=e.positionScreen.x,C=e.positionScreen.y,A=t.positionScreen.x,P=t.positionScreen.y,D=i.positionScreen.x,F=i.positionScreen.y,p(M,C,A,P,D,F),(s instanceof THREE.MeshLambertMaterial||s instanceof THREE.MeshPhongMaterial)&&null===s.map)de.copy(s.color),fe.copy(s.emissive),s.vertexColors===THREE.FaceColors&&de.multiply(a.color),!1===s.wireframe&&s.shading==THREE.SmoothShading&&3==a.vertexNormalsLength?(he.copy(xe),ce.copy(xe),ue.copy(xe),c(a.v1.positionWorld,a.vertexNormalsModel[0],he),c(a.v2.positionWorld,a.vertexNormalsModel[1],ce),c(a.v3.positionWorld,a.vertexNormalsModel[2],ue),he.multiply(de).add(fe),ce.multiply(de).add(fe),ue.multiply(de).add(fe),pe.addColors(ce,ue).multiplyScalar(.5),j=v(he,ce,ue,pe),E(M,C,A,P,D,F,0,0,1,0,0,1,j)):(le.copy(xe),c(a.centroidModel,a.normalModel,le),le.multiply(de).add(fe),!0===s.wireframe?f(le,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):L(le));else if(s instanceof THREE.MeshBasicMaterial||s instanceof THREE.MeshLambertMaterial||s instanceof THREE.MeshPhongMaterial)null!==s.map?s.map.mapping instanceof THREE.UVMapping&&(G=a.uvs[0],m(M,C,A,P,D,F,G[r].x,G[r].y,G[n].x,G[n].y,G[o].x,G[o].y,s.map)):null!==s.envMap?s.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(we.copy(a.vertexNormalsModelView[r]),W=.5*we.x+.5,q=.5*we.y+.5,we.copy(a.vertexNormalsModelView[n]),X=.5*we.x+.5,Y=.5*we.y+.5,we.copy(a.vertexNormalsModelView[o]),K=.5*we.x+.5,$=.5*we.y+.5,m(M,C,A,P,D,F,W,q,X,Y,K,$,s.envMap)):(le.copy(s.color),s.vertexColors===THREE.FaceColors&&le.multiply(a.color),!0===s.wireframe?f(le,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):L(le));else if(s instanceof THREE.MeshDepthMaterial)I=h.near,O=h.far,he.r=he.g=he.b=1-g(e.positionScreen.z*e.positionScreen.w,I,O),ce.r=ce.g=ce.b=1-g(t.positionScreen.z*t.positionScreen.w,I,O),ue.r=ue.g=ue.b=1-g(i.positionScreen.z*i.positionScreen.w,I,O),pe.addColors(ce,ue).multiplyScalar(.5),j=v(he,ce,ue,pe),E(M,C,A,P,D,F,0,0,1,0,0,1,j);else if(s instanceof THREE.MeshNormalMaterial){var l;s.shading==THREE.FlatShading?(l=a.normalModelView,le.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5),!0===s.wireframe?f(le,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):L(le)):s.shading==THREE.SmoothShading&&(l=a.vertexNormalsModelView[r],he.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5),l=a.vertexNormalsModelView[n],ce.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5),l=a.vertexNormalsModelView[o],ue.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5),pe.addColors(ce,ue).multiplyScalar(.5),j=v(he,ce,ue,pe),E(M,C,A,P,D,F,0,0,1,0,0,1,j))}}function s(e,t,i,r,n,o,a,s){if(re.info.render.vertices+=4,re.info.render.faces++,He(s.opacity),_e(s.blending),void 0!==s.map&&null!==s.map||void 0!==s.envMap&&null!==s.envMap)return u(e,t,r,0,1,3,a,s),void u(n,i,o,1,2,3,a,s);if(M=e.positionScreen.x,C=e.positionScreen.y,A=t.positionScreen.x,P=t.positionScreen.y,D=i.positionScreen.x,F=i.positionScreen.y,N=r.positionScreen.x,U=r.positionScreen.y,B=n.positionScreen.x,k=n.positionScreen.y,z=o.positionScreen.x,V=o.positionScreen.y,s instanceof THREE.MeshLambertMaterial||s instanceof THREE.MeshPhongMaterial)de.copy(s.color),fe.copy(s.emissive),s.vertexColors===THREE.FaceColors&&de.multiply(a.color),!1===s.wireframe&&s.shading==THREE.SmoothShading&&4==a.vertexNormalsLength?(he.copy(xe),ce.copy(xe),ue.copy(xe),pe.copy(xe),c(a.v1.positionWorld,a.vertexNormalsModel[0],he),c(a.v2.positionWorld,a.vertexNormalsModel[1],ce),c(a.v4.positionWorld,a.vertexNormalsModel[3],ue),c(a.v3.positionWorld,a.vertexNormalsModel[2],pe),he.multiply(de).add(fe),ce.multiply(de).add(fe),ue.multiply(de).add(fe),pe.multiply(de).add(fe),j=v(he,ce,ue,pe),p(M,C,A,P,N,U),E(M,C,A,P,N,U,0,0,1,0,0,1,j),p(B,k,D,F,z,V),E(B,k,D,F,z,V,1,0,1,1,0,1,j)):(le.copy(xe),c(a.centroidModel,a.normalModel,le),le.multiply(de).add(fe),d(M,C,A,P,D,F,N,U),!0===s.wireframe?f(le,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):L(le));else if(s instanceof THREE.MeshBasicMaterial)le.copy(s.color),s.vertexColors===THREE.FaceColors&&le.multiply(a.color),d(M,C,A,P,D,F,N,U),!0===s.wireframe?f(le,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):L(le);else if(s instanceof THREE.MeshNormalMaterial){var l;s.shading==THREE.FlatShading?(l=a.normalModelView,le.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5),d(M,C,A,P,D,F,N,U),!0===s.wireframe?f(le,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):L(le)):s.shading==THREE.SmoothShading&&(l=a.vertexNormalsModelView[0],he.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5),l=a.vertexNormalsModelView[1],ce.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5),l=a.vertexNormalsModelView[3],ue.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5),l=a.vertexNormalsModelView[2],pe.setRGB(l.x,l.y,l.z).multiplyScalar(.5).addScalar(.5),j=v(he,ce,ue,pe),p(M,C,A,P,N,U),E(M,C,A,P,N,U,0,0,1,0,0,1,j),p(B,k,D,F,z,V),E(B,k,D,F,z,V,1,0,1,1,0,1,j))}else s instanceof THREE.MeshDepthMaterial&&(I=h.near,O=h.far,he.r=he.g=he.b=1-g(e.positionScreen.z*e.positionScreen.w,I,O),ce.r=ce.g=ce.b=1-g(t.positionScreen.z*t.positionScreen.w,I,O),ue.r=ue.g=ue.b=1-g(r.positionScreen.z*r.positionScreen.w,I,O),pe.r=pe.g=pe.b=1-g(i.positionScreen.z*i.positionScreen.w,I,O),j=v(he,ce,ue,pe),p(M,C,A,P,N,U),E(M,C,A,P,N,U,0,0,1,0,0,1,j),p(B,k,D,F,z,V),E(B,k,D,F,z,V,1,0,1,1,0,1,j))}function p(e,t,i,r,n,o){oe.beginPath(),oe.moveTo(e,t),oe.lineTo(i,r),oe.lineTo(n,o),oe.closePath()}function d(e,t,i,r,n,o,a,s){oe.beginPath(),oe.moveTo(e,t),oe.lineTo(i,r),oe.lineTo(n,o),oe.lineTo(a,s),oe.closePath()}function f(e,t,i,r){Se(t),Me(i),Ce(r),Ae(e.getStyle()),oe.stroke(),Te.expandByScalar(2*t)}function L(e){Le(e.getStyle()),oe.fill()}function m(e,t,i,r,n,o,a,s,l,h,c,u,p){if(!(p instanceof THREE.DataTexture||void 0===p.image||0==p.image.width)){if(!0===p.needsUpdate){var d=p.wrapS==THREE.RepeatWrapping,f=p.wrapT==THREE.RepeatWrapping;Ee[p.id]=oe.createPattern(p.image,!0===d&&!0===f?"repeat":!0===d&&!1===f?"repeat-x":!1===d&&!0===f?"repeat-y":"no-repeat"),p.needsUpdate=!1}void 0===Ee[p.id]?Le("rgba(0,0,0,1)"):Le(Ee[p.id]);var m,E,v,g,y,T,x,b,R=p.offset.x/p.repeat.x,w=p.offset.y/p.repeat.y,H=p.image.width*p.repeat.x,_=p.image.height*p.repeat.y;if(l=(l+R)*H,h=(1-h+w)*_,c=(c+R)*H,u=(1-u+w)*_,i-=e,r-=t,n-=e,o-=t,0===(x=(l-=a=(a+R)*H)*(u-=s=(1-s+w)*_)-(c-=a)*(h-=s))){if(void 0===ve[p.id]){var S=document.createElement("canvas");S.width=p.image.width,S.height=p.image.height;var M=S.getContext("2d");M.drawImage(p.image,0,0),ve[p.id]=M.getImageData(0,0,p.image.width,p.image.height).data}var C=ve[p.id],A=4*(Math.floor(a)+Math.floor(s)*p.image.width);return le.setRGB(C[A]/255,C[A+1]/255,C[A+2]/255),void L(le)}y=e-(m=(u*i-h*n)*(b=1/x))*a-(v=(l*n-c*i)*b)*s,T=t-(E=(u*r-h*o)*b)*a-(g=(l*o-c*r)*b)*s,oe.save(),oe.transform(m,E,v,g,y,T),oe.fill(),oe.restore()}}function E(e,t,i,r,n,o,a,s,l,h,c,u,p){var d,f,m,E,v,g,y,T=p.width-1,x=p.height-1;l*=T,h*=x,c*=T,u*=x,v=e-(d=((u-=s*=x)*(i-=e)-(h-=s)*(n-=e))*(y=1/((l-=a*=T)*u-(c-=a)*h)))*a-(m=(l*n-c*i)*y)*s,g=t-(f=(u*(r-=t)-h*(o-=t))*y)*a-(E=(l*o-c*r)*y)*s,oe.save(),oe.transform(d,f,m,E,v,g),oe.clip(),oe.drawImage(p,0,0),oe.restore()}function v(e,t,i,r){return ee[0]=255*e.r|0,ee[1]=255*e.g|0,ee[2]=255*e.b|0,ee[4]=255*t.r|0,ee[5]=255*t.g|0,ee[6]=255*t.b|0,ee[8]=255*i.r|0,ee[9]=255*i.g|0,ee[10]=255*i.b|0,ee[12]=255*r.r|0,ee[13]=255*r.g|0,ee[14]=255*r.b|0,Z.putImageData(J,0,0),ie.drawImage(Q,0,0),te}function l(e,t){var i,r=t.x-e.x,n=t.y-e.y,o=r*r+n*n;0!==o&&(r*=i=1/Math.sqrt(o),n*=i,t.x+=r,t.y+=n,e.x-=r,e.y-=n)}}},THREE.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix \t+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},THREE.UniformsUtils={merge:function(e){var t,i,r,n={};for(t=0;t<e.length;t++)for(i in r=this.clone(e[t]))n[i]=r[i];return n},clone:function(e){var t,i,r,n={};for(t in e)for(i in n[t]={},e[t])(r=e[t][i])instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix4||r instanceof THREE.Texture?n[t][i]=r.clone():r instanceof Array?n[t][i]=r.slice():n[t][i]=r;return n}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}},THREE.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",THREE.REVISION);var T=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),w=void 0!==e.precision?e.precision:"highp",t=void 0===e.alpha||e.alpha,i=void 0===e.premultipliedAlpha||e.premultipliedAlpha,r=void 0!==e.antialias&&e.antialias,n=void 0===e.stencil||e.stencil,o=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,a=new THREE.Color(0),s=0;void 0!==e.clearColor&&(console.warn("DEPRECATED: clearColor in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),a.setHex(e.clearColor)),void 0!==e.clearAlpha&&(console.warn("DEPRECATED: clearAlpha in WebGLRenderer constructor parameters is being removed. Use .setClearColor() instead."),s=e.clearAlpha),this.domElement=T,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyBasedShading=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var qe,l,h,c,u,I=this,H=[],_=0,x=null,p=null,b=-1,R=null,S=null,M=0,C=0,d=-1,f=-1,m=-1,E=-1,v=-1,g=-1,y=-1,A=-1,L=null,P=null,D=null,F=null,N=0,U=0,B=0,k=0,z=0,V=0,O={},j=new THREE.Frustum,G=new THREE.Matrix4,W=new THREE.Matrix4,q=new THREE.Vector3,X=new THREE.Vector3,Y=!0,K={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}};!function(){try{if(!(qe=T.getContext("experimental-webgl",{alpha:t,premultipliedAlpha:i,antialias:r,stencil:n,preserveDrawingBuffer:o})))throw"Error creating WebGL context."}catch(e){console.error(e)}l=qe.getExtension("OES_texture_float"),h=qe.getExtension("OES_standard_derivatives"),c=qe.getExtension("EXT_texture_filter_anisotropic")||qe.getExtension("MOZ_EXT_texture_filter_anisotropic")||qe.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),u=qe.getExtension("WEBGL_compressed_texture_s3tc")||qe.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||qe.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),l||console.log("THREE.WebGLRenderer: Float textures not supported.");h||console.log("THREE.WebGLRenderer: Standard derivatives not supported.");c||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported.");u||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported.");void 0===qe.getShaderPrecisionFormat&&(qe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}(),qe.clearColor(0,0,0,1),qe.clearDepth(1),qe.clearStencil(0),qe.enable(qe.DEPTH_TEST),qe.depthFunc(qe.LEQUAL),qe.frontFace(qe.CCW),qe.cullFace(qe.BACK),qe.enable(qe.CULL_FACE),qe.enable(qe.BLEND),qe.blendEquation(qe.FUNC_ADD),qe.blendFunc(qe.SRC_ALPHA,qe.ONE_MINUS_SRC_ALPHA),qe.clearColor(a.r,a.g,a.b,s);var $=(this.context=qe).getParameter(qe.MAX_TEXTURE_IMAGE_UNITS),Q=qe.getParameter(qe.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Z=(qe.getParameter(qe.MAX_TEXTURE_SIZE),qe.getParameter(qe.MAX_CUBE_MAP_TEXTURE_SIZE)),J=c?qe.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,ee=0<Q,te=ee&&l,ie=(u&&qe.getParameter(qe.COMPRESSED_TEXTURE_FORMATS),qe.getShaderPrecisionFormat(qe.VERTEX_SHADER,qe.HIGH_FLOAT)),re=qe.getShaderPrecisionFormat(qe.VERTEX_SHADER,qe.MEDIUM_FLOAT),ne=(qe.getShaderPrecisionFormat(qe.VERTEX_SHADER,qe.LOW_FLOAT),qe.getShaderPrecisionFormat(qe.FRAGMENT_SHADER,qe.HIGH_FLOAT)),oe=qe.getShaderPrecisionFormat(qe.FRAGMENT_SHADER,qe.MEDIUM_FLOAT),ae=(qe.getShaderPrecisionFormat(qe.FRAGMENT_SHADER,qe.LOW_FLOAT),qe.getShaderPrecisionFormat(qe.VERTEX_SHADER,qe.HIGH_INT),qe.getShaderPrecisionFormat(qe.VERTEX_SHADER,qe.MEDIUM_INT),qe.getShaderPrecisionFormat(qe.VERTEX_SHADER,qe.LOW_INT),qe.getShaderPrecisionFormat(qe.FRAGMENT_SHADER,qe.HIGH_INT),qe.getShaderPrecisionFormat(qe.FRAGMENT_SHADER,qe.MEDIUM_INT),qe.getShaderPrecisionFormat(qe.FRAGMENT_SHADER,qe.LOW_INT),0<ie.precision&&0<ne.precision),se=0<re.precision&&0<oe.precision;function le(e){var t,i;if(e.__webglVertexBuffer=qe.createBuffer(),e.__webglNormalBuffer=qe.createBuffer(),e.__webglTangentBuffer=qe.createBuffer(),e.__webglColorBuffer=qe.createBuffer(),e.__webglUVBuffer=qe.createBuffer(),e.__webglUV2Buffer=qe.createBuffer(),e.__webglSkinIndicesBuffer=qe.createBuffer(),e.__webglSkinWeightsBuffer=qe.createBuffer(),e.__webglFaceBuffer=qe.createBuffer(),e.__webglLineBuffer=qe.createBuffer(),e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,i=e.numMorphTargets;t<i;t++)e.__webglMorphTargetsBuffers.push(qe.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,i=e.numMorphNormals;t<i;t++)e.__webglMorphNormalsBuffers.push(qe.createBuffer());I.info.memory.geometries++}"highp"!==w||ae||(se?(w="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(w="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==w||se||(w="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return qe},this.supportsVertexTextures=function(){return ee},this.supportsFloatTextures=function(){return l},this.supportsStandardDerivatives=function(){return h},this.supportsCompressedTextureS3TC=function(){return u},this.getMaxAnisotropy=function(){return J},this.getPrecision=function(){return w},this.setSize=function(e,t,i){T.width=e*this.devicePixelRatio,T.height=t*this.devicePixelRatio,1!==this.devicePixelRatio&&!1!==i&&(T.style.width=e+"px",T.style.height=t+"px"),this.setViewport(0,0,T.width,T.height)},this.setViewport=function(e,t,i,r){N=void 0!==e?e:0,U=void 0!==t?t:0,B=void 0!==i?i:T.width,k=void 0!==r?r:T.height,qe.viewport(N,U,B,k)},this.setScissor=function(e,t,i,r){qe.scissor(e,t,i,r)},this.enableScissorTest=function(e){e?qe.enable(qe.SCISSOR_TEST):qe.disable(qe.SCISSOR_TEST)},this.setClearColor=function(e,t){a.set(e),s=void 0!==t?t:1,qe.clearColor(a.r,a.g,a.b,s)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return a},this.getClearAlpha=function(){return s},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=qe.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=qe.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=qe.STENCIL_BUFFER_BIT),qe.clear(r)},this.clearTarget=function(e,t,i,r){this.setRenderTarget(e),this.clear(t,i,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){Y=!(x=null),f=d=b=R=A=y=m=-1,this.shadowMapPlugin.update(e,t)};var he=function(e){var t=e.target;t.removeEventListener("dispose",he),de(t),I.info.memory.geometries--},ce=function(e){var t=e.target;t.removeEventListener("dispose",ce),fe(t),I.info.memory.textures--},ue=function(e){var t=e.target;t.removeEventListener("dispose",ue),me(t),I.info.memory.textures--},pe=function(e){var t=e.target;t.removeEventListener("dispose",pe),Ee(t)},de=function(e){if((e.__webglInit=void 0)!==e.__webglVertexBuffer&&qe.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&qe.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&qe.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&qe.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&qe.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&qe.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&qe.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&qe.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&qe.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&qe.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&qe.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.geometryGroups)for(var t in e.geometryGroups){var i=e.geometryGroups[t];if(void 0!==i.numMorphTargets)for(var r=0,n=i.numMorphTargets;r<n;r++)qe.deleteBuffer(i.__webglMorphTargetsBuffers[r]);if(void 0!==i.numMorphNormals)for(r=0,n=i.numMorphNormals;r<n;r++)qe.deleteBuffer(i.__webglMorphNormalsBuffers[r]);ve(i)}ve(e)},fe=function(e){if(e.image&&e.image.__webglTextureCube)qe.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,qe.deleteTexture(e.__webglTexture)}},me=function(e){if(e&&e.__webglTexture)if(qe.deleteTexture(e.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var t=0;t<6;t++)qe.deleteFramebuffer(e.__webglFramebuffer[t]),qe.deleteRenderbuffer(e.__webglRenderbuffer[t]);else qe.deleteFramebuffer(e.__webglFramebuffer),qe.deleteRenderbuffer(e.__webglRenderbuffer)},Ee=function(e){var t=e.program;if(void 0!==t){var i,r,n;e.program=void 0;var o=!1;for(i=0,r=H.length;i<r;i++)if((n=H[i]).program===t){n.usedTimes--,0===n.usedTimes&&(o=!0);break}if(!0===o){var a=[];for(i=0,r=H.length;i<r;i++)(n=H[i]).program!==t&&a.push(n);H=a,qe.deleteProgram(t),I.info.memory.programs--}}};function ve(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)qe.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function ge(e,t){var i=e.vertices.length,r=t.material;if(r.attributes)for(var n in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),r.attributes){var o=r.attributes[n];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(i*a),o.buffer=qe.createBuffer(),o.buffer.belongsToAttribute=n,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}function ye(e,t){var i,r,n=t.geometry,o=e.faces3,a=e.faces4,s=3*o.length+4*a.length,l=1*o.length+2*a.length,h=3*o.length+4*a.length,c=Te(t,e),u=Ke(c),p=Xe(c),d=Ye(c);if(e.__vertexArray=new Float32Array(3*s),p&&(e.__normalArray=new Float32Array(3*s)),n.hasTangents&&(e.__tangentArray=new Float32Array(4*s)),d&&(e.__colorArray=new Float32Array(3*s)),u&&((0<n.faceUvs.length||0<n.faceVertexUvs.length)&&(e.__uvArray=new Float32Array(2*s)),(1<n.faceUvs.length||1<n.faceVertexUvs.length)&&(e.__uv2Array=new Float32Array(2*s))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*s),e.__skinWeightArray=new Float32Array(4*s)),e.__faceArray=new Uint16Array(3*l),e.__lineArray=new Uint16Array(2*h),e.numMorphTargets)for(e.__morphTargetsArrays=[],i=0,r=e.numMorphTargets;i<r;i++)e.__morphTargetsArrays.push(new Float32Array(3*s));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],i=0,r=e.numMorphNormals;i<r;i++)e.__morphNormalsArrays.push(new Float32Array(3*s));if(e.__webglFaceCount=3*l,e.__webglLineCount=2*h,c.attributes)for(var f in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),c.attributes){var m=c.attributes[f],E={};for(var v in m)E[v]=m[v];if(!E.__webglInitialized||E.createUniqueBuffers){E.__webglInitialized=!0;var g=1;"v2"===E.type?g=2:"v3"===E.type?g=3:"v4"===E.type?g=4:"c"===E.type&&(g=3),E.size=g,E.array=new Float32Array(s*g),E.buffer=qe.createBuffer(),E.buffer.belongsToAttribute=f,m.needsUpdate=!0,E.__original=m}e.__webglCustomAttributesList.push(E)}e.__inittedArrays=!0}function Te(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Xe(e){return!(e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial)&&((t=e)&&void 0!==t.shading&&t.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading);var t}function Ye(e){return!!e.vertexColors&&e.vertexColors}function Ke(e){return!!(e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof THREE.ShaderMaterial)}function xe(e,t,i,r,n){if(e.__inittedArrays){var o,a,s,l,h,c,u,p,d,f,m,E,v,g,y,T,x,b,R,w,H,_,S,M,C,A,L,P,D,F,N,U,B,k,z,V,I,O,j,G,W,q,X,Y,K,$,Q,Z=Xe(n),J=Ye(n),ee=Ke(n),te=Z===THREE.SmoothShading,ie=0,re=0,ne=0,oe=0,ae=0,se=0,le=0,he=0,ce=0,ue=0,pe=0,de=0,fe=e.__vertexArray,me=e.__uvArray,Ee=e.__uv2Array,ve=e.__normalArray,ge=e.__tangentArray,ye=e.__colorArray,Te=e.__skinIndexArray,xe=e.__skinWeightArray,be=e.__morphTargetsArrays,Re=e.__morphNormalsArrays,we=e.__webglCustomAttributesList,He=e.__faceArray,_e=e.__lineArray,Se=t.geometry,Me=Se.verticesNeedUpdate,Ce=Se.elementsNeedUpdate,Ae=Se.uvsNeedUpdate,Le=Se.normalsNeedUpdate,Pe=Se.tangentsNeedUpdate,De=Se.colorsNeedUpdate,Fe=Se.morphTargetsNeedUpdate,Ne=Se.vertices,Ue=e.faces3,Be=e.faces4,ke=Se.faces,ze=Se.faceVertexUvs[0],Ve=Se.faceVertexUvs[1],Ie=(Se.colors,Se.skinIndices),Oe=Se.skinWeights,je=Se.morphTargets,Ge=Se.morphNormals;if(Me){for(o=0,a=Ue.length;o<a;o++)m=Ne[(s=ke[Ue[o]]).a],E=Ne[s.b],v=Ne[s.c],fe[re]=m.x,fe[re+1]=m.y,fe[re+2]=m.z,fe[re+3]=E.x,fe[re+4]=E.y,fe[re+5]=E.z,fe[re+6]=v.x,fe[re+7]=v.y,fe[re+8]=v.z,re+=9;for(o=0,a=Be.length;o<a;o++)m=Ne[(s=ke[Be[o]]).a],E=Ne[s.b],v=Ne[s.c],g=Ne[s.d],fe[re]=m.x,fe[re+1]=m.y,fe[re+2]=m.z,fe[re+3]=E.x,fe[re+4]=E.y,fe[re+5]=E.z,fe[re+6]=v.x,fe[re+7]=v.y,fe[re+8]=v.z,fe[re+9]=g.x,fe[re+10]=g.y,fe[re+11]=g.z,re+=12;qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglVertexBuffer),qe.bufferData(qe.ARRAY_BUFFER,fe,i)}if(Fe)for(G=0,W=je.length;G<W;G++){for(o=pe=0,a=Ue.length;o<a;o++)s=ke[Y=Ue[o]],m=je[G].vertices[s.a],E=je[G].vertices[s.b],v=je[G].vertices[s.c],(q=be[G])[pe]=m.x,q[pe+1]=m.y,q[pe+2]=m.z,q[pe+3]=E.x,q[pe+4]=E.y,q[pe+5]=E.z,q[pe+6]=v.x,q[pe+7]=v.y,q[pe+8]=v.z,n.morphNormals&&(te?(R=(K=Ge[G].vertexNormals[Y]).a,w=K.b,H=K.c):H=w=R=Ge[G].faceNormals[Y],(X=Re[G])[pe]=R.x,X[pe+1]=R.y,X[pe+2]=R.z,X[pe+3]=w.x,X[pe+4]=w.y,X[pe+5]=w.z,X[pe+6]=H.x,X[pe+7]=H.y,X[pe+8]=H.z),pe+=9;for(o=0,a=Be.length;o<a;o++)s=ke[Y=Be[o]],m=je[G].vertices[s.a],E=je[G].vertices[s.b],v=je[G].vertices[s.c],g=je[G].vertices[s.d],(q=be[G])[pe]=m.x,q[pe+1]=m.y,q[pe+2]=m.z,q[pe+3]=E.x,q[pe+4]=E.y,q[pe+5]=E.z,q[pe+6]=v.x,q[pe+7]=v.y,q[pe+8]=v.z,q[pe+9]=g.x,q[pe+10]=g.y,q[pe+11]=g.z,n.morphNormals&&(te?(R=(K=Ge[G].vertexNormals[Y]).a,w=K.b,H=K.c,_=K.d):_=H=w=R=Ge[G].faceNormals[Y],(X=Re[G])[pe]=R.x,X[pe+1]=R.y,X[pe+2]=R.z,X[pe+3]=w.x,X[pe+4]=w.y,X[pe+5]=w.z,X[pe+6]=H.x,X[pe+7]=H.y,X[pe+8]=H.z,X[pe+9]=_.x,X[pe+10]=_.y,X[pe+11]=_.z),pe+=12;qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[G]),qe.bufferData(qe.ARRAY_BUFFER,be[G],i),n.morphNormals&&(qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[G]),qe.bufferData(qe.ARRAY_BUFFER,Re[G],i))}if(Oe.length){for(o=0,a=Ue.length;o<a;o++)L=Oe[(s=ke[Ue[o]]).a],P=Oe[s.b],D=Oe[s.c],xe[ue]=L.x,xe[ue+1]=L.y,xe[ue+2]=L.z,xe[ue+3]=L.w,xe[ue+4]=P.x,xe[ue+5]=P.y,xe[ue+6]=P.z,xe[ue+7]=P.w,xe[ue+8]=D.x,xe[ue+9]=D.y,xe[ue+10]=D.z,xe[ue+11]=D.w,N=Ie[s.a],U=Ie[s.b],B=Ie[s.c],Te[ue]=N.x,Te[ue+1]=N.y,Te[ue+2]=N.z,Te[ue+3]=N.w,Te[ue+4]=U.x,Te[ue+5]=U.y,Te[ue+6]=U.z,Te[ue+7]=U.w,Te[ue+8]=B.x,Te[ue+9]=B.y,Te[ue+10]=B.z,Te[ue+11]=B.w,ue+=12;for(o=0,a=Be.length;o<a;o++)L=Oe[(s=ke[Be[o]]).a],P=Oe[s.b],D=Oe[s.c],F=Oe[s.d],xe[ue]=L.x,xe[ue+1]=L.y,xe[ue+2]=L.z,xe[ue+3]=L.w,xe[ue+4]=P.x,xe[ue+5]=P.y,xe[ue+6]=P.z,xe[ue+7]=P.w,xe[ue+8]=D.x,xe[ue+9]=D.y,xe[ue+10]=D.z,xe[ue+11]=D.w,xe[ue+12]=F.x,xe[ue+13]=F.y,xe[ue+14]=F.z,xe[ue+15]=F.w,N=Ie[s.a],U=Ie[s.b],B=Ie[s.c],k=Ie[s.d],Te[ue]=N.x,Te[ue+1]=N.y,Te[ue+2]=N.z,Te[ue+3]=N.w,Te[ue+4]=U.x,Te[ue+5]=U.y,Te[ue+6]=U.z,Te[ue+7]=U.w,Te[ue+8]=B.x,Te[ue+9]=B.y,Te[ue+10]=B.z,Te[ue+11]=B.w,Te[ue+12]=k.x,Te[ue+13]=k.y,Te[ue+14]=k.z,Te[ue+15]=k.w,ue+=16;0<ue&&(qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),qe.bufferData(qe.ARRAY_BUFFER,Te,i),qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),qe.bufferData(qe.ARRAY_BUFFER,xe,i))}if(De&&J){for(o=0,a=Ue.length;o<a;o++)c=(s=ke[Ue[o]]).vertexColors,u=s.color,3===c.length&&J===THREE.VertexColors?(S=c[0],M=c[1],C=c[2]):C=M=S=u,ye[ce]=S.r,ye[ce+1]=S.g,ye[ce+2]=S.b,ye[ce+3]=M.r,ye[ce+4]=M.g,ye[ce+5]=M.b,ye[ce+6]=C.r,ye[ce+7]=C.g,ye[ce+8]=C.b,ce+=9;for(o=0,a=Be.length;o<a;o++)c=(s=ke[Be[o]]).vertexColors,u=s.color,4===c.length&&J===THREE.VertexColors?(S=c[0],M=c[1],C=c[2],A=c[3]):A=C=M=S=u,ye[ce]=S.r,ye[ce+1]=S.g,ye[ce+2]=S.b,ye[ce+3]=M.r,ye[ce+4]=M.g,ye[ce+5]=M.b,ye[ce+6]=C.r,ye[ce+7]=C.g,ye[ce+8]=C.b,ye[ce+9]=A.r,ye[ce+10]=A.g,ye[ce+11]=A.b,ce+=12;0<ce&&(qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglColorBuffer),qe.bufferData(qe.ARRAY_BUFFER,ye,i))}if(Pe&&Se.hasTangents){for(o=0,a=Ue.length;o<a;o++)y=(p=(s=ke[Ue[o]]).vertexTangents)[0],T=p[1],x=p[2],ge[le]=y.x,ge[le+1]=y.y,ge[le+2]=y.z,ge[le+3]=y.w,ge[le+4]=T.x,ge[le+5]=T.y,ge[le+6]=T.z,ge[le+7]=T.w,ge[le+8]=x.x,ge[le+9]=x.y,ge[le+10]=x.z,ge[le+11]=x.w,le+=12;for(o=0,a=Be.length;o<a;o++)y=(p=(s=ke[Be[o]]).vertexTangents)[0],T=p[1],x=p[2],b=p[3],ge[le]=y.x,ge[le+1]=y.y,ge[le+2]=y.z,ge[le+3]=y.w,ge[le+4]=T.x,ge[le+5]=T.y,ge[le+6]=T.z,ge[le+7]=T.w,ge[le+8]=x.x,ge[le+9]=x.y,ge[le+10]=x.z,ge[le+11]=x.w,ge[le+12]=b.x,ge[le+13]=b.y,ge[le+14]=b.z,ge[le+15]=b.w,le+=16;qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglTangentBuffer),qe.bufferData(qe.ARRAY_BUFFER,ge,i)}if(Le&&Z){for(o=0,a=Ue.length;o<a;o++)if(l=(s=ke[Ue[o]]).vertexNormals,h=s.normal,3===l.length&&te)for(z=0;z<3;z++)I=l[z],ve[se]=I.x,ve[se+1]=I.y,ve[se+2]=I.z,se+=3;else for(z=0;z<3;z++)ve[se]=h.x,ve[se+1]=h.y,ve[se+2]=h.z,se+=3;for(o=0,a=Be.length;o<a;o++)if(l=(s=ke[Be[o]]).vertexNormals,h=s.normal,4===l.length&&te)for(z=0;z<4;z++)I=l[z],ve[se]=I.x,ve[se+1]=I.y,ve[se+2]=I.z,se+=3;else for(z=0;z<4;z++)ve[se]=h.x,ve[se+1]=h.y,ve[se+2]=h.z,se+=3;qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglNormalBuffer),qe.bufferData(qe.ARRAY_BUFFER,ve,i)}if(Ae&&ze&&ee){for(o=0,a=Ue.length;o<a;o++)if(void 0!==(d=ze[Ue[o]]))for(z=0;z<3;z++)O=d[z],me[ne]=O.x,me[ne+1]=O.y,ne+=2;for(o=0,a=Be.length;o<a;o++)if(void 0!==(d=ze[Be[o]]))for(z=0;z<4;z++)O=d[z],me[ne]=O.x,me[ne+1]=O.y,ne+=2;0<ne&&(qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglUVBuffer),qe.bufferData(qe.ARRAY_BUFFER,me,i))}if(Ae&&Ve&&ee){for(o=0,a=Ue.length;o<a;o++)if(void 0!==(f=Ve[Ue[o]]))for(z=0;z<3;z++)j=f[z],Ee[oe]=j.x,Ee[oe+1]=j.y,oe+=2;for(o=0,a=Be.length;o<a;o++)if(void 0!==(f=Ve[Be[o]]))for(z=0;z<4;z++)j=f[z],Ee[oe]=j.x,Ee[oe+1]=j.y,oe+=2;0<oe&&(qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglUV2Buffer),qe.bufferData(qe.ARRAY_BUFFER,Ee,i))}if(Ce){for(o=0,a=Ue.length;o<a;o++)He[ae]=ie,He[ae+1]=ie+1,He[ae+2]=ie+2,ae+=3,_e[he]=ie,_e[he+1]=ie+1,_e[he+2]=ie,_e[he+3]=ie+2,_e[he+4]=ie+1,_e[he+5]=ie+2,he+=6,ie+=3;for(o=0,a=Be.length;o<a;o++)He[ae]=ie,He[ae+1]=ie+1,He[ae+2]=ie+3,He[ae+3]=ie+1,He[ae+4]=ie+2,He[ae+5]=ie+3,ae+=6,_e[he]=ie,_e[he+1]=ie+1,_e[he+2]=ie,_e[he+3]=ie+3,_e[he+4]=ie+1,_e[he+5]=ie+2,_e[he+6]=ie+2,_e[he+7]=ie+3,he+=8,ie+=4;qe.bindBuffer(qe.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),qe.bufferData(qe.ELEMENT_ARRAY_BUFFER,He,i),qe.bindBuffer(qe.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),qe.bufferData(qe.ELEMENT_ARRAY_BUFFER,_e,i)}if(we)for(z=0,V=we.length;z<V;z++)if((Q=we[z]).__original.needsUpdate){if(de=0,1===Q.size){if(void 0===Q.boundTo||"vertices"===Q.boundTo){for(o=0,a=Ue.length;o<a;o++)s=ke[Ue[o]],Q.array[de]=Q.value[s.a],Q.array[de+1]=Q.value[s.b],Q.array[de+2]=Q.value[s.c],de+=3;for(o=0,a=Be.length;o<a;o++)s=ke[Be[o]],Q.array[de]=Q.value[s.a],Q.array[de+1]=Q.value[s.b],Q.array[de+2]=Q.value[s.c],Q.array[de+3]=Q.value[s.d],de+=4}else if("faces"===Q.boundTo){for(o=0,a=Ue.length;o<a;o++)$=Q.value[Ue[o]],Q.array[de]=$,Q.array[de+1]=$,Q.array[de+2]=$,de+=3;for(o=0,a=Be.length;o<a;o++)$=Q.value[Be[o]],Q.array[de]=$,Q.array[de+1]=$,Q.array[de+2]=$,Q.array[de+3]=$,de+=4}}else if(2===Q.size){if(void 0===Q.boundTo||"vertices"===Q.boundTo){for(o=0,a=Ue.length;o<a;o++)s=ke[Ue[o]],m=Q.value[s.a],E=Q.value[s.b],v=Q.value[s.c],Q.array[de]=m.x,Q.array[de+1]=m.y,Q.array[de+2]=E.x,Q.array[de+3]=E.y,Q.array[de+4]=v.x,Q.array[de+5]=v.y,de+=6;for(o=0,a=Be.length;o<a;o++)s=ke[Be[o]],m=Q.value[s.a],E=Q.value[s.b],v=Q.value[s.c],g=Q.value[s.d],Q.array[de]=m.x,Q.array[de+1]=m.y,Q.array[de+2]=E.x,Q.array[de+3]=E.y,Q.array[de+4]=v.x,Q.array[de+5]=v.y,Q.array[de+6]=g.x,Q.array[de+7]=g.y,de+=8}else if("faces"===Q.boundTo){for(o=0,a=Ue.length;o<a;o++)v=E=m=$=Q.value[Ue[o]],Q.array[de]=m.x,Q.array[de+1]=m.y,Q.array[de+2]=E.x,Q.array[de+3]=E.y,Q.array[de+4]=v.x,Q.array[de+5]=v.y,de+=6;for(o=0,a=Be.length;o<a;o++)g=v=E=m=$=Q.value[Be[o]],Q.array[de]=m.x,Q.array[de+1]=m.y,Q.array[de+2]=E.x,Q.array[de+3]=E.y,Q.array[de+4]=v.x,Q.array[de+5]=v.y,Q.array[de+6]=g.x,Q.array[de+7]=g.y,de+=8}}else if(3===Q.size){var We;if(We="c"===Q.type?["r","g","b"]:["x","y","z"],void 0===Q.boundTo||"vertices"===Q.boundTo){for(o=0,a=Ue.length;o<a;o++)s=ke[Ue[o]],m=Q.value[s.a],E=Q.value[s.b],v=Q.value[s.c],Q.array[de]=m[We[0]],Q.array[de+1]=m[We[1]],Q.array[de+2]=m[We[2]],Q.array[de+3]=E[We[0]],Q.array[de+4]=E[We[1]],Q.array[de+5]=E[We[2]],Q.array[de+6]=v[We[0]],Q.array[de+7]=v[We[1]],Q.array[de+8]=v[We[2]],de+=9;for(o=0,a=Be.length;o<a;o++)s=ke[Be[o]],m=Q.value[s.a],E=Q.value[s.b],v=Q.value[s.c],g=Q.value[s.d],Q.array[de]=m[We[0]],Q.array[de+1]=m[We[1]],Q.array[de+2]=m[We[2]],Q.array[de+3]=E[We[0]],Q.array[de+4]=E[We[1]],Q.array[de+5]=E[We[2]],Q.array[de+6]=v[We[0]],Q.array[de+7]=v[We[1]],Q.array[de+8]=v[We[2]],Q.array[de+9]=g[We[0]],Q.array[de+10]=g[We[1]],Q.array[de+11]=g[We[2]],de+=12}else if("faces"===Q.boundTo){for(o=0,a=Ue.length;o<a;o++)v=E=m=$=Q.value[Ue[o]],Q.array[de]=m[We[0]],Q.array[de+1]=m[We[1]],Q.array[de+2]=m[We[2]],Q.array[de+3]=E[We[0]],Q.array[de+4]=E[We[1]],Q.array[de+5]=E[We[2]],Q.array[de+6]=v[We[0]],Q.array[de+7]=v[We[1]],Q.array[de+8]=v[We[2]],de+=9;for(o=0,a=Be.length;o<a;o++)g=v=E=m=$=Q.value[Be[o]],Q.array[de]=m[We[0]],Q.array[de+1]=m[We[1]],Q.array[de+2]=m[We[2]],Q.array[de+3]=E[We[0]],Q.array[de+4]=E[We[1]],Q.array[de+5]=E[We[2]],Q.array[de+6]=v[We[0]],Q.array[de+7]=v[We[1]],Q.array[de+8]=v[We[2]],Q.array[de+9]=g[We[0]],Q.array[de+10]=g[We[1]],Q.array[de+11]=g[We[2]],de+=12}else if("faceVertices"===Q.boundTo){for(o=0,a=Ue.length;o<a;o++)m=($=Q.value[Ue[o]])[0],E=$[1],v=$[2],Q.array[de]=m[We[0]],Q.array[de+1]=m[We[1]],Q.array[de+2]=m[We[2]],Q.array[de+3]=E[We[0]],Q.array[de+4]=E[We[1]],Q.array[de+5]=E[We[2]],Q.array[de+6]=v[We[0]],Q.array[de+7]=v[We[1]],Q.array[de+8]=v[We[2]],de+=9;for(o=0,a=Be.length;o<a;o++)m=($=Q.value[Be[o]])[0],E=$[1],v=$[2],g=$[3],Q.array[de]=m[We[0]],Q.array[de+1]=m[We[1]],Q.array[de+2]=m[We[2]],Q.array[de+3]=E[We[0]],Q.array[de+4]=E[We[1]],Q.array[de+5]=E[We[2]],Q.array[de+6]=v[We[0]],Q.array[de+7]=v[We[1]],Q.array[de+8]=v[We[2]],Q.array[de+9]=g[We[0]],Q.array[de+10]=g[We[1]],Q.array[de+11]=g[We[2]],de+=12}}else if(4===Q.size)if(void 0===Q.boundTo||"vertices"===Q.boundTo){for(o=0,a=Ue.length;o<a;o++)s=ke[Ue[o]],m=Q.value[s.a],E=Q.value[s.b],v=Q.value[s.c],Q.array[de]=m.x,Q.array[de+1]=m.y,Q.array[de+2]=m.z,Q.array[de+3]=m.w,Q.array[de+4]=E.x,Q.array[de+5]=E.y,Q.array[de+6]=E.z,Q.array[de+7]=E.w,Q.array[de+8]=v.x,Q.array[de+9]=v.y,Q.array[de+10]=v.z,Q.array[de+11]=v.w,de+=12;for(o=0,a=Be.length;o<a;o++)s=ke[Be[o]],m=Q.value[s.a],E=Q.value[s.b],v=Q.value[s.c],g=Q.value[s.d],Q.array[de]=m.x,Q.array[de+1]=m.y,Q.array[de+2]=m.z,Q.array[de+3]=m.w,Q.array[de+4]=E.x,Q.array[de+5]=E.y,Q.array[de+6]=E.z,Q.array[de+7]=E.w,Q.array[de+8]=v.x,Q.array[de+9]=v.y,Q.array[de+10]=v.z,Q.array[de+11]=v.w,Q.array[de+12]=g.x,Q.array[de+13]=g.y,Q.array[de+14]=g.z,Q.array[de+15]=g.w,de+=16}else if("faces"===Q.boundTo){for(o=0,a=Ue.length;o<a;o++)v=E=m=$=Q.value[Ue[o]],Q.array[de]=m.x,Q.array[de+1]=m.y,Q.array[de+2]=m.z,Q.array[de+3]=m.w,Q.array[de+4]=E.x,Q.array[de+5]=E.y,Q.array[de+6]=E.z,Q.array[de+7]=E.w,Q.array[de+8]=v.x,Q.array[de+9]=v.y,Q.array[de+10]=v.z,Q.array[de+11]=v.w,de+=12;for(o=0,a=Be.length;o<a;o++)g=v=E=m=$=Q.value[Be[o]],Q.array[de]=m.x,Q.array[de+1]=m.y,Q.array[de+2]=m.z,Q.array[de+3]=m.w,Q.array[de+4]=E.x,Q.array[de+5]=E.y,Q.array[de+6]=E.z,Q.array[de+7]=E.w,Q.array[de+8]=v.x,Q.array[de+9]=v.y,Q.array[de+10]=v.z,Q.array[de+11]=v.w,Q.array[de+12]=g.x,Q.array[de+13]=g.y,Q.array[de+14]=g.z,Q.array[de+15]=g.w,de+=16}else if("faceVertices"===Q.boundTo){for(o=0,a=Ue.length;o<a;o++)m=($=Q.value[Ue[o]])[0],E=$[1],v=$[2],Q.array[de]=m.x,Q.array[de+1]=m.y,Q.array[de+2]=m.z,Q.array[de+3]=m.w,Q.array[de+4]=E.x,Q.array[de+5]=E.y,Q.array[de+6]=E.z,Q.array[de+7]=E.w,Q.array[de+8]=v.x,Q.array[de+9]=v.y,Q.array[de+10]=v.z,Q.array[de+11]=v.w,de+=12;for(o=0,a=Be.length;o<a;o++)m=($=Q.value[Be[o]])[0],E=$[1],v=$[2],g=$[3],Q.array[de]=m.x,Q.array[de+1]=m.y,Q.array[de+2]=m.z,Q.array[de+3]=m.w,Q.array[de+4]=E.x,Q.array[de+5]=E.y,Q.array[de+6]=E.z,Q.array[de+7]=E.w,Q.array[de+8]=v.x,Q.array[de+9]=v.y,Q.array[de+10]=v.z,Q.array[de+11]=v.w,Q.array[de+12]=g.x,Q.array[de+13]=g.y,Q.array[de+14]=g.z,Q.array[de+15]=g.w,de+=16}qe.bindBuffer(qe.ARRAY_BUFFER,Q.buffer),qe.bufferData(qe.ARRAY_BUFFER,Q.array,i)}r&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function be(e){O[e]||(qe.enableVertexAttribArray(e),O[e]=!0)}function Re(){for(var e in O)O[e]&&(qe.disableVertexAttribArray(e),O[e]=!1)}function we(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function He(e,t){return t[0]-e[0]}function _e(e,t,i){if(e.length)for(var r=0,n=e.length;r<n;r++)b=R=f=d=A=y=m=-1,Y=!(S=x=null),e[r].render(t,i,z,V),b=R=f=d=A=y=m=-1,Y=!(S=x=null)}function Se(e,t,i,r,n,o,a,s){var l,h,c,u,p,d,f;t?(p=e.length-1,f=d=-1):(p=0,d=e.length,f=1);for(var m=p;m!==d;m+=f)if((l=e[m]).render){if(h=l.object,c=l.buffer,s)u=s;else{if(!(u=l[i]))continue;a&&I.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),I.setDepthTest(u.depthTest),I.setDepthWrite(u.depthWrite),$e(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}I.setMaterialFaces(u),c instanceof THREE.BufferGeometry?I.renderBufferDirect(r,n,o,u,c,h):I.renderBuffer(r,n,o,u,c,h)}}function Me(e,t,i,r,n,o,a){for(var s,l,h,c=0,u=e.length;c<u;c++)if((l=(s=e[c]).object).visible){if(a)h=a;else{if(!(h=s[t]))continue;o&&I.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),I.setDepthTest(h.depthTest),I.setDepthWrite(h.depthWrite),$e(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}I.renderImmediateObject(i,r,n,h,l)}}function Ce(e){var t=e.object.material;t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)}function Ae(e){var t,i,r,n=e.object,o=e.buffer;(r=n.material)instanceof THREE.MeshFaceMaterial?(i=o.materialIndex,(t=r.materials[i]).transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)):(t=r)&&(t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null))}function Le(e,t){var i,r,n,o,a,s,l,h,c,u,p,d,f,m,E,v,g,y;if(void 0===e.__webglInit)if(e.__webglInit=!0,e._modelViewMatrix=new THREE.Matrix4,e._normalMatrix=new THREE.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",he)),void 0===(r=e.geometry));else if(r instanceof THREE.BufferGeometry)!function(e){var t,i,r;for(t in e.attributes)r="index"===t?qe.ELEMENT_ARRAY_BUFFER:qe.ARRAY_BUFFER,(i=e.attributes[t]).buffer=qe.createBuffer(),qe.bindBuffer(r,i.buffer),qe.bufferData(r,i.array,qe.STATIC_DRAW)}(r);else if(e instanceof THREE.Mesh)for(i in n=e.material,void 0===r.geometryGroups&&function(e,t){var i,r,n,o,a,s,l={},h=e.morphTargets.length,c=e.morphNormals.length,u=t instanceof THREE.MeshFaceMaterial;for(e.geometryGroups={},i=0,r=e.faces.length;i<r;i++)n=e.faces[i],void 0===l[o=u?n.materialIndex:0]&&(l[o]={hash:o,counter:0}),s=l[o].hash+"_"+l[o].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:o,vertices:0,numMorphTargets:h,numMorphNormals:c}),a=n instanceof THREE.Face3?3:4,65535<e.geometryGroups[s].vertices+a&&(l[o].counter+=1,s=l[o].hash+"_"+l[o].counter,void 0===e.geometryGroups[s]&&(e.geometryGroups[s]={faces3:[],faces4:[],materialIndex:o,vertices:0,numMorphTargets:h,numMorphNormals:c})),n instanceof THREE.Face3?e.geometryGroups[s].faces3.push(i):e.geometryGroups[s].faces4.push(i),e.geometryGroups[s].vertices+=a;for(var p in e.geometryGroupsList=[],e.geometryGroups)e.geometryGroups[p].id=M++,e.geometryGroupsList.push(e.geometryGroups[p])}(r,n),r.geometryGroups)(o=r.geometryGroups[i]).__webglVertexBuffer||(le(o),ye(o,e),r.verticesNeedUpdate=!0,r.morphTargetsNeedUpdate=!0,r.elementsNeedUpdate=!0,r.uvsNeedUpdate=!0,r.normalsNeedUpdate=!0,r.tangentsNeedUpdate=!0,r.colorsNeedUpdate=!0);else e instanceof THREE.Ribbon?r.__webglVertexBuffer||((v=r).__webglVertexBuffer=qe.createBuffer(),v.__webglColorBuffer=qe.createBuffer(),v.__webglNormalBuffer=qe.createBuffer(),I.info.memory.geometries++,m=e,E=(f=r).vertices.length,f.__vertexArray=new Float32Array(3*E),f.__colorArray=new Float32Array(3*E),f.__normalArray=new Float32Array(3*E),f.__webglVertexCount=E,ge(f,m),r.verticesNeedUpdate=!0,r.colorsNeedUpdate=!0,r.normalsNeedUpdate=!0):e instanceof THREE.Line?r.__webglVertexBuffer||((d=r).__webglVertexBuffer=qe.createBuffer(),d.__webglColorBuffer=qe.createBuffer(),d.__webglLineDistanceBuffer=qe.createBuffer(),I.info.memory.geometries++,u=e,p=(c=r).vertices.length,c.__vertexArray=new Float32Array(3*p),c.__colorArray=new Float32Array(3*p),c.__lineDistanceArray=new Float32Array(1*p),c.__webglLineCount=p,ge(c,u),r.verticesNeedUpdate=!0,r.colorsNeedUpdate=!0,r.lineDistancesNeedUpdate=!0):e instanceof THREE.ParticleSystem&&(r.__webglVertexBuffer||((h=r).__webglVertexBuffer=qe.createBuffer(),h.__webglColorBuffer=qe.createBuffer(),I.info.memory.geometries++,s=e,l=(a=r).vertices.length,a.__vertexArray=new Float32Array(3*l),a.__colorArray=new Float32Array(3*l),a.__sortArray=[],a.__webglParticleCount=l,ge(a,s),r.verticesNeedUpdate=!0,r.colorsNeedUpdate=!0));if(void 0===e.__webglActive){if(e instanceof THREE.Mesh){if((r=e.geometry)instanceof THREE.BufferGeometry)Pe(t.__webglObjects,r,e);else if(r instanceof THREE.Geometry)for(i in r.geometryGroups)o=r.geometryGroups[i],Pe(t.__webglObjects,o,e)}else e instanceof THREE.Ribbon||e instanceof THREE.Line||e instanceof THREE.ParticleSystem?(r=e.geometry,Pe(t.__webglObjects,r,e)):e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback?(g=t.__webglObjectsImmediate,y=e,g.push({object:y,opaque:null,transparent:null})):e instanceof THREE.Sprite?t.__webglSprites.push(e):e instanceof THREE.LensFlare&&t.__webglFlares.push(e);e.__webglActive=!0}}function Pe(e,t,i){e.push({buffer:t,object:i,opaque:null,transparent:null})}function De(e){var t,i,r,n=e.geometry;if(n instanceof THREE.BufferGeometry)!function(e,t,i){var r,n,o=e.attributes;for(r in o)(n=o[r]).needsUpdate&&("index"===r?(qe.bindBuffer(qe.ELEMENT_ARRAY_BUFFER,n.buffer),qe.bufferData(qe.ELEMENT_ARRAY_BUFFER,n.array,t)):(qe.bindBuffer(qe.ARRAY_BUFFER,n.buffer),qe.bufferData(qe.ARRAY_BUFFER,n.array,t)),n.needsUpdate=!1),i&&!n.dynamic&&delete n.array}(n,qe.DYNAMIC_DRAW,!n.dynamic);else if(e instanceof THREE.Mesh){for(var o=0,a=n.geometryGroupsList.length;o<a;o++)r=Te(e,t=n.geometryGroupsList[o]),n.buffersNeedUpdate&&ye(t,e),i=r.attributes&&Fe(r),(n.verticesNeedUpdate||n.morphTargetsNeedUpdate||n.elementsNeedUpdate||n.uvsNeedUpdate||n.normalsNeedUpdate||n.colorsNeedUpdate||n.tangentsNeedUpdate||i)&&xe(t,e,qe.DYNAMIC_DRAW,!n.dynamic,r);n.verticesNeedUpdate=!1,n.morphTargetsNeedUpdate=!1,n.elementsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.tangentsNeedUpdate=!1,n.buffersNeedUpdate=!1,r.attributes&&Ne(r)}else e instanceof THREE.Ribbon?(i=(r=Te(e,n)).attributes&&Fe(r),(n.verticesNeedUpdate||n.colorsNeedUpdate||n.normalsNeedUpdate||i)&&function(e,t){var i,r,n,o,a,s,l,h,c,u,p,d,f,m=e.vertices,E=e.colors,v=e.normals,g=m.length,y=E.length,T=v.length,x=e.__vertexArray,b=e.__colorArray,R=e.__normalArray,w=e.verticesNeedUpdate,H=e.colorsNeedUpdate,_=e.normalsNeedUpdate,S=e.__webglCustomAttributesList;if(w){for(i=0;i<g;i++)o=m[i],x[a=3*i]=o.x,x[a+1]=o.y,x[a+2]=o.z;qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglVertexBuffer),qe.bufferData(qe.ARRAY_BUFFER,x,t)}if(H){for(r=0;r<y;r++)s=E[r],b[a=3*r]=s.r,b[a+1]=s.g,b[a+2]=s.b;qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglColorBuffer),qe.bufferData(qe.ARRAY_BUFFER,b,t)}if(_){for(n=0;n<T;n++)l=v[n],R[a=3*n]=l.x,R[a+1]=l.y,R[a+2]=l.z;qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglNormalBuffer),qe.bufferData(qe.ARRAY_BUFFER,R,t)}if(S)for(h=0,c=S.length;h<c;h++)if((d=S[h]).needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo)){if(a=0,p=d.value.length,1===d.size)for(u=0;u<p;u++)d.array[u]=d.value[u];else if(2===d.size)for(u=0;u<p;u++)f=d.value[u],d.array[a]=f.x,d.array[a+1]=f.y,a+=2;else if(3===d.size)if("c"===d.type)for(u=0;u<p;u++)f=d.value[u],d.array[a]=f.r,d.array[a+1]=f.g,d.array[a+2]=f.b,a+=3;else for(u=0;u<p;u++)f=d.value[u],d.array[a]=f.x,d.array[a+1]=f.y,d.array[a+2]=f.z,a+=3;else if(4===d.size)for(u=0;u<p;u++)f=d.value[u],d.array[a]=f.x,d.array[a+1]=f.y,d.array[a+2]=f.z,d.array[a+3]=f.w,a+=4;qe.bindBuffer(qe.ARRAY_BUFFER,d.buffer),qe.bufferData(qe.ARRAY_BUFFER,d.array,t)}}(n,qe.DYNAMIC_DRAW),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,n.normalsNeedUpdate=!1,r.attributes&&Ne(r)):e instanceof THREE.Line?(i=(r=Te(e,n)).attributes&&Fe(r),(n.verticesNeedUpdate||n.colorsNeedUpdate||n.lineDistancesNeedUpdate||i)&&function(e,t){var i,r,n,o,a,s,l,h,c,u,p,d,f=e.vertices,m=e.colors,E=e.lineDistances,v=f.length,g=m.length,y=E.length,T=e.__vertexArray,x=e.__colorArray,b=e.__lineDistanceArray,R=e.verticesNeedUpdate,w=e.colorsNeedUpdate,H=e.lineDistancesNeedUpdate,_=e.__webglCustomAttributesList;if(R){for(i=0;i<v;i++)o=f[i],T[a=3*i]=o.x,T[a+1]=o.y,T[a+2]=o.z;qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglVertexBuffer),qe.bufferData(qe.ARRAY_BUFFER,T,t)}if(w){for(r=0;r<g;r++)s=m[r],x[a=3*r]=s.r,x[a+1]=s.g,x[a+2]=s.b;qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglColorBuffer),qe.bufferData(qe.ARRAY_BUFFER,x,t)}if(H){for(n=0;n<y;n++)b[n]=E[n];qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglLineDistanceBuffer),qe.bufferData(qe.ARRAY_BUFFER,b,t)}if(_)for(l=0,h=_.length;l<h;l++)if((d=_[l]).needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo)){if(a=0,u=d.value.length,1===d.size)for(c=0;c<u;c++)d.array[c]=d.value[c];else if(2===d.size)for(c=0;c<u;c++)p=d.value[c],d.array[a]=p.x,d.array[a+1]=p.y,a+=2;else if(3===d.size)if("c"===d.type)for(c=0;c<u;c++)p=d.value[c],d.array[a]=p.r,d.array[a+1]=p.g,d.array[a+2]=p.b,a+=3;else for(c=0;c<u;c++)p=d.value[c],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,a+=3;else if(4===d.size)for(c=0;c<u;c++)p=d.value[c],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,d.array[a+3]=p.w,a+=4;qe.bindBuffer(qe.ARRAY_BUFFER,d.buffer),qe.bufferData(qe.ARRAY_BUFFER,d.array,t)}}(n,qe.DYNAMIC_DRAW),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,n.lineDistancesNeedUpdate=!1,r.attributes&&Ne(r)):e instanceof THREE.ParticleSystem&&(i=(r=Te(e,n)).attributes&&Fe(r),(n.verticesNeedUpdate||n.colorsNeedUpdate||e.sortParticles||i)&&function(e,t,i){var r,n,o,a,s,l,h,c,u,p,d,f,m=e.vertices,E=m.length,v=e.colors,g=v.length,y=e.__vertexArray,T=e.__colorArray,x=e.__sortArray,b=e.verticesNeedUpdate,R=(e.elementsNeedUpdate,e.colorsNeedUpdate),w=e.__webglCustomAttributesList;if(i.sortParticles){for(W.copy(G),W.multiply(i.matrixWorld),r=0;r<E;r++)o=m[r],q.copy(o),q.applyProjection(W),x[r]=[q.z,r];for(x.sort(He),r=0;r<E;r++)o=m[x[r][1]],y[a=3*r]=o.x,y[a+1]=o.y,y[a+2]=o.z;for(n=0;n<g;n++)a=3*n,l=v[x[n][1]],T[a]=l.r,T[a+1]=l.g,T[a+2]=l.b;if(w)for(h=0,c=w.length;h<c;h++)if(void 0===(f=w[h]).boundTo||"vertices"===f.boundTo)if(a=0,p=f.value.length,1===f.size)for(u=0;u<p;u++)s=x[u][1],f.array[u]=f.value[s];else if(2===f.size)for(u=0;u<p;u++)s=x[u][1],d=f.value[s],f.array[a]=d.x,f.array[a+1]=d.y,a+=2;else if(3===f.size)if("c"===f.type)for(u=0;u<p;u++)s=x[u][1],d=f.value[s],f.array[a]=d.r,f.array[a+1]=d.g,f.array[a+2]=d.b,a+=3;else for(u=0;u<p;u++)s=x[u][1],d=f.value[s],f.array[a]=d.x,f.array[a+1]=d.y,f.array[a+2]=d.z,a+=3;else if(4===f.size)for(u=0;u<p;u++)s=x[u][1],d=f.value[s],f.array[a]=d.x,f.array[a+1]=d.y,f.array[a+2]=d.z,f.array[a+3]=d.w,a+=4}else{if(b)for(r=0;r<E;r++)o=m[r],y[a=3*r]=o.x,y[a+1]=o.y,y[a+2]=o.z;if(R)for(n=0;n<g;n++)l=v[n],T[a=3*n]=l.r,T[a+1]=l.g,T[a+2]=l.b;if(w)for(h=0,c=w.length;h<c;h++)if((f=w[h]).needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo))if(p=f.value.length,a=0,1===f.size)for(u=0;u<p;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;u<p;u++)d=f.value[u],f.array[a]=d.x,f.array[a+1]=d.y,a+=2;else if(3===f.size)if("c"===f.type)for(u=0;u<p;u++)d=f.value[u],f.array[a]=d.r,f.array[a+1]=d.g,f.array[a+2]=d.b,a+=3;else for(u=0;u<p;u++)d=f.value[u],f.array[a]=d.x,f.array[a+1]=d.y,f.array[a+2]=d.z,a+=3;else if(4===f.size)for(u=0;u<p;u++)d=f.value[u],f.array[a]=d.x,f.array[a+1]=d.y,f.array[a+2]=d.z,f.array[a+3]=d.w,a+=4}if((b||i.sortParticles)&&(qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglVertexBuffer),qe.bufferData(qe.ARRAY_BUFFER,y,t)),(R||i.sortParticles)&&(qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglColorBuffer),qe.bufferData(qe.ARRAY_BUFFER,T,t)),w)for(h=0,c=w.length;h<c;h++)((f=w[h]).needsUpdate||i.sortParticles)&&(qe.bindBuffer(qe.ARRAY_BUFFER,f.buffer),qe.bufferData(qe.ARRAY_BUFFER,f.array,t))}(n,qe.DYNAMIC_DRAW,e),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,r.attributes&&Ne(r))}function Fe(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function Ne(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function Ue(e,t){e instanceof THREE.Mesh||e instanceof THREE.ParticleSystem||e instanceof THREE.Ribbon||e instanceof THREE.Line?Be(t.__webglObjects,e):e instanceof THREE.Sprite?ke(t.__webglSprites,e):e instanceof THREE.LensFlare?ke(t.__webglFlares,e):(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&Be(t.__webglObjectsImmediate,e),delete e.__webglActive}function Be(e,t){for(var i=e.length-1;0<=i;i--)e[i].object===t&&e.splice(i,1)}function ke(e,t){for(var i=e.length-1;0<=i;i--)e[i]===t&&e.splice(i,1)}function ze(e,t,i,r,n){C=0,r.needsUpdate&&(r.program&&Ee(r),I.initMaterial(r,t,i,n),r.needsUpdate=!1),r.morphTargets&&(n.__webglMorphTargetInfluences||(n.__webglMorphTargetInfluences=new Float32Array(I.maxMorphTargets)));var o,a,s,l,h,c,u,p,d,f,m=!1,E=r.program,v=E.uniforms,g=r.uniforms;if(E!==x&&(qe.useProgram(E),x=E,m=!0),r.id!==b&&(b=r.id,m=!0),(m||e!==S)&&(qe.uniformMatrix4fv(v.projectionMatrix,!1,e.projectionMatrix.elements),e!==S&&(S=e)),r.skinning)if(te&&n.useVertexTexture){if(null!==v.boneTexture){var y=Ie();qe.uniform1i(v.boneTexture,y),I.setTexture(n.boneTexture,y)}}else null!==v.boneGlobalMatrices&&qe.uniformMatrix4fv(v.boneGlobalMatrices,!1,n.boneMatrices);return m&&(i&&r.fog&&(p=i,(u=g).fogColor.value=p.color,p instanceof THREE.Fog?(u.fogNear.value=p.near,u.fogFar.value=p.far):p instanceof THREE.FogExp2&&(u.fogDensity.value=p.density)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights)&&(Y&&(!function(e,t){var i,r,n,o,a,s,l,h,c,u=0,p=0,d=0,f=K,m=f.directional.colors,E=f.directional.positions,v=f.point.colors,g=f.point.positions,y=f.point.distances,T=f.spot.colors,x=f.spot.positions,b=f.spot.distances,R=f.spot.directions,w=f.spot.anglesCos,H=f.spot.exponents,_=f.hemi.skyColors,S=f.hemi.groundColors,M=f.hemi.positions,C=0,A=0,L=0,P=0,D=0,F=0,N=0,U=0,B=0,k=0,z=0,V=0;for(i=0,r=t.length;i<r;i++)if(!(n=t[i]).onlyShadow)if(o=n.color,l=n.intensity,c=n.distance,n instanceof THREE.AmbientLight){if(!n.visible)continue;I.gammaInput?(u+=o.r*o.r,p+=o.g*o.g,d+=o.b*o.b):(u+=o.r,p+=o.g,d+=o.b)}else if(n instanceof THREE.DirectionalLight){if(D+=1,!n.visible)continue;if(X.getPositionFromMatrix(n.matrixWorld),q.getPositionFromMatrix(n.target.matrixWorld),X.sub(q),X.normalize(),0===X.x&&0===X.y&&0===X.z)continue;E[B=3*C]=X.x,E[B+1]=X.y,E[B+2]=X.z,I.gammaInput?je(m,B,o,l*l):Ge(m,B,o,l),C+=1}else if(n instanceof THREE.PointLight){if(F+=1,!n.visible)continue;k=3*A,I.gammaInput?je(v,k,o,l*l):Ge(v,k,o,l),q.getPositionFromMatrix(n.matrixWorld),g[k]=q.x,g[k+1]=q.y,g[k+2]=q.z,y[A]=c,A+=1}else if(n instanceof THREE.SpotLight){if(N+=1,!n.visible)continue;z=3*L,I.gammaInput?je(T,z,o,l*l):Ge(T,z,o,l),q.getPositionFromMatrix(n.matrixWorld),x[z]=q.x,x[z+1]=q.y,x[z+2]=q.z,b[L]=c,X.copy(q),q.getPositionFromMatrix(n.target.matrixWorld),X.sub(q),X.normalize(),R[z]=X.x,R[z+1]=X.y,R[z+2]=X.z,w[L]=Math.cos(n.angle),H[L]=n.exponent,L+=1}else if(n instanceof THREE.HemisphereLight){if(U+=1,!n.visible)continue;if(X.getPositionFromMatrix(n.matrixWorld),X.normalize(),0===X.x&&0===X.y&&0===X.z)continue;M[V=3*P]=X.x,M[V+1]=X.y,M[V+2]=X.z,a=n.color,s=n.groundColor,I.gammaInput?(je(_,V,a,h=l*l),je(S,V,s,h)):(Ge(_,V,a,l),Ge(S,V,s,l)),P+=1}for(i=3*C,r=Math.max(m.length,3*D);i<r;i++)m[i]=0;for(i=3*A,r=Math.max(v.length,3*F);i<r;i++)v[i]=0;for(i=3*L,r=Math.max(T.length,3*N);i<r;i++)T[i]=0;for(i=3*P,r=Math.max(_.length,3*U);i<r;i++)_[i]=0;for(i=3*P,r=Math.max(S.length,3*U);i<r;i++)S[i]=0;f.directional.length=C,f.point.length=A,f.spot.length=L,f.hemi.length=P,f.ambient[0]=u,f.ambient[1]=p,f.ambient[2]=d}(0,t),Y=!1),c=K,(h=g).ambientLightColor.value=c.ambient,h.directionalLightColor.value=c.directional.colors,h.directionalLightDirection.value=c.directional.positions,h.pointLightColor.value=c.point.colors,h.pointLightPosition.value=c.point.positions,h.pointLightDistance.value=c.point.distances,h.spotLightColor.value=c.spot.colors,h.spotLightPosition.value=c.spot.positions,h.spotLightDistance.value=c.spot.distances,h.spotLightDirection.value=c.spot.directions,h.spotLightAngleCos.value=c.spot.anglesCos,h.spotLightExponent.value=c.spot.exponents,h.hemisphereLightSkyColor.value=c.hemi.skyColors,h.hemisphereLightGroundColor.value=c.hemi.groundColors,h.hemisphereLightDirection.value=c.hemi.positions),(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)&&function(e,t){e.opacity.value=t.opacity,I.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color;e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var i;t.map?i=t.map:t.specularMap?i=t.specularMap:t.normalMap?i=t.normalMap:t.bumpMap&&(i=t.bumpMap);if(void 0!==i){var r=i.offset,n=i.repeat;e.offsetRepeat.value.set(r.x,r.y,n.x,n.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,I.gammaInput,e.reflectivity.value=t.reflectivity;e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof THREE.CubeRefractionMapping}(g,r),r instanceof THREE.LineBasicMaterial?Ve(g,r):r instanceof THREE.LineDashedMaterial?(Ve(g,r),l=r,(s=g).dashSize.value=l.dashSize,s.totalSize.value=l.dashSize+l.gapSize,s.scale.value=l.scale):r instanceof THREE.ParticleBasicMaterial?(a=r,(o=g).psColor.value=a.color,o.opacity.value=a.opacity,o.size.value=a.size,o.scale.value=T.height/2,o.map.value=a.map):r instanceof THREE.MeshPhongMaterial?function(e,t){e.shininess.value=t.shininess,I.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular);t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(g,r):r instanceof THREE.MeshLambertMaterial?function(e,t){I.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive);t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(g,r):r instanceof THREE.MeshDepthMaterial?(g.mNear.value=e.near,g.mFar.value=e.far,g.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(g.opacity.value=r.opacity),n.receiveShadow&&!r._shadowPass&&function(e,t){if(e.shadowMatrix)for(var i=0,r=0,n=t.length;r<n;r++){var o=t[r];o.castShadow&&((o instanceof THREE.SpotLight||o instanceof THREE.DirectionalLight&&!o.shadowCascade)&&(e.shadowMap.value[i]=o.shadowMap,e.shadowMapSize.value[i]=o.shadowMapSize,e.shadowMatrix.value[i]=o.shadowMatrix,e.shadowDarkness.value[i]=o.shadowDarkness,e.shadowBias.value[i]=o.shadowBias,i++))}}(g,t),function(e,t){var i,r,n,o,a,s,l,h,c,u,p;for(c=0,u=t.length;c<u;c++)if(o=e.uniforms[t[c][1]])if(i=t[c][0],n=i.type,r=i.value,"i"===n)qe.uniform1i(o,r);else if("f"===n)qe.uniform1f(o,r);else if("v2"===n)qe.uniform2f(o,r.x,r.y);else if("v3"===n)qe.uniform3f(o,r.x,r.y,r.z);else if("v4"===n)qe.uniform4f(o,r.x,r.y,r.z,r.w);else if("c"===n)qe.uniform3f(o,r.r,r.g,r.b);else if("iv1"===n)qe.uniform1iv(o,r);else if("iv"===n)qe.uniform3iv(o,r);else if("fv1"===n)qe.uniform1fv(o,r);else if("fv"===n)qe.uniform3fv(o,r);else if("v2v"===n){for(void 0===i._array&&(i._array=new Float32Array(2*r.length)),l=0,h=r.length;l<h;l++)p=2*l,i._array[p]=r[l].x,i._array[p+1]=r[l].y;qe.uniform2fv(o,i._array)}else if("v3v"===n){for(void 0===i._array&&(i._array=new Float32Array(3*r.length)),l=0,h=r.length;l<h;l++)p=3*l,i._array[p]=r[l].x,i._array[p+1]=r[l].y,i._array[p+2]=r[l].z;qe.uniform3fv(o,i._array)}else if("v4v"===n){for(void 0===i._array&&(i._array=new Float32Array(4*r.length)),l=0,h=r.length;l<h;l++)p=4*l,i._array[p]=r[l].x,i._array[p+1]=r[l].y,i._array[p+2]=r[l].z,i._array[p+3]=r[l].w;qe.uniform4fv(o,i._array)}else if("m4"===n)void 0===i._array&&(i._array=new Float32Array(16)),r.flattenToArray(i._array),qe.uniformMatrix4fv(o,!1,i._array);else if("m4v"===n){for(void 0===i._array&&(i._array=new Float32Array(16*r.length)),l=0,h=r.length;l<h;l++)r[l].flattenToArrayOffset(i._array,16*l);qe.uniformMatrix4fv(o,!1,i._array)}else if("t"===n){if(a=r,s=Ie(),qe.uniform1i(o,s),!a)continue;a.image instanceof Array&&6===a.image.length?tt(a,s):a instanceof THREE.WebGLRenderTargetCube?it(a,s):I.setTexture(a,s)}else if("tv"===n){for(void 0===i._array&&(i._array=[]),l=0,h=i.value.length;l<h;l++)i._array[l]=Ie();for(qe.uniform1iv(o,i._array),l=0,h=i.value.length;l<h;l++)a=i.value[l],s=i._array[l],a&&I.setTexture(a,s)}}(E,r.uniformsList),(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&null!==v.cameraPosition&&(q.getPositionFromMatrix(e.matrixWorld),qe.uniform3f(v.cameraPosition,q.x,q.y,q.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&null!==v.viewMatrix&&qe.uniformMatrix4fv(v.viewMatrix,!1,e.matrixWorldInverse.elements)),d=v,f=n,qe.uniformMatrix4fv(d.modelViewMatrix,!1,f._modelViewMatrix.elements),d.normalMatrix&&qe.uniformMatrix3fv(d.normalMatrix,!1,f._normalMatrix.elements),null!==v.modelMatrix&&qe.uniformMatrix4fv(v.modelMatrix,!1,n.matrixWorld.elements),E}function Ve(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function Ie(){var e=C;return $<=e&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+$),C+=1,e}function Oe(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function je(e,t,i,r){e[t]=i.r*i.r*r,e[t+1]=i.g*i.g*r,e[t+2]=i.b*i.b*r}function Ge(e,t,i,r){e[t]=i.r*r,e[t+1]=i.g*r,e[t+2]=i.b*r}function We(e){e!==F&&(qe.lineWidth(e),F=e)}function $e(e,t,i){L!==e&&(e?qe.enable(qe.POLYGON_OFFSET_FILL):qe.disable(qe.POLYGON_OFFSET_FILL),L=e),!e||P===t&&D===i||(qe.polygonOffset(t,i),P=t,D=i)}function Qe(e,t){var i;return"fragment"===e?i=qe.createShader(qe.FRAGMENT_SHADER):"vertex"===e&&(i=qe.createShader(qe.VERTEX_SHADER)),qe.shaderSource(i,t),qe.compileShader(i),qe.getShaderParameter(i,qe.COMPILE_STATUS)?i:(console.error(qe.getShaderInfoLog(i)),console.error(function(e){for(var t=e.split("\n"),i=0,r=t.length;i<r;i++)t[i]=i+1+": "+t[i];return t.join("\n")}(t)),null)}function Ze(e){return 0==(e&e-1)}function Je(e,t,i){i?(qe.texParameteri(e,qe.TEXTURE_WRAP_S,at(t.wrapS)),qe.texParameteri(e,qe.TEXTURE_WRAP_T,at(t.wrapT)),qe.texParameteri(e,qe.TEXTURE_MAG_FILTER,at(t.magFilter)),qe.texParameteri(e,qe.TEXTURE_MIN_FILTER,at(t.minFilter))):(qe.texParameteri(e,qe.TEXTURE_WRAP_S,qe.CLAMP_TO_EDGE),qe.texParameteri(e,qe.TEXTURE_WRAP_T,qe.CLAMP_TO_EDGE),qe.texParameteri(e,qe.TEXTURE_MAG_FILTER,ot(t.magFilter)),qe.texParameteri(e,qe.TEXTURE_MIN_FILTER,ot(t.minFilter))),c&&t.type!==THREE.FloatType&&(1<t.anisotropy||t.__oldAnisotropy)&&(qe.texParameterf(e,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,J)),t.__oldAnisotropy=t.anisotropy)}function et(e,t){if(e.width<=t&&e.height<=t)return e;var i=Math.max(e.width,e.height),r=Math.floor(e.width*t/i),n=Math.floor(e.height*t/i),o=document.createElement("canvas");return o.width=r,o.height=n,o.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r,n),o}function tt(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.image.__webglTextureCube=qe.createTexture(),I.info.memory.textures++),qe.activeTexture(qe.TEXTURE0+t),qe.bindTexture(qe.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),qe.pixelStorei(qe.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var i=e instanceof THREE.CompressedTexture,r=[],n=0;n<6;n++)I.autoScaleCubemaps&&!i?r[n]=et(e.image[n],Z):r[n]=e.image[n];var o=r[0],a=Ze(o.width)&&Ze(o.height),s=at(e.format),l=at(e.type);Je(qe.TEXTURE_CUBE_MAP,e,a);for(n=0;n<6;n++)if(i)for(var h,c=r[n].mipmaps,u=0,p=c.length;u<p;u++)h=c[u],qe.compressedTexImage2D(qe.TEXTURE_CUBE_MAP_POSITIVE_X+n,u,s,h.width,h.height,0,h.data);else qe.texImage2D(qe.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,s,s,l,r[n]);e.generateMipmaps&&a&&qe.generateMipmap(qe.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else qe.activeTexture(qe.TEXTURE0+t),qe.bindTexture(qe.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function it(e,t){qe.activeTexture(qe.TEXTURE0+t),qe.bindTexture(qe.TEXTURE_CUBE_MAP,e.__webglTexture)}function rt(e,t,i){qe.bindFramebuffer(qe.FRAMEBUFFER,e),qe.framebufferTexture2D(qe.FRAMEBUFFER,qe.COLOR_ATTACHMENT0,i,t.__webglTexture,0)}function nt(e,t){qe.bindRenderbuffer(qe.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(qe.renderbufferStorage(qe.RENDERBUFFER,qe.DEPTH_COMPONENT16,t.width,t.height),qe.framebufferRenderbuffer(qe.FRAMEBUFFER,qe.DEPTH_ATTACHMENT,qe.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(qe.renderbufferStorage(qe.RENDERBUFFER,qe.DEPTH_STENCIL,t.width,t.height),qe.framebufferRenderbuffer(qe.FRAMEBUFFER,qe.DEPTH_STENCIL_ATTACHMENT,qe.RENDERBUFFER,e)):qe.renderbufferStorage(qe.RENDERBUFFER,qe.RGBA4,t.width,t.height)}function ot(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?qe.NEAREST:qe.LINEAR}function at(e){if(e===THREE.RepeatWrapping)return qe.REPEAT;if(e===THREE.ClampToEdgeWrapping)return qe.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return qe.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return qe.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return qe.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return qe.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return qe.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return qe.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return qe.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return qe.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return qe.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return qe.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return qe.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return qe.BYTE;if(e===THREE.ShortType)return qe.SHORT;if(e===THREE.UnsignedShortType)return qe.UNSIGNED_SHORT;if(e===THREE.IntType)return qe.INT;if(e===THREE.UnsignedIntType)return qe.UNSIGNED_INT;if(e===THREE.FloatType)return qe.FLOAT;if(e===THREE.AlphaFormat)return qe.ALPHA;if(e===THREE.RGBFormat)return qe.RGB;if(e===THREE.RGBAFormat)return qe.RGBA;if(e===THREE.LuminanceFormat)return qe.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return qe.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return qe.FUNC_ADD;if(e===THREE.SubtractEquation)return qe.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return qe.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return qe.ZERO;if(e===THREE.OneFactor)return qe.ONE;if(e===THREE.SrcColorFactor)return qe.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return qe.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return qe.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return qe.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return qe.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return qe.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return qe.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return qe.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return qe.SRC_ALPHA_SATURATE;if(void 0!==u){if(e===THREE.RGB_S3TC_DXT1_Format)return u.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return u.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return u.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return u.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}this.renderBufferImmediate=function(e,t,i){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=qe.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=qe.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=qe.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=qe.createBuffer()),e.hasPositions&&(qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglVertexBuffer),qe.bufferData(qe.ARRAY_BUFFER,e.positionArray,qe.DYNAMIC_DRAW),qe.enableVertexAttribArray(t.attributes.position),qe.vertexAttribPointer(t.attributes.position,3,qe.FLOAT,!1,0,0)),e.hasNormals){if(qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglNormalBuffer),i.shading===THREE.FlatShading){var r,n,o,a,s,l,h,c,u,p,d,f=3*e.count;for(d=0;d<f;d+=9)a=(p=e.normalArray)[d],l=p[d+1],c=p[d+2],s=p[d+3],h=p[d+4],u=p[d+5],r=(a+s+p[d+6])/3,n=(l+h+p[d+7])/3,o=(c+u+p[d+8])/3,p[d]=r,p[d+1]=n,p[d+2]=o,p[d+3]=r,p[d+4]=n,p[d+5]=o,p[d+6]=r,p[d+7]=n,p[d+8]=o}qe.bufferData(qe.ARRAY_BUFFER,e.normalArray,qe.DYNAMIC_DRAW),qe.enableVertexAttribArray(t.attributes.normal),qe.vertexAttribPointer(t.attributes.normal,3,qe.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglUvBuffer),qe.bufferData(qe.ARRAY_BUFFER,e.uvArray,qe.DYNAMIC_DRAW),qe.enableVertexAttribArray(t.attributes.uv),qe.vertexAttribPointer(t.attributes.uv,2,qe.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==THREE.NoColors&&(qe.bindBuffer(qe.ARRAY_BUFFER,e.__webglColorBuffer),qe.bufferData(qe.ARRAY_BUFFER,e.colorArray,qe.DYNAMIC_DRAW),qe.enableVertexAttribArray(t.attributes.color),qe.vertexAttribPointer(t.attributes.color,3,qe.FLOAT,!1,0,0)),qe.drawArrays(qe.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,n,o){if(!1!==r.visible){var a,s,l,h,c,u,p;s=(a=ze(e,t,i,r,o)).attributes,l=n.attributes;var d=!1,f=r.wireframe?1:0,m=16777215*n.id+2*a.id+f;if(m!==R&&(R=m,d=!0),d&&Re(),o instanceof THREE.Mesh){var E=l.index;if(E){var v=n.offsets;1<v.length&&(d=!0);for(var g=0,y=v.length;g<y;g++){var T=v[g].index;if(d){for(c in l)"index"!==c&&(u=s[c],p=(h=l[c]).itemSize,0<=u&&(qe.bindBuffer(qe.ARRAY_BUFFER,h.buffer),be(u),qe.vertexAttribPointer(u,p,qe.FLOAT,!1,0,T*p*4)));qe.bindBuffer(qe.ELEMENT_ARRAY_BUFFER,E.buffer)}qe.drawElements(qe.TRIANGLES,v[g].count,qe.UNSIGNED_SHORT,2*v[g].start),I.info.render.calls++,I.info.render.vertices+=v[g].count,I.info.render.faces+=v[g].count/3}}else{if(d)for(c in l)"index"!==c&&(u=s[c],p=(h=l[c]).itemSize,0<=u&&(qe.bindBuffer(qe.ARRAY_BUFFER,h.buffer),be(u),qe.vertexAttribPointer(u,p,qe.FLOAT,!1,0,0)));var x=n.attributes.position;qe.drawArrays(qe.TRIANGLES,0,x.numItems/3),I.info.render.calls++,I.info.render.vertices+=x.numItems/3,I.info.render.faces+=x.numItems/3/3}}else if(o instanceof THREE.ParticleSystem){if(d){for(c in l)u=s[c],p=(h=l[c]).itemSize,0<=u&&(qe.bindBuffer(qe.ARRAY_BUFFER,h.buffer),be(u),qe.vertexAttribPointer(u,p,qe.FLOAT,!1,0,0));x=l.position;qe.drawArrays(qe.POINTS,0,x.numItems/3),I.info.render.calls++,I.info.render.points+=x.numItems/3}}else if(o instanceof THREE.Line&&d){for(c in l)u=s[c],p=(h=l[c]).itemSize,0<=u&&(qe.bindBuffer(qe.ARRAY_BUFFER,h.buffer),be(u),qe.vertexAttribPointer(u,p,qe.FLOAT,!1,0,0));We(r.linewidth);x=l.position;qe.drawArrays(qe.LINE_STRIP,0,x.numItems/3),I.info.render.calls++,I.info.render.points+=x.numItems}}},this.renderBuffer=function(e,t,i,r,n,o){if(!1!==r.visible){var a,s,l,h,c,u;s=(a=ze(e,t,i,r,o)).attributes;var p=!1,d=r.wireframe?1:0,f=16777215*n.id+2*a.id+d;if(f!==R&&(R=f,p=!0),p&&Re(),!r.morphTargets&&0<=s.position?p&&(qe.bindBuffer(qe.ARRAY_BUFFER,n.__webglVertexBuffer),be(s.position),qe.vertexAttribPointer(s.position,3,qe.FLOAT,!1,0,0)):o.morphTargetBase&&function(e,t,i){var r=e.program.attributes;-1!==i.morphTargetBase&&0<=r.position?(qe.bindBuffer(qe.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[i.morphTargetBase]),be(r.position),qe.vertexAttribPointer(r.position,3,qe.FLOAT,!1,0,0)):0<=r.position&&(qe.bindBuffer(qe.ARRAY_BUFFER,t.__webglVertexBuffer),be(r.position),qe.vertexAttribPointer(r.position,3,qe.FLOAT,!1,0,0));if(i.morphTargetForcedOrder.length)for(var n=0,o=i.morphTargetForcedOrder,a=i.morphTargetInfluences;n<e.numSupportedMorphTargets&&n<o.length;)0<=r["morphTarget"+n]&&(qe.bindBuffer(qe.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[n]]),be(r["morphTarget"+n]),qe.vertexAttribPointer(r["morphTarget"+n],3,qe.FLOAT,!1,0,0)),0<=r["morphNormal"+n]&&e.morphNormals&&(qe.bindBuffer(qe.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[n]]),be(r["morphNormal"+n]),qe.vertexAttribPointer(r["morphNormal"+n],3,qe.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[n]=a[o[n]],n++;else{var s,l,h=[],a=i.morphTargetInfluences,c=a.length;for(l=0;l<c;l++)0<(s=a[l])&&h.push([s,l]);h.length>e.numSupportedMorphTargets?(h.sort(He),h.length=e.numSupportedMorphTargets):h.length>e.numSupportedMorphNormals?h.sort(He):0===h.length&&h.push([0,0]);for(var u,n=0;n<e.numSupportedMorphTargets;)h[n]?(u=h[n][1],0<=r["morphTarget"+n]&&(qe.bindBuffer(qe.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[u]),be(r["morphTarget"+n]),qe.vertexAttribPointer(r["morphTarget"+n],3,qe.FLOAT,!1,0,0)),0<=r["morphNormal"+n]&&e.morphNormals&&(qe.bindBuffer(qe.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[u]),be(r["morphNormal"+n]),qe.vertexAttribPointer(r["morphNormal"+n],3,qe.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[n]=a[u]):i.__webglMorphTargetInfluences[n]=0,n++}null!==e.program.uniforms.morphTargetInfluences&&qe.uniform1fv(e.program.uniforms.morphTargetInfluences,i.__webglMorphTargetInfluences)}(r,n,o),p){if(n.__webglCustomAttributesList)for(c=0,u=n.__webglCustomAttributesList.length;c<u;c++)0<=s[(h=n.__webglCustomAttributesList[c]).buffer.belongsToAttribute]&&(qe.bindBuffer(qe.ARRAY_BUFFER,h.buffer),be(s[h.buffer.belongsToAttribute]),qe.vertexAttribPointer(s[h.buffer.belongsToAttribute],h.size,qe.FLOAT,!1,0,0));0<=s.color&&(qe.bindBuffer(qe.ARRAY_BUFFER,n.__webglColorBuffer),be(s.color),qe.vertexAttribPointer(s.color,3,qe.FLOAT,!1,0,0)),0<=s.normal&&(qe.bindBuffer(qe.ARRAY_BUFFER,n.__webglNormalBuffer),be(s.normal),qe.vertexAttribPointer(s.normal,3,qe.FLOAT,!1,0,0)),0<=s.tangent&&(qe.bindBuffer(qe.ARRAY_BUFFER,n.__webglTangentBuffer),be(s.tangent),qe.vertexAttribPointer(s.tangent,4,qe.FLOAT,!1,0,0)),0<=s.uv&&(qe.bindBuffer(qe.ARRAY_BUFFER,n.__webglUVBuffer),be(s.uv),qe.vertexAttribPointer(s.uv,2,qe.FLOAT,!1,0,0)),0<=s.uv2&&(qe.bindBuffer(qe.ARRAY_BUFFER,n.__webglUV2Buffer),be(s.uv2),qe.vertexAttribPointer(s.uv2,2,qe.FLOAT,!1,0,0)),r.skinning&&0<=s.skinIndex&&0<=s.skinWeight&&(qe.bindBuffer(qe.ARRAY_BUFFER,n.__webglSkinIndicesBuffer),be(s.skinIndex),qe.vertexAttribPointer(s.skinIndex,4,qe.FLOAT,!1,0,0),qe.bindBuffer(qe.ARRAY_BUFFER,n.__webglSkinWeightsBuffer),be(s.skinWeight),qe.vertexAttribPointer(s.skinWeight,4,qe.FLOAT,!1,0,0)),0<=s.lineDistance&&(qe.bindBuffer(qe.ARRAY_BUFFER,n.__webglLineDistanceBuffer),be(s.lineDistance),qe.vertexAttribPointer(s.lineDistance,1,qe.FLOAT,!1,0,0))}o instanceof THREE.Mesh?(r.wireframe?(We(r.wireframeLinewidth),p&&qe.bindBuffer(qe.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer),qe.drawElements(qe.LINES,n.__webglLineCount,qe.UNSIGNED_SHORT,0)):(p&&qe.bindBuffer(qe.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer),qe.drawElements(qe.TRIANGLES,n.__webglFaceCount,qe.UNSIGNED_SHORT,0)),I.info.render.calls++,I.info.render.vertices+=n.__webglFaceCount,I.info.render.faces+=n.__webglFaceCount/3):o instanceof THREE.Line?(l=o.type===THREE.LineStrip?qe.LINE_STRIP:qe.LINES,We(r.linewidth),qe.drawArrays(l,0,n.__webglLineCount),I.info.render.calls++):o instanceof THREE.ParticleSystem?(qe.drawArrays(qe.POINTS,0,n.__webglParticleCount),I.info.render.calls++,I.info.render.points+=n.__webglParticleCount):o instanceof THREE.Ribbon&&(qe.drawArrays(qe.TRIANGLE_STRIP,0,n.__webglVertexCount),I.info.render.calls++)}},this.render=function(e,t,i,r){if(t instanceof THREE.Camera!=!1){var n,o,a,s,l,h,c=e.__lights,u=e.fog;for(b=-1,(Y=!0)===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),G.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),j.setFromMatrix(G),this.autoUpdateObjects&&this.initWebGLObjects(e),_e(this.renderPluginsPre,e,t),I.info.render.calls=0,I.info.render.vertices=0,I.info.render.faces=0,I.info.render.points=0,this.setRenderTarget(i),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),n=0,o=(l=e.__webglObjects).length;n<o;n++)s=(a=l[n]).object,a.id=n,a.render=!1,s.visible&&((s instanceof THREE.Mesh||s instanceof THREE.ParticleSystem)&&s.frustumCulled&&!j.intersectsObject(s)||(Oe(s,t),Ae(a),(a.render=!0)===this.sortObjects&&(null!==s.renderDepth?a.z=s.renderDepth:(q.getPositionFromMatrix(s.matrixWorld),q.applyProjection(G),a.z=q.z))));for(this.sortObjects&&l.sort(we),n=0,o=(l=e.__webglObjectsImmediate).length;n<o;n++)(s=(a=l[n]).object).visible&&(Oe(s,t),Ce(a));if(e.overrideMaterial){var p=e.overrideMaterial;this.setBlending(p.blending,p.blendEquation,p.blendSrc,p.blendDst),this.setDepthTest(p.depthTest),this.setDepthWrite(p.depthWrite),$e(p.polygonOffset,p.polygonOffsetFactor,p.polygonOffsetUnits),Se(e.__webglObjects,!1,"",t,c,u,!0,p),Me(e.__webglObjectsImmediate,"",t,c,u,!1,p)}else{p=null;this.setBlending(THREE.NoBlending),Se(e.__webglObjects,!0,"opaque",t,c,u,!1,p),Me(e.__webglObjectsImmediate,"opaque",t,c,u,!1,p),Se(e.__webglObjects,!1,"transparent",t,c,u,!0,p),Me(e.__webglObjectsImmediate,"transparent",t,c,u,!0,p)}_e(this.renderPluginsPost,e,t),i&&i.generateMipmaps&&i.minFilter!==THREE.NearestFilter&&i.minFilter!==THREE.LinearFilter&&((h=i)instanceof THREE.WebGLRenderTargetCube?(qe.bindTexture(qe.TEXTURE_CUBE_MAP,h.__webglTexture),qe.generateMipmap(qe.TEXTURE_CUBE_MAP),qe.bindTexture(qe.TEXTURE_CUBE_MAP,null)):(qe.bindTexture(qe.TEXTURE_2D,h.__webglTexture),qe.generateMipmap(qe.TEXTURE_2D),qe.bindTexture(qe.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.renderImmediateObject=function(e,t,i,r,n){var o=ze(e,t,i,r,n);R=-1,I.setMaterialFaces(r),n.immediateRenderCallback?n.immediateRenderCallback(o,qe,j):n.render(function(e){I.renderBufferImmediate(e,o,r)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;)Le(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)Ue(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,i=e.__webglObjects.length;t<i;t++){var r=e.__webglObjects[t].object;void 0===r.__webglInit&&(void 0!==r.__webglActive&&Ue(r,e),Le(r,e)),De(r)}},this.initMaterial=function(e,t,i,r){var n,o,a,s,l,h,c,u,p;e.addEventListener("dispose",pe),e instanceof THREE.MeshDepthMaterial?c="depth":e instanceof THREE.MeshNormalMaterial?c="normal":e instanceof THREE.MeshBasicMaterial?c="basic":e instanceof THREE.MeshLambertMaterial?c="lambert":e instanceof THREE.MeshPhongMaterial?c="phong":e instanceof THREE.LineBasicMaterial?c="basic":e instanceof THREE.LineDashedMaterial?c="dashed":e instanceof THREE.ParticleBasicMaterial&&(c="particle_basic"),c&&(u=e,p=THREE.ShaderLib[c],u.uniforms=THREE.UniformsUtils.clone(p.uniforms),u.vertexShader=p.vertexShader,u.fragmentShader=p.fragmentShader),s=function(e){var t,i,r,n,o,a,s;for(n=o=a=s=0,t=0,i=e.length;t<i;t++)(r=e[t]).onlyShadow||(r instanceof THREE.DirectionalLight&&n++,r instanceof THREE.PointLight&&o++,r instanceof THREE.SpotLight&&a++,r instanceof THREE.HemisphereLight&&s++);return{directional:n,point:o,spot:a,hemi:s}}(t),h=function(e){var t,i,r,n=0;for(t=0,i=e.length;t<i;t++)(r=e[t]).castShadow&&(r instanceof THREE.SpotLight&&n++,r instanceof THREE.DirectionalLight&&!r.shadowCascade&&n++);return n}(t),l=function(e){{if(te&&e&&e.useVertexTexture)return 1024;var t=qe.getParameter(qe.MAX_VERTEX_UNIFORM_VECTORS),i=Math.floor((t-20)/4),r=i;return void 0!==e&&e instanceof THREE.SkinnedMesh&&(r=Math.min(e.bones.length,r))<e.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)"),r}}(r),a={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:l,useVertexTexture:te&&r&&r.useVertexTexture,boneTextureWidth:r&&r.boneTextureWidth,boneTextureHeight:r&&r.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:h,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide},e.program=function(e,t,i,r,n,o,a){var s,l,h,c,u,p=[];e?p.push(e):(p.push(t),p.push(i));for(h in o)p.push(h),p.push(o[h]);for(s in a)p.push(s),p.push(a[s]);for(u=p.join(),s=0,l=H.length;s<l;s++){var d=H[s];if(d.code===u)return d.usedTimes++,d.program}var f="SHADOWMAP_TYPE_BASIC";a.shadowMapType===THREE.PCFShadowMap?f="SHADOWMAP_TYPE_PCF":a.shadowMapType===THREE.PCFSoftShadowMap&&(f="SHADOWMAP_TYPE_PCF_SOFT");var m=function(e){var t,i,r=[];for(var n in e)!1!==(t=e[n])&&(i="#define "+n+" "+t,r.push(i));return r.join("\n")}(o);c=qe.createProgram();var E,v,g,y,T=["precision "+w+" float;",m,ee?"#define VERTEX_TEXTURES":"",I.gammaInput?"#define GAMMA_INPUT":"",I.gammaOutput?"#define GAMMA_OUTPUT":"",I.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,"#define MAX_BONES "+a.maxBones,a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.vertexColors?"#define USE_COLOR":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.boneTextureWidth?"#define N_BONE_PIXEL_X "+a.boneTextureWidth.toFixed(1):"",a.boneTextureHeight?"#define N_BONE_PIXEL_Y "+a.boneTextureHeight.toFixed(1):"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals?"#define USE_MORPHNORMALS":"",a.perPixel?"#define PHONG_PER_PIXEL":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+f:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),x=["precision "+w+" float;",a.bumpMap||a.normalMap?"#extension GL_OES_standard_derivatives : enable":"",m,"#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,a.alphaTest?"#define ALPHATEST "+a.alphaTest:"",I.gammaInput?"#define GAMMA_INPUT":"",I.gammaOutput?"#define GAMMA_OUTPUT":"",I.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.vertexColors?"#define USE_COLOR":"",a.metal?"#define METAL":"",a.perPixel?"#define PHONG_PER_PIXEL":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+f:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),b=Qe("vertex",T+i),R=Qe("fragment",x+t);qe.attachShader(c,b),qe.attachShader(c,R),qe.linkProgram(c),qe.getProgramParameter(c,qe.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+qe.getProgramParameter(c,qe.VALIDATE_STATUS)+", gl error ["+qe.getError()+"]");qe.deleteShader(R),qe.deleteShader(b),c.uniforms={},c.attributes={},E=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],a.useVertexTexture?E.push("boneTexture"):E.push("boneGlobalMatrices");for(v in r)E.push(v);for(function(e,t){var i,r,n;for(i=0,r=t.length;i<r;i++)n=t[i],e.uniforms[n]=qe.getUniformLocation(e,n)}(c,E),E=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"],y=0;y<a.maxMorphTargets;y++)E.push("morphTarget"+y);for(y=0;y<a.maxMorphNormals;y++)E.push("morphNormal"+y);for(g in n)E.push(g);return function(e,t){var i,r,n;for(i=0,r=t.length;i<r;i++)n=t[i],e.attributes[n]=qe.getAttribLocation(e,n)}(c,E),c.id=_++,H.push({program:c,code:u,usedTimes:1}),I.info.memory.programs=H.length,c}(c,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,a);var d=e.program.attributes;if(e.morphTargets){var f="morphTarget";for(o=e.numSupportedMorphTargets=0;o<this.maxMorphTargets;o++)0<=d[f+o]&&e.numSupportedMorphTargets++}if(e.morphNormals){f="morphNormal";for(o=e.numSupportedMorphNormals=0;o<this.maxMorphNormals;o++)0<=d[f+o]&&e.numSupportedMorphNormals++}for(n in e.uniformsList=[],e.uniforms)e.uniformsList.push([e.uniforms[n],n])},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?qe.disable(qe.CULL_FACE):(t===THREE.FrontFaceDirectionCW?qe.frontFace(qe.CW):qe.frontFace(qe.CCW),e===THREE.CullFaceBack?qe.cullFace(qe.BACK):e===THREE.CullFaceFront?qe.cullFace(qe.FRONT):qe.cullFace(qe.FRONT_AND_BACK),qe.enable(qe.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide,i=e.side===THREE.BackSide;d!==t&&(t?qe.disable(qe.CULL_FACE):qe.enable(qe.CULL_FACE),d=t),f!==i&&(i?qe.frontFace(qe.CW):qe.frontFace(qe.CCW),f=i)},this.setDepthTest=function(e){y!==e&&(e?qe.enable(qe.DEPTH_TEST):qe.disable(qe.DEPTH_TEST),y=e)},this.setDepthWrite=function(e){A!==e&&(qe.depthMask(e),A=e)},this.setBlending=function(e,t,i,r){e!==m&&(e===THREE.NoBlending?qe.disable(qe.BLEND):e===THREE.AdditiveBlending?(qe.enable(qe.BLEND),qe.blendEquation(qe.FUNC_ADD),qe.blendFunc(qe.SRC_ALPHA,qe.ONE)):e===THREE.SubtractiveBlending?(qe.enable(qe.BLEND),qe.blendEquation(qe.FUNC_ADD),qe.blendFunc(qe.ZERO,qe.ONE_MINUS_SRC_COLOR)):e===THREE.MultiplyBlending?(qe.enable(qe.BLEND),qe.blendEquation(qe.FUNC_ADD),qe.blendFunc(qe.ZERO,qe.SRC_COLOR)):e===THREE.CustomBlending?qe.enable(qe.BLEND):(qe.enable(qe.BLEND),qe.blendEquationSeparate(qe.FUNC_ADD,qe.FUNC_ADD),qe.blendFuncSeparate(qe.SRC_ALPHA,qe.ONE_MINUS_SRC_ALPHA,qe.ONE,qe.ONE_MINUS_SRC_ALPHA)),m=e),e===THREE.CustomBlending?(t!==E&&(qe.blendEquation(at(t)),E=t),i===v&&r===g||(qe.blendFunc(at(i),at(r)),v=i,g=r)):g=v=E=null},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",ce),e.__webglTexture=qe.createTexture(),I.info.memory.textures++),qe.activeTexture(qe.TEXTURE0+t),qe.bindTexture(qe.TEXTURE_2D,e.__webglTexture),qe.pixelStorei(qe.UNPACK_FLIP_Y_WEBGL,e.flipY),qe.pixelStorei(qe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),qe.pixelStorei(qe.UNPACK_ALIGNMENT,e.unpackAlignment);var i=e.image,r=Ze(i.width)&&Ze(i.height),n=at(e.format),o=at(e.type);Je(qe.TEXTURE_2D,e,r);var a,s=e.mipmaps;if(e instanceof THREE.DataTexture)if(0<s.length&&r){for(var l=0,h=s.length;l<h;l++)a=s[l],qe.texImage2D(qe.TEXTURE_2D,l,n,a.width,a.height,0,n,o,a.data);e.generateMipmaps=!1}else qe.texImage2D(qe.TEXTURE_2D,0,n,i.width,i.height,0,n,o,i.data);else if(e instanceof THREE.CompressedTexture)for(l=0,h=s.length;l<h;l++)a=s[l],qe.compressedTexImage2D(qe.TEXTURE_2D,l,n,a.width,a.height,0,a.data);else if(0<s.length&&r){for(l=0,h=s.length;l<h;l++)a=s[l],qe.texImage2D(qe.TEXTURE_2D,l,n,n,o,a);e.generateMipmaps=!1}else qe.texImage2D(qe.TEXTURE_2D,0,n,n,o,e.image);e.generateMipmaps&&r&&qe.generateMipmap(qe.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else qe.activeTexture(qe.TEXTURE0+t),qe.bindTexture(qe.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t,i,r,n,o,a=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",ue),e.__webglTexture=qe.createTexture(),I.info.memory.textures++;var s=Ze(e.width)&&Ze(e.height),l=at(e.format),h=at(e.type);if(a){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],qe.bindTexture(qe.TEXTURE_CUBE_MAP,e.__webglTexture),Je(qe.TEXTURE_CUBE_MAP,e,s);for(var c=0;c<6;c++)e.__webglFramebuffer[c]=qe.createFramebuffer(),e.__webglRenderbuffer[c]=qe.createRenderbuffer(),qe.texImage2D(qe.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,l,e.width,e.height,0,l,h,null),rt(e.__webglFramebuffer[c],e,qe.TEXTURE_CUBE_MAP_POSITIVE_X+c),nt(e.__webglRenderbuffer[c],e);s&&qe.generateMipmap(qe.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=qe.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=qe.createRenderbuffer(),qe.bindTexture(qe.TEXTURE_2D,e.__webglTexture),Je(qe.TEXTURE_2D,e,s),qe.texImage2D(qe.TEXTURE_2D,0,l,e.width,e.height,0,l,h,null),rt(e.__webglFramebuffer,e,qe.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?qe.framebufferRenderbuffer(qe.FRAMEBUFFER,qe.DEPTH_ATTACHMENT,qe.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&qe.framebufferRenderbuffer(qe.FRAMEBUFFER,qe.DEPTH_STENCIL_ATTACHMENT,qe.RENDERBUFFER,e.__webglRenderbuffer):nt(e.__webglRenderbuffer,e),s&&qe.generateMipmap(qe.TEXTURE_2D);a?qe.bindTexture(qe.TEXTURE_CUBE_MAP,null):qe.bindTexture(qe.TEXTURE_2D,null),qe.bindRenderbuffer(qe.RENDERBUFFER,null),qe.bindFramebuffer(qe.FRAMEBUFFER,null)}e?(t=a?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,i=e.width,r=e.height,o=n=0):(t=null,i=B,r=k,n=N,o=U),t!==p&&(qe.bindFramebuffer(qe.FRAMEBUFFER,t),qe.viewport(n,o,i,r),p=t),z=i,V=r},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(e,t,i){this.width=e,this.height=t,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:THREE.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==i.format?i.format:THREE.RGBAFormat,this.type=void 0!==i.type?i.type:THREE.UnsignedByteType,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,addEventListener:THREE.EventDispatcher.prototype.addEventListener,hasEventListener:THREE.EventDispatcher.prototype.hasEventListener,removeEventListener:THREE.EventDispatcher.prototype.removeEventListener,dispatchEvent:THREE.EventDispatcher.prototype.dispatchEvent,clone:function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.WebGLRenderTargetCube=function(e,t,i){THREE.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidModel=new THREE.Vector3,this.normalModel=new THREE.Vector3,this.normalModelView=new THREE.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidModel=new THREE.Vector3,this.normalModel=new THREE.Vector3,this.normalModelView=new THREE.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableObject=function(){this.object=null,this.z=null},THREE.RenderableParticle=function(){this.object=null,this.x=null,this.y=null,this.z=null,this.rotation=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null},THREE.GeometryUtils={merge:function(e,t,i){var r,n,o=e.vertices.length,a=(e.faceVertexUvs[0].length,t instanceof THREE.Mesh?t.geometry:t),s=e.vertices,l=a.vertices,h=e.faces,c=a.faces,u=e.faceVertexUvs[0],p=a.faceVertexUvs[0];void 0===i&&(i=0),t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,n=(new THREE.Matrix3).getNormalMatrix(r));for(var d=0,f=l.length;d<f;d++){var m=l[d].clone();r&&m.applyMatrix4(r),s.push(m)}for(d=0,f=c.length;d<f;d++){var E,v,g,y=c[d],T=y.vertexNormals,x=y.vertexColors;y instanceof THREE.Face3?E=new THREE.Face3(y.a+o,y.b+o,y.c+o):y instanceof THREE.Face4&&(E=new THREE.Face4(y.a+o,y.b+o,y.c+o,y.d+o)),E.normal.copy(y.normal),n&&E.normal.applyMatrix3(n).normalize();for(var b=0,R=T.length;b<R;b++)v=T[b].clone(),n&&v.applyMatrix3(n).normalize(),E.vertexNormals.push(v);E.color.copy(y.color);for(b=0,R=x.length;b<R;b++)g=x[b],E.vertexColors.push(g.clone());E.materialIndex=y.materialIndex+i,E.centroid.copy(y.centroid),r&&E.centroid.applyMatrix4(r),h.push(E)}for(d=0,f=p.length;d<f;d++){var w=p[d],H=[];for(b=0,R=w.length;b<R;b++)H.push(new THREE.Vector2(w[b].x,w[b].y));u.push(H)}},removeMaterials:function(e,t){for(var i={},r=0,n=t.length;r<n;r++)i[t[r]]=!0;var o,a=[];for(r=0,n=e.faces.length;r<n;r++)(o=e.faces[r]).materialIndex in i||a.push(o);e.faces=a},randomPointInTriangle:function(e,t,i){var r,n,o,a=new THREE.Vector3,s=THREE.GeometryUtils.__v1;return 1<(r=THREE.GeometryUtils.random())+(n=THREE.GeometryUtils.random())&&(r=1-r,n=1-n),o=1-r-n,a.copy(e),a.multiplyScalar(r),s.copy(t),s.multiplyScalar(n),a.add(s),s.copy(i),s.multiplyScalar(o),a.add(s),a},randomPointInFace:function(e,t,i){var r,n,o,a,s,l;return e instanceof THREE.Face3?(r=t.vertices[e.a],n=t.vertices[e.b],o=t.vertices[e.c],THREE.GeometryUtils.randomPointInTriangle(r,n,o)):e instanceof THREE.Face4?(r=t.vertices[e.a],n=t.vertices[e.b],o=t.vertices[e.c],a=t.vertices[e.d],i?e._area1&&e._area2?(s=e._area1,l=e._area2):(s=THREE.GeometryUtils.triangleArea(r,n,a),l=THREE.GeometryUtils.triangleArea(n,o,a),e._area1=s,e._area2=l):(s=THREE.GeometryUtils.triangleArea(r,n,a),l=THREE.GeometryUtils.triangleArea(n,o,a)),THREE.GeometryUtils.random()*(s+l)<s?THREE.GeometryUtils.randomPointInTriangle(r,n,a):THREE.GeometryUtils.randomPointInTriangle(n,o,a)):void 0},randomPointsInGeometry:function(e,t){var i,r,n,o,a,s,l=e.faces,h=e.vertices,c=l.length,u=0,p=[];for(r=0;r<c;r++)(i=l[r])instanceof THREE.Face3?(n=h[i.a],o=h[i.b],a=h[i.c],i._area=THREE.GeometryUtils.triangleArea(n,o,a)):i instanceof THREE.Face4&&(n=h[i.a],o=h[i.b],a=h[i.c],s=h[i.d],i._area1=THREE.GeometryUtils.triangleArea(n,o,s),i._area2=THREE.GeometryUtils.triangleArea(o,a,s),i._area=i._area1+i._area2),u+=i._area,p[r]=u;var d,f,m,E=[],v={};for(r=0;r<t;r++)d=THREE.GeometryUtils.random()*u,m=d,f=function e(t,i){if(i<t)return t;var r=t+Math.floor((i-t)/2);return p[r]>m?e(t,r-1):p[r]<m?e(r+1,i):r}(0,p.length-1),E[r]=THREE.GeometryUtils.randomPointInFace(l[f],e,!0),v[f]?v[f]+=1:v[f]=1;return E},triangleArea:function(e,t,i){var r=THREE.GeometryUtils.__v1,n=THREE.GeometryUtils.__v2;return r.subVectors(t,e),n.subVectors(i,e),r.cross(n),.5*r.length()},center:function(e){e.computeBoundingBox();var t=e.boundingBox,i=new THREE.Vector3;return i.addVectors(t.min,t.max),i.multiplyScalar(-.5),e.applyMatrix((new THREE.Matrix4).makeTranslation(i.x,i.y,i.z)),e.computeBoundingBox(),i},normalizeUVs:function(e){for(var t=e.faceVertexUvs[0],i=0,r=t.length;i<r;i++)for(var n=t[i],o=0,a=n.length;o<a;o++)1!==n[o].x&&(n[o].x=n[o].x-Math.floor(n[o].x)),1!==n[o].y&&(n[o].y=n[o].y-Math.floor(n[o].y))},triangulateQuads:function(e){var t,i,r,n,o=[],a=[],s=[];for(t=0,i=e.faceUvs.length;t<i;t++)a[t]=[];for(t=0,i=e.faceVertexUvs.length;t<i;t++)s[t]=[];for(t=0,i=e.faces.length;t<i;t++){var l=e.faces[t];if(l instanceof THREE.Face4){var h=l.a,c=l.b,u=l.c,p=l.d,d=new THREE.Face3,f=new THREE.Face3;for(d.color.copy(l.color),f.color.copy(l.color),d.materialIndex=l.materialIndex,f.materialIndex=l.materialIndex,d.a=h,d.b=c,d.c=p,f.a=c,f.b=u,f.c=p,4===l.vertexColors.length&&(d.vertexColors[0]=l.vertexColors[0].clone(),d.vertexColors[1]=l.vertexColors[1].clone(),d.vertexColors[2]=l.vertexColors[3].clone(),f.vertexColors[0]=l.vertexColors[1].clone(),f.vertexColors[1]=l.vertexColors[2].clone(),f.vertexColors[2]=l.vertexColors[3].clone()),o.push(d,f),r=0,n=e.faceVertexUvs.length;r<n;r++)if(e.faceVertexUvs[r].length){var m=e.faceVertexUvs[r][t],E=m[0],v=m[1],g=m[2],y=m[3],T=[E.clone(),v.clone(),y.clone()],x=[v.clone(),g.clone(),y.clone()];s[r].push(T,x)}for(r=0,n=e.faceUvs.length;r<n;r++)if(e.faceUvs[r].length){var b=e.faceUvs[r][t];a[r].push(b,b)}}else{for(o.push(l),r=0,n=e.faceUvs.length;r<n;r++)a[r].push(e.faceUvs[r][t]);for(r=0,n=e.faceVertexUvs.length;r<n;r++)s[r].push(e.faceVertexUvs[r][t])}}e.faces=o,e.faceUvs=a,e.faceVertexUvs=s,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()},setMaterialIndex:function(e,t,i,r){for(var n=e.faces,o=i||0,a=r||n.length-1,s=o;s<=a;s++)n[s].materialIndex=t}},THREE.GeometryUtils.random=THREE.Math.random16,THREE.GeometryUtils.__v1=new THREE.Vector3,THREE.GeometryUtils.__v2=new THREE.Vector3,THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,i,r){var n=new Image,o=new THREE.Texture(n,t),a=new THREE.ImageLoader;return a.addEventListener("load",function(e){o.image=e.content,o.needsUpdate=!0,i&&i(o)}),a.addEventListener("error",function(e){r&&r(e.message)}),a.crossOrigin=this.crossOrigin,a.load(e,n),o.sourceFile=e,o},loadCompressedTexture:function(e,t,i,r){var n=new THREE.CompressedTexture;n.mapping=t;var o=new XMLHttpRequest;return o.onload=function(){var e=o.response,t=THREE.ImageUtils.parseDDS(e,!0);n.format=t.format,n.mipmaps=t.mipmaps,n.image.width=t.width,n.image.height=t.height,n.generateMipmaps=!1,n.needsUpdate=!0,i&&i(n)},o.onerror=r,o.open("GET",e,!0),o.responseType="arraybuffer",o.send(null),n},loadTextureCube:function(e,t,i,r){var n=[];n.loadCount=0;var o=new THREE.Texture;o.image=n,void 0!==t&&(o.mapping=t),o.flipY=!1;for(var a=0,s=e.length;a<s;++a){var l=new Image;(n[a]=l).onload=function(){n.loadCount+=1,6===n.loadCount&&(o.needsUpdate=!0,i&&i(o))},l.onerror=r,l.crossOrigin=this.crossOrigin,l.src=e[a]}return o},loadCompressedTextureCube:function(e,t,o,i){var a=[];a.loadCount=0;var s=new THREE.CompressedTexture;s.image=a,void 0!==t&&(s.mapping=t),s.flipY=!1,s.generateMipmaps=!1;var r=function(i,r){return function(){var e=i.response,t=THREE.ImageUtils.parseDDS(e,!0);r.format=t.format,r.mipmaps=t.mipmaps,r.width=t.width,r.height=t.height,a.loadCount+=1,6===a.loadCount&&(s.format=t.format,s.needsUpdate=!0,o&&o(s))}};if(e instanceof Array)for(var n=0,l=e.length;n<l;++n){var h={};a[n]=h,(u=new XMLHttpRequest).onload=r(u,h),u.onerror=i;var c=e[n];u.open("GET",c,!0),u.responseType="arraybuffer",u.send(null)}else{var u;c=e;(u=new XMLHttpRequest).onload=function(){var e=u.response,t=THREE.ImageUtils.parseDDS(e,!0);if(t.isCubemap){for(var i=t.mipmaps.length/t.mipmapCount,r=0;r<i;r++){a[r]={mipmaps:[]};for(var n=0;n<t.mipmapCount;n++)a[r].mipmaps.push(t.mipmaps[r*t.mipmapCount+n]),a[r].format=t.format,a[r].width=t.width,a[r].height=t.height}s.format=t.format,s.needsUpdate=!0,o&&o(s)}},u.onerror=i,u.open("GET",c,!0),u.responseType="arraybuffer",u.send(null)}return s},parseDDS:function(e,t){var i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var n,o=r("DXT1"),a=r("DXT3"),s=r("DXT5"),l=new Int32Array(e,0,31);if(542327876!==l[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),i;if(4&!l[20])return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),i;var h,c=l[21];switch(c){case o:n=8,i.format=THREE.RGB_S3TC_DXT1_Format;break;case a:n=16,i.format=THREE.RGBA_S3TC_DXT3_Format;break;case s:n=16,i.format=THREE.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",(h=c,String.fromCharCode(255&h,h>>8&255,h>>16&255,h>>24&255))),i}i.mipmapCount=1,131072&l[2]&&!1!==t&&(i.mipmapCount=Math.max(1,l[7])),i.isCubemap=!!(512&l[28]),i.width=l[4],i.height=l[3];for(var u=l[1]+4,p=i.width,d=i.height,f=i.isCubemap?6:1,m=0;m<f;m++){for(var E=0;E<i.mipmapCount;E++){var v=Math.max(4,p)/4*Math.max(4,d)/4*n,g={data:new Uint8Array(e,u,v),width:p,height:d};i.mipmaps.push(g),u+=v,p=Math.max(.5*p,1),d=Math.max(.5*d,1)}p=i.width,d=i.height}return i},getNormalMap:function(e,t){var i=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]};t|=1;var r=e.width,n=e.height,o=document.createElement("canvas");o.width=r,o.height=n;var a=o.getContext("2d");a.drawImage(e,0,0);for(var s,l,h,c,u=a.getImageData(0,0,r,n).data,p=a.createImageData(r,n),d=p.data,f=0;f<r;f++)for(var m=0;m<n;m++){var E=m-1<0?0:m-1,v=n-1<m+1?n-1:m+1,g=f-1<0?0:f-1,y=r-1<f+1?r-1:f+1,T=[],x=[0,0,u[4*(m*r+f)]/255*t];T.push([-1,0,u[4*(m*r+g)]/255*t]),T.push([-1,-1,u[4*(E*r+g)]/255*t]),T.push([0,-1,u[4*(E*r+f)]/255*t]),T.push([1,-1,u[4*(E*r+y)]/255*t]),T.push([1,0,u[4*(m*r+y)]/255*t]),T.push([1,1,u[4*(v*r+y)]/255*t]),T.push([0,1,u[4*(v*r+f)]/255*t]),T.push([-1,1,u[4*(v*r+g)]/255*t]);for(var b=[],R=T.length,w=0;w<R;w++){var H=T[w],_=T[(w+1)%R];H=i(H,x),_=i(_,x),b.push((c=_,s=[(h=H)[1]*c[2]-h[2]*c[1],h[2]*c[0]-h[0]*c[2],h[0]*c[1]-h[1]*c[0]],void 0,l=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),[s[0]/l,s[1]/l,s[2]/l]))}var S=[0,0,0];for(w=0;w<b.length;w++)S[0]+=b[w][0],S[1]+=b[w][1],S[2]+=b[w][2];S[0]/=b.length,S[1]/=b.length,S[2]/=b.length;var M=4*(m*r+f);d[M]=(S[0]+1)/2*255|0,d[M+1]=(S[1]+1)/2*255|0,d[M+2]=255*S[2]|0,d[M+3]=255}return a.putImageData(p,0,0),o},generateDataTexture:function(e,t,i){for(var r=e*t,n=new Uint8Array(3*r),o=Math.floor(255*i.r),a=Math.floor(255*i.g),s=Math.floor(255*i.b),l=0;l<r;l++)n[3*l]=o,n[3*l+1]=a,n[3*l+2]=s;var h=new THREE.DataTexture(n,e,t,THREE.RGBFormat);return h.needsUpdate=!0,h}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new THREE.Object3D,r=0,n=t.length;r<n;r++)i.add(new THREE.Mesh(e,t[r]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var r=new THREE.Matrix4;r.getInverse(i.matrixWorld),e.applyMatrix(r),t.remove(e),i.add(e)}},THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e;this.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,i=this.getFace(),r=this.size/i.resolution,n=0,o=String(e).split(""),a=o.length,s=[];for(t=0;t<a;t++){var l=new THREE.Path,h=this.extractGlyphPoints(o[t],i,r,n,l);n+=h.offset,s.push(h.path)}return{paths:s,offset:n/2}},extractGlyphPoints:function(e,t,i,r,n){var o,a,s,l,h,c,u,p,d,f,m,E,v,g,y,T,x,b,R=[],w=t.glyphs[e]||t.glyphs["?"];if(w){if(w.o)for(h=(l=w._cachedOutline||(w._cachedOutline=w.o.split(" "))).length,u=c=i,o=0;o<h;)switch(l[o++]){case"m":p=l[o++]*c+r,d=l[o++]*u,n.moveTo(p,d);break;case"l":p=l[o++]*c+r,d=l[o++]*u,n.lineTo(p,d);break;case"q":if(f=l[o++]*c+r,m=l[o++]*u,g=l[o++]*c+r,y=l[o++]*u,n.quadraticCurveTo(g,y,f,m),b=R[R.length-1])for(E=b.x,v=b.y,a=1,s=this.divisions;a<=s;a++){var H=a/s;THREE.Shape.Utils.b2(H,E,g,f),THREE.Shape.Utils.b2(H,v,y,m)}break;case"b":if(f=l[o++]*c+r,m=l[o++]*u,g=l[o++]*c+r,y=l[o++]*-u,T=l[o++]*c+r,x=l[o++]*-u,n.bezierCurveTo(f,m,g,y,T,x),b=R[R.length-1])for(E=b.x,v=b.y,a=1,s=this.divisions;a<=s;a++)H=a/s,THREE.Shape.Utils.b3(H,E,g,T,f),THREE.Shape.Utils.b3(H,v,y,x,m)}return{offset:w.ha*i,path:n}}}},THREE.FontUtils.generateShapes=function(e,t){var i=void 0!==(t=t||{}).size?t.size:100,r=void 0!==t.curveSegments?t.curveSegments:4,n=void 0!==t.font?t.font:"helvetiker",o=void 0!==t.weight?t.weight:"normal",a=void 0!==t.style?t.style:"normal";THREE.FontUtils.size=i,THREE.FontUtils.divisions=r,THREE.FontUtils.face=n,THREE.FontUtils.weight=o,THREE.FontUtils.style=a;for(var s=THREE.FontUtils.drawText(e).paths,l=[],h=0,c=s.length;h<c;h++)Array.prototype.push.apply(l,s[h].toShapes());return l},function(e){var E=function(e){for(var t=e.length,i=0,r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i},v=function(e,t,i,r,n,o){var a,s,l,h,c,u,p,d,f,m,E,v,g,y,T;if(s=e[o[t]].x,l=e[o[t]].y,h=e[o[i]].x,c=e[o[i]].y,u=e[o[r]].x,(h-s)*((p=e[o[r]].y)-l)-(c-l)*(u-s)<1e-10)return!1;for(m=u-h,E=p-c,v=s-u,g=l-p,y=h-s,T=c-l,a=0;a<n;a++)if(a!==t&&a!==i&&a!==r&&(d=e[o[a]].x,0<=m*((f=e[o[a]].y)-c)-E*(d-h)&&0<=v*(f-p)-g*(d-u)&&0<=y*(f-l)-T*(d-s)))return!1;return!0};e.Triangulate=function(e,t){var i=e.length;if(i<3)return null;var r,n,o,a=[],s=[],l=[];if(0<E(e))for(n=0;n<i;n++)s[n]=n;else for(n=0;n<i;n++)s[n]=i-1-n;var h=i,c=2*h;for(n=h-1;2<h;){if(c--<=0)return console.log("Warning, unable to triangulate polygon!"),t?l:a;if(h<=(r=n)&&(r=0),h<=(n=r+1)&&(n=0),h<=(o=n+1)&&(o=0),v(e,r,n,o,h,s)){var u,p,d,f,m;for(u=s[r],p=s[n],d=s[o],a.push([e[u],e[p],e[d]]),l.push([s[r],s[n],s[o]]),m=(f=n)+1;m<h;f++,m++)s[f]=s[m];c=2*--h}}return t?l:a},e.Triangulate.area=E}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.typeface_js=self._typeface_js,THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPoint(t/e));return i},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPointAt(t/e));return i},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],n=this.getPoint(0),o=0;for(r.push(0),i=1;i<=e;i++)o+=(t=this.getPoint(i/e)).distanceTo(n),r.push(o),n=t;return this.cacheArcLengths=r},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var i,r=this.getLengths(),n=0,o=r.length;i=t||e*r[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=r[n=Math.floor(s+(l-s)/2)]-i)<0)s=n+1;else{if(!(0<a)){l=n;break}l=n-1}if(r[n=l]==i)return n/(o-1);var h=r[n];return(n+(i-h)/(r[n+1]-h))/(o-1)},THREE.Curve.prototype.getTangent=function(e){var t=e-1e-4,i=e+1e-4;t<0&&(t=0),1<i&&(i=1);var r=this.getPoint(t);return this.getPoint(i).clone().sub(r).normalize()},THREE.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},THREE.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t,i;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,i)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t,i;t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),i=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var r=new THREE.Vector2(t,i);return r.normalize(),r},THREE.CubicBezierCurve=function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.getPoint=function(e){var t,i;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,i)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t,i;t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var r=new THREE.Vector2(t,i);return r.normalize(),r},THREE.SplineCurve=function(e){this.points=null==e?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.getPoint=function(e){var t,i,r,n=new THREE.Vector2,o=[],a=this.points;return r=(t=(a.length-1)*e)-(i=Math.floor(t)),o[0]=0==i?i:i-1,o[1]=i,o[2]=i>a.length-2?a.length-1:i+1,o[3]=i>a.length-3?a.length-1:i+2,n.x=THREE.Curve.Utils.interpolate(a[o[0]].x,a[o[1]].x,a[o[2]].x,a[o[3]].x,r),n.y=THREE.Curve.Utils.interpolate(a[o[0]].y,a[o[1]].y,a[o[2]].y,a[o[3]].y,r),n},THREE.EllipseCurve=function(e,t,i,r,n,o,a){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=a},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;this.aClockwise||(e=1-e);var i=this.aStartAngle+e*t,r=this.aX+this.xRadius*Math.cos(i),n=this.aY+this.yRadius*Math.sin(i);return new THREE.Vector2(r,n)},THREE.ArcCurve=function(e,t,i,r,n,o){THREE.EllipseCurve.call(this,e,t,i,i,r,n,o)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,n){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*n},tangentSpline:function(e,t,i,r,n){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,r,n){var o=.5*(i-e),a=.5*(r-t),s=n*n;return(2*t-2*i+o+a)*(n*s)+(-3*t+3*i-2*o-a)*s+o*n+t}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.getPoint=t,e},THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t,i,r;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),r=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,i,r)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},function(e){var t,i,r;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),r=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,i,r)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=null==e?[]:e},function(e){var t,i,r,n=new THREE.Vector3,o=[],a=this.points;r=(t=(a.length-1)*e)-(i=Math.floor(t)),o[0]=0==i?i:i-1,o[1]=i,o[2]=i>a.length-2?a.length-1:i+1,o[3]=i>a.length-3?a.length-1:i+2;var s=a[o[0]],l=a[o[1]],h=a[o[2]],c=a[o[3]];return n.x=THREE.Curve.Utils.interpolate(s.x,l.x,h.x,c.x,r),n.y=THREE.Curve.Utils.interpolate(s.y,l.y,h.y,c.y,r),n.z=THREE.Curve.Utils.interpolate(s.z,l.z,h.z,c.z,r),n}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=null==e?[]:e},function(e){var t,i,r,n=new THREE.Vector3,o=[],a=this.points;return r=(t=(a.length-0)*e)-(i=Math.floor(t)),i+=0<i?0:(Math.floor(Math.abs(i)/a.length)+1)*a.length,o[0]=(i-1)%a.length,o[1]=i%a.length,o[2]=(i+1)%a.length,o[3]=(i+2)%a.length,n.x=THREE.Curve.Utils.interpolate(a[o[0]].x,a[o[1]].x,a[o[2]].x,a[o[3]].x,r),n.y=THREE.Curve.Utils.interpolate(a[o[0]].y,a[o[1]].y,a[o[2]].y,a[o[3]].y,r),n.z=THREE.Curve.Utils.interpolate(a[o[0]].z,a[o[1]].z,a[o[2]].z,a[o[3]].z,r),n}),THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t,i=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=i){var o=1-(r[n]-i)/(t=this.curves[n]).getLength();return t.getPointAt(o)}n++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,r=this.curves.length;for(e=0;e<r;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t},THREE.CurvePath.prototype.getBoundingBox=function(){var e,t,i,r,n,o,a,s,l,h,c=this.getPoints();e=t=Number.NEGATIVE_INFINITY,r=n=Number.POSITIVE_INFINITY;var u=c[0]instanceof THREE.Vector3;for(h=u?new THREE.Vector3:new THREE.Vector2,s=0,l=c.length;s<l;s++)(a=c[s]).x>e?e=a.x:a.x<r&&(r=a.x),a.y>t?t=a.y:a.y<n&&(n=a.y),u&&(a.z>i?i=a.z:a.z<o&&(o=a.z)),h.add(a);var p={minX:r,minY:n,maxX:e,maxY:t,centroid:h.divideScalar(l)};return u&&(p.maxZ=i,p.minZ=o),p},THREE.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,i=0;i<e.length;i++)t.vertices.push(new THREE.Vector3(e[i].x,e[i].y,e[i].z||0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var i,r,n=this.getPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)n=this.getWrapPoints(n,t[i]);return n},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,r,n=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)n=this.getWrapPoints(n,t[i]);return n},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var i,r,n,o,a,s,l=this.getBoundingBox();for(i=0,r=e.length;i<r;i++){o=(n=e[i]).x,a=n.y,s=o/l.maxX,s=t.getUtoTmapping(s,o);var h=t.getPoint(s),c=t.getNormalVector(s).multiplyScalar(a);n.x=h.x+c.x,n.y=h.y+c.y}return e},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.makeFromPositionQuaternionScale(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),e=!(this.matrixWorldNeedsUpdate=!1));for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(e,t){var i=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:i})},THREE.Path.prototype.lineTo=function(e,t){var i=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,n=r[r.length-2],o=r[r.length-1],a=new THREE.LineCurve(new THREE.Vector2(n,o),new THREE.Vector2(e,t));this.curves.push(a),this.actions.push({action:THREE.PathActions.LINE_TO,args:i})},THREE.Path.prototype.quadraticCurveTo=function(e,t,i,r){var n=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,a=o[o.length-2],s=o[o.length-1],l=new THREE.QuadraticBezierCurve(new THREE.Vector2(a,s),new THREE.Vector2(e,t),new THREE.Vector2(i,r));this.curves.push(l),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:n})},THREE.Path.prototype.bezierCurveTo=function(e,t,i,r,n,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,l=s[s.length-2],h=s[s.length-1],c=new THREE.CubicBezierCurve(new THREE.Vector2(l,h),new THREE.Vector2(e,t),new THREE.Vector2(i,r),new THREE.Vector2(n,o));this.curves.push(c),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:a})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,r=i[i.length-2],n=i[i.length-1],o=[new THREE.Vector2(r,n)];Array.prototype.push.apply(o,e);var a=new THREE.SplineCurve(o);this.curves.push(a),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,i,r,n,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],l=a[a.length-1];this.absarc(e+s,t+l,i,r,n,o)},THREE.Path.prototype.absarc=function(e,t,i,r,n,o){this.absellipse(e,t,i,i,r,n,o)},THREE.Path.prototype.ellipse=function(e,t,i,r,n,o,a){var s=this.actions[this.actions.length-1].args,l=s[s.length-2],h=s[s.length-1];this.absellipse(e+l,t+h,i,r,n,o,a)},THREE.Path.prototype.absellipse=function(e,t,i,r,n,o,a){var s=Array.prototype.slice.call(arguments),l=new THREE.EllipseCurve(e,t,i,r,n,o,a);this.curves.push(l);var h=l.getPoint(a?1:0);s.push(h.x),s.push(h.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:s})},THREE.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var i=[],r=0;r<e;r++)i.push(this.getPoint(r/e));return i},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var i,r,n,o,a,s,l,h,c,u,p,d,f,m,E,v,g,y,T=[];for(i=0,r=this.actions.length;i<r;i++)switch(o=(n=this.actions[i]).action,a=n.args,o){case THREE.PathActions.MOVE_TO:case THREE.PathActions.LINE_TO:T.push(new THREE.Vector2(a[0],a[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(s=a[2],l=a[3],u=a[0],p=a[1],0<T.length?(d=(m=T[T.length-1]).x,f=m.y):(d=(m=this.actions[i-1].args)[m.length-2],f=m[m.length-1]),E=1;E<=e;E++)v=E/e,g=THREE.Shape.Utils.b2(v,d,u,s),y=THREE.Shape.Utils.b2(v,f,p,l),T.push(new THREE.Vector2(g,y));break;case THREE.PathActions.BEZIER_CURVE_TO:for(s=a[4],l=a[5],u=a[0],p=a[1],h=a[2],c=a[3],0<T.length?(d=(m=T[T.length-1]).x,f=m.y):(d=(m=this.actions[i-1].args)[m.length-2],f=m[m.length-1]),E=1;E<=e;E++)v=E/e,g=THREE.Shape.Utils.b3(v,d,u,h,s),y=THREE.Shape.Utils.b3(v,f,p,c,l),T.push(new THREE.Vector2(g,y));break;case THREE.PathActions.CSPLINE_THRU:m=this.actions[i-1].args;var x=[new THREE.Vector2(m[m.length-2],m[m.length-1])],b=e*a[0].length;x=x.concat(a[0]);var R=new THREE.SplineCurve(x);for(E=1;E<=b;E++)T.push(R.getPointAt(E/b));break;case THREE.PathActions.ARC:var w=a[0],H=a[1],_=a[2],S=a[3],M=a[4],C=!!a[5],A=M-S,L=2*e;for(E=1;E<=L;E++)v=E/L,C||(v=1-v),P=S+v*A,g=w+_*Math.cos(P),y=H+_*Math.sin(P),T.push(new THREE.Vector2(g,y));break;case THREE.PathActions.ELLIPSE:w=a[0],H=a[1];var P,D=a[2],F=a[3];S=a[4],M=a[5],C=!!a[6],A=M-S,L=2*e;for(E=1;E<=L;E++)v=E/L,C||(v=1-v),P=S+v*A,g=w+D*Math.cos(P),y=H+F*Math.sin(P),T.push(new THREE.Vector2(g,y))}var N=T[T.length-1];return Math.abs(N.x-T[0].x)<1e-10&&Math.abs(N.y-T[0].y)<1e-10&&T.splice(T.length-1,1),t&&T.push(T[0]),T},THREE.Path.prototype.toShapes=function(){var e,t,i,r,n,o=[],a=new THREE.Path;for(e=0,t=this.actions.length;e<t;e++)n=(i=this.actions[e]).args,(r=i.action)==THREE.PathActions.MOVE_TO&&0!=a.actions.length&&(o.push(a),a=new THREE.Path),a[r].apply(a,n);if(0!=a.actions.length&&o.push(a),0==o.length)return[];var s,l,h=[],c=!THREE.Shape.Utils.isClockWise(o[0].getPoints());if(1==o.length)return s=o[0],(l=new THREE.Shape).actions=s.actions,l.curves=s.curves,h.push(l),h;if(c)for(l=new THREE.Shape,e=0,t=o.length;e<t;e++)s=o[e],THREE.Shape.Utils.isClockWise(s.getPoints())?(l.actions=s.actions,l.curves=s.curves,h.push(l),l=new THREE.Shape):l.holes.push(s);else{for(e=0,t=o.length;e<t;e++)s=o[e],THREE.Shape.Utils.isClockWise(s.getPoints())?(l&&h.push(l),(l=new THREE.Shape).actions=s.actions,l.curves=s.curves):l.holes.push(s);h.push(l)}return h},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.makeGeometry=function(e){return new THREE.ShapeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={removeHoles:function(e,t){var i,r,n,o,a,s,l,h,c,u,p,d,f,m,E,v,g=e.concat(),y=g.concat(),T=[];for(a=0;a<t.length;a++){for(l=t[a],Array.prototype.push.apply(y,l),h=Number.POSITIVE_INFINITY,s=0;s<l.length;s++){p=l[s];var x=[];for(u=0;u<g.length;u++)d=g[u],c=p.distanceToSquared(d),x.push(c),c<h&&(h=c,n=s,o=u)}i=0<=o-1?o-1:g.length-1,r=0<=n-1?n-1:l.length-1;var b=[l[n],g[o],g[i]],R=THREE.FontUtils.Triangulate.area(b),w=[l[n],l[r],g[o]],H=THREE.FontUtils.Triangulate.area(w),_=o,S=n;n+=-1,(o+=1)<0&&(o+=g.length),o%=g.length,n<0&&(n+=l.length),n%=l.length,i=0<=o-1?o-1:g.length-1,r=0<=n-1?n-1:l.length-1,b=[l[n],g[o],g[i]];var M=THREE.FontUtils.Triangulate.area(b);w=[l[n],l[r],g[o]],M+THREE.FontUtils.Triangulate.area(w)<R+H&&(n=S,(o=_)<0&&(o+=g.length),o%=g.length,n<0&&(n+=l.length),n%=l.length,i=0<=o-1?o-1:g.length-1,r=0<=n-1?n-1:l.length-1),f=g.slice(0,o),m=g.slice(o),E=l.slice(n),v=l.slice(0,n);var C=[l[n],g[o],g[i]],A=[l[n],l[r],g[o]];T.push(C),T.push(A),g=f.concat(E).concat(v).concat(m)}return{shape:g,isolatedPts:T,allpoints:y}},triangulateShape:function(e,t){var i,r,n,o,a,s,l=THREE.Shape.Utils.removeHoles(e,t),h=l.shape,c=l.allpoints,u=l.isolatedPts,p=THREE.FontUtils.Triangulate(h,!1),d={};for(i=0,r=c.length;i<r;i++)void 0!==d[a=c[i].x+":"+c[i].y]&&console.log("Duplicate point",a),d[a]=i;for(i=0,r=p.length;i<r;i++)for(o=p[i],n=0;n<3;n++)void 0!==(s=d[a=o[n].x+":"+o[n].y])&&(o[n]=s);for(i=0,r=u.length;i<r;i++)for(o=u[i],n=0;n<3;n++)void 0!==(s=d[a=o[n].x+":"+o[n].y])&&(o[n]=s);return p.concat(u)},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,n){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,n)}},THREE.AnimationHandler=function(){var i=[],t={},e={update:function(e){for(var t=0;t<i.length;t++)i[t].update(e)},addToUpdate:function(e){-1===i.indexOf(e)&&i.push(e)},removeFromUpdate:function(e){var t=i.indexOf(e);-1!==t&&i.splice(t,1)},add:function(e){void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,n(e)},get:function(e){if("string"==typeof e)return t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var i=0;i<e.bones.length;i++)t.push(e.bones[i]);else r(e,t);return t}},r=function(e,t){t.push(e);for(var i=0;i<e.children.length;i++)r(e.children[i],t)},n=function(e){if(!0!==e.initialized){for(var t=0;t<e.hierarchy.length;t++){for(var i=0;i<e.hierarchy[t].keys.length;i++)if(e.hierarchy[t].keys[i].time<0&&(e.hierarchy[t].keys[i].time=0),void 0!==e.hierarchy[t].keys[i].rot&&!(e.hierarchy[t].keys[i].rot instanceof THREE.Quaternion)){var r=e.hierarchy[t].keys[i].rot;e.hierarchy[t].keys[i].rot=new THREE.Quaternion(r[0],r[1],r[2],r[3])}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){var n={};for(i=0;i<e.hierarchy[t].keys.length;i++)for(var o=0;o<e.hierarchy[t].keys[i].morphTargets.length;o++){n[s=e.hierarchy[t].keys[i].morphTargets[o]]=-1}e.hierarchy[t].usedMorphTargets=n;for(i=0;i<e.hierarchy[t].keys.length;i++){var a={};for(var s in n){for(o=0;o<e.hierarchy[t].keys[i].morphTargets.length;o++)if(e.hierarchy[t].keys[i].morphTargets[o]===s){a[s]=e.hierarchy[t].keys[i].morphTargetsInfluences[o];break}o===e.hierarchy[t].keys[i].morphTargets.length&&(a[s]=0)}e.hierarchy[t].keys[i].morphTargetsInfluences=a}}for(i=1;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].time===e.hierarchy[t].keys[i-1].time&&(e.hierarchy[t].keys.splice(i,1),i--);for(i=0;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].index=i}var l=parseInt(e.length*e.fps,10);e.JIT={},e.JIT.hierarchy=[];for(t=0;t<e.hierarchy.length;t++)e.JIT.hierarchy.push(new Array(l));e.initialized=!0}};return e.LINEAR=0,e.CATMULLROM=1,e.CATMULLROM_FORWARD=2,e}(),THREE.Animation=function(e,t,i){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=void 0!==i?i:THREE.AnimationHandler.LINEAR,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(e,t){if(!1===this.isPlaying){this.isPlaying=!0,this.loop=void 0===e||e,this.currentTime=void 0!==t?t:0;var i,r,n=this.hierarchy.length;for(i=0;i<n;i++){r=this.hierarchy[i],this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD&&(r.useQuaternion=!0),r.matrixAutoUpdate=!0,void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey={pos:0,rot:0,scl:0},r.animationCache.nextKey={pos:0,rot:0,scl:0},r.animationCache.originalMatrix=r instanceof THREE.Bone?r.skinMatrix:r.matrix);var o=r.animationCache.prevKey,a=r.animationCache.nextKey;o.pos=this.data.hierarchy[i].keys[0],o.rot=this.data.hierarchy[i].keys[0],o.scl=this.data.hierarchy[i].keys[0],a.pos=this.getNextKeyWith("pos",i,1),a.rot=this.getNextKeyWith("rot",i,1),a.scl=this.getNextKeyWith("scl",i,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){!0===this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,THREE.AnimationHandler.removeFromUpdate(this)},THREE.Animation.prototype.update=function(e){if(!1!==this.isPlaying){var t,i,r,n,o,a,s,l,h,c,u,p,d,f,m=["pos","rot","scl"];this.data.JIT.hierarchy;this.currentTime+=e*this.timeScale,u=this.currentTime,c=this.currentTime=this.currentTime%this.data.length,parseInt(Math.min(c*this.data.fps,this.data.length*this.data.fps),10);for(var E=0,v=this.hierarchy.length;E<v;E++){h=(l=this.hierarchy[E]).animationCache;for(var g=0;g<3;g++){if(t=m[g],a=h.prevKey[t],(s=h.nextKey[t]).time<=u){if(c<u){if(!this.loop)return void this.stop();for(a=this.data.hierarchy[E].keys[0],s=this.getNextKeyWith(t,E,1);s.time<c;)a=s,s=this.getNextKeyWith(t,E,s.index+1)}else for(;a=s,(s=this.getNextKeyWith(t,E,s.index+1)).time<c;);h.prevKey[t]=a,h.nextKey[t]=s}l.matrixAutoUpdate=!0,l.matrixWorldNeedsUpdate=!0,i=(c-a.time)/(s.time-a.time),n=a[t],o=s[t],(i<0||1<i)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+i+" on bone "+E),i=i<0?0:1),"pos"===t?(r=l.position,this.interpolationType===THREE.AnimationHandler.LINEAR?(r.x=n[0]+(o[0]-n[0])*i,r.y=n[1]+(o[1]-n[1])*i,r.z=n[2]+(o[2]-n[2])*i):this.interpolationType!==THREE.AnimationHandler.CATMULLROM&&this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD||(this.points[0]=this.getPrevKeyWith("pos",E,a.index-1).pos,this.points[1]=n,this.points[2]=o,this.points[3]=this.getNextKeyWith("pos",E,s.index+1).pos,i=.33*i+.33,p=this.interpolateCatmullRom(this.points,i),r.x=p[0],r.y=p[1],r.z=p[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(d=this.interpolateCatmullRom(this.points,1.01*i),this.target.set(d[0],d[1],d[2]),this.target.sub(r),this.target.y=0,this.target.normalize(),f=Math.atan2(this.target.x,this.target.z),l.rotation.set(0,f,0)))):"rot"===t?THREE.Quaternion.slerp(n,o,l.quaternion,i):"scl"===t&&((r=l.scale).x=n[0]+(o[0]-n[0])*i,r.y=n[1]+(o[1]-n[1])*i,r.z=n[2]+(o[2]-n[2])*i)}}}},THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var i,r,n,o,a,s,l,h,c,u=[],p=[];return n=(i=(e.length-1)*t)-(r=Math.floor(i)),u[0]=0===r?r:r-1,u[1]=r,u[2]=r>e.length-2?r:r+1,u[3]=r>e.length-3?r:r+2,s=e[u[0]],l=e[u[1]],h=e[u[2]],c=e[u[3]],a=n*(o=n*n),p[0]=this.interpolate(s[0],l[0],h[0],c[0],n,o,a),p[1]=this.interpolate(s[1],l[1],h[1],c[1],n,o,a),p[2]=this.interpolate(s[2],l[2],h[2],c[2],n,o,a),p},THREE.Animation.prototype.interpolate=function(e,t,i,r,n,o,a){var s=.5*(i-e),l=.5*(r-t);return(2*(t-i)+s+l)*a+(-3*(t-i)-2*s-l)*o+s*n+t},THREE.Animation.prototype.getNextKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i=i<r.length-1?i:r.length-1:i%=r.length;i<r.length;i++)if(void 0!==r[i][e])return r[i];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;for(i=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<i?i:0:0<=i?i:i+r.length;0<=i;i--)if(void 0!==r[i][e])return r[i];return this.data.hierarchy[t].keys[r.length-1]},THREE.KeyFrameAnimation=function(e,t,i){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.JITCompile=void 0===i||i;for(var r=0,n=this.hierarchy.length;r<n;r++){var o=this.data.hierarchy[r].keys,a=this.data.hierarchy[r].sids,s=this.hierarchy[r];if(o.length&&a){for(var l=0;l<a.length;l++){var h=a[l],c=this.getNextKeyWith(h,r,0);c&&c.apply(h)}s.matrixAutoUpdate=!1,this.data.hierarchy[r].node.updateMatrix(),s.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0===e||e,this.currentTime=void 0!==t?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var i,r,n,o=this.hierarchy.length;for(i=0;i<o;i++){r=this.hierarchy[i],n=this.data.hierarchy[i],r.useQuaternion=!0,void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey=null,n.animationCache.nextKey=null,n.animationCache.originalMatrix=r instanceof THREE.Bone?r.skinMatrix:r.matrix);var a=this.data.hierarchy[i].keys;a.length&&(n.animationCache.prevKey=a[0],n.animationCache.nextKey=a[1],this.startTime=Math.min(a[0].time,this.startTime),this.endTime=Math.max(a[a.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],i=this.data.hierarchy[e];if(void 0!==i.animationCache){var r=i.animationCache.originalMatrix;t instanceof THREE.Bone?(r.copy(t.skinMatrix),t.skinMatrix=r):(r.copy(t.matrix),t.matrix=r),delete i.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,i,r,n,o,a,s,l,h=this.data.JIT.hierarchy;if(this.currentTime+=e*this.timeScale,s=this.currentTime,(a=this.currentTime=this.currentTime%this.data.length)<this.startTimeMs&&(a=this.currentTime=this.startTimeMs+a),o=parseInt(Math.min(a*this.data.fps,this.data.length*this.data.fps),10),!(l=a<s)||this.loop){if(!(a<this.startTime)){for(p=0,d=this.hierarchy.length;p<d;p++){r=this.hierarchy[p];f=(n=this.data.hierarchy[p]).keys;var c=n.animationCache;if(this.JITCompile&&void 0!==h[p][o])r instanceof THREE.Bone?(r.skinMatrix=h[p][o],r.matrixWorldNeedsUpdate=!1):(r.matrix=h[p][o],r.matrixWorldNeedsUpdate=!0);else if(f.length){if(this.JITCompile&&c&&(r instanceof THREE.Bone?r.skinMatrix=c.originalMatrix:r.matrix=c.originalMatrix),t=c.prevKey,i=c.nextKey,t&&i){if(i.time<=s){if(l&&this.loop)for(t=f[0],i=f[1];i.time<a;)i=f[(t=i).index+1];else if(!l)for(var u=f.length-1;i.time<a&&i.index!==u;)i=f[(t=i).index+1];c.prevKey=t,c.nextKey=i}i.time>=a?t.interpolate(i,a):t.interpolate(i,i.time)}this.data.hierarchy[p].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===h[0][o]){this.hierarchy[0].updateMatrixWorld(!0);for(p=0;p<this.hierarchy.length;p++)this.hierarchy[p]instanceof THREE.Bone?h[p][o]=this.hierarchy[p].skinMatrix.clone():h[p][o]=this.hierarchy[p].matrix.clone()}}}else{for(var p=0,d=this.hierarchy.length;p<d;p++){var f=this.data.hierarchy[p].keys,m=this.data.hierarchy[p].sids,E=f.length-1,v=this.hierarchy[p];if(f.length){for(var g=0;g<m.length;g++){var y=m[g],T=this.getPrevKeyWith(y,p,E);T&&T.apply(y)}this.data.hierarchy[p].node.updateMatrix(),v.matrixWorldNeedsUpdate=!0}}this.stop()}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;for(i%=r.length;i<r.length;i++)if(r[i].hasTarget(e))return r[i];return r[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;for(i=0<=i?i:i+r.length;0<=i;i--)if(r[i].hasTarget(e))return r[i];return r[r.length-1]},THREE.CubeCamera=function(e,t,i){THREE.Object3D.call(this);var n=new THREE.PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new THREE.Vector3(1,0,0)),this.add(n);var o=new THREE.PerspectiveCamera(90,1,e,t);o.up.set(0,-1,0),o.lookAt(new THREE.Vector3(-1,0,0)),this.add(o);var a=new THREE.PerspectiveCamera(90,1,e,t);a.up.set(0,0,1),a.lookAt(new THREE.Vector3(0,1,0)),this.add(a);var s=new THREE.PerspectiveCamera(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new THREE.Vector3(0,-1,0)),this.add(s);var l=new THREE.PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new THREE.Vector3(0,0,1)),this.add(l);var h=new THREE.PerspectiveCamera(90,1,e,t);h.up.set(0,-1,0),h.lookAt(new THREE.Vector3(0,0,-1)),this.add(h),this.renderTarget=new THREE.WebGLRenderTargetCube(i,i,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var i=this.renderTarget,r=i.generateMipmaps;i.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,n,i),i.activeCubeFace=1,e.render(t,o,i),i.activeCubeFace=2,e.render(t,a,i),i.activeCubeFace=3,e.render(t,s,i),i.activeCubeFace=4,e.render(t,l,i),i.generateMipmaps=r,i.activeCubeFace=5,e.render(t,h,i)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CombinedCamera=function(e,t,i,r,n,o,a){THREE.Camera.call(this),this.fov=i,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,a),this.cameraP=new THREE.PerspectiveCamera(i,e/t,r,n),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov,t=this.cameraP.aspect,i=(this.cameraP.near+this.cameraP.far)/2,r=Math.tan(e/2)*i,n=2*r*t/2;r/=this.zoom,n/=this.zoom,this.cameraO.left=-n,this.cameraO.right=n,this.cameraO.top=r,this.cameraO.bottom=-r,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var i=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(i),i},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CircleGeometry=function(e,t,i,r){THREE.Geometry.call(this),e=e||50,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,t=void 0!==t?Math.max(3,t):8;var n,o=[],a=new THREE.Vector3,s=new THREE.Vector2(.5,.5);for(this.vertices.push(a),o.push(s),n=0;n<=t;n++){var l=new THREE.Vector3,h=i+n/t*r;l.x=e*Math.cos(h),l.y=e*Math.sin(h),this.vertices.push(l),o.push(new THREE.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var c=new THREE.Vector3(0,0,1);for(n=1;n<=t;n++){var u=n,p=n+1;this.faces.push(new THREE.Face3(u,p,0,[c,c,c])),this.faceVertexUvs[0].push([o[n],o[n+1],s])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CubeGeometry=function(e,t,i,r,n,o){THREE.Geometry.call(this);var S=this;this.width=e,this.height=t,this.depth=i,this.widthSegments=r||1,this.heightSegments=n||1,this.depthSegments=o||1;var a=this.width/2,s=this.height/2,l=this.depth/2;function h(e,t,i,r,n,o,a,s){var l,h,c,u=S.widthSegments,p=S.heightSegments,d=n/2,f=o/2,m=S.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?l="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(l="y",p=S.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(l="x",u=S.depthSegments);var E=u+1,v=p+1,g=n/u,y=o/p,T=new THREE.Vector3;for(T[l]=0<a?1:-1,c=0;c<v;c++)for(h=0;h<E;h++){var x=new THREE.Vector3;x[e]=(h*g-d)*i,x[t]=(c*y-f)*r,x[l]=a,S.vertices.push(x)}for(c=0;c<p;c++)for(h=0;h<u;h++){var b=h+E*c,R=h+E*(c+1),w=h+1+E*(c+1),H=h+1+E*c,_=new THREE.Face4(b+m,R+m,w+m,H+m);_.normal.copy(T),_.vertexNormals.push(T.clone(),T.clone(),T.clone(),T.clone()),_.materialIndex=s,S.faces.push(_),S.faceVertexUvs[0].push([new THREE.Vector2(h/u,1-c/p),new THREE.Vector2(h/u,1-(c+1)/p),new THREE.Vector2((h+1)/u,1-(c+1)/p),new THREE.Vector2((h+1)/u,1-c/p)])}}h("z","y",-1,-1,this.depth,this.height,a,0),h("z","y",1,-1,this.depth,this.height,-a,1),h("x","z",1,1,this.width,this.depth,s,2),h("x","z",1,-1,this.width,this.depth,-s,3),h("x","y",1,-1,this.width,this.height,l,4),h("x","y",-1,-1,this.width,this.height,-l,5),this.computeCentroids(),this.mergeVertices()},THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CylinderGeometry=function(e,t,i,r,n,o){THREE.Geometry.call(this),this.radiusTop=e=void 0!==e?e:20,this.radiusBottom=t=void 0!==t?t:20,this.height=i=void 0!==i?i:100,this.radiusSegments=r=r||8,this.heightSegments=n=n||1,this.openEnded=o=void 0!==o&&o;var a,s,l=i/2,h=[],c=[];for(s=0;s<=n;s++){var u=[],p=[],d=s/n,f=d*(t-e)+e;for(a=0;a<=r;a++){var m=a/r,E=new THREE.Vector3;E.x=f*Math.sin(m*Math.PI*2),E.y=-d*i+l,E.z=f*Math.cos(m*Math.PI*2),this.vertices.push(E),u.push(this.vertices.length-1),p.push(new THREE.Vector2(m,1-d))}h.push(u),c.push(p)}var v,g,y=(t-e)/i;for(a=0;a<r;a++)for(0!==e?(v=this.vertices[h[0][a]].clone(),g=this.vertices[h[0][a+1]].clone()):(v=this.vertices[h[1][a]].clone(),g=this.vertices[h[1][a+1]].clone()),v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*y).normalize(),g.setY(Math.sqrt(g.x*g.x+g.z*g.z)*y).normalize(),s=0;s<n;s++){var T=h[s][a],x=h[s+1][a],b=h[s+1][a+1],R=h[s][a+1],w=v.clone(),H=v.clone(),_=g.clone(),S=g.clone(),M=c[s][a].clone(),C=c[s+1][a].clone(),A=c[s+1][a+1].clone(),L=c[s][a+1].clone();this.faces.push(new THREE.Face4(T,x,b,R,[w,H,_,S])),this.faceVertexUvs[0].push([M,C,A,L])}if(!1===o&&0<e)for(this.vertices.push(new THREE.Vector3(0,l,0)),a=0;a<r;a++){T=h[0][a],x=h[0][a+1],b=this.vertices.length-1,w=new THREE.Vector3(0,1,0),H=new THREE.Vector3(0,1,0),_=new THREE.Vector3(0,1,0),M=c[0][a].clone(),C=c[0][a+1].clone(),A=new THREE.Vector2(C.u,0);this.faces.push(new THREE.Face3(T,x,b,[w,H,_])),this.faceVertexUvs[0].push([M,C,A])}if(!1===o&&0<t)for(this.vertices.push(new THREE.Vector3(0,-l,0)),a=0;a<r;a++){T=h[s][a+1],x=h[s][a],b=this.vertices.length-1,w=new THREE.Vector3(0,-1,0),H=new THREE.Vector3(0,-1,0),_=new THREE.Vector3(0,-1,0),M=c[s][a+1].clone(),C=c[s][a].clone(),A=new THREE.Vector2(C.u,1);this.faces.push(new THREE.Face3(T,x,b,[w,H,_])),this.faceVertexUvs[0].push([M,C,A])}this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry=function(e,t){void 0!==e?(THREE.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()):e=[]},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,r=0;r<i;r++){var n=e[r];this.addShape(n,t)}},THREE.ExtrudeGeometry.prototype.addShape=function(c,u){var e,t,i,r,n,o,a,s,l=void 0!==u.amount?u.amount:100,h=void 0!==u.bevelThickness?u.bevelThickness:6,p=void 0!==u.bevelSize?u.bevelSize:h-2,d=void 0!==u.bevelSegments?u.bevelSegments:3,f=void 0===u.bevelEnabled||u.bevelEnabled,m=void 0!==u.curveSegments?u.curveSegments:12,E=void 0!==u.steps?u.steps:1,v=u.extrudePath,g=!1,y=u.material,T=u.extrudeMaterial,x=void 0!==u.UVGenerator?u.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;this.shapebb;v&&(e=v.getSpacedPoints(E),f=!(g=!0),t=void 0!==u.frames?u.frames:new THREE.TubeGeometry.FrenetFrames(v,E,!1),i=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Vector3),f||(p=h=d=0);var b=this,R=this.vertices.length,w=c.extractPoints(m),H=w.shape,_=w.holes,S=!THREE.Shape.Utils.isClockWise(H);if(S){for(H=H.reverse(),a=0,s=_.length;a<s;a++)o=_[a],THREE.Shape.Utils.isClockWise(o)&&(_[a]=o.reverse());S=!1}var M=THREE.Shape.Utils.triangulateShape(H,_),C=H;for(a=0,s=_.length;a<s;a++)o=_[a],H=H.concat(o);function A(e,t,i){return t||console.log("die"),t.clone().multiplyScalar(i).add(e)}var L,P,D,F,N,U,B=H.length,k=M.length;C.length,Math.PI;function z(e,t,i){return function(e,t,i){var r,n,o,a,s,l=THREE.ExtrudeGeometry.__v1,h=THREE.ExtrudeGeometry.__v2,c=THREE.ExtrudeGeometry.__v3,u=THREE.ExtrudeGeometry.__v4,p=THREE.ExtrudeGeometry.__v5,d=THREE.ExtrudeGeometry.__v6;if(l.set(e.x-t.x,e.y-t.y),h.set(e.x-i.x,e.y-i.y),r=l.normalize(),n=h.normalize(),c.set(-r.y,r.x),u.set(n.y,-n.x),p.copy(e).add(c),d.copy(e).add(u),p.equals(d))return u.clone();p.copy(t).add(c),d.copy(i).add(u),o=r.dot(u),a=d.sub(p).dot(u),0===o&&(console.log("Either infinite or no solutions!"),0===a?console.log("Its finite solutions."):console.log("Too bad, no solutions."));if((s=a/o)<0)return function(e,t,i){var r=Math.atan2(t.y-e.y,t.x-e.x),n=Math.atan2(i.y-e.y,i.x-e.x);n<r&&(n+=2*Math.PI);var o=(r+n)/2,a=-Math.cos(o),s=-Math.sin(o);return new THREE.Vector2(a,s)}(e,t,i);return r.multiplyScalar(s).add(p).sub(e).clone()}(e,t,i)}for(var V=[],I=0,O=C.length,j=O-1,G=I+1;I<O;I++,j++,G++){j===O&&(j=0),G===O&&(G=0);C[I],C[j],C[G];V[I]=z(C[I],C[j],C[G])}var W,q,X=[],Y=V.concat();for(a=0,s=_.length;a<s;a++){for(o=_[a],W=[],I=0,j=(O=o.length)-1,G=I+1;I<O;I++,j++,G++)j===O&&(j=0),G===O&&(G=0),W[I]=z(o[I],o[j],o[G]);X.push(W),Y=Y.concat(W)}for(L=0;L<d;L++){for(F=h*(1-(D=L/d)),P=p*Math.sin(D*Math.PI/2),I=0,O=C.length;I<O;I++)$((N=A(C[I],V[I],P)).x,N.y,-F);for(a=0,s=_.length;a<s;a++)for(o=_[a],W=X[a],I=0,O=o.length;I<O;I++)$((N=A(o[I],W[I],P)).x,N.y,-F)}for(P=p,I=0;I<B;I++)N=f?A(H[I],Y[I],P):H[I],g?(r.copy(t.normals[0]).multiplyScalar(N.x),i.copy(t.binormals[0]).multiplyScalar(N.y),n.copy(e[0]).add(r).add(i),$(n.x,n.y,n.z)):$(N.x,N.y,0);for(q=1;q<=E;q++)for(I=0;I<B;I++)N=f?A(H[I],Y[I],P):H[I],g?(r.copy(t.normals[q]).multiplyScalar(N.x),i.copy(t.binormals[q]).multiplyScalar(N.y),n.copy(e[q]).add(r).add(i),$(n.x,n.y,n.z)):$(N.x,N.y,l/E*q);for(L=d-1;0<=L;L--){for(F=h*(1-(D=L/d)),P=p*Math.sin(D*Math.PI/2),I=0,O=C.length;I<O;I++)$((N=A(C[I],V[I],P)).x,N.y,l+F);for(a=0,s=_.length;a<s;a++)for(o=_[a],W=X[a],I=0,O=o.length;I<O;I++)N=A(o[I],W[I],P),g?$(N.x,N.y+e[E-1].y,e[E-1].x+F):$(N.x,N.y,l+F)}function K(e,t){var i,r;for(I=e.length;0<=--I;){(r=(i=I)-1)<0&&(r=e.length-1);var n=0,o=E+2*d;for(n=0;n<o;n++){var a=B*n,s=B*(n+1);Z(t+i+a,t+r+a,t+r+s,t+i+s,e,n,o,i,r)}}}function $(e,t,i){b.vertices.push(new THREE.Vector3(e,t,i))}function Q(e,t,i,r){e+=R,t+=R,i+=R,b.faces.push(new THREE.Face3(e,t,i,null,null,y));var n=r?x.generateBottomUV(b,c,u,e,t,i):x.generateTopUV(b,c,u,e,t,i);b.faceVertexUvs[0].push(n)}function Z(e,t,i,r,n,o,a,s,l){e+=R,t+=R,i+=R,r+=R,b.faces.push(new THREE.Face4(e,t,i,r,null,null,T));var h=x.generateSideWallUV(b,c,n,u,e,t,i,r,o,a,s,l);b.faceVertexUvs[0].push(h)}!function(){if(f){var e=0,t=B*e;for(I=0;I<k;I++)Q((U=M[I])[2]+t,U[1]+t,U[0]+t,!0);for(t=B*(e=E+2*d),I=0;I<k;I++)Q((U=M[I])[0]+t,U[1]+t,U[2]+t,!1)}else{for(I=0;I<k;I++)Q((U=M[I])[2],U[1],U[0],!0);for(I=0;I<k;I++)Q((U=M[I])[0]+B*E,U[1]+B*E,U[2]+B*E,!1)}}(),function(){var e=0;for(K(C,e),e+=C.length,a=0,s=_.length;a<s;a++)K(o=_[a],e),e+=o.length}()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,r,n,o){var a=e.vertices[r].x,s=e.vertices[r].y,l=e.vertices[n].x,h=e.vertices[n].y,c=e.vertices[o].x,u=e.vertices[o].y;return[new THREE.Vector2(a,s),new THREE.Vector2(l,h),new THREE.Vector2(c,u)]},generateBottomUV:function(e,t,i,r,n,o){return this.generateTopUV(e,t,i,r,n,o)},generateSideWallUV:function(e,t,i,r,n,o,a,s,l,h,c,u){var p=e.vertices[n].x,d=e.vertices[n].y,f=e.vertices[n].z,m=e.vertices[o].x,E=e.vertices[o].y,v=e.vertices[o].z,g=e.vertices[a].x,y=e.vertices[a].y,T=e.vertices[a].z,x=e.vertices[s].x,b=e.vertices[s].y,R=e.vertices[s].z;return Math.abs(d-E)<.01?[new THREE.Vector2(p,1-f),new THREE.Vector2(m,1-v),new THREE.Vector2(g,1-T),new THREE.Vector2(x,1-R)]:[new THREE.Vector2(d,1-f),new THREE.Vector2(E,1-v),new THREE.Vector2(y,1-T),new THREE.Vector2(b,1-R)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),e instanceof Array==!1&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,r=e.length;i<r;i++)this.addShape(e[i],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var i,r,n,o=void 0!==t.curveSegments?t.curveSegments:12,a=t.material,s=void 0===t.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=(this.shapebb,this.vertices.length),h=e.extractPoints(o),c=h.shape,u=h.holes,p=!THREE.Shape.Utils.isClockWise(c);if(p){for(c=c.reverse(),i=0,r=u.length;i<r;i++)n=u[i],THREE.Shape.Utils.isClockWise(n)&&(u[i]=n.reverse());p=!1}var d=THREE.Shape.Utils.triangulateShape(c,u),f=c;for(i=0,r=u.length;i<r;i++)n=u[i],c=c.concat(n);var m,E,v=c.length,g=d.length;f.length;for(i=0;i<v;i++)m=c[i],this.vertices.push(new THREE.Vector3(m.x,m.y,0));for(i=0;i<g;i++){var y=(E=d[i])[0]+l,T=E[1]+l,x=E[2]+l;this.faces.push(new THREE.Face3(y,T,x,null,null,a)),this.faceVertexUvs[0].push(s.generateBottomUV(this,e,t,y,T,x))}},THREE.LatheGeometry=function(e,t,i,r){THREE.Geometry.call(this),t=t||12,i=i||0,r=r||2*Math.PI;for(var n=1/(e.length-1),o=1/t,a=0,s=t;a<=s;a++)for(var l=i+a*o*r,h=Math.cos(l),c=Math.sin(l),u=0,p=e.length;u<p;u++){var d=e[u],f=new THREE.Vector3;f.x=h*d.x-c*d.y,f.y=c*d.x+h*d.y,f.z=d.z,this.vertices.push(f)}var m=e.length;for(a=0,s=t;a<s;a++)for(u=0,p=e.length-1;u<p;u++){var E=u+m*a,v=E,g=E+m,y=(h=E+1+m,E+1);this.faces.push(new THREE.Face4(v,g,h,y));var T=a*o,x=u*n,b=T+o,R=x+n;this.faceVertexUvs[0].push([new THREE.Vector2(T,x),new THREE.Vector2(b,x),new THREE.Vector2(b,R),new THREE.Vector2(T,R)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry=function(e,t,i,r){var n,o;THREE.Geometry.call(this),this.width=e,this.height=t,this.widthSegments=i||1,this.heightSegments=r||1;var a=e/2,s=t/2,l=this.widthSegments,h=this.heightSegments,c=l+1,u=h+1,p=this.width/l,d=this.height/h,f=new THREE.Vector3(0,0,1);for(o=0;o<u;o++)for(n=0;n<c;n++){var m=n*p-a,E=o*d-s;this.vertices.push(new THREE.Vector3(m,-E,0))}for(o=0;o<h;o++)for(n=0;n<l;n++){var v=n+c*o,g=n+c*(o+1),y=n+1+c*(o+1),T=n+1+c*o,x=new THREE.Face4(v,g,y,T);x.normal.copy(f),x.vertexNormals.push(f.clone(),f.clone(),f.clone(),f.clone()),this.faces.push(x),this.faceVertexUvs[0].push([new THREE.Vector2(n/l,1-o/h),new THREE.Vector2(n/l,1-(o+1)/h),new THREE.Vector2((n+1)/l,1-(o+1)/h),new THREE.Vector2((n+1)/l,1-o/h)])}this.computeCentroids()},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry=function(e,t,i,r,n,o){THREE.Geometry.call(this),e=e||0,t=t||50,n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var a,s,l=[],h=e,c=(t-e)/(r=void 0!==r?Math.max(3,r):8);for(a=0;a<=r;a++){for(s=0;s<=i;s++){var u=new THREE.Vector3,p=n+s/i*o;u.x=h*Math.cos(p),u.y=h*Math.sin(p),this.vertices.push(u),l.push(new THREE.Vector2((u.x/h+1)/2,-(u.y/h+1)/2+1))}h+=c}var d=new THREE.Vector3(0,0,1);for(a=0;a<r;a++){var f=a*i;for(s=0;s<=i;s++){var m=(p=s+f)+a,E=p+i+a,v=p+i+1+a;this.faces.push(new THREE.Face3(m,E,v,[d,d,d])),this.faceVertexUvs[0].push([l[m],l[E],l[v]]),m=p+a,E=p+i+1+a,v=p+1+a,this.faces.push(new THREE.Face3(m,E,v,[d,d,d])),this.faceVertexUvs[0].push([l[m],l[E],l[v]])}}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,h)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry=function(e,t,i,r,n,o,a){THREE.Geometry.call(this),this.radius=e=e||50,this.widthSegments=t=Math.max(3,Math.floor(t)||8),this.heightSegments=i=Math.max(2,Math.floor(i)||6),this.phiStart=r=void 0!==r?r:0,this.phiLength=n=void 0!==n?n:2*Math.PI,this.thetaStart=o=void 0!==o?o:0,this.thetaLength=a=void 0!==a?a:Math.PI;var s,l,h=[],c=[];for(l=0;l<=i;l++){var u=[],p=[];for(s=0;s<=t;s++){var d=s/t,f=l/i,m=new THREE.Vector3;m.x=-e*Math.cos(r+d*n)*Math.sin(o+f*a),m.y=e*Math.cos(o+f*a),m.z=e*Math.sin(r+d*n)*Math.sin(o+f*a),this.vertices.push(m),u.push(this.vertices.length-1),p.push(new THREE.Vector2(d,1-f))}h.push(u),c.push(p)}for(l=0;l<this.heightSegments;l++)for(s=0;s<this.widthSegments;s++){var E=h[l][s+1],v=h[l][s],g=h[l+1][s],y=h[l+1][s+1],T=this.vertices[E].clone().normalize(),x=this.vertices[v].clone().normalize(),b=this.vertices[g].clone().normalize(),R=this.vertices[y].clone().normalize(),w=c[l][s+1].clone(),H=c[l][s].clone(),_=c[l+1][s].clone(),S=c[l+1][s+1].clone();Math.abs(this.vertices[E].y)===this.radius?(this.faces.push(new THREE.Face3(E,g,y,[T,b,R])),this.faceVertexUvs[0].push([w,_,S])):Math.abs(this.vertices[g].y)===this.radius?(this.faces.push(new THREE.Face3(E,v,g,[T,x,b])),this.faceVertexUvs[0].push([w,H,_])):(this.faces.push(new THREE.Face4(E,v,g,y,[T,x,b,R])),this.faceVertexUvs[0].push([w,H,_,S]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TextGeometry=function(e,t){t=t||{};var i=THREE.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,i,t)},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TorusGeometry=function(e,t,i,r,n){THREE.Geometry.call(this);this.radius=e||100,this.tube=t||40,this.radialSegments=i||8,this.tubularSegments=r||6,this.arc=n||2*Math.PI;for(var o=new THREE.Vector3,a=[],s=[],l=0;l<=this.radialSegments;l++)for(var h=0;h<=this.tubularSegments;h++){var c=h/this.tubularSegments*this.arc,u=l/this.radialSegments*Math.PI*2;o.x=this.radius*Math.cos(c),o.y=this.radius*Math.sin(c);var p=new THREE.Vector3;p.x=(this.radius+this.tube*Math.cos(u))*Math.cos(c),p.y=(this.radius+this.tube*Math.cos(u))*Math.sin(c),p.z=this.tube*Math.sin(u),this.vertices.push(p),a.push(new THREE.Vector2(h/this.tubularSegments,l/this.radialSegments)),s.push(p.clone().sub(o).normalize())}for(l=1;l<=this.radialSegments;l++)for(h=1;h<=this.tubularSegments;h++){var d=(this.tubularSegments+1)*l+h-1,f=(this.tubularSegments+1)*(l-1)+h-1,m=(this.tubularSegments+1)*(l-1)+h,E=(this.tubularSegments+1)*l+h,v=new THREE.Face4(d,f,m,E,[s[d],s[f],s[m],s[E]]);v.normal.add(s[d]),v.normal.add(s[f]),v.normal.add(s[m]),v.normal.add(s[E]),v.normal.normalize(),this.faces.push(v),this.faceVertexUvs[0].push([a[d].clone(),a[f].clone(),a[m].clone(),a[E].clone()])}this.computeCentroids()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry=function(e,t,i,r,n,o,a){THREE.Geometry.call(this);var s=this;this.radius=e||100,this.tube=t||40,this.radialSegments=i||64,this.tubularSegments=r||8,this.p=n||2,this.q=o||3,this.heightScale=a||1,this.grid=new Array(this.radialSegments);for(var l,h,c,u=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3,f=0;f<this.radialSegments;++f){this.grid[f]=new Array(this.tubularSegments);for(var m=0;m<this.tubularSegments;++m){var E,v,g=f/this.radialSegments*2*this.p*Math.PI,y=m/this.tubularSegments*2*Math.PI,T=P(g,y,this.q,this.p,this.radius,this.heightScale),x=P(g+.01,y,this.q,this.p,this.radius,this.heightScale);u.subVectors(x,T),p.addVectors(x,T),d.crossVectors(u,p),p.crossVectors(d,u),d.normalize(),p.normalize(),E=-this.tube*Math.cos(y),v=this.tube*Math.sin(y),T.x+=E*p.x+v*d.x,T.y+=E*p.y+v*d.y,T.z+=E*p.z+v*d.z,this.grid[f][m]=(l=T.x,h=T.y,c=T.z,s.vertices.push(new THREE.Vector3(l,h,c))-1)}}for(f=0;f<this.radialSegments;++f)for(m=0;m<this.tubularSegments;++m){var b=(f+1)%this.radialSegments,R=(m+1)%this.tubularSegments,w=this.grid[f][m],H=this.grid[b][m],_=this.grid[b][R],S=this.grid[f][R],M=new THREE.Vector2(f/this.radialSegments,m/this.tubularSegments),C=new THREE.Vector2((f+1)/this.radialSegments,m/this.tubularSegments),A=new THREE.Vector2((f+1)/this.radialSegments,(m+1)/this.tubularSegments),L=new THREE.Vector2(f/this.radialSegments,(m+1)/this.tubularSegments);this.faces.push(new THREE.Face4(w,H,_,S)),this.faceVertexUvs[0].push([M,C,A,L])}function P(e,t,i,r,n,o){var a=Math.cos(e),s=(Math.cos(t),Math.sin(e)),l=i/r*e,h=Math.cos(l),c=n*(2+h)*.5*a,u=n*(2+h)*s*.5,p=o*n*Math.sin(l)*.5;return new THREE.Vector3(c,u,p)}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry=function(e,t,i,r,n,o){THREE.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=i||1,this.radiusSegments=r||8,this.closed=n||!1,o&&(this.debug=new THREE.Object3D),this.grid=[];var a,s,l,h,c,u,p,d,f,m,E,v,g,y,T,x,b,R,w,H,_,S,M,C=this,A=this.segments+1,L=new THREE.Vector3,P=new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),D=P.tangents,F=P.normals,N=P.binormals;for(this.tangents=D,this.normals=F,this.binormals=N,f=0;f<A;f++)for(this.grid[f]=[],h=f/(A-1),d=e.getPointAt(h),a=D[f],s=F[f],l=N[f],this.debug&&(this.debug.add(new THREE.ArrowHelper(a,d,i,255)),this.debug.add(new THREE.ArrowHelper(s,d,i,16711680)),this.debug.add(new THREE.ArrowHelper(l,d,i,65280))),m=0;m<this.radiusSegments;m++)c=m/this.radiusSegments*2*Math.PI,u=-this.radius*Math.cos(c),p=this.radius*Math.sin(c),L.copy(d),L.x+=u*s.x+p*l.x,L.y+=u*s.y+p*l.y,L.z+=u*s.z+p*l.z,this.grid[f][m]=(_=L.x,S=L.y,M=L.z,C.vertices.push(new THREE.Vector3(_,S,M))-1);for(f=0;f<this.segments;f++)for(m=0;m<this.radiusSegments;m++)E=this.closed?(f+1)%this.segments:f+1,v=(m+1)%this.radiusSegments,g=this.grid[f][m],y=this.grid[E][m],T=this.grid[E][v],x=this.grid[f][v],b=new THREE.Vector2(f/this.segments,m/this.radiusSegments),R=new THREE.Vector2((f+1)/this.segments,m/this.radiusSegments),w=new THREE.Vector2((f+1)/this.segments,(m+1)/this.radiusSegments),H=new THREE.Vector2(f/this.segments,(m+1)/this.radiusSegments),this.faces.push(new THREE.Face4(g,y,T,x)),this.faceVertexUvs[0].push([b,R,w,H]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.FrenetFrames=function(e,t,i){new THREE.Vector3;var r,n,o,a,s,l,h,c=new THREE.Vector3,u=(new THREE.Vector3,[]),p=[],d=[],f=new THREE.Vector3,m=new THREE.Matrix4,E=t+1,v=1e-4;for(this.tangents=u,this.normals=p,this.binormals=d,l=0;l<E;l++)h=l/(E-1),u[l]=e.getTangentAt(h),u[l].normalize();for(function(){p[0]=new THREE.Vector3,d[0]=new THREE.Vector3,n=Number.MAX_VALUE,o=Math.abs(u[0].x),a=Math.abs(u[0].y),s=Math.abs(u[0].z),o<=n&&(n=o,c.set(1,0,0));a<=n&&(n=a,c.set(0,1,0));s<=n&&c.set(0,0,1);f.crossVectors(u[0],c).normalize(),p[0].crossVectors(u[0],f),d[0].crossVectors(u[0],p[0])}(),l=1;l<E;l++)p[l]=p[l-1].clone(),d[l]=d[l-1].clone(),f.crossVectors(u[l-1],u[l]),f.length()>v&&(f.normalize(),r=Math.acos(u[l-1].dot(u[l])),p[l].applyMatrix4(m.makeRotationAxis(f,r))),d[l].crossVectors(u[l],p[l]);if(i)for(r=Math.acos(p[0].dot(p[E-1])),r/=E-1,0<u[0].dot(f.crossVectors(p[0],p[E-1]))&&(r=-r),l=1;l<E;l++)p[l].applyMatrix4(m.makeRotationAxis(u[l],r*l)),d[l].crossVectors(u[l],p[l])},THREE.PolyhedronGeometry=function(e,t,i,r){THREE.Geometry.call(this),i=i||1,r=r||0;for(var d=this,n=0,o=e.length;n<o;n++)g(new THREE.Vector3(e[n][0],e[n][1],e[n][2]));var a=this.vertices,s=[];for(n=0,o=t.length;n<o;n++){var l=a[t[n][0]],h=a[t[n][1]],c=a[t[n][2]];s[n]=new THREE.Face3(l.index,h.index,c.index,[l.clone(),h.clone(),c.clone()])}for(n=0,o=s.length;n<o;n++)T(s[n],r);for(n=0,o=this.faceVertexUvs[0].length;n<o;n++){var u=this.faceVertexUvs[0][n],p=u[0].x,f=u[1].x,m=u[2].x,E=Math.max(p,Math.max(f,m)),v=Math.min(p,Math.min(f,m));.9<E&&v<.1&&(p<.2&&(u[0].x+=1),f<.2&&(u[1].x+=1),m<.2&&(u[2].x+=1))}this.mergeVertices();for(n=0,o=this.vertices.length;n<o;n++)this.vertices[n].multiplyScalar(i);function g(e){var t=e.normalize().clone();t.index=d.vertices.push(t)-1;var i,r=x(e)/2/Math.PI+.5,n=(i=e,Math.atan2(-i.y,Math.sqrt(i.x*i.x+i.z*i.z))/Math.PI+.5);return t.uv=new THREE.Vector2(r,1-n),t}function y(e,t,i){var r=new THREE.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);r.centroid.add(e).add(t).add(i).divideScalar(3),r.normal.copy(r.centroid).normalize(),d.faces.push(r);var n=x(r.centroid);d.faceVertexUvs[0].push([b(e.uv,e,n),b(t.uv,t,n),b(i.uv,i,n)])}function T(e,t){for(var i=Math.pow(2,t),r=(Math.pow(4,t),g(d.vertices[e.a])),n=g(d.vertices[e.b]),o=g(d.vertices[e.c]),a=[],s=0;s<=i;s++){a[s]=[];for(var l=g(r.clone().lerp(o,s/i)),h=g(n.clone().lerp(o,s/i)),c=i-s,u=0;u<=c;u++)a[s][u]=0==u&&s==i?l:g(l.clone().lerp(h,u/c))}for(s=0;s<i;s++)for(u=0;u<2*(i-s)-1;u++){var p=Math.floor(u/2);u%2==0?y(a[s][p+1],a[s+1][p],a[s][p]):y(a[s][p+1],a[s+1][p+1],a[s+1][p])}}function x(e){return Math.atan2(e.z,-e.x)}function b(e,t,i){return i<0&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(i/2/Math.PI+.5,e.y)),e.clone()}this.computeCentroids(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,i)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry=function(e,t){this.radius=e,this.detail=t;var i=(1+Math.sqrt(5))/2,r=[[-1,i,0],[1,i,0],[-1,-i,0],[1,-i,0],[0,-1,i],[0,1,i],[0,-1,-i],[0,1,-i],[i,0,-1],[i,0,1],[-i,0,-1],[-i,0,1]];THREE.PolyhedronGeometry.call(this,r,[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],e,t)},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],e,t)},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],e,t)},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry=function(e,t,i,r){THREE.Geometry.call(this);var n,o,a,s,l=this.vertices,h=this.faces,c=this.faceVertexUvs[0];r=void 0!==r&&r;var u,p,d,f,m,E,v,g,y=t+1;for(n=0;n<=i;n++)for(s=n/i,o=0;o<=t;o++)a=e(o/t,s),l.push(a);for(n=0;n<i;n++)for(o=0;o<t;o++)p=(u=n*y+o)+1,f=(d=(n+1)*y+o)+1,m=new THREE.Vector2(o/t,n/i),E=new THREE.Vector2((o+1)/t,n/i),v=new THREE.Vector2(o/t,(n+1)/i),g=new THREE.Vector2((o+1)/t,(n+1)/i),r?(h.push(new THREE.Face3(u,p,d)),h.push(new THREE.Face3(p,f,d)),c.push([m,E,v]),c.push([E,g,v])):(h.push(new THREE.Face4(u,p,f,d)),c.push([m,E,g,v]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ConvexGeometry=function(w){THREE.Geometry.call(this);for(var H=[[0,1,2],[0,2,1]],e=3;e<w.length;e++)t(e);function t(e){var t=w[e].clone(),i=t.length();t.x+=i*_(),t.y+=i*_(),t.z+=i*_();for(var r,n,o,a,s,l,h,c,u,p,d,f,m,E,v=[],g=0;g<H.length;){var y=H[g];if(u=t,m=void 0,p=w[(c=y)[0]],d=w[c[1]],f=w[c[2]],r=p,n=d,o=f,s=a=void 0,a=new THREE.Vector3,s=new THREE.Vector3,a.subVectors(o,n),s.subVectors(r,n),a.cross(s),a.normalize(),E=(m=a).dot(p),m.dot(u)>=E){for(var T=0;T<3;T++){for(var x=[y[T],y[(T+1)%3]],b=!0,R=0;R<v.length;R++)if(l=v[R],h=x,l[0]===h[1]&&l[1]===h[0]){v[R]=v[v.length-1],v.pop(),b=!1;break}b&&v.push(x)}H[g]=H[H.length-1],H.pop()}else g++}for(R=0;R<v.length;R++)H.push([v[R][0],v[R][1],e])}function _(){return 2*(Math.random()-.5)*1e-6}function i(e){var t=e.length();return new THREE.Vector2(e.x/t,e.y/t)}var r=0,n=new Array(w.length);for(e=0;e<H.length;e++)for(var o=H[e],a=0;a<3;a++)void 0===n[o[a]]&&(n[o[a]]=r++,this.vertices.push(w[o[a]])),o[a]=n[o[a]];for(e=0;e<H.length;e++)this.faces.push(new THREE.Face3(H[e][0],H[e][1],H[e][2]));for(e=0;e<this.faces.length;e++){o=this.faces[e];this.faceVertexUvs[0].push([i(this.vertices[o.a]),i(this.vertices[o.b]),i(this.vertices[o.c])])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ConvexGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.AxisHelper=function(e){e=e||1;var t=new THREE.Geometry;t.vertices.push(new THREE.Vector3,new THREE.Vector3(e,0,0),new THREE.Vector3,new THREE.Vector3(0,e,0),new THREE.Vector3,new THREE.Vector3(0,0,e)),t.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775));var i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,t,i,THREE.LinePieces)},THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype),THREE.ArrowHelper=function(e,t,i,r){THREE.Object3D.call(this),void 0===r&&(r=16776960),void 0===i&&(i=1),this.position=t,this.useQuaternion=!0;var n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(0,0,0)),n.vertices.push(new THREE.Vector3(0,1,0)),this.line=new THREE.Line(n,new THREE.LineBasicMaterial({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line);var o=new THREE.CylinderGeometry(0,.05,.25,5,1);o.applyMatrix((new THREE.Matrix4).makeTranslation(0,.875,0)),this.cone=new THREE.Mesh(o,new THREE.MeshBasicMaterial({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i)},THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.setDirection=function(){var t,i=new THREE.Vector3;return function(e){.999<e.y?this.quaternion.set(0,0,0,1):e.y<-.999?this.quaternion.set(1,0,0,0):(i.set(e.z,0,-e.x).normalize(),t=Math.acos(e.y),this.quaternion.setFromAxisAngle(i,t))}}(),THREE.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},THREE.BoxHelper=function(e){e=e||1;var t=new THREE.Geometry,i=[new THREE.Vector3(e,e,e),new THREE.Vector3(-e,e,e),new THREE.Vector3(-e,-e,e),new THREE.Vector3(e,-e,e),new THREE.Vector3(e,e,-e),new THREE.Vector3(-e,e,-e),new THREE.Vector3(-e,-e,-e),new THREE.Vector3(e,-e,-e)];t.vertices.push(i[0],i[1],i[1],i[2],i[2],i[3],i[3],i[0],i[4],i[5],i[5],i[6],i[6],i[7],i[7],i[4],i[0],i[4],i[1],i[5],i[2],i[6],i[3],i[7]),this.vertices=i,THREE.Line.call(this,t,new THREE.LineBasicMaterial,THREE.LinePieces)},THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype),THREE.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var i=t.boundingBox.min,r=t.boundingBox.max,n=this.vertices;n[0].set(r.x,r.y,r.z),n[1].set(i.x,r.y,r.z),n[2].set(i.x,i.y,r.z),n[3].set(r.x,i.y,r.z),n[4].set(r.x,r.y,i.z),n[5].set(i.x,r.y,i.z),n[6].set(i.x,i.y,i.z),n[7].set(r.x,i.y,i.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.CameraHelper=function(e){THREE.Line.call(this);var i=new THREE.Geometry,t=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),r={},n=16755200,o=16711680,a=3355443;function s(e,t,i){l(e,i),l(t,i)}function l(e,t){i.vertices.push(new THREE.Vector3),i.colors.push(new THREE.Color(t)),void 0===r[e]&&(r[e]=[]),r[e].push(i.vertices.length-1)}s("n1","n2",n),s("n2","n4",n),s("n4","n3",n),s("n3","n1",n),s("f1","f2",n),s("f2","f4",n),s("f4","f3",n),s("f3","f1",n),s("n1","f1",n),s("n2","f2",n),s("n3","f3",n),s("n4","f4",n),s("p","n1",o),s("p","n2",o),s("p","n3",o),s("p","n4",o),s("u1","u2",43775),s("u2","u3",43775),s("u3","u1",43775),s("c","t",16777215),s("p","c",a),s("cn1","cn2",a),s("cn3","cn4",a),s("cf1","cf2",a),s("cf3","cf4",a),THREE.Line.call(this,i,t,THREE.LinePieces),this.camera=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype),THREE.CameraHelper.prototype.update=function(){var l=new THREE.Vector3,h=new THREE.Camera,c=new THREE.Projector;return function(){var s=this;function e(e,t,i,r){l.set(t,i,r),c.unprojectVector(l,h);var n=s.pointMap[e];if(void 0!==n)for(var o=0,a=n.length;o<a;o++)s.geometry.vertices[n[o]].copy(l)}h.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=e;var i=new THREE.SphereGeometry(t,4,2),r=new THREE.MeshBasicMaterial({fog:!1,wireframe:!0});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new THREE.Mesh(i,r),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere),(i=new THREE.Geometry).vertices.push(this.light.position),i.vertices.push(this.light.target.position),i.computeLineDistances(),(r=new THREE.LineDashedMaterial({dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(i,r),this.add(this.targetLine)},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.GridHelper=function(e,t){for(var i=new THREE.Geometry,r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}),n=new THREE.Color(4473924),o=new THREE.Color(8947848),a=-e;a<=e;a+=t){i.vertices.push(new THREE.Vector3(-e,0,a)),i.vertices.push(new THREE.Vector3(e,0,a)),i.vertices.push(new THREE.Vector3(a,0,-e)),i.vertices.push(new THREE.Vector3(a,0,e));var s=0===a?n:o;i.colors.push(s,s,s,s)}THREE.Line.call(this,i,r,THREE.LinePieces)},THREE.GridHelper.prototype=Object.create(THREE.Line.prototype),THREE.HemisphereLightHelper=function(e,t,i,r){THREE.Object3D.call(this),this.light=e;var n=new THREE.SphereGeometry(t,4,2);n.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var o=0;o<8;o++)n.faces[o].materialIndex=o<4?0:1;var a=new THREE.MeshBasicMaterial({fog:!1,wireframe:!0});a.color.copy(e.color).multiplyScalar(e.intensity);var s=new THREE.MeshBasicMaterial({fog:!1,wireframe:!0});s.color.copy(e.groundColor).multiplyScalar(e.intensity),this.lightSphere=new THREE.Mesh(n,new THREE.MeshFaceMaterial([a,s])),this.lightSphere.position=e.position,this.lightSphere.lookAt(new THREE.Vector3),this.add(this.lightSphere)},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.update=function(){this.lightSphere.lookAt(new THREE.Vector3),this.lightSphere.material.materials[0].color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere.material.materials[1].color.copy(this.light.groundColor).multiplyScalar(this.light.intensity)},THREE.PointLightHelper=function(e,t){THREE.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=e;var i=new THREE.SphereGeometry(t,4,2),r=new THREE.MeshBasicMaterial({fog:!1,wireframe:!0});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new THREE.Mesh(i,r),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere)},THREE.PointLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.PointLightHelper.prototype.update=function(){this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SpotLightHelper=function(e,t){THREE.Object3D.call(this),this.matrixAutoUpdate=!1,this.light=e;var i=new THREE.SphereGeometry(t,4,2),r=new THREE.MeshBasicMaterial({fog:!1,wireframe:!0});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightSphere=new THREE.Mesh(i,r),this.lightSphere.matrixWorld=this.light.matrixWorld,this.lightSphere.matrixAutoUpdate=!1,this.add(this.lightSphere),(i=new THREE.CylinderGeometry(1e-4,1,1,8,1,!0)).applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0)),i.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),(r=new THREE.MeshBasicMaterial({fog:!1,wireframe:!0,opacity:.3,transparent:!0})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightCone=new THREE.Mesh(i,r),this.lightCone.position=this.light.position;var n=e.distance?e.distance:1e4,o=n*Math.tan(e.angle);this.lightCone.scale.set(o,o,n),this.lightCone.lookAt(this.light.target.position),this.add(this.lightCone)},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.update=function(){var e=this.light.distance?this.light.distance:1e4,t=e*Math.tan(this.light.angle);this.lightCone.scale.set(t,t,e),this.lightCone.lookAt(this.light.target.position),this.lightSphere.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightCone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(e){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare=function(e,t,i,r,n){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,(this.customUpdateCallback=void 0)!==e&&this.add(e,t,i,r,n)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.add=function(e,t,i,r,n,o){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===n&&(n=new THREE.Color(16777215)),void 0===r&&(r=THREE.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:n,blending:r})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,r=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;e<i;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,r=i-1,n=i/1;this.createAnimation("__default",0,r,n),this.setAnimationWeight("__default",1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,i,r){var n={startFrame:t,endFrame:i,length:i-t+1,fps:r,duration:(i-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)(\d+)/,r={},n=this.geometry,o=0,a=n.morphTargets.length;o<a;o++){var s=n.morphTargets[o].name.match(i);if(s&&1<s.length){var l=s[1];s[2];r[l]||(r[l]={start:1/0,end:-1/0}),o<(h=r[l]).start&&(h.start=o),o>h.end&&(h.end=o),t||(t=l)}}for(var l in r){var h=r[l];this.createAnimation(l,h.start,h.end,e)}this.firstAnimation=t},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,i=this.animationsMap[e];return i&&(t=i.time),t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,i=this.animationsMap[e];return i&&(t=i.duration),t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;t<i;t++){var r=this.animationsList[t];if(r.active){var n=r.duration/r.length;r.time+=r.direction*e,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var o=r.startFrame+THREE.Math.clamp(Math.floor(r.time/n),0,r.length-1),a=r.weight;o!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*a,this.morphTargetInfluences[o]=0,r.lastFrame=r.currentFrame,r.currentFrame=o);var s=r.time%n/n;r.directionBackwards&&(s=1-s),this.morphTargetInfluences[r.currentFrame]=s*a,this.morphTargetInfluences[r.lastFrame]=(1-s)*a}}},THREE.LensFlarePlugin=function(){var x,b,i,R={};function r(e,t){var i=x.createProgram(),r=x.createShader(x.FRAGMENT_SHADER),n=x.createShader(x.VERTEX_SHADER),o="precision "+t+" float;\n";return x.shaderSource(r,o+e.fragmentShader),x.shaderSource(n,o+e.vertexShader),x.compileShader(r),x.compileShader(n),x.attachShader(i,r),x.attachShader(i,n),x.linkProgram(i),i}this.init=function(e){x=e.context,i=(b=e).getPrecision(),R.vertices=new Float32Array(16),R.faces=new Uint16Array(6);var t=0;R.vertices[t++]=-1,R.vertices[t++]=-1,R.vertices[t++]=0,R.vertices[t++]=0,R.vertices[t++]=1,R.vertices[t++]=-1,R.vertices[t++]=1,R.vertices[t++]=0,R.vertices[t++]=1,R.vertices[t++]=1,R.vertices[t++]=1,R.vertices[t++]=1,R.vertices[t++]=-1,R.vertices[t++]=1,R.vertices[t++]=0,R.vertices[t++]=1,t=0,R.faces[t++]=0,R.faces[t++]=1,R.faces[t++]=2,R.faces[t++]=0,R.faces[t++]=2,R.faces[t++]=3,R.vertexBuffer=x.createBuffer(),R.elementBuffer=x.createBuffer(),x.bindBuffer(x.ARRAY_BUFFER,R.vertexBuffer),x.bufferData(x.ARRAY_BUFFER,R.vertices,x.STATIC_DRAW),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,R.elementBuffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,R.faces,x.STATIC_DRAW),R.tempTexture=x.createTexture(),R.occlusionTexture=x.createTexture(),x.bindTexture(x.TEXTURE_2D,R.tempTexture),x.texImage2D(x.TEXTURE_2D,0,x.RGB,16,16,0,x.RGB,x.UNSIGNED_BYTE,null),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST),x.bindTexture(x.TEXTURE_2D,R.occlusionTexture),x.texImage2D(x.TEXTURE_2D,0,x.RGBA,16,16,0,x.RGBA,x.UNSIGNED_BYTE,null),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST),x.getParameter(x.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(R.hasVertexTexture=!1,R.program=r(THREE.ShaderFlares.lensFlare,i)):(R.hasVertexTexture=!0,R.program=r(THREE.ShaderFlares.lensFlareVertexTexture,i)),R.attributes={},R.uniforms={},R.attributes.vertex=x.getAttribLocation(R.program,"position"),R.attributes.uv=x.getAttribLocation(R.program,"uv"),R.uniforms.renderType=x.getUniformLocation(R.program,"renderType"),R.uniforms.map=x.getUniformLocation(R.program,"map"),R.uniforms.occlusionMap=x.getUniformLocation(R.program,"occlusionMap"),R.uniforms.opacity=x.getUniformLocation(R.program,"opacity"),R.uniforms.color=x.getUniformLocation(R.program,"color"),R.uniforms.scale=x.getUniformLocation(R.program,"scale"),R.uniforms.rotation=x.getUniformLocation(R.program,"rotation"),R.uniforms.screenPosition=x.getUniformLocation(R.program,"screenPosition")},this.render=function(e,t,i,r){var n=e.__webglFlares,o=n.length;if(o){var a,s,l,h,c,u=new THREE.Vector3,p=r/i,d=.5*i,f=.5*r,m=16/r,E=new THREE.Vector2(m*p,m),v=new THREE.Vector3(1,1,0),g=new THREE.Vector2(1,1),y=R.uniforms,T=R.attributes;for(x.useProgram(R.program),x.enableVertexAttribArray(R.attributes.vertex),x.enableVertexAttribArray(R.attributes.uv),x.uniform1i(y.occlusionMap,0),x.uniform1i(y.map,1),x.bindBuffer(x.ARRAY_BUFFER,R.vertexBuffer),x.vertexAttribPointer(T.vertex,2,x.FLOAT,!1,16,0),x.vertexAttribPointer(T.uv,2,x.FLOAT,!1,16,8),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,R.elementBuffer),x.disable(x.CULL_FACE),x.depthMask(!1),a=0;a<o;a++)if(m=16/r,E.set(m*p,m),h=n[a],u.set(h.matrixWorld.elements[12],h.matrixWorld.elements[13],h.matrixWorld.elements[14]),u.applyMatrix4(t.matrixWorldInverse),u.applyProjection(t.projectionMatrix),v.copy(u),g.x=v.x*d+d,g.y=v.y*f+f,R.hasVertexTexture||0<g.x&&g.x<i&&0<g.y&&g.y<r)for(x.activeTexture(x.TEXTURE1),x.bindTexture(x.TEXTURE_2D,R.tempTexture),x.copyTexImage2D(x.TEXTURE_2D,0,x.RGB,g.x-8,g.y-8,16,16,0),x.uniform1i(y.renderType,0),x.uniform2f(y.scale,E.x,E.y),x.uniform3f(y.screenPosition,v.x,v.y,v.z),x.disable(x.BLEND),x.enable(x.DEPTH_TEST),x.drawElements(x.TRIANGLES,6,x.UNSIGNED_SHORT,0),x.activeTexture(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,R.occlusionTexture),x.copyTexImage2D(x.TEXTURE_2D,0,x.RGBA,g.x-8,g.y-8,16,16,0),x.uniform1i(y.renderType,1),x.disable(x.DEPTH_TEST),x.activeTexture(x.TEXTURE1),x.bindTexture(x.TEXTURE_2D,R.tempTexture),x.drawElements(x.TRIANGLES,6,x.UNSIGNED_SHORT,0),h.positionScreen.copy(v),h.customUpdateCallback?h.customUpdateCallback(h):h.updateLensFlares(),x.uniform1i(y.renderType,2),x.enable(x.BLEND),s=0,l=h.lensFlares.length;s<l;s++).001<(c=h.lensFlares[s]).opacity&&.001<c.scale&&(v.x=c.x,v.y=c.y,v.z=c.z,m=c.size*c.scale/r,E.x=m*p,E.y=m,x.uniform3f(y.screenPosition,v.x,v.y,v.z),x.uniform2f(y.scale,E.x,E.y),x.uniform1f(y.rotation,c.rotation),x.uniform1f(y.opacity,c.opacity),x.uniform3f(y.color,c.color.r,c.color.g,c.color.b),b.setBlending(c.blending,c.blendEquation,c.blendSrc,c.blendDst),b.setTexture(c.texture,1),x.drawElements(x.TRIANGLES,6,x.UNSIGNED_SHORT,0));x.enable(x.CULL_FACE),x.enable(x.DEPTH_TEST),x.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){var M,C,A,L,P,D,F=new THREE.Frustum,N=new THREE.Matrix4,s=new THREE.Vector3,l=new THREE.Vector3,U=new THREE.Vector3;function B(e,t){var i=new THREE.DirectionalLight;i.isVirtual=!0,i.onlyShadow=!0,i.castShadow=!0,i.shadowCameraNear=e.shadowCameraNear,i.shadowCameraFar=e.shadowCameraFar,i.shadowCameraLeft=e.shadowCameraLeft,i.shadowCameraRight=e.shadowCameraRight,i.shadowCameraBottom=e.shadowCameraBottom,i.shadowCameraTop=e.shadowCameraTop,i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t],i.shadowMapWidth=e.shadowCascadeWidth[t],i.shadowMapHeight=e.shadowCascadeHeight[t],i.pointsWorld=[],i.pointsFrustum=[];for(var r=i.pointsWorld,n=i.pointsFrustum,o=0;o<8;o++)r[o]=new THREE.Vector3,n[o]=new THREE.Vector3;var a=e.shadowCascadeNearZ[t],s=e.shadowCascadeFarZ[t];return n[0].set(-1,-1,a),n[1].set(1,-1,a),n[2].set(-1,1,a),n[3].set(1,1,a),n[4].set(-1,-1,s),n[5].set(1,-1,s),n[6].set(-1,1,s),n[7].set(1,1,s),i}function k(e,t){var i=e.shadowCascadeArray[t];i.position.copy(e.position),i.target.position.copy(e.target.position),i.lookAt(i.target),i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t],n=e.shadowCascadeFarZ[t],o=i.pointsFrustum;o[0].z=r,o[1].z=r,o[2].z=r,o[3].z=r,o[4].z=n,o[5].z=n,o[6].z=n,o[7].z=n}function z(e,t){var i=t.shadowCamera,r=t.pointsFrustum,n=t.pointsWorld;s.set(1/0,1/0,1/0),l.set(-1/0,-1/0,-1/0);for(var o=0;o<8;o++){var a=n[o];a.copy(r[o]),THREE.ShadowMapPlugin.__projector.unprojectVector(a,e),a.applyMatrix4(i.matrixWorldInverse),a.x<s.x&&(s.x=a.x),a.x>l.x&&(l.x=a.x),a.y<s.y&&(s.y=a.y),a.y>l.y&&(l.y=a.y),a.z<s.z&&(s.z=a.z),a.z>l.z&&(l.z=a.z)}i.left=s.x,i.right=l.x,i.top=l.y,i.bottom=s.y,i.updateProjectionMatrix()}this.init=function(e){M=e.context,C=e;var t=THREE.ShaderLib.depthRGBA,i=THREE.UniformsUtils.clone(t.uniforms);A=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i}),L=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0}),P=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,skinning:!0}),D=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0,skinning:!0}),A._shadowPass=!0,L._shadowPass=!0,P._shadowPass=!0,D._shadowPass=!0},this.render=function(e,t){C.shadowMapEnabled&&C.shadowMapAutoUpdate&&this.update(e,t)},this.update=function(e,t){var i,r,n,o,a,s,l,h,c,u,p,d,f,m,E,v=[],g=0;for(M.clearColor(1,1,1,1),M.disable(M.BLEND),M.enable(M.CULL_FACE),M.frontFace(M.CCW),C.shadowMapCullFace===THREE.CullFaceFront?M.cullFace(M.FRONT):M.cullFace(M.BACK),C.setDepthTest(!0),i=0,r=e.__lights.length;i<r;i++)if((f=e.__lights[i]).castShadow)if(f instanceof THREE.DirectionalLight&&f.shadowCascade)for(a=0;a<f.shadowCascadeCount;a++){var y;if(f.shadowCascadeArray[a])y=f.shadowCascadeArray[a];else{(y=B(f,a)).originalCamera=t;var T=new THREE.Gyroscope;T.position=f.shadowCascadeOffset,T.add(y),T.add(y.target),t.add(T),f.shadowCascadeArray[a]=y,console.log("Created virtualLight",y)}k(f,a),v[g]=y,g++}else v[g]=f,g++;for(i=0,r=v.length;i<r;i++){if(!(f=v[i]).shadowMap){var x=THREE.LinearFilter;C.shadowMapType===THREE.PCFSoftShadowMap&&(x=THREE.NearestFilter);var b={minFilter:x,magFilter:x,format:THREE.RGBAFormat};f.shadowMap=new THREE.WebGLRenderTarget(f.shadowMapWidth,f.shadowMapHeight,b),f.shadowMapSize=new THREE.Vector2(f.shadowMapWidth,f.shadowMapHeight),f.shadowMatrix=new THREE.Matrix4}if(!f.shadowCamera){if(f instanceof THREE.SpotLight)f.shadowCamera=new THREE.PerspectiveCamera(f.shadowCameraFov,f.shadowMapWidth/f.shadowMapHeight,f.shadowCameraNear,f.shadowCameraFar);else{if(!(f instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}f.shadowCamera=new THREE.OrthographicCamera(f.shadowCameraLeft,f.shadowCameraRight,f.shadowCameraTop,f.shadowCameraBottom,f.shadowCameraNear,f.shadowCameraFar)}e.add(f.shadowCamera),!0===e.autoUpdate&&e.updateMatrixWorld()}for(f.shadowCameraVisible&&!f.cameraHelper&&(f.cameraHelper=new THREE.CameraHelper(f.shadowCamera),f.shadowCamera.add(f.cameraHelper)),f.isVirtual&&y.originalCamera==t&&z(t,f),s=f.shadowMap,l=f.shadowMatrix,(h=f.shadowCamera).position.getPositionFromMatrix(f.matrixWorld),U.getPositionFromMatrix(f.target.matrixWorld),h.lookAt(U),h.updateMatrixWorld(),h.matrixWorldInverse.getInverse(h.matrixWorld),f.cameraHelper&&(f.cameraHelper.visible=f.shadowCameraVisible),f.shadowCameraVisible&&f.cameraHelper.update(),l.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),l.multiply(h.projectionMatrix),l.multiply(h.matrixWorldInverse),N.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),F.setFromMatrix(N),C.setRenderTarget(s),C.clear(),n=0,o=(m=e.__webglObjects).length;n<o;n++)d=(p=m[n]).object,p.render=!1,d.visible&&d.castShadow&&((d instanceof THREE.Mesh||d instanceof THREE.ParticleSystem)&&d.frustumCulled&&!F.intersectsObject(d)||(d._modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,d.matrixWorld),p.render=!0));var R,w,H;for(n=0,o=m.length;n<o;n++)(p=m[n]).render&&(d=p.object,c=p.buffer,R=(E=d).material instanceof THREE.MeshFaceMaterial?E.material.materials[0]:E.material,w=0<d.geometry.morphTargets.length&&R.morphTargets,H=d instanceof THREE.SkinnedMesh&&R.skinning,u=d.customDepthMaterial?d.customDepthMaterial:H?w?D:P:w?L:A,c instanceof THREE.BufferGeometry?C.renderBufferDirect(h,e.__lights,null,u,c,d):C.renderBuffer(h,e.__lights,null,u,c,d));for(n=0,o=(m=e.__webglObjectsImmediate).length;n<o;n++)(d=(p=m[n]).object).visible&&d.castShadow&&(d._modelViewMatrix.multiplyMatrices(h.matrixWorldInverse,d.matrixWorld),C.renderImmediateObject(h,e.__lights,null,A,d))}var _=C.getClearColor(),S=C.getClearAlpha();M.clearColor(_.r,_.g,_.b,S),M.enable(M.BLEND),C.shadowMapCullFace===THREE.CullFaceFront&&M.cullFace(M.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){var T,x,l,b={};function R(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}this.init=function(e){T=e.context,l=(x=e).getPrecision(),b.vertices=new Float32Array(16),b.faces=new Uint16Array(6);var t,i,r,n,o,a,s=0;b.vertices[s++]=-1,b.vertices[s++]=-1,b.vertices[s++]=0,b.vertices[s++]=0,b.vertices[s++]=1,b.vertices[s++]=-1,b.vertices[s++]=1,b.vertices[s++]=0,b.vertices[s++]=1,b.vertices[s++]=1,b.vertices[s++]=1,b.vertices[s++]=1,b.vertices[s++]=-1,b.vertices[s++]=1,b.vertices[s++]=0,b.vertices[s++]=1,s=0,b.faces[s++]=0,b.faces[s++]=1,b.faces[s++]=2,b.faces[s++]=0,b.faces[s++]=2,b.faces[s++]=3,b.vertexBuffer=T.createBuffer(),b.elementBuffer=T.createBuffer(),T.bindBuffer(T.ARRAY_BUFFER,b.vertexBuffer),T.bufferData(T.ARRAY_BUFFER,b.vertices,T.STATIC_DRAW),T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,b.elementBuffer),T.bufferData(T.ELEMENT_ARRAY_BUFFER,b.faces,T.STATIC_DRAW),b.program=(t=THREE.ShaderSprite.sprite,i=l,r=T.createProgram(),n=T.createShader(T.FRAGMENT_SHADER),o=T.createShader(T.VERTEX_SHADER),a="precision "+i+" float;\n",T.shaderSource(n,a+t.fragmentShader),T.shaderSource(o,a+t.vertexShader),T.compileShader(n),T.compileShader(o),T.attachShader(r,n),T.attachShader(r,o),T.linkProgram(r),r),b.attributes={},b.uniforms={},b.attributes.position=T.getAttribLocation(b.program,"position"),b.attributes.uv=T.getAttribLocation(b.program,"uv"),b.uniforms.uvOffset=T.getUniformLocation(b.program,"uvOffset"),b.uniforms.uvScale=T.getUniformLocation(b.program,"uvScale"),b.uniforms.rotation=T.getUniformLocation(b.program,"rotation"),b.uniforms.scale=T.getUniformLocation(b.program,"scale"),b.uniforms.alignment=T.getUniformLocation(b.program,"alignment"),b.uniforms.color=T.getUniformLocation(b.program,"color"),b.uniforms.map=T.getUniformLocation(b.program,"map"),b.uniforms.opacity=T.getUniformLocation(b.program,"opacity"),b.uniforms.useScreenCoordinates=T.getUniformLocation(b.program,"useScreenCoordinates"),b.uniforms.sizeAttenuation=T.getUniformLocation(b.program,"sizeAttenuation"),b.uniforms.screenPosition=T.getUniformLocation(b.program,"screenPosition"),b.uniforms.modelViewMatrix=T.getUniformLocation(b.program,"modelViewMatrix"),b.uniforms.projectionMatrix=T.getUniformLocation(b.program,"projectionMatrix"),b.uniforms.fogType=T.getUniformLocation(b.program,"fogType"),b.uniforms.fogDensity=T.getUniformLocation(b.program,"fogDensity"),b.uniforms.fogNear=T.getUniformLocation(b.program,"fogNear"),b.uniforms.fogFar=T.getUniformLocation(b.program,"fogFar"),b.uniforms.fogColor=T.getUniformLocation(b.program,"fogColor"),b.uniforms.alphaTest=T.getUniformLocation(b.program,"alphaTest")},this.render=function(e,t,i,r){var n=e.__webglSprites,o=n.length;if(o){var a=b.attributes,s=b.uniforms,l=r/i,h=.5*i,c=.5*r;T.useProgram(b.program),T.enableVertexAttribArray(a.position),T.enableVertexAttribArray(a.uv),T.disable(T.CULL_FACE),T.enable(T.BLEND),T.bindBuffer(T.ARRAY_BUFFER,b.vertexBuffer),T.vertexAttribPointer(a.position,2,T.FLOAT,!1,16,0),T.vertexAttribPointer(a.uv,2,T.FLOAT,!1,16,8),T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,b.elementBuffer),T.uniformMatrix4fv(s.projectionMatrix,!1,t.projectionMatrix.elements),T.activeTexture(T.TEXTURE0),T.uniform1i(s.map,0);var u=0,p=0,d=e.fog;d?(T.uniform3f(s.fogColor,d.color.r,d.color.g,d.color.b),d instanceof THREE.Fog?(T.uniform1f(s.fogNear,d.near),T.uniform1f(s.fogFar,d.far),T.uniform1i(s.fogType,1),p=u=1):d instanceof THREE.FogExp2&&(T.uniform1f(s.fogDensity,d.density),T.uniform1i(s.fogType,2),p=u=2)):(T.uniform1i(s.fogType,0),p=u=0);var f,m,E,v,g,y=[];for(f=0;f<o;f++)E=(m=n[f]).material,m.visible&&0!==E.opacity&&(E.useScreenCoordinates?m.z=-m.position.z:(m._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,m.matrixWorld),m.z=-m._modelViewMatrix.elements[14]));for(n.sort(R),f=0;f<o;f++)E=(m=n[f]).material,m.visible&&0!==E.opacity&&E.map&&E.map.image&&E.map.image.width&&(T.uniform1f(s.alphaTest,E.alphaTest),!0===E.useScreenCoordinates?(T.uniform1i(s.useScreenCoordinates,1),T.uniform3f(s.screenPosition,(m.position.x*x.devicePixelRatio-h)/h,(c-m.position.y*x.devicePixelRatio)/c,Math.max(0,Math.min(1,m.position.z))),y[0]=x.devicePixelRatio,y[1]=x.devicePixelRatio):(T.uniform1i(s.useScreenCoordinates,0),T.uniform1i(s.sizeAttenuation,E.sizeAttenuation?1:0),T.uniformMatrix4fv(s.modelViewMatrix,!1,m._modelViewMatrix.elements),y[0]=1,y[1]=1),u!==(g=e.fog&&E.fog?p:0)&&(T.uniform1i(s.fogType,g),u=g),v=1/(E.scaleByViewport?r:1),y[0]*=v*l*m.scale.x,y[1]*=v*m.scale.y,T.uniform2f(s.uvScale,E.uvScale.x,E.uvScale.y),T.uniform2f(s.uvOffset,E.uvOffset.x,E.uvOffset.y),T.uniform2f(s.alignment,E.alignment.x,E.alignment.y),T.uniform1f(s.opacity,E.opacity),T.uniform3f(s.color,E.color.r,E.color.g,E.color.b),T.uniform1f(s.rotation,m.rotation),T.uniform2fv(s.scale,y),x.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst),x.setDepthTest(E.depthTest),x.setDepthWrite(E.depthWrite),x.setTexture(E.map,0),T.drawElements(T.TRIANGLES,6,T.UNSIGNED_SHORT,0));T.enable(T.CULL_FACE)}}},THREE.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var m,E,v,g,y,T,x=new THREE.Frustum,b=new THREE.Matrix4;this.init=function(e){m=e.context,E=e;var t=THREE.ShaderLib.depthRGBA,i=THREE.UniformsUtils.clone(t.uniforms);v=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i}),g=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0}),y=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,skinning:!0}),T=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0,skinning:!0}),v._shadowPass=!0,g._shadowPass=!0,y._shadowPass=!0,T._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(e,t){var i,r,n,o,a,s,l,h,c,u,p;for(m.clearColor(1,1,1,1),m.disable(m.BLEND),E.setDepthTest(!0),!0===e.autoUpdate&&e.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),b.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),x.setFromMatrix(b),E.setRenderTarget(this.renderTarget),E.clear(),i=0,r=(l=e.__webglObjects).length;i<r;i++)s=(a=l[i]).object,a.render=!1,s.visible&&((s instanceof THREE.Mesh||s instanceof THREE.ParticleSystem)&&s.frustumCulled&&!x.intersectsObject(s)||(s._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,s.matrixWorld),a.render=!0));for(i=0,r=l.length;i<r;i++)if((a=l[i]).render){if(s=a.object,n=a.buffer,s instanceof THREE.ParticleSystem&&!s.customDepthMaterial)continue;(h=(p=s).material instanceof THREE.MeshFaceMaterial?p.material.materials[0]:p.material)&&E.setMaterialFaces(s.material),c=0<s.geometry.morphTargets.length&&h.morphTargets,u=s instanceof THREE.SkinnedMesh&&h.skinning,o=s.customDepthMaterial?s.customDepthMaterial:u?c?T:y:c?g:v,n instanceof THREE.BufferGeometry?E.renderBufferDirect(t,e.__lights,null,o,n,s):E.renderBuffer(t,e.__lights,null,o,n,s)}for(i=0,r=(l=e.__webglObjectsImmediate).length;i<r;i++)(s=(a=l[i]).object).visible&&(s._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,s.matrixWorld),E.renderImmediateObject(t,e.__lights,null,v,s));var d=E.getClearColor(),f=E.getClearAlpha();m.clearColor(d.r,d.g,d.b,f),m.enable(m.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility = (       visibility.r / 9.0 ) *","( 1.0 - visibility.g / 9.0 ) *","(       visibility.b / 9.0 ) *","( 1.0 - visibility.a / 9.0 );","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},THREE.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}},THREE.OBJLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(e,t,i,r){var n=this,o=new THREE.XHRLoader(n.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){t(n.parse(e))})},parse:function(e){function t(e,t,i){return new THREE.Vector3(e,t,i)}function i(e,t,i,r){return new THREE.Face3(e,t,i,r)}function r(e,t,i,r,n){return new THREE.Face4(e,t,i,r,n)}function n(e,t){0<h.vertices.length&&(h.mergeVertices(),h.computeCentroids(),h.computeFaceNormals(),h.computeBoundingSphere(),l.add(u),h=new THREE.Geometry,u=new THREE.Mesh(h,c),d=0),void 0!==e&&(u.name=e),void 0!==t&&((c=new THREE.MeshLambertMaterial).name=t,u.material=c)}e=e.replace(/\ \\\r\n/g,"");for(var o,a,s=new THREE.Object3D,l=s,h=new THREE.Geometry,c=new THREE.MeshLambertMaterial,u=new THREE.Mesh(h,c),p=[],d=0,f=[],m=[],E=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,v=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,g=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,y=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,T=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,x=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,b=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,R=e.split("\n"),w=0;w<R.length;w++){var H,_=R[w];0!==(_=_.trim()).length&&"#"!==_.charAt(0)&&(null!==(H=E.exec(_))?p.push(t(parseFloat(H[1]),parseFloat(H[2]),parseFloat(H[3]))):null!==(H=v.exec(_))?f.push(t(parseFloat(H[1]),parseFloat(H[2]),parseFloat(H[3]))):null!==(H=g.exec(_))?m.push((o=parseFloat(H[1]),a=parseFloat(H[2]),new THREE.Vector2(o,a))):null!==(H=y.exec(_))?void 0===H[4]?(h.vertices.push(p[parseInt(H[1])-1],p[parseInt(H[2])-1],p[parseInt(H[3])-1]),h.faces.push(i(d++,d++,d++))):(h.vertices.push(p[parseInt(H[1])-1],p[parseInt(H[2])-1],p[parseInt(H[3])-1],p[parseInt(H[4])-1]),h.faces.push(r(d++,d++,d++,d++))):null!==(H=T.exec(_))?void 0===H[10]?(h.vertices.push(p[parseInt(H[2])-1],p[parseInt(H[5])-1],p[parseInt(H[8])-1]),h.faces.push(i(d++,d++,d++)),h.faceVertexUvs[0].push([m[parseInt(H[3])-1],m[parseInt(H[6])-1],m[parseInt(H[9])-1]])):(h.vertices.push(p[parseInt(H[2])-1],p[parseInt(H[5])-1],p[parseInt(H[8])-1],p[parseInt(H[11])-1]),h.faces.push(r(d++,d++,d++,d++)),h.faceVertexUvs[0].push([m[parseInt(H[3])-1],m[parseInt(H[6])-1],m[parseInt(H[9])-1],m[parseInt(H[12])-1]])):null!==(H=x.exec(_))?void 0===H[13]?(h.vertices.push(p[parseInt(H[2])-1],p[parseInt(H[6])-1],p[parseInt(H[10])-1]),h.faces.push(i(d++,d++,d++,[f[parseInt(H[4])-1],f[parseInt(H[8])-1],f[parseInt(H[12])-1]])),h.faceVertexUvs[0].push([m[parseInt(H[3])-1],m[parseInt(H[7])-1],m[parseInt(H[11])-1]])):(h.vertices.push(p[parseInt(H[2])-1],p[parseInt(H[6])-1],p[parseInt(H[10])-1],p[parseInt(H[14])-1]),h.faces.push(r(d++,d++,d++,d++,[f[parseInt(H[4])-1],f[parseInt(H[8])-1],f[parseInt(H[12])-1],f[parseInt(H[16])-1]])),h.faceVertexUvs[0].push([m[parseInt(H[3])-1],m[parseInt(H[7])-1],m[parseInt(H[11])-1],m[parseInt(H[15])-1]])):null!==(H=b.exec(_))?void 0===H[10]?(h.vertices.push(p[parseInt(H[2])-1],p[parseInt(H[5])-1],p[parseInt(H[8])-1]),h.faces.push(i(d++,d++,d++,[f[parseInt(H[3])-1],f[parseInt(H[6])-1],f[parseInt(H[9])-1]]))):(h.vertices.push(p[parseInt(H[2])-1],p[parseInt(H[5])-1],p[parseInt(H[8])-1],p[parseInt(H[11])-1]),h.faces.push(r(d++,d++,d++,d++,[f[parseInt(H[3])-1],f[parseInt(H[6])-1],f[parseInt(H[9])-1],f[parseInt(H[12])-1]]))):/^o /.test(_)?((l=new THREE.Object3D).name=_.substring(2).trim(),s.add(l)):/^g /.test(_)?n(_.substring(2).trim(),void 0):/^usemtl /.test(_)?n(void 0,_.substring(7).trim()):/^mtllib /.test(_)||/^s /.test(_))}return n(void 0,void 0),s}},THREE.LoadingManager=function(e,t,i){var r=this,n=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++},this.itemEnd=function(e){n++,void 0!==r.onProgress&&r.onProgress(e,n,o),n===o&&void 0!==r.onLoad&&r.onLoad()}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.XHRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(t,i,r,n){var o=this,e=new XMLHttpRequest;void 0!==i&&e.addEventListener("load",function(e){i(e.target.responseText),o.manager.itemEnd(t)},!1),void 0!==r&&e.addEventListener("progress",function(e){r(e)},!1),void 0!==n&&e.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(e.crossOrigin=this.crossOrigin),e.open("GET",t,!0),e.send(null),o.manager.itemStart(t)},setCrossOrigin:function(e){this.crossOrigin=e}},function(){var i,e=this,t=e.Sandbox||{},r=0,s=e.Sandbox=function(e){var t,i,r,n=this,o=_.defaults(e||{},{showGraph:!0,showNodeListing:!0,width:window.innerWidth,height:window.innerHeight,size:50,useDefault:!1,defaultStyles:!0});if(this.width=o.width,this.height=o.height,this.showing={value:o.showGraph,graph:o.showGraph,viewport:!o.showGraph,force:!1},this.domElement=document.createElement("div"),this.domElement.classList.add(s.className,"container"),$(this.domElement).bind("mousemove",function(e){n.showing.value||(t=this.getBoundingClientRect(),i=(e.clientX-t.left)/t.width,r=(e.clientY-t.top)/t.height,_.each(_.toArray(n.nodes),function(e){e.onMouseMove&&e.onMouseMove(i,r)},n))}),$(this.domElement).bind("mousedown",function(e){n.showing.value||_.each(_.toArray(n.nodes),function(e){e.onMouseDown&&e.onMouseDown(i,r)},n)}),this.wrapper=document.createElement("div"),$(this.wrapper).addClass(s.className+" wrapper"),_.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"}),_.extend(this.wrapper.style,{width:2*this.width+"px",height:this.height+"px"}),this.loader=new s.Loader(this).appendTo(this.domElement),this.graph=new s.Graph({width:this.width,height:this.height,size:o.size}).appendTo(this.wrapper),this.graph.unbind("connect").unbind("disconnect").bind("preview",_.bind(function(){this.showViewport()},this)).bind("connect",_.bind(function(e,t,i){this.connectNubs(t,e,i)},this)).bind("disconnect",_.bind(function(e){var t=e.next;this.graph.background.children[t.parentId].object.inputs[t.name]=null,e.die=!0},this)).bind("focus",_.bind(function(e){var t=e.object;this.inspector.focus(t)},this)),this.viewport=new s.Viewport({parent:this,width:2*this.width,height:this.height}).appendTo(this.wrapper),this.domElement.appendChild(this.wrapper),this.inspector=new s.Inspector({parent:this,defaultJSON:o.useDefault}).appendTo(this.domElement),this.nodes=[],this.preview=new s.Preview,this.preview.attach(this),this.viewport.inputs=this.preview.inputs,this.graph.add(this.preview),o.showGraph?this.showGraph():this.showViewport(),o.showNodeListing?this.inspector.showNodeListing():this.inspector.showParamsListing(),o.defaultStyles){var a=document.createElement("style");a.innerHTML=s.defaultStyles,document.body.appendChild(a)}};_.extend(s,{noConflict:function(){return e.Sandbox=t,this},className:"sb",aspectRatio:16/9,defaultStyles:'body.dragging,body.dragging.drag-enabled,body.dragging *,body.dragging.drag-enabled *,.inner-dom{-webkit-user-select:none !important;-moz-user-select:none !important;-ms-user-select:none !important;-o-user-select:none !important;user-select:none !important;cursor:-webkit-grabbing}body.dragging .frame,body.dragging.drag-enabled .frame,body.dragging * .frame,body.dragging.drag-enabled * .frame,.inner-dom .frame{cursor:-webkit-grabbing}body.drag-enabled{cursor:-webkit-grab}*{margin:0;padding:0}.sb.container{position:relative;overflow:hidden;z-index:1000;top:0;left:0;right:0;bottom:0}.sb.container *{letter-spacing:0;font-family:times,serif}.sb.wrapper{position:relative;-webkit-transition:left 350ms cubic-bezier(0.075,0.82,0.165,1);-moz-transition:left 350ms cubic-bezier(0.075,0.82,0.165,1);transition:left 350ms cubic-bezier(0.075,0.82,0.165,1)}.connection{cursor:pointer !important}.connection.agent,.glow,.fo,foreignobject,foreignObject{pointer-events:none}.context-menu,.context-label{position:absolute;top:-1000px;left:-1000px;width:150px;font-family:"Lucida Grande",sans-serif;font-style:normal;font-size:10px;letter-spacing:0;color:#333;line-height:20px;background:white;box-shadow:0 0 20px black;border:2px solid white;z-index:9999}.context-menu ul li,.context-label ul li{list-style:none;padding-left:15px;cursor:pointer}.context-menu ul li:hover,.context-label ul li:hover{background:rgba(0,0,0,0.1)}.context-menu .nub,.context-label .nub{position:absolute;bottom:-13px;left:50%;margin-left:-6px;height:0;width:0;border-color:transparent;border-style:solid;border-width:6px;border-top-color:white}.tool-tip{pointer-events:none;position:absolute;top:-10000px;left:-10000px;font-family:"Lucida Grande",sans-serif;font-style:normal;font-size:10px;letter-spacing:0;color:#333;line-height:20px;background:white;box-shadow:0 0 20px black;border:2px solid white;z-index:9999;padding:0 15px}.tool-tip:after{position:absolute;top:50%;right:-13px;margin-top:-6px;height:0;width:0;border-color:transparent;border-style:solid;border-width:6px;border-left-color:white;content:""}.context-label{content:" ";width:auto;padding:0 12.5px;text-transform:capitalize;min-width:50px;text-align:center}@-webkit-keyframes glow{from{box-shadow:0 0 0 #ff3f3f}to{box-shadow:0 0 18px #ff3f3f}}@-moz-keyframes glow{from{box-shadow:0 0 0 #ff3f3f}to{box-shadow:0 0 18px #ff3f3f}}@-o-keyframes glow{from{box-shadow:0 0 0 #ff3f3f}to{box-shadow:0 0 18px #ff3f3f}}@keyframes glow{from{box-shadow:0 0 0 #ff3f3f}to{box-shadow:0 0 18px #ff3f3f}}.inner-dom{cursor:-webkit-grab;width:100%;height:100%;overflow:hidden;background:#191919;line-height:0}.inner-dom .preview p{display:inline-block;vertical-align:baseline;zoom:1;*display:inline;*vertical-align:auto;line-height:25px;vertical-align:top}.inner-dom .preview p span {vertical-align:super;}.inner-dom .preview p:hover{color:#ff3f3f}.inner-dom .preview p:hover:before{background-image:url(./images/hover/viewport.svg)}.inner-dom .preview p:before{display:inline-block;vertical-align:baseline;zoom:1;*display:inline;*vertical-align:auto;width:25px;height:25px;background:url(./images/viewport.svg) center center no-repeat;content:""}.inner-dom .description{min-width:128px;min-height:210px;padding:10px 0 0 10px;z-index:9999;color:#fff;line-height:25px}.inner-dom .description span:hover{color:#ff3f3f}.inner-dom .description.s-video{background:red !important}.inner-dom .description.s-data{background:green !important}.inner-dom .description.s-shader{background:blue !important}.inner-dom .description i.info{margin-bottom:20px;text-align:center;display:block;width:12px;height:12px;line-height:18px;overflow:hidden;text-indent:-9999px;background:black;border-radius:50%}.inner-dom .description i.info:hover{background:#ff3f3f}.inner-dom .description i.info.enabled{background:#ff3f3f;-webkit-animation-name:glow;-moz-animation-name:glow;animation-name:glow;-webkit-animation-duration:750ms;-moz-animation-duration:750ms;animation-duration:750ms;-webkit-animation-timing-function:ease-out;-moz-animation-timing-function:ease-out;animation-timing-function:ease-out;-webkit-animation-direction:alternate;-moz-animation-direction:alternate;animation-direction:alternate;-webkit-animation-iteration-count:infinite;-moz-animation-iteration-count:infinite;animation-iteration-count:infinite}g g g:hover .inner-dom .description{display:block}g g g:hover .inner-dom img,g g g:hover .inner-dom canvas,g g g:hover .inner-dom video{display:none}.sb.graph{position:relative;width:100%;height:100%;background-color:#191919}.sb.graph .frame{cursor:-webkit-grab}.sb.viewport{position:absolute;top:0;left:0;right:0;bottom:0}.sb.viewport,.sb.viewport *{pointer-events:none}.sb.inspector{position:absolute;right:0;top:0;bottom:0;width:25px;overflow:visible;line-height:18px;color:white}.sb.inspector h1,.sb.inspector h2,.sb.inspector h3,.sb.inspector h4,.sb.inspector h5,.sb.inspector h6{font-weight:normal}.sb.inspector:not(.hide-drawer):hover .drawer,.sb.inspector:not(.hide-drawer) .drawer.enabled{left:-300px}.sb.inspector .add,.sb.inspector .home,.sb.inspector .share,.sb.inspector .fullpage,.sb.inspector .fullscreen,.sb.inspector .switch{position:relative;overflow:visible;width:25px;height:18px;margin:15px 0 32px 0}.sb.inspector .add{height:18px;background:url(./images/plus.svg) center center no-repeat}.sb.inspector .add:hover,.sb.inspector .add.enabled{background-image:url(./images/hover/plus.svg)}.sb.inspector .home{height:18px;background:url(./images/toggle.svg) center center no-repeat}.sb.inspector .home:hover,.sb.inspector .home.enabled{background-image:url(./images/hover/toggle.svg)}.sb.inspector .share{margin-left:2px;height:18px;background:url(./images/link.svg) center center no-repeat}.sb.inspector .share:hover,.sb.inspector .share.enabled{background-image:url(./images/hover/link.svg)}.sb.inspector .fullpage{height:18px;background:url(./images/fullpage.svg) center center no-repeat}.sb.inspector .fullpage:hover,.sb.inspector .fullpage.enabled{background-image:url(./images/hover/fullpage.svg)}.sb.inspector .fullscreen{height:18px;background:url(./images/fullscreen.svg) center center no-repeat}.sb.inspector .fullscreen:hover,.sb.inspector .fullscreen.enabled{background-image:url(./images/hover/fullscreen.svg)}.sb.inspector .fullscreen.set{background:url(./images/i-fullscreen.svg) center center no-repeat}.sb.inspector .fullscreen.set:hover,.sb.inspector .fullscreen.set.enabled{background-image:url(./images/hover/i-fullscreen.svg)}.sb.inspector .switch{height:18px;background:url(./images/viewport.svg) center center no-repeat}.sb.inspector .switch:hover,.sb.inspector .switch.enabled{background-image:url(./images/hover/viewport.svg)}.sb.inspector .switch.viewport{height:18px;background:url(./images/graph.svg) center center no-repeat}.sb.inspector .switch.viewport:hover,.sb.inspector .switch.viewport.enabled{background-image:url(./images/hover/graph.svg)}.sb.inspector div.number{overflow:hidden}.sb.inspector div.string textarea{margin:0 0 0 20px;width:139px;height:200px;display:block;background:#3b3b3b;color:white;font-size:13px;line-height:18px;border:0;padding:0 10px;resize:none;outline:0}.sb.inspector div.number div.slider{display:inline-block;vertical-align:baseline;zoom:1;*display:inline;*vertical-align:auto;position:relative;line-height:0;width:60%;line-height:15px;height:18px;background:rgba(255,255,255,0.1);vertical-align:top;cursor:ew-resize}.sb.inspector div.number div.slider div.fg{background:rgba(255,255,255,0.1);border-right:1px solid rgba(255,255,255,0.5);height:100%;top:0;left:0;bottom:0;width:0}.sb.inspector div.number input[type="text"],.sb.inspector div.string input[type="text"]{color:white;margin-left:12px;font-size:85%;height:16px;border:0;background:transparent;border-bottom:1px solid #bbb;text-align:right;width:20%;outline:0}.sb.inspector .drawer{position:absolute;height:100%;width:300px;background:#0f0f0f;-webkit-transition:left 350ms cubic-bezier(0.075,0.82,0.165,1);-moz-transition:left 350ms cubic-bezier(0.075,0.82,0.165,1);transition:left 350ms cubic-bezier(0.075,0.82,0.165,1)}.sb.inspector .drawer ul.params-listing,.sb.inspector .drawer ul.node-listing{position:absolute;top:0;left:0;right:0;bottom:0;overflow:auto}.sb.inspector .drawer ul.params-listing li.shell,.sb.inspector .drawer ul.node-listing li.shell{margin:0 !important;padding:0 !important;border:0 !important}.sb.inspector .drawer ul.params-listing li.shell:hover,.sb.inspector .drawer ul.node-listing li.shell:hover{background:transparent}.sb.inspector .drawer ul.params-listing li:not(:first-child){cursor:default}.sb.inspector .drawer ul.params-listing li.function{cursor:pointer}.sb.inspector .drawer li h3{letter-spacing:1px;font-size:100%;vertical-align:top;position:relative}.sb.inspector .drawer li h3 div.delete{position:absolute;top:3px;right:30px;width:10px;height:10px;text-indent:-9999px;cursor:pointer;background:url(./images/x.svg) center center no-repeat;content:""}.sb.inspector .drawer li h3 div.delete:hover{background-image:url(./images/hover/x.svg)}.sb.inspector .drawer li.param{font-style:italic;overflow:hidden}.sb.inspector .drawer li.param:hover{overflow:visible}.sb.inspector .drawer li.param:hover label+div.string{overflow:visible}.sb.inspector .drawer .io-0-1{padding-left:60px;background:url(./images/nodes/0-1.svg) 25px center no-repeat}.sb.inspector .drawer .io-1-1{padding-left:60px;background:url(./images/nodes/1-1.svg) 25px center no-repeat}.sb.inspector .drawer .io-2-1{padding-left:60px;background:url(./images/nodes/2-1.svg) 25px center no-repeat}.sb.inspector .drawer .io-3-1{padding-left:60px;background:url(./images/nodes/3-1.svg) 25px center no-repeat}.sb.inspector .drawer label{cursor:pointer;width:25%;text-transform:capitalize;text-overflow:ellipsis;letter-spacing:1px;font-size:15px}.sb.inspector .drawer label,.sb.inspector .drawer label+*{display:inline-block;vertical-align:baseline;zoom:1;*display:inline;*vertical-align:auto;overflow:hidden;height:18px;vertical-align:top}.sb.inspector .drawer label+*{width:75%}.sb.inspector .drawer ul{list-style:none}.sb.inspector .drawer ul li{letter-spacing:1px;padding:15px 0 16px 25px;border-bottom:1px solid rgba(255,255,255,0.1)}.sb.inspector .drawer ul li:not(:first-child){cursor:pointer}.sb.inspector .drawer ul li:not(:first-child):hover{background-color:rgba(255,255,255,0.1)}.sb.inspector .drawer ul li:first-child{border-bottom-color:rgba(255,255,255,0.2)}.sb.inspector .panel{position:absolute;top:0;left:0;right:0;bottom:0;background:#191919;text-align:center;list-style:none;padding:0;font-size:12px}.sb.inspector .panel li.enabled,.sb.inspector .panel li:hover{color:#ff3f3f}.sb.inspector .panel li{cursor:pointer}.sb.inspector .panel li.fullpage{position:absolute;margin:0;bottom:115px}.sb.inspector .panel li.fullscreen{position:absolute;margin:0;bottom:65px}.sb.inspector .panel li.switch{position:absolute;margin:0;bottom:15px}.url-context-menu{display:none;opacity:0;position:absolute;top:0;left:0;width:100%;height:100%;-webkit-transition:opacity 150ms ease-out;-moz-transition:opacity 150ms ease-out;transition:opacity 150ms ease-out;color:white}.url-context-menu .backdrop{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.25)}.url-context-menu .loader{position:absolute;top:0;left:0;width:100%;height:100%}.url-context-menu .loader .content{padding-top:40px}.url-context-menu .container{position:absolute;width:500px;height:165px;top:50%;left:50%;margin-left:-250px;margin-top:-82px;background:black;box-shadow:0 0 20px rgba(0,0,0,0.5);text-align:center;border:1px solid #444}.url-context-menu .container>div{padding:30px 25px 25px}.url-context-menu .container div.divider{width:25%;border-bottom:1px solid #666;content:"";height:0;margin:0 auto}.url-context-menu .container p{letter-spacing:1px;margin-bottom:25px}.url-context-menu .container input{color:white;font-size:100%;font-family:times,serif;display:inline-block;vertical-align:baseline;zoom:1;*display:inline;*vertical-align:auto;margin-top:25px;border:0;border-bottom:1px solid #bbb;outline:0;letter-spacing:1px;width:60%;background:transparent}svg .preset{cursor:pointer;opacity:.9;-webkit-transition:opacity .35s ease-out;-moz-transition:opacity .35s ease-out;transition:opacity .35s ease-out}svg .preset:hover{opacity:1.0}',uniqueId:function(e){var t=Date.now();return i===t?(t+="-"+r,r++):(i=t,r=0),_.isString(e)?e+t:t},Nodes:{}}),_.extend(s.prototype,Backbone.Events,{appendTo:function(e){return e.appendChild(this.domElement),this.container=e,this.json&&(this.loadJSON(this.json),_.isFunction(this.__callback)&&this.__callback(),delete this.json,delete this.__callback),this},add:function(e){return e.attach(this),_.isFunction(e.resize)&&e.resize(this.width,this.height),this.graph.add(e),this.nodes.push(e),this.inspector.add(e),this},remove:function(e){var t=_.indexOf(this.nodes,e);return e.destroy(),t<0||(this.nodes.splice(t,1),this.graph.remove(e),this.inspector.remove(e)),this},clear:function(){return _.each(_.toArray(this.nodes),function(e){this.remove(e)},this),this.preview.inputs.buffer=null,this.inspector.__focused=!1,this},connectNubs:function(e,t,i){var r=this.graph.background.children[e.parentId].object,n=this.graph.background.children[t.parentId].object,o=e.name;return r.inputs[o]&&(r.inputs[o]=null,this.graph.clearNub(e)),this.graph.connectNubs(t,e,i),r.inputs[o]=n.outputs[t.name],this},connect:function(e,t,i,r){var n=_.isString(e),o=_.isString(i),a=p2=e;n&&o&&(a=e,p2=i,i=r,r=arguments[4]);var s=this.graph.getShapeByObject(t),l=this.graph.getShapeByObject(i);return this.graph.connectNubs(l.outputs[p2],s.inputs[a],!!r),t.inputs[a]&&this.disconnect(a,t,t.inputs[a].__parentNode),t.inputs[a]=i.outputs[p2],this},disconnect:function(e,t,i,r){var n=this.graph.getShapeByObject(t),o=this.graph.getShapeByObject(i);return(r=r||this.graph.getConnection(o.outputs[e],n.inputs[e]))&&(r.die=!0,t.inputs[e]=null),this},setSize:function(e,t){return this.width=Math.min(e,2048),this.height=this.width/s.aspectRatio,_.each(this.nodes,function(e){_.isFunction(e.resize)&&e.resize(this.width,this.height)},this),this.graph.setSize(this.width,this.height),this.viewport.setSize(2*this.width,this.height),_.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"}),_.extend(this.wrapper.style,{width:2*this.width+"px",height:this.height+"px"}),this.showing.value||(this.wrapper.style.left=-this.width+"px"),this},update:function(){return this.viewport.renderer.clearTarget(),_.each(this.nodes,function(e){e.update()}),this.preview.update(),this.showing.viewport&&this.viewport.update(),(this.showing.graph||this.showing.force)&&this.graph.update(),this},showViewport:function(){var e=this;return this.showing.graph=!0,this.showing.viewport=!0,clearTimeout(this.__timeout),this.__timeout=setTimeout(function(){e.showing.graph=!1,e.showing.viewport=!0},s.transitionDuration),this.showing.value=!1,_.extend(this.wrapper.style,{left:-this.width+"px"}),this.inspector.showParamsListing(),this.trigger("viewport")},showGraph:function(){var e=this;return this.showing.graph=!0,this.showing.viewport=!0,clearTimeout(this.__timeout),this.__timeout=setTimeout(function(){e.showing.graph=!0,e.showing.viewport=!1},s.transitionDuration),this.showing.value=!0,_.extend(this.wrapper.style,{left:0}),this.trigger("graph")},toggle:function(){return this.showing.value?this.showViewport():this.showGraph(),this},setJSON:function(e,t){return this.json=e,_.isFunction(t)&&(this.__callback=t),this},loadJSON:function(){this.loader.clear(),this.clear();var e=arguments[0];return _.isString(e)&&(e=JSON.stringify(JSON)),this.preview.setId(e.output.id),this.graph.setPosition(this.preview,e.output.position),_.each(e.nodes,function(e){var t=new s.Nodes[e.property];t.setId(e.id),t.setParams(e.params),this.add(t),this.graph.setPosition(t,e.position)},this),_.each(e.connections,function(e){var t=this.getNodeById(e.input.id),i=this.getNodeById(e.output.id);this.connect(e.input.property,t,e.output.property,i)},this),this.showing.force=!0,_.delay(_.bind(function(){this.showing.force=!1},this),1e3),this},toJSON:function(e){var t={output:{id:this.preview.id,position:this.graph.getPosition(this.preview)},connections:_.map(this.graph.getConnections(),function(e){var t=graph.background.children[e.next.parentId].object,i=graph.background.children[e.prev.parentId].object;return{input:{id:t.id,property:e.next.name},output:{id:i.id,property:e.prev.name}}}),nodes:_.map(this.nodes,function(e){return{property:function(e){for(var t in s.Nodes)if(e instanceof s.Nodes[t])return t;return null}(e),id:e.id,params:e.extractParams(),position:this.graph.getPosition(e)}})};return e?JSON.stringify(t):t},getNodeById:function(e){if(e===this.preview.id)return this.preview;for(var t in this.nodes){var i=this.nodes[t];if(i.id===e)return i}return null}}),_.uniqueId=s.uniqueId}(),function(){$(window);var i=Sandbox.Viewport=function(e){var t=_.defaults(e||{},{width:1920,height:1080});this.width=t.width,this.height=t.height,this.domElement=document.createElement("div"),$(this.domElement).addClass(i.className+" "+Sandbox.className),this.renderer=new THREE.WebGLRenderer({preserveDrawingBuffer:!0,antialias:!1}),this.renderer.setClearColor(new THREE.Color(0),0),this.renderer.autoClear=!1,this.domElement.appendChild(this.renderer.domElement),this.setSize(this.width,this.height),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,-1,1),this.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),new THREE.MeshBasicMaterial({map:null})),this.scene=new THREE.Scene,this.scene.add(this.quad),this.inputs={buffer:null}};_.extend(i,{className:"viewport"}),_.extend(i.prototype,{appendTo:function(e){return e.appendChild(this.domElement),this},setSize:function(e,t){return this.width=e,this.height=t,this.renderer.setSize(e/(window.devicePixelRatio||1),t/(window.devicePixelRatio||1)),_.extend(this.domElement.style,{width:e+"px",height:t+"px"}),_.extend(this.renderer.domElement.style,{width:e+"px",height:t+"px"}),this},update:function(){return this.inputs.buffer&&this.render(this.inputs.buffer,this.width/2,0,this.width/2,this.height),this},render:function(e,t,i,r,n){return this.quad.material.map=e,this.renderer.setViewport(t,this.height-n-i,r,n),this.renderer.render(this.scene,this.camera),this}})}(),function(){var e=Sandbox,r=document.createElement("canvas"),b=$(window),R=$(document.body),w=new Two.Vector,H=/^(buffer|texture|video)$/gi,S=/^(scene|data)$/gi;$(function(){b=$(window),R=$(document.body),b.scroll(function(){w.set(b.scrollLeft(),b.scrollTop())})});var M=e.Graph=function(e){var o=graph=this,t=_.defaults(e||{},{size:50});this.size=t.size,this.domElement=document.createElement("div"),this.two=new Two({width:t.width,height:t.height}).appendTo(this.domElement),_.extend(this.domElement.style,{width:t.width+"px",height:t.height+"px"}),this.inputs=[],this.outputs=[],this.needsReset=!0,this.shouldRender=!0,Object.defineProperty(this,"width",{get:function(){return this.two.width},set:function(e){this.setSize(e,this.height)}}),Object.defineProperty(this,"height",{get:function(){return this.two.height},set:function(e){this.setSize(this.width,e)}}),_.extend(this.two.renderer.domElement.style,{position:"absolute"}),M.InitializeGraph(this),this.bind("connect",this.connect).bind("disconnect",this.disconnect);var a=new Two.Vector;this.two.bind("update",function(e,t){graph.dragging&&graph.needsReset&&(e,graph.needsReset=!1);var i=o.connection.vertices[1];i.addSelf(a.copy(i.destination).subSelf(i).multiplyScalar(.3)),i.equals(o.connection.vertices[0])&&o.connection.visible&&(o.connection.visible=!1),_.each(o.connections.children,function(e){if(e.visible&&e.domElement&&e!==o.connection)if(e.die&&(e.opacity-=.3*e.opacity,e.fillament.opacity=e.opacity,e.opacity<=.001&&e.visible))o.disconnect(e);else{if(!e.die&&e.opacity!==e.__opacity){var t=e.__opacity-e.opacity;Math.abs(t)<.01?e.opacity=e.__opacity:e.opacity+=.125*t}var i=e.vertices[0],r=e.vertices[3];i.destination&&(i.addSelf(a.copy(i.destination).subSelf(i).multiplyScalar(.3)),i.equals(i.destination)&&delete i.destination),r.destination&&(r.addSelf(a.copy(r.destination).subSelf(r).multiplyScalar(.3)),r.equals(r.destination)&&delete r.destination);e.fillament.t;var n=e.domElement.getTotalLength();e.fillament.translation.copy(e.domElement.getPointAtLength(n*e.fillament.t)),e.fillament.t+=10/n,.99<e.fillament.t&&(e.fillament.t=0)}}),_.each(o.background.children,function(e){var t=e.object;_.isFunction(t.update)&&t.update(),e.destination&&e.translation.addSelf(a.copy(e.destination).subSelf(e.translation).multiplyScalar(.3))})})};function C(e,t,i){var r=e.connections.children;for(var n in r){var o=r[n];if(o[i]&&o[i].id===t.id)return!0}return!1}_.extend(M,{className:"graph",Threshold:{distance:{x:160,y:70}},Colors:{content:"white",active:"rgb(255, 63, 63)",background:"#333"},Templates:{description:'<div class="description s-<%= type %>"><span><%= name %></span></div>',preview:'<div class="preview description s-<%= type %>"><p><span><%= name %></p></span></div>',image:"",canvas:"",video:""},ContextLabel:{domElement:document.createElement("div"),show:function(t,i,e){var r=M.ContextLabel.domElement;r.querySelector(".content").innerHTML=e.replace(/[0-9]/gi,""),_.defer(function(){var e=r.getBoundingClientRect();_.extend(r.style,{display:"block",top:i-e.height-20+"px",left:t-e.width/2+"px"})})},hide:function(){_.extend(M.ContextLabel.domElement.style,{top:"-1000px",left:"-1000px"})}},ContextMenu:{domElement:document.createElement("div"),show:function(e,t,i){var r=$(M.ContextMenu.domElement.querySelector(".remove")),n=function(e){M.ContextMenu.hide(),b.unbind("click",n),r.unbind("click",i)},o=M.ContextMenu.domElement.getBoundingClientRect();_.extend(M.ContextMenu.domElement.style,{display:"block",top:t-o.height-10+"px",left:e-o.width/2+"px"}),_.defer(function(){b.bind("click",n)}),r.bind("click",i)},hide:function(){_.extend(M.ContextMenu.domElement.style,{top:"-1000px",left:"-1000px"})}},GetCommonProperty:function(e,t){for(var i in e.object.outputs)for(var r in t.object.inputs)if(i===r)return i;return null},ApplyConnectionStyles:function(t,i){var e=i.two;t.fill="none",t.stroke=M.Colors.active,t.linewidth=3,t.fillament=e.makeCircle(0,0,2),t.fillament.noStroke().fill="white",t.fillament.t=0,t.visible=t.fillament.visible=!1,t.domElement=document.querySelector("#two-"+t.id),t.domElement&&t.domElement.setAttribute("class","connection"),t.__opacity=1,$(t.domElement).bind("click",function(e){e.preventDefault(),M.ContextMenu.show(e.clientX+R.scrollLeft(),e.clientY+R.scrollTop(),function(){i.trigger("disconnect",t)})})},InitializeGraph:function(e){var t=e.size,i=e.two;$(e.domElement).addClass(M.className+" "+Sandbox.className),M.CreateGrid(e.domElement,t),e.connection=i.makeLine(0,0,0,0),M.ApplyConnectionStyles(e.connection,e),e.connection.fillament.remove(),e.connection.vertices[1].destination=(new Two.Vector).copy(e.connection.vertices[1]);Sandbox.aspectRatio;e.connections=i.makeGroup(),e.background=i.makeGroup()},GenerateDOM:function(e){var t=document.createElement("div");return t.classList.add("inner-dom"),t.style.visibility="visible",t.innerHTML=e,t},CreateGrid:function(e,t){r.width=r.height=t;var i=r.getContext("2d");i.clearRect(0,0,t,t),i.strokeStyle="rgba(255, 255, 255, 0.15)",i.beginPath(),i.moveTo(t,0),i.lineTo(t,t),i.lineTo(0,t),i.stroke(),_.extend(e.style,{backgroundImage:"url("+r.toDataURL("image/png")+")",backgroundRepeat:"repeat"})},CreateNub:function(e){var t=e.width;height=e.height,pct=e.pct,bleed=e.bleed,spread=e.spread,graph=e.graph,two=graph.two,color=e.color,group=e.group,k=e.k,v=e.v,i=e.i,isInput=e.isInput,x=isInput?-t/2:t/2,y=pct*spread-spread/2;var r=two.makeCircle(x,y,bleed);r.linewidth=bleed,r.stroke=color,r.fill=M.Colors.background;var n=two.makeCircle(x,y,bleed+bleed);return n.noFill().stroke="rgba(255, 255, 255, 0.66)",n.linewidth=7,n.elem=two.renderer.domElement.querySelector("#two-"+n.id),n.elem.classList.add("glow"),n.visible=!1,r.isInput=isInput,r.parentId=group.id,r.name=k,r.elem=two.renderer.domElement.querySelector("#two-"+r.id),$(r.elem).addClass("frame nub"),r.glow=n,r},CreateElement:function(c,u){var n=M.Colors.content,e=c.two,o=$(c.domElement),a=u.name===Sandbox.Preview.prototype.name?250:150,s=a/Sandbox.aspectRatio,l=e.makeGroup(),t=e.makeRectangle(0,0,a,s).noStroke(),i=e.makeRectangle(0,0,a-8,s-8).noStroke(),r=e.renderer.domElement.querySelector("#two-"+t.id);$(r).addClass("frame nub"),t.fill=n,l.shouldRender=!0,e.renderer.domElement.querySelector("#two-"+i.id).classList.add("fo");var h=_.size(u.inputs),p=0,d={},f=.75*s;_.each(u.inputs,function(e,t){var i=(p+1)/(h+1),r=M.CreateNub({i:p,k:t,v:e,graph:c,group:l,width:a,height:s,pct:i,color:n,spread:f,bleed:4,isInput:!0});$(r.elem).bind("mousedown",function(e){isInput=!0,y.call(r,e)}).bind("mouseup",function(e){c.__nub=r}).hover(function(e){var t=r.elem.getBoundingClientRect();M.ContextLabel.show(t.left+t.width/2,t.top+t.height/2+R.scrollTop(),r.name)},function(){M.ContextLabel.hide()}),c.inputs.push(r),d[t]=r,p++}),h=_.size(u.outputs),p=0;var m={};_.each(u.outputs,function(e,t){var i=(p+1)/(h+1),r=M.CreateNub({i:p,k:t,v:e,graph:c,group:l,width:a,height:s,pct:i,color:n,spread:f,bleed:4,isInput:!1});$(r.elem).bind("mousedown",function(e){isInput=!1,y.call(r,e)}).bind("mouseup",function(e){c.__nub=r}).hover(function(e){var t=r.elem.getBoundingClientRect();M.ContextLabel.show(t.left+t.width/2,t.top+t.height/2+R.scrollTop(),r.name)},function(){M.ContextLabel.hide()}),c.outputs.push(r),m[t]=r,p++}),_.each(d,function(e){l.add(e.glow)}),_.each(m,function(e){l.add(e.glow)}),l.add(t).add(_.toArray(d)).add(_.toArray(m)).add(i),l.translation.set(e.width/2,e.height/2),l.destination=(new Two.Vector).copy(l.translation);var E=new Two.Vector,v=function(e){e.preventDefault(),c.shouldRender=!1;var t=e.clientX-E.x+w.x,i=e.clientY-E.y+w.y;e.shiftKey&&(t=M.SnapTo(t,c.size),i=M.SnapTo(i,c.size)),l.destination.set(t,i)},g=function(e){e.preventDefault(),c.shouldRender=!0,document.body.classList.remove("dragging"),b.unbind("mousemove",v).unbind("mouseup",g)};$(e.renderer.domElement.querySelector("#two-"+l.id)).hover(function(){l.shouldRender=!1},function(){l.shouldRender=!0}),l.mousedown=function(e){e.preventDefault(),scrollTop=R.scrollTop(),document.body.classList.add("dragging");var t=o.offset();E.x=t.left+e.clientX+w.x-(t.left+l.translation.x),E.y=t.top+e.clientY+w.y-(t.top+l.translation.y),b.bind("mousemove",v).bind("mouseup",g)},$(r).bind("mousedown",l.mousedown);var y=function(e){e.preventDefault(),document.body.classList.add("dragging"),u=this,c.dragging=!0,c.__nub=void 0,u.fill=M.Colors.active,c.needsReset=!0;var t=u.isInput?"outputs":"inputs";_.each(c.connections.children,function(e){e.__opacity=.33});var n=u.name.replace(/[0-9]/gi,"");_.each(c[t],function(e){var t=e.name.replace(/[0-9]/gi,""),i=n==t,r=n.match(H)&&t.match(H);(i||r)&&e.parentId!==u.parentId&&(e.glow.visible=!0)});var i=(new Two.Vector).copy(u.translation).addSelf(l.translation);c.connection[isInput?"next":"prev"]=l,_.each(c.connection.vertices,function(e){e.copy(i),e.destination&&e.destination.copy(i)});var r=o.offset();E.set(r.left,r.top),b.bind("mousemove",T).bind("mouseup",x)},T=function(e){e.preventDefault();var t=e.clientX-E.x+w.x,i=e.clientY-E.y+w.y;c.connection.visible=!0,c.connection.vertices[1].destination.set(t,i)},x=function(e){e.preventDefault(),document.body.classList.remove("dragging"),c.dragging=!1,b.unbind("mousemove",T).unbind("mouseup",x);var t=new Two.Vector;new Two.Vector;t.x=e.clientX-E.x,t.y=e.clientY-E.y,c.connection.vertices[1].destination.copy(c.connection.vertices[0]),_.each(c.connections.children,function(e){e.__opacity=1});var i=u.isInput?"outputs":"inputs";_.each(c[i],function(e){e.glow.visible=!1});var r=c.__nub;if(r&&u.isInput!==r.isInput){var n=u,o=r;r.isInput&&(n=r,o=u);var a=n.name.replace(/[0-9]/gi,""),s=o.name.replace(/[0-9]/gi,""),l=a==s,h=a.match(S)||s.match(S);if((l||!h)&&n.parentId!==o.parentId)return c.connection.vertices[0].clear(),c.connection.vertices[1].clear(),c.connection.vertices[1].destination.clear(),delete c.connection.prev,delete c.connection.next,void c.trigger("connect",o,n,!0)}C(c,u,u.isInput?"next":"prev")||(u.fill=M.Colors.background),delete c.connection.prev,delete c.connection.next};return l.inputs=d,l.outputs=m,l.content=i,c.background.add(l),l},InjectHTML:function(t,i,e){var r=i.content.getBoundingClientRect(),n=Two[Two.Types.svg].Utils.createElement("foreignObject",{x:-r.width/2,y:-r.height/2,width:r.width,height:r.height}),o=M.GenerateDOM(e);$(n).bind("mousedown",i.mousedown),$(o.querySelector("span")).css("cursor","pointer").bind("click",function(e){e.preventDefault(),e.stopPropagation(),t.trigger("focus",i)}),$(o.querySelector("p")).css("cursor","pointer").bind("click",function(e){t.trigger("preview")}),n.appendChild(o),i.domElement.appendChild(n)},SnapTo:function(e,t){return Math.round(e/t)*t}}),_.extend(M.prototype,Backbone.Events,{appendTo:function(e){return e.appendChild(this.domElement),this},setSize:function(e,t){return $(this.domElement).width(e).height(t),this.two.width=e,this.two.height=t,this.two.renderer.setSize(e,t),this},add:function(t){var i=this,r=M.CreateElement(this,t);return r.object=t||{},r.domElement=this.two.renderer.domElement.querySelector("#two-"+r.id),_.isUndefined(r.object.html)||M.InjectHTML(this,r,r.object.html),t.bind("update",function(){if(t.renderer&&i.shouldRender&&r.shouldRender&&t.buffer){var e=r.content.getBoundingClientRect();t.viewport.render(t.buffer,e.left,e.top,e.width,e.height)}}),this.disperse(r),r},remove:function(e){var t=this.getShapeByObject(e);return _.each(t.inputs,function(e){this.clearNub(e)},this),_.each(t.outputs,function(e){this.clearNub(e)},this),t.remove(),this},clearNub:function(t){return _.each(this.connections.children,function(e){(t.isInput&&e.next&&e.next.id===t.id||!t.isInput&&e.prev&&e.prev.id===t.id)&&(e.die=!0)},this),this},connectNubs:function(e,t,i){var r=this.two,n=this.background.children[e.parentId],o=this.background.children[t.parentId],a=e.translation,s=t.translation;e.fill=t.fill=M.Colors.active;var l=[new Two.Vector,new Two.Vector,new Two.Vector,new Two.Vector],h=r.makeCurve(l,!0);M.ApplyConnectionStyles(h,this),h.fillament.visible=h.visible=!0,i&&(l[0].destination=new Two.Vector,l[3].destination=new Two.Vector);var c=function(){var e=l[0].destination?l[0].destination:l[0],t=l[3].destination?l[3].destination:l[3];e.copy(n.translation),t.copy(o.translation),l[1].copy(a).addSelf(n.translation),l[2].copy(s).addSelf(o.translation)};o.translation.bind(Two.Events.change,c),n.translation.bind(Two.Events.change,c),c();var u=Math.atan2(l[2].y-l[1].y,l[2].x-l[2].y),p=a.length()/10,d=p*Math.cos(u)+l[2].x,f=p*Math.sin(u)+l[2].y;return l[3].set(d,f),u+=Math.PI,d=p*Math.cos(u)+l[1].x,f=p*Math.sin(u)+l[1].y,l[0].set(d,f),h.next=t,h.prev=e,this.connections.add(h,h.fillament),h},disconnect:function(e){return e.fillament.visible=e.visible=!1,e.remove(),e.fillament.remove(),C(this,e.prev,"prev")||(e.prev.fill=M.Colors.background),C(this,e.next,"next")||(e.next.fill=M.Colors.background),this},disperse:function(e){if(e.__set)return this;var t=new Two.Vector;for(var i in this.background.children){var r=this.background.children[i];if(e.id!==r.id)if(t.copy(e.destination).subSelf(r.destination),!(t.length()>M.Threshold.distance.x)){var n=Math.atan2(t.y,t.x)+(void 0,Math.floor(3*Math.random())/2*Math.PI-Math.PI/2);return e.destination.x+=(M.Threshold.distance.x-Math.abs(t.x))*Math.cos(n),e.destination.y+=(M.Threshold.distance.y-Math.abs(t.y))*Math.sin(n),_.defer(_.bind(this.disperse,this,e)),this}}return this},update:function(){return this.two.update(),this},getShapeByObject:function(e){var t=this.background.children;for(var i in t){var r=t[i];if(r.object.id===e.id)return r}return null},getConnection:function(e,t){var i=e.id,r=t.id,n=this.connections.children;for(var o in n){var a=n[o];if(a.next&&a.prev&&(a.next.id===r&&a.prev.id===i))return a}return null},getConnections:function(e){var t=[];return _.each(this.connections.children,function(e){(e.next||e.prev)&&t.push(e)}),e&&t.splice(0,1),t},getPosition:function(e){var t=this.getShapeByObject(e);return t?{x:Math.round(t.translation.x),y:Math.round(t.translation.y)}:null},setPosition:function(e,t){var i=this.getShapeByObject(e);return i&&(i.destination.copy(t),i.__set=!0),this},cascade:function(i){this.size;var e=this.background.children,r=(_.size(e),0),n=0,o=0,a=0;return _.each(e,function(e){var t=e.getBoundingClientRect();o+=t.width/2,a+=t.height/2}),r=(this.width-o)/2,n=(this.height-a)/2,_.each(e,function(e){var t=e.getBoundingClientRect();e.destination.set(i?M.SnapTo(r,this.size):r,i?M.SnapTo(n,this.size):n),r+=t.width/2,n+=t.height/2},this),this},lineup:function(n){var o=this.size,e=this.background.children,a=(_.size(e),0),s=o,l=0;return _.each(e,function(e){var t=e.getBoundingClientRect();l=Math.max(l,t.height),a+o+t.width>this.width-o&&(s+=o+l,l=a=0);var i=(a+=o)+t.width/2,r=s+t.height/2;e.destination.set(n?M.SnapTo(i,this.size):i,n?M.SnapTo(r,this.size):r),a+=t.width},this),this},randomize:function(n){var o=this.two.width,a=this.two.height;return _.each(this.background.children,function(e){var t=e.getBoundingClientRect(),i=Math.random()*(o-t.width)+t.width/2,r=Math.random()*(a-t.height)+t.height/2;e.destination.set(n?M.SnapTo(i,this.size):i,n?M.SnapTo(r,this.size):r)},this),this}}),M.ContextMenu.domElement.classList.add("context-menu"),M.ContextLabel.domElement.classList.add("context-label"),document.body.appendChild(M.ContextLabel.domElement),document.body.appendChild(M.ContextMenu.domElement),M.ContextMenu.domElement.innerHTML='<ul><li class="remove">Remove Connection</li></ul><div class="nub"></div>',M.ContextLabel.domElement.innerHTML='<p class="content"></p><div class="nub"></div>'}(),function(){var u,m;document.createElement("div");$(function(){u=$(window),m=$(document.body)});var p=Sandbox.Inspector=function(e){var t=_.defaults(e||{},{defaultJSON:!0});this.parent=t.parent,this.fullpage=!1,this.domElement=document.createElement("div"),$(this.domElement).addClass(Sandbox.className+" inspector"),this.drawer=document.createElement("div"),this.drawer.classList.add("drawer"),this.panel=document.createElement("ul"),this.panel.classList.add("panel"),this.domElement.appendChild(this.drawer),this.domElement.appendChild(this.panel),p.CreateContextMenu(this),p.CreateNavigation(this),p.CreateNodeListing(this),p.CreateParamsListing(this),this.showNodeListing();var i=_.bind(function(){$(this.panel.querySelector(".fullpage")).trigger("click")},this);if(url.setup){var r=JSON.parse(decodeURIComponent(url.setup));this.parent.setJSON(r,i)}};function l(e,t){var i,r=_.uniqueId("param-");return e.options?i=_.template('<div class="array"><select id="<%= id %>"><% _.each(array, function(o, i) { %><option value="<%= o.value %>" <%= (!_.isUndefined(value) && o.value.toString() === value.toString()) ? "selected" : "" %>><%= o.name %></option><% }); %></select></div>',{id:r,array:e.options,value:e.value}):_.isNumber(e.value)?(e.id=r,i=_.template('<div class="number"><div class="slider"><div class="fg"></div></div><input id="<%= id %>" type="text" value="<%= value %>"></div>',e)):_.isBoolean(e.value)?(e.id=r,i=_.template('<div class="boolean"><input id="<%= id %>" type="checkbox" value="<%= name %>" <%= !!value ? "checked" : "" %>></div>',e)):_.isString(e.value)&&(e.id=r,i=_.template('<div class="string"><textarea id="<%= id %>"><%= value %></textarea></div>',e)),{id:r,name:t,reference:t,html:i}}function E(e,t,i){return Math.min(Math.max(e,t),i)}_.extend(p,{defaultJSON:{output:{id:1376350967933,position:{x:800,y:275}},connections:[{input:{id:1376350967933,property:"buffer"},output:{id:1376350999822,property:"buffer"}},{input:{id:1376351020528,property:"scene"},output:{id:1376351013022,property:"scene"}},{input:{id:1376350999822,property:"normal"},output:{id:1376351020528,property:"buffer"}},{input:{id:1376350999822,property:"video"},output:{id:1376350984248,property:"texture"}}],nodes:[{property:"VideoTexture",id:1376350984248,params:{source:"/media/sandbox/reflektor_1_640.mp4"},position:{x:275,y:400}},{property:"Refraction",id:1376350999822,params:{},position:{x:575,y:275}},{property:"BreakingGlassScene",id:1376351013022,params:{force:.05,spin:1,randomness:.15,radius:.03,damping:.025},position:{x:175,y:125}},{property:"RenderNormals",id:1376351020528,params:{},position:{x:400,y:125}}]},Templates:{navigation:'<li class="add" description="Add node"></li><li class="home" description="Node options"></li><li class="share" description="Share a link"></li><li class="fullpage" description="Expand"></li><li class="fullscreen" description="Fullscreen"></li><li class="switch" description="View output"></li>',nodeListing:'<li class="title"><h3><%= title %></h3></li><% _.each(nodes, function(o) { %><li class="io-<%= o.inputs %>-<%= o.outputs %>" reference="<%= o.reference %>"><%= o.name %></li><% }); %>',paramsListing:'<li class="title"><h3><%= title %><div class="delete"></div></h3></li><% _.each(nodes, function(o, i) { %><li reference="<%= o.reference %>" class="param"><label for="<%= o.id %>"><%= o.name %></label><%= o.html %></li><% }); %>',defaultParamsListing:""},CreateNavigation:function(n){var e=n.parent.width,t=n.parent.height,i=function(){n.snapToScreen()};n.$={};var r=function(){var e=this.getBoundingClientRect();n.toolTip.show(e.left+m.scrollLeft(),e.top+m.scrollTop()+e.height/2,this.getAttribute("description"))},o=function(){n.toolTip.hide()},a=_.debounce(function(){n.parent.graph.shouldRender=!0},2e3);n.panel.innerHTML=p.Templates.navigation;var s=!(localStorage&&localStorage.getItem("opened-graph"));s&&_.delay(function(){r.call(n.$.switcher[0])},1e4),n.$.add=$(n.panel.querySelector(".add")).hover(r,o).bind("click",function(){n.parent.showing.value||n.parent.toggle(),n.showNodeListing()}),n.$.home=$(n.panel.querySelector(".home")).hover(r,o).bind("click",function(){n.showParamsListing(),n.__focused||(n.parent.graph.shouldRender=!1,n.parent.viewport.renderer.clear(),a())}),n.$.share=$(n.panel.querySelector(".share")).hover(r,o).bind("click",function(){var e=window.location.protocol+"//"+window.location.host,t=window.location.pathname,i=n.parent.toJSON(!0).replace(/\s/gi,""),r=e+t+("?editor="+n.parent.showing.value+"&setup="+i);n.contextMenu.show(r)});var l=n.$.fullpage=$(n.panel.querySelector(".fullpage")).hover(r,o).bind("click",function(){BigScreen.exit(),n.fullpage||n.fullscreen?(m.removeClass("fullpage"),_.extend(n.parent.domElement.style,{margin:0}),n.parent.setSize(e,t),u.unbind("resize",i),l.attr("description","Expand sandbox to the page")):(m.addClass("fullpage"),n.snapToScreen(),u.bind("resize",i),l.attr("description","Reduce sandbox within the page")),n.fullpage=!n.fullpage}),h=n.$.fullscreen=$(n.panel.querySelector(".fullscreen")).hover(r,o).bind("click",function(){n.fullpage&&(m.removeClass("fullpage"),_.extend(n.parent.domElement.style,{margin:0}),n.parent.setSize(e,t),u.unbind("resize",i)),BigScreen.toggle(n.parent.domElement,function(){n.parent.setSize(screen.width,screen.height),n.fullscreen=!0,n.fullpage=!1,h.addClass("set"),h.attr("description","Exit fullscreen")},function(){m.removeClass("fullpage"),_.extend(n.parent.domElement.style,{margin:0}),n.parent.setSize(e,t),n.fullscreen=!1,h.removeClass("set"),h.attr("description","Fullscreen")},function(){})}),c=n.$.switcher=$(n.panel.querySelector(".switch")).hover(r,o).bind("click",function(){s&&localStorage&&localStorage.setItem("opened-graph",!0),n.parent.toggle()});n.parent.bind("viewport",function(){c.addClass("viewport"),c.attr("description","Hide output")}).bind("graph",function(){c.removeClass("viewport"),c.attr("description","View output")})},CreateNodeListing:function(i){i.nodeListing=document.createElement("ul"),i.nodeListing.classList.add("node-listing");var e={title:"Select a Node to Add",nodes:_.map(Sandbox.Nodes,function(e,t){var i=new e,r={reference:t,name:e.prototype.name,inputs:_.size(i.inputs),outputs:_.size(i.outputs)};return i.destroy(),r})};i.nodeListing.innerHTML=_.template(p.Templates.nodeListing,e),i.drawer.appendChild(i.nodeListing),_.each(i.nodeListing.children,function(e){var t=e.getAttribute("reference");t&&$(e).bind("click",function(){var e=new Sandbox.Nodes[t];i.parent.add(e)})})},CreateParamsListing:function(e){e.paramsListing=document.createElement("ul"),e.paramsListing.classList.add("params-listing"),e.paramsListing.innerHTML=p.Templates.defaultParamsListing,e.drawer.appendChild(e.paramsListing)},CreateContextMenu:function(r){r.toolTip={domElement:document.createElement("div"),show:function(t,i,e){u.bind("click",r.toolTip.hide),r.toolTip.content.innerHTML=e,_.defer(function(){var e=r.toolTip.domElement.getBoundingClientRect();_.extend(r.toolTip.domElement.style,{top:i-e.height/2+"px",left:t-(e.width+12)+"px",display:"block"})})},hide:function(){_.extend(r.toolTip.domElement.style,{top:-1e4+"px",left:-1e4+"px"}),u.unbind("click",r.toolTip.hide)}},r.contextMenu={domElement:document.createElement("div"),backdrop:document.createElement("div"),container:document.createElement("div"),loader:document.createElement("div"),showLoader:function(e){r.contextMenu.loader.querySelector(".content").innerHTML=e,r.contextMenu.container.style.display="none",r.contextMenu.loader.style.display="block",i()},show:function(e){var t=r.contextMenu.container.querySelector('input[type="text"]');t.value=e||"http://justareflektor.com/sandbox/4567",r.contextMenu.container.style.display="block",r.contextMenu.loader.style.display="none",i(),t.select()},hide:function(){r.contextMenu.domElement.style.opacity=0,_.delay(function(){r.contextMenu.domElement.style.display="none"},150)}};var i=_.throttle(function(){_.extend(r.contextMenu.domElement.style,{display:"block"}),_.defer(function(){r.contextMenu.domElement.style.opacity=1})},1e3);r.contextMenu.domElement.classList.add("url-context-menu"),r.contextMenu.backdrop.classList.add("backdrop"),r.contextMenu.container.classList.add("container"),r.contextMenu.loader.classList.add("loader"),r.toolTip.domElement.classList.add("tool-tip"),r.toolTip.domElement.innerHTML='<span class="content"></span>',r.toolTip.content=r.toolTip.domElement.querySelector(".content"),r.contextMenu.container.innerHTML='<div><p>To share this patch with others, copy and paste this link:</p><div class="divider"></div><input type="text" value=""></div>',r.contextMenu.container.querySelector("input").value="http://justareflektor.com/sandbox/4564",r.contextMenu.loader.innerHTML='<div class="container"><div><p class="content"></p></div></div>',r.contextMenu.domElement.appendChild(r.contextMenu.backdrop),r.contextMenu.domElement.appendChild(r.contextMenu.container),r.contextMenu.domElement.appendChild(r.contextMenu.loader),document.body.appendChild(r.toolTip.domElement),$(r.contextMenu.backdrop).bind("click",function(e){r.contextMenu.hide()})}}),_.extend(p.prototype,{appendTo:function(e){return e.appendChild(this.domElement),e.appendChild(this.contextMenu.domElement),this},showParamsListing:function(){return this.showing=!0,this.nodeListing.style.display="none",this.paramsListing.style.display="block",this.$.home.addClass("enabled"),this.$.add.removeClass("enabled"),this},showNodeListing:function(){return this.showing=!1,this.nodeListing.style.display="block",this.paramsListing.style.display="none",this.$.home.removeClass("enabled"),this.$.add.addClass("enabled"),this},toggle:function(){return this.showing?this.showNodeListing():this.showParamsListing(),this},add:function(e){var t,i,r,o,n,a=_.template(p.Templates.paramsListing,{title:e.name,nodes:_.map(e.params,l)}),s=document.createElement("li");return s.classList.add("shell"),s.id="params-"+e.id,s.innerHTML=a,t=this,r=s,o=(i=e).params,n=r||t.paramsListing,_.each(n.querySelectorAll(".param"),function(e){var t=e.getAttribute("reference"),p=o[t];if(p.options)$(e.querySelector("select")).change(function(e){p.value=this.value,_.isFunction(p.onUpdate)&&p.onUpdate()});else if(_.isNumber(p.value))var i=function(e){e.preventDefault(),e.stopPropagation();var t,i,r,n,o,a,s,l,h,c=d[0].getBoundingClientRect(),u=(t=(e.clientX-c.left)/c.width,i=p,r=E(t,0,1),n=0,o=1,a=i.min,s=i.max,a+(r-n)/(o-n)*(s-a));_.isNumber(p.step)&&(l=u,h=p.step,u=Math.round(l/h)*h),f.val(u).trigger("blur")},r=function(e){e.preventDefault(),e.stopPropagation(),m.removeClass("dragging"),u.unbind("mousemove",i).unbind("mouseup",r)},d=$(e.querySelector(".slider")).bind("mousedown",function(e){e.preventDefault(),e.stopPropagation(),m.addClass("dragging"),u.bind("mousemove",i).bind("mouseup",r)}),n=$(e.querySelector(".fg")),f=$(e.querySelector("input")).bind("keyup",function(e){13===e.which&&f.trigger("blur")}).bind("blur",function(e){var t;p.value=E(this.value,p.min,p.max),n.css("width",100*(t=p).value/(t.max-t.min)+"%")}).trigger("blur");else _.isBoolean(p.value)?$(e.querySelector("input")).change(function(e){p.value=!!this.checked}):_.isString(p.value)&&$(e.querySelector("textarea")).blur(function(e){p.value=$(this).val(),p.onUpdate()})}),$(n.querySelector(".delete")).bind("click",function(e){t.parent.remove(i)}),this.paramsListing.appendChild(s),this},remove:function(e){var t="#params-"+e.id,i=document.querySelector(t);return $(i).remove(),this},focus:function(e){this.__focused=!0,this.drawer.classList.add("enabled");var t=_.bind(function(){this.drawer.classList.remove("enabled"),$(this.domElement).unbind("mouseleave",t)},this);return $(this.domElement).bind("mouseleave",t),this.showParamsListing()},snapToScreen:function(){var e=w=u.width(),t=h=u.height();return e/Sandbox.aspectRatio>t&&(w=t*Sandbox.aspectRatio),w=Math.min(w,1920),h=w/Sandbox.aspectRatio,this.parent.setSize(w,h),_.extend(this.parent.domElement.style,{marginLeft:(e-w)/2+"px",marginTop:(t-h)/2+"px"}),this}})}(),function(){var e=Sandbox.Node=function(){this.id=Sandbox.uniqueId(),this.params={},this.inputs={},this.outputs={},this.scene=new THREE.Scene,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,-1,1),this.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2)),this.scene.add(this.quad),this.destructables=[this.scene,this.camera,this.quad],this.shouldRender=!0};_.extend(e.prototype,Backbone.Events,{type:"Node",update:_.identity,setId:function(e){return this.id=e,this},setParams:function(e){return _.each(e,function(e,t){_.isUndefined(this.params[t])||(this.params[t].value=e,_.isFunction(this.params[t].onUpdate)&&this.params[t].onUpdate())},this),this},getParam:function(e){return this.params[e]&&this.params[e].value},extractParams:function(){var i={};return _.each(this.params,function(e,t){i[t]=this.getParam(t)},this),i},attach:function(e){return this.sandbox=e,this.renderer=e.viewport.renderer,this.viewport=e.viewport,this},createBuffer:function(e){e=_.defaults(e||{},{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1,generateMipmaps:!1,width:0,height:0});var t=new THREE.WebGLRenderTarget(e.width,e.height,e);return t.generateMipmaps=e.generateMipmaps,t.__parentNode=this,t},dispose:function(e){_.isFunction(e.dispose)&&e.dispose();var t=_.indexOf(this.destructables,e);return t<0||this.destructables.splice(t,1),this},destroy:function(){return _.each(_.compact(this.destructables),function(e){_.isFunction(e.dispose)&&e.dispose()}),this.destructables.length=0,this}})}(),function(){var e=Sandbox.Asset=function(e){this._callbacks=[],_.each(e,function(e,t){this[t]=e},this)};_.extend(e.prototype,Backbone.Events,{isReady:!1,ready:function(e,t){return _.isFunction(t)&&(this.isReady?t.call(this):(this._callbacks.push(t),e.loader.add(this))),this},available:function(){return this.isReady=!0,_.each(this._callbacks,function(e){e.call(this)},this),this._callbacks.length=0,this.trigger("dequeue"),this}})}(),function(){var t=document.createElement("div"),i=Sandbox.Loader=function(e){this.sandbox=e,this.domElement=i.GenerateDOM(i.Template),this.queued=0,this.assets=[]};_.extend(i,{Template:'<div class="loader" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 99999; background: #000 url(./media/ajax-loader.gif) center center no-repeat;"></div>',GenerateDOM:function(e){return t.innerHTML=e,t.children[0]}}),_.extend(i.prototype,{appendTo:function(e){return e.appendChild(this.domElement),this},add:function(e){var t=_.bind(function(){this.remove(e),e.unbind("dequeue",t)},this);return e.bind("dequeue",t),this.show(),this.queued++,this.assets.push(e),this},clear:function(){return _.each(this.assets,function(e){e.trigger("dequeue")}),this.assets.length=0,this},remove:function(e){this.queued--,this.queued<=0&&this.hide();var t=_.indexOf(this.assets,e);return t<0||this.assets.splice(t,1),this},show:function(){return this.domElement.style.display="block",this},hide:function(){return this.domElement.style.display="none",this}})}(),function(){var e=Sandbox.Preview=function(){Sandbox.Node.call(this);var t=this,i=null;this.buffer=null,this.inputs.buffer=null,Object.defineProperty(this.inputs,"buffer",{get:function(){return i},set:function(e){i=t.buffer=e}}),this.html=_.template(Sandbox.Graph.Templates.preview,this)};_.extend(e.prototype,Sandbox.Node.prototype,{name:"Output",update:function(){return this.trigger("update")}})}(),THREE.Composite3Shader={uniforms:{texture1:{type:"t",value:null},texture2:{type:"t",value:null},opacity1:{type:"f",value:1},opacity2:{type:"f",value:1},mode:{type:"i",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float blend;","uniform sampler2D texture1;","uniform sampler2D texture2;","uniform int mode;","uniform float opacity1;","uniform float opacity2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( texture1, vUv ) * opacity1;","vec4 texel2 = texture2D( texture2, vUv ) * opacity2;","if (mode == 0) {","gl_FragColor = min(texel1 + texel2, 1.0);","} else if (mode == 1) {","gl_FragColor = max(texel1 - texel2, 0.0);","} else if (mode == 2) {","gl_FragColor = texel1 * texel2;","}","}"].join("\n")},THREE.AddBlendShader={uniforms:{texture1:{type:"t",value:null},texture2:{type:"t",value:null},blend:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float blend;","uniform sampler2D texture1;","uniform sampler2D texture2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( texture1, vUv );","vec4 texel2 = texture2D( texture2, vUv );","gl_FragColor = texel1 + texel2 * blend;","}"].join("\n")},THREE.BlendShader={uniforms:{texture1:{type:"t",value:null},texture2:{type:"t",value:null},blend:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float blend;","uniform sampler2D texture1;","uniform sampler2D texture2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( texture1, vUv );","vec4 texel2 = texture2D( texture2, vUv );","gl_FragColor = mix( texel1, texel2, 0.5 );","}"].join("\n")},THREE.ConvolutionShader={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{texture:{type:"t",value:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D texture;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( texture, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){var t,i,r,n,o,a,s=2*Math.ceil(3*e)+1;for(25<s&&(s=25),n=.5*(s-1),i=new Array(s),t=r=0;t<s;++t)i[t]=(o=t-n,a=e,Math.exp(-o*o/(2*a*a))),r+=i[t];for(t=0;t<s;++t)i[t]/=r;return i}},THREE.CopyShader={uniforms:{texture:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D texture;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( texture, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},THREE.GodRaysShader={defines:{TAPS_PER_PASS:"6.0"},uniforms:{texture:{type:"t",value:null},fStepSize:{type:"f",value:6},center:{type:"v2",value:new THREE.Vector2(0,0)},rayLength:{type:"f",value:1},intensity:{type:"f",value:1},aspect:{type:"f",value:1.33}},vertexShader:["varying highp vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D texture;","uniform vec2 center;","uniform float fStepSize;","uniform float rayLength;","uniform float intensity;","uniform float aspect;","void main() {","vec2 delta = (center - vUv);","float dist = length( delta * vec2(aspect,1.0) );","vec2 stepv = (fStepSize * delta / dist) * rayLength;","vec2 uv = vUv.xy;","vec3 col = vec3(0.0);","for ( float i = 0.0; i < TAPS_PER_PASS; i += 1.0 ) {","col += ( dot(center-uv,center-vUv.xy) > 0.0 ? ( texture2D( texture, uv ).rgb ) : vec3(0.0));","uv += stepv;","}","gl_FragColor = vec4( col / TAPS_PER_PASS * intensity, 1.0 );","}"].join("\n")},THREE.RefractionShader={uniforms:{normalBuffer:{type:"t",value:null},videoBuffer:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D normalBuffer;","uniform sampler2D videoBuffer;","varying highp vec2 vUv;","void main() {","vec3 normal = texture2D(normalBuffer,vUv).rgb * vec3(2.0) - vec3(1.0);","if ( normal == vec3(-1.0) ) normal = vec3(0.0);","vec2 vUv2 = vUv * vec2(0.95);","vec2 rUvR = vUv2 + ( ( normal.xy ) * vec2(0.31) );","vec2 rUvG = vUv2 + ( ( normal.xy ) * vec2(0.32) );","vec2 rUvB = vUv2 + ( ( normal.xy ) * vec2(0.33) );","vec3 video = texture2D(videoBuffer,rUvR).rgb;","video.g = texture2D(videoBuffer,rUvG).g;","video.b = texture2D(videoBuffer,rUvB).b;","gl_FragColor = vec4(video, 1.0);","}"].join("\n")},THREE.DrawingBlur={uniforms:{previousBuffer:{type:"t",value:null},center:{type:"v2",value:new THREE.Vector2(.5,.5)},ratio:{type:"v2",value:new THREE.Vector2(1,1)},drawingSize:{type:"f",value:null},intensity:{type:"f",value:null},fade:{type:"f",value:null}},vertexShader:["varying mediump vec2 vUv;","void main() {","     vUv = vec2(uv.x,uv.y);","     gl_Position = projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying mediump vec2 vUv;","uniform sampler2D previousBuffer;","uniform mediump vec2 center;","uniform mediump float drawingSize;","uniform mediump vec2 ratio;","uniform mediump float fade;","uniform mediump float intensity;","void main() {","    mediump float centerDist = distance((vUv-0.5)*ratio,(center-0.5)*ratio);","    float dist = max(drawingSize-centerDist,0.0) / drawingSize * intensity;","    vec3 previousColor = texture2D(previousBuffer, vUv).rgb - fade;","    gl_FragColor = vec4(previousColor + dist*(1.0-previousColor), 1.0);","    gl_FragColor = clamp(gl_FragColor, 0.0, 1.0);","}"].join("\n")},THREE.BumpToNormal={uniforms:{bumpBuffer:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2},intensity:{type:"f",value:1}},vertexShader:["varying mediump vec2 vUv;","void main() {","     vUv = vec2(uv.x,uv.y);","     gl_Position = projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying mediump vec2 vUv;","uniform sampler2D bumpBuffer;","uniform vec2 resolution;","uniform float intensity;","void main() {","float top    = texture2D(bumpBuffer, vec2(vUv.x, vUv.y - 1./resolution.y)).x;","float bottom  = texture2D(bumpBuffer, vec2(vUv.x, vUv.y + 1./resolution.y)).x;","float left  = texture2D(bumpBuffer, vec2(vUv.x - 1./resolution.x, vUv.y)).x;","float right = texture2D(bumpBuffer, vec2(vUv.x + 1./resolution.x, vUv.y)).x;","float dx = (right - left) * intensity;","float dy = (bottom - top) * intensity;","float dz = max(sqrt(intensity - dx*dx - dy*dy), 0.0);  ","vec3 normal = normalize(vec3(dx,dy,dz))/2.0+0.5;","    gl_FragColor = vec4( normal , 1.0);","}"].join("\n")},THREE.VideoFeedback={uniforms:{previousBuffer:{type:"t",value:null},maskBuffer:{type:"t",value:null},videoBuffer:{type:"t",value:null}},vertexShader:["varying mediump vec2 vUv;","void main() {","     vUv = vec2(uv.x,uv.y);","     gl_Position = projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying mediump vec2 vUv;","uniform sampler2D previousBuffer;","uniform sampler2D maskBuffer;","uniform sampler2D videoBuffer;","void main() {","    vec3 previousColor = texture2D(previousBuffer, vUv).rgb;","    vec3 videoColor = texture2D(videoBuffer, vUv).rgb;","    vec3 maskColor = texture2D(maskBuffer, vUv).rgb;","    gl_FragColor = vec4( mix(previousColor,videoColor, pow(maskColor.r,3.8)), 1.0);","}"].join("\n")},THREE.Vibrance={uniforms:{maskBuffer:{type:"t",value:null},videoBuffer:{type:"t",value:null},effectAlpha:{type:"f",value:.5},timep:{type:"f",value:null}},vertexShader:["varying mediump vec2 vUv;","void main() {","     vUv = vec2(uv.x,uv.y);","     gl_Position = projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying mediump vec2 vUv;","uniform float timep;","uniform float effectAlpha;","uniform sampler2D maskBuffer;","uniform sampler2D videoBuffer;","lowp float rand( vec2 co ){","    return fract( sin( dot( co.xy ,vec2( 12.9898,78.233 ) ) ) * 43758.5453 );","}","const mediump vec3  kRGBToYPrime = vec3 (0.299, 0.587, 0.114);","void main() {","    lowp float noise = rand(vUv*timep*10.0);","    mediump float vibrance = 1.0-texture2D(maskBuffer,vUv).r;","    vibrance*=vibrance*noise;","    vec4 color = texture2D(videoBuffer,vUv);","    lowp float YPrime  = dot (color.rgb, kRGBToYPrime);","    lowp float average = YPrime; //(color.r + color.g + color.b) / 3.0;","    lowp float mx = max(color.r, max(color.g, color.b));","    lowp float amt = (mx - average) * (-vibrance * 100.0 * effectAlpha);","    color.rgb = mix(color.rgb, vec3(mx), amt);","    gl_FragColor = color;","}"].join("\n")},THREE.OffsetBlurShader={uniforms:{tDiffuse:{type:"t",value:null},offset:{type:"v2",value:new THREE.Vector2(.0125,.0125)}},vertexShader:["varying vec2 vUv;","varying vec2 uvLeft;","varying vec2 uvRight;","varying vec2 uvTop;","varying vec2 uvBottom;","varying vec2 uvTopLeft;","varying vec2 uvTopRight;","varying vec2 uvBottomLeft;","varying vec2 uvBottomRight;","uniform vec2 offset;","void main() {","vUv = vec2(uv.x, uv.y);","uvLeft = vUv + vec2(-offset.x, 0.0);","uvRight = vUv + vec2(offset.x, 0.0);","uvTop = vUv + vec2(0.0, -offset.y);","uvBottom = vUv + vec2(0.0, offset.y);","uvTopLeft = vUv + vec2(-offset.x, -offset.y);","uvTopRight = vUv + vec2(offset.x, -offset.y);","uvBottomLeft = vUv + vec2(-offset.x, offset.y);","uvBottomRight = vUv + vec2(offset.x, offset.y);","gl_Position = projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","varying vec2 uvLeft;","varying vec2 uvRight;","varying vec2 uvTop;","varying vec2 uvBottom;","varying vec2 uvTopLeft;","varying vec2 uvTopRight;","varying vec2 uvBottomLeft;","varying vec2 uvBottomRight;","uniform vec2 offset;","uniform sampler2D tDiffuse;","void main() {","gl_FragColor = (","texture2D(tDiffuse, vUv) * 4.0 +","(texture2D(tDiffuse, uvLeft) +","texture2D(tDiffuse, uvRight) +","texture2D(tDiffuse, uvTop) +","texture2D(tDiffuse, uvBottom)) * 2.0 +","texture2D(tDiffuse, uvTopLeft) +","texture2D(tDiffuse, uvTopRight) +","texture2D(tDiffuse, uvBottomRight) +","texture2D(tDiffuse, uvBottomLeft)",") * 0.0625;","gl_FragColor.a = 1.0;","}"].join("\n")},THREE.NoiseShader={uniforms:{texture:{type:"t",value:null},amount:{type:"v2",value:new THREE.Vector2(Math.random(),Math.random())},fade:{type:"f",value:1}},vertexShader:["varying mediump vec2 vUv;","void main() {","vUv = vec2(uv.x, uv.y);","gl_Position = projectionMatrix *  modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["varying mediump vec2 vUv;","uniform sampler2D texture;","uniform highp vec2 amount;","uniform lowp float fade;","float rand(vec2 co) {","return fract(sin(dot(co.xy ,vec2(12.9898, 78.233))) * 43758.5453);","}","#define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))","void main() {","float noise = 0.5 + 0.5 * rand(amount + vUv);","lowp float linea = dot(texture2D(texture, vUv).rgb, vec3(1.0));","linea *= linea * linea * fade;","vec4 lineValue = linea * linea * vec4(1.0);","lineValue = (lineValue * noise) * 1.5 - 0.5;","gl_FragColor = max(lineValue, 0.0) * fade;","}"].join("\n")},THREE.InvertShader={uniforms:{texture:{type:"t",value:null},amount:{type:"f",value:1}},vertexShader:["varying mediump vec2 vUv;","void main() {","vUv = vec2(uv.x, uv.y);","gl_Position = projectionMatrix *  modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["varying mediump vec2 vUv;","uniform sampler2D texture;","uniform float amount;","void main() {","vec4 c = texture2D(texture, vUv);","vec4 i = vec4(1.0 - c.r, 1.0 - c.g, 1.0 - c.b, c.a);","gl_FragColor = (i * amount) + c * (1.0 - amount);","}"].join("\n")},function(){var e=Sandbox.Nodes.DrawingBlur=function(){Sandbox.Node.call(this),this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.shader=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.DrawingBlur.uniforms),vertexShader:THREE.DrawingBlur.vertexShader,fragmentShader:THREE.DrawingBlur.fragmentShader,depthTest:!1,transparent:!1}),this.params={size:{value:.3,step:.001,min:0,max:1},sizeRandomness:{value:.4,step:.001,min:0,max:1},intensity:{value:.9,step:.001,min:0,max:1},fade:{value:.01,step:.001,min:0,max:1}},this.quad.material=this.shader,this.fbo0=this.createBuffer(),this.fbo1=this.createBuffer(),this.buffer=this.outputs.buffer=this.fbo0,this.destructables.push(this.shader,this.fbo0,this.fbo1)};_.extend(e.prototype,Sandbox.Node.prototype,{name:"Drawing Blur",resize:function(e,t){var i=Math.min(1,1920/e);this.fbo0.dispose();var r=_.indexOf(this.destructables,this.fbo0);return 0<=r&&this.destructables.splice(r,1),this.fbo0=this.createBuffer({width:e*i,height:t*i}),this.fbo1.dispose(),0<=(r=_.indexOf(this.destructables,this.fbo1))&&this.destructables.splice(r,1),this.fbo1=this.createBuffer({width:e*i,height:t*i}),this.shader.uniforms.ratio.value.set(e/t,1),this.destructables.push(this.fbo0,this.fbo1),this.buffer=this.outputs.buffer=this.fbo0,this},update:function(){var e=this.fbo1;return this.fbo1=this.fbo0,this.fbo0=this.outputs.buffer=e,this.shader.uniforms.drawingSize.value=this.getParam("size")+Math.pow(Math.random(),6)*this.getParam("sizeRandomness"),this.shader.uniforms.intensity.value=this.getParam("intensity"),this.shader.uniforms.fade.value=this.getParam("fade"),this.shader.uniforms.previousBuffer.value=this.fbo1,this.renderer.render(this.scene,this.camera,this.outputs.buffer,!0),this.trigger("update")},onMouseMove:function(e,t){return this.shader.uniforms.center.value.set(e,1-t),this}})}(),function(){var p=2*Math.PI,e=Sandbox.Nodes.Suminagashi=function(){Sandbox.Node.call(this),this.destroy(),this.two=new Two({type:Two.Types.canvas,width:480,height:270}),this.drops=this.two.scene,this.outputs.texture=this.buffer=new THREE.Texture(this.two.renderer.domElement),(this.outputs.texture.__parentNode=this).outputs.texture.minFilter=THREE.LinearFilter,this.outputs.texture.magFilter=THREE.LinearFilter,this.outputs.texture.format=THREE.RGBFormat,this.outputs.texture.generateMipmaps=!1,this.params={interval:{value:2e3,min:250,max:1e4,step:10},resolution:{value:32,min:16,max:64,step:2},velocity:{value:10,min:1,max:20,step:1},drag:{value:.125,min:1e-4,max:1,step:1e-4},randomness:{value:0,min:0,max:1,step:.001},perlin:{value:!1},fade:{value:!1}},this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.destructables.push(this.texture),this.lastTrigger=Date.now(),this.width=this.two.width,this.height=this.two.height,this.mouse={x:this.width/2,y:this.height/2}};function d(e){return"rgb("+e+","+e+","+e+")"}_.extend(e.prototype,Sandbox.Node.prototype,{name:"Suminagashi",resize:function(e,t){var i=Math.min(1,480/e);return this.width=e*i,this.height=t*i,this.two.renderer.setSize(this.width,this.height),this.two.width=this.width,this.two.height=this.height,this},addDrop:function(){var n=this.getParam("velocity"),o=this.getParam("resolution"),a=this.getParam("randomness"),s=this.getParam("perlin"),l=this.mouse.x,h=this.mouse.y,r=this.two,e=this.drops,t=function(e,t){var i=this.two.renderer.domElement.getContext("2d").getImageData(e,t,1,1).data;return i[3]<=0||i[0]<127.5&&i[1]<127.5&&i[2]<127.5}.call(this,l,h),c=new Two.Vector(l,h),i=_.map(_.range(o),function(e){var t=p*(e/o),i=new Two.Vector(Math.cos(t)+l,Math.sin(t)+h),r=(noise.perlin2(l,h)+1)/2;return i.velocity=a*(s?r:Math.random())*n+n,i.direction=Math.atan2(h-i.y,l-i.x),i});_.each(e.children,function(e){var i=e.translation;_.each(e.vertices,function(e){var t=e.distanceTo(c)/r.width;e.velocity=n*t+n,e.direction=Math.atan2(h-i.y-e.y,l-i.x-e.x)+Math.PI})});var u=r.makeCurve(i);u.color=t?255:0,u.noStroke().fill=d(u.color),u.isWhite=t,e.add(u)},update:function(){var e=Date.now();return e-this.lastTrigger>this.getParam("interval")&&(this.addDrop(),this.lastTrigger=e),function(){var e=this.drops,t=this.getParam("fade"),o=this.getParam("drag"),a=this.getParam("randomness"),s=this.getParam("perlin");_.each(e.children,function(e){var r=!0,n=!1;e.isWhite&&t&&(e.color+=-e.color*o/12,e.color=Math.floor(e.color),e.fill=d(e.color)),_.each(e.vertices,function(e){if(e.velocity<=0)n=!0;else{var t=e.length();t<two.width&&(r=!1);var i=(noise.perlin2(e.x,e.y)+1)/2;e.x+=e.velocity*Math.cos(e.direction),e.y+=e.velocity*Math.sin(e.direction),e.velocity-=e.velocity*o*((s?i:Math.random())*a||1)}}),r&&!n&&e.remove()})}.call(this),this.two.render(),this.outputs.texture.needsUpdate=!0,this.trigger("update")},onMouseMove:function(e,t){return this.mouse.x=this.width*e,this.mouse.y=this.height*t,this},destroy:function(){Sandbox.Node.prototype.destroy.call(this);var e=_.indexOf(Two.Instances,this.two);return 0<=e&&Two.Instances.splice(e,1),this}})}(),function(){var e=document.createElement("canvas");e.width=16,e.height=16;var o=Sandbox.Nodes.Video=function(){Sandbox.Node.call(this),this.destroy(),this.outputs.texture=this.buffer=new THREE.Texture(e),(this.outputs.texture.__parentNode=this).outputs.texture.minFilter=THREE.LinearFilter,this.outputs.texture.magFilter=THREE.LinearFilter,this.outputs.texture.format=THREE.RGBFormat,this.outputs.texture.generateMipmaps=!1,this.outputs.texture.needsUpdate=!0;var t=_.bind(function(){var e=this.getParam("source");this.outputs.texture.image=this.video=o.getVideoBySrc(e)},this);this.params={source:{options:o.Files,onUpdate:_.bind(function(){if(this.sandbox){var e=o.getAssetBySrc(this.getParam("source"));_.isNull(e)||e.ready(this.sandbox,t)}},this)}},this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.destructables.push(this.buffer)};_.extend(o,{getVideoBySrc:function(e){for(var t=o.Files,i=0,r=t.length;i<r;i++){var n=t[i];if(n.value===e)return n.video}return null},getAssetBySrc:function(e){for(var t=o.Files,i=0,r=t.length;i<r;i++){var n=t[i];if(n.value===e)return n}},Files:[new Sandbox.Asset({name:"Light",value:"./media/reflektor_1.mp4?fdjskaoi"}),new Sandbox.Asset({name:"Sea",value:"./media/reflektor_3.mp4?fdjskaoi"}),new Sandbox.Asset({name:"Portrait",value:"./media/reflektor_4.mp4?fdjskaoi"}),new Sandbox.Asset({name:"Multiplication",value:"./media/reflektor_5.mp4?fdjskaoi"})]}),_.each(o.Files,function(e){var t=document.createElement("video");t.setAttribute("autoplay",""),t.setAttribute("autoload",""),t.setAttribute("loop",""),t.setAttribute("playsinline",""),t.setAttribute("inline",""),t.setAttribute("muted",""),t.setAttribute("crossorigin",""),t.volume=0,t.loop=!0,t.addEventListener("canplaythrough",function(){e.available()});var i=document.createElement("source");i.setAttribute("src",e.value),t.appendChild(i),t.width=1,t.height=1;var r=document.querySelector(".scripts");_.isElement(r)&&r.appendChild(t),e.video=t}),_.extend(o.prototype,Sandbox.Node.prototype,{name:"Video",attach:function(){return Sandbox.Node.prototype.attach.apply(this,arguments),this.params.source.value||(this.params.source.value=this.params.source.options[0].value),this.params.source.onUpdate(),this},update:function(){var e;return this.video&&((e=this.video).readyState>=e.HAVE_CURRENT_DATA&&!e.paused)&&(this.outputs.texture.needsUpdate=!0),this.trigger("update")}})}(),function(){var r=document.createElement("video"),e=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),n=Sandbox.Nodes.Webcam=function(){Sandbox.Node.call(this),this.destroy(),this.outputs.texture=this.buffer=window.texture=new THREE.Texture(r),(this.outputs.texture.__parentNode=this).outputs.texture.minFilter=THREE.LinearFilter,this.outputs.texture.magFilter=THREE.LinearFilter,this.outputs.texture.format=THREE.RGBFormat,this.outputs.texture.generateMipmaps=!1,this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.destructables.push(this.texture),this._requested=!1};_.extend(n,{requested:!1,Request:function(){e&&(window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({video:!0},function(e){e.getVideoTracks()[0].label;r.src=window.URL.createObjectURL(e),r.play(),_.delay(function(){n.requested=!0},1e3)},function(e){console.error(e)}))}}),_.extend(n.prototype,Sandbox.Node.prototype,{name:"Webcam",resize:function(e,t){return this.width=e,this.height=t,this},update:function(){if(this._requested||n.requested||(n.Request(),this._requested=!0),n.requested){var e=r.videoWidth/r.videoHeight,t=this.width/this.height,i=e/t;this.outputs.texture.repeat.y!==i&&this.outputs.texture.repeat.set(1,e/t),this.outputs.texture.needsUpdate=!0}return this.trigger("update")}})}(),function(){var e=Sandbox.Nodes.Planes=function(){Sandbox.Node.call(this),this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.params={amount:{value:1,min:1,max:50,step:1},drag:{value:.0625,min:0,max:1,step:.001},blending:{value:THREE.AdditiveBlending,options:e.BlendingModes}},this.scene.remove(this.quad),this.dispose(this.quad),delete this.quad;var i=new THREE.PlaneGeometry(2,2);this.material=new THREE.MeshBasicMaterial({blending:this.getParam("blending"),transparent:!0}),this.planes=_.map(_.range(this.params.amount.max),function(e){var t=new THREE.Mesh(i,this.material);return t.position.destination=new THREE.Vector3,this.scene.add(t),this.destructables.push(t),t},this),this.inputs.video=null,this.buffer=this.outputs.buffer=this.createBuffer(),this.destructables.push(this.buffer,this.material)};_.extend(e,{BlendingModes:[{name:"None",value:THREE.NoBlending},{name:"Normal",value:THREE.NormalBlending},{name:"Additive",value:THREE.AdditiveBlending},{name:"Subtractive",value:THREE.SubtractiveBlending},{name:"Multiply",value:THREE.MultiplyBlending}]}),_.extend(e.prototype,Sandbox.Node.prototype,{name:"Planes",resize:function(e,t){var i=Math.min(1,480/e),r={width:e*i,height:t*i};return this.dispose(this.buffer),this.buffer=this.outputs.buffer=this.createBuffer(r),this.destructables.push(this.buffer),this},update:function(){var r=this.getParam("drag"),n=this.getParam("amount");if(this.inputs.video){_.each(this.planes,function(e,t){if(n<=t)e.visible=!1;else{if(0<t){var i=this.planes[t-1].position;e.position.destination.copy(i)}e.position.add(e.position.destination.clone().sub(e.position).multiplyScalar(r)),e.visible=!0}},this);var e=this.getParam("blending");this.material.blending!==e&&(this.material.blending=parseInt(e),this.material.needsUpdate=!0),this.material.map!==this.inputs.video&&(this.material.map=this.inputs.video,this.material.needsUpdate=!0),this.renderer.render(this.scene,this.camera,this.outputs.buffer,!0)}return this.trigger("update")},onMouseMove:function(e,t){return this.planes[0].position.destination.set(e-.5,1-t-.5,0),this}})}(),function(){var e=Sandbox.Nodes.GodRays=function(){Sandbox.Node.call(this),this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.params={intensity:{value:1.5,min:0,max:10,step:.001},rayLength:{value:1,min:0,max:1,step:.001}},this.shader=this.quad.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.GodRaysShader.uniforms),vertexShader:THREE.GodRaysShader.vertexShader,fragmentShader:THREE.GodRaysShader.fragmentShader,blending:THREE.AdditiveBlending,defines:THREE.GodRaysShader.defines,transparent:!1}),this.inputs.texture=null,this.fbo0=this.createBuffer(),this.fbo1=this.createBuffer(),this.buffer=this.outputs.buffer=this.fbo0,this.destructables.push(this.fbo0,this.fbo1,this.shader)};_.extend(e.prototype,Sandbox.Node.prototype,{name:"God Rays",resize:function(e,t){var i=Math.min(1,480/e);return this.dispose(this.fbo0),this.fbo0=this.createBuffer({width:e*i,height:t*i}),this.dispose(this.fbo1),this.fbo1=this.createBuffer({width:e*i,height:t*i}),this.destructables.push(this.fbo0,this.fbo1),this.buffer=this.outputs.buffer=this.fbo0,this},update:function(){if(this.inputs.texture){this.shader.uniforms.texture.value!==this.inputs.texture&&(this.shader.uniforms.texture.value=this.inputs.texture);var e=1,t=1*Math.pow(6,-e);this.shader.uniforms.intensity.value=this.getParam("intensity"),this.shader.uniforms.rayLength.value=this.getParam("rayLength"),this.shader.uniforms.aspect.value=this.buffer.width/this.buffer.height,this.shader.uniforms.fStepSize.value=t,this.shader.uniforms.texture.value=this.inputs.texture,this.renderer.render(this.scene,this.camera,this.fbo0,!1),e=2,t=1*Math.pow(6,-e),this.shader.uniforms.fStepSize.value=t,this.shader.uniforms.texture.value=this.fbo0,this.renderer.render(this.scene,this.camera,this.fbo1,!1),e=3,t=1*Math.pow(6,-e),this.shader.uniforms.fStepSize.value=t,this.shader.uniforms.texture.value=this.fbo1,this.renderer.render(this.scene,this.camera,this.fbo0,!0)}return this.trigger("update")},onMouseMove:function(e,t){return this.shader.uniforms.center.value.set(e,1-t),this}})}(),function(){var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},e=Sandbox.Nodes.Bloom=function(){Sandbox.Node.call(this),this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this);var e=void 0!==e?e:.5,t=void 0!==t?t:25,i=void 0!==i?i:4;this.params={strength:{value:e,step:.1,min:0,max:2},"horizontal blur":{value:.001953125,step:.001,min:0,max:10},"vertical blur":{value:0,step:.001,min:0,max:10}},this.blur=new THREE.Vector2(this.getParam("horizontal blur"),this.getParam("vertical blur")),this.blendShader=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.AddBlendShader.uniforms),vertexShader:THREE.AddBlendShader.vertexShader,fragmentShader:THREE.AddBlendShader.fragmentShader,transparent:!1}),this.blendShader.uniforms.blend.value=this.getParam("strength"),this.shader=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.ConvolutionShader.uniforms),vertexShader:THREE.ConvolutionShader.vertexShader,fragmentShader:THREE.ConvolutionShader.fragmentShader,defines:{KERNEL_SIZE_FLOAT:t.toFixed(1),KERNEL_SIZE_INT:t.toFixed(0)}}),this.shader.uniforms.uImageIncrement.value=this.blur,this.shader.uniforms.cKernel.value=THREE.ConvolutionShader.buildKernel(i),this.quad.material=this.shader,this.inputs.buffer=null,this.fbo0=new THREE.WebGLRenderTarget(0,0,r),this.fbo1=new THREE.WebGLRenderTarget(0,0,r),this.buffer=this.outputs.buffer=new THREE.WebGLRenderTarget(0,0,r),(this.outputs.buffer.__parentNode=this).destructables.push(this.shader,this.blendShader,this.buffer,this.fbo0,this.fbo1)};_.extend(e.prototype,Sandbox.Node.prototype,{name:"Bloom",resize:function(e,t){var i=Math.min(1,1920/e);return this.outputs.buffer.width=e*i,this.outputs.buffer.height=t*i,this.fbo0.width=e*i/16,this.fbo0.height=t*i/16,this.fbo1.width=e*i/16,this.fbo1.height=t*i/16,this.outputs.buffer.width=e*i,this.outputs.buffer.height=t*i,this},update:function(){return this.inputs.buffer&&(this.blur.x=this.getParam("horizontal blur"),this.blur.y=this.getParam("vertical blur"),this.blendShader.uniforms.blend.value=this.getParam("strength"),this.shader.uniforms.texture.value=this.inputs.buffer,this.shader.uniforms.uImageIncrement.value=this.blur,this.renderer.render(this.scene,this.camera,this.fbo0,!1),this.shader.uniforms.texture.value=this.fbo0,this.renderer.render(this.scene,this.camera,this.fbo1,!1),this.scene.overrideMaterial=this.blendShader,this.blendShader.uniforms.texture1.value=this.inputs.buffer,this.blendShader.uniforms.texture2.value=this.fbo1,this.renderer.render(this.scene,this.camera,this.outputs.buffer,!1),this.scene.overrideMaterial=null),this.trigger("update")}})}(),function(){var e=Sandbox.Nodes.Blur=function(){Sandbox.Node.call(this),this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.width=1,this.height=1,this.params={amount:{value:4,step:.25,min:0,max:50}},this.shader=this.quad.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.OffsetBlurShader.uniforms),vertexShader:THREE.OffsetBlurShader.vertexShader,fragmentShader:THREE.OffsetBlurShader.fragmentShader,transparent:!1}),this.inputs.buffer=null,this.buffer=this.outputs.buffer=this.createBuffer(),this.destructables.push(this.shader,this.outputs.buffer)};_.extend(e.prototype,Sandbox.Node.prototype,{name:"Blur",resize:function(e,t){var i=Math.min(1,480/e),r={width:e*i,height:t*i};return this.width=e,this.height=t,this.dispose(this.buffer),this.buffer=this.outputs.buffer=this.createBuffer(r),this.destructables.push(this.buffer),this},update:function(){var e=this.getParam("amount");return this.inputs.buffer&&(this.shader.uniforms.tDiffuse.value=this.inputs.buffer,this.shader.uniforms.offset.value.set(e/this.width,e/this.height),this.renderer.render(this.scene,this.camera,this.buffer,!1)),this.trigger("update")}})}(),function(){var e=Sandbox.Nodes.Invert=function(){Sandbox.Node.call(this),this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.params={amount:{value:1,min:0,max:1,step:.001}},this.shader=this.quad.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.InvertShader.uniforms),vertexShader:THREE.InvertShader.vertexShader,fragmentShader:THREE.InvertShader.fragmentShader,transparent:!1}),this.inputs.buffer=null,this.buffer=this.outputs.buffer=this.createBuffer(),this.destructables.push(this.shader,this.outputs.buffer)};_.extend(e.prototype,Sandbox.Node.prototype,{name:"Invert",resize:function(e,t){var i=Math.min(1,480/e),r={width:e*i,height:t*i};return this.dispose(this.buffer),this.buffer=this.outputs.buffer=this.createBuffer(r),this.destructables.push(this.buffer),this},update:function(){return this.inputs.buffer&&(this.shader.uniforms.texture.value=this.inputs.buffer,this.shader.uniforms.amount.value=this.getParam("amount"),this.renderer.render(this.scene,this.camera,this.buffer,!1)),this.trigger("update")}})}(),function(){var e=Sandbox.Nodes.Noise=function(){Sandbox.Node.call(this),this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.params={fade:{value:1,step:.001,min:0,max:1}},this.shader=this.quad.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.NoiseShader.uniforms),vertexShader:THREE.NoiseShader.vertexShader,fragmentShader:THREE.NoiseShader.fragmentShader,transparent:!1}),this.inputs.buffer=null,this.buffer=this.outputs.buffer=this.createBuffer(),this.destructables.push(this.shader,this.outputs.buffer)};_.extend(e.prototype,Sandbox.Node.prototype,{name:"Noise",resize:function(e,t){var i=Math.min(1,480/e),r={width:e*i,height:t*i};return this.dispose(this.buffer),this.buffer=this.outputs.buffer=this.createBuffer(r),this.destructables.push(this.buffer),this},update:function(){return this.inputs.buffer&&(this.shader.uniforms.texture.value=this.inputs.buffer,this.shader.uniforms.fade.value=this.getParam("fade"),this.renderer.render(this.scene,this.camera,this.buffer,!1)),this.trigger("update")}})}(),function(){var e=Sandbox.Nodes.BumpToNormal=function(){Sandbox.Node.call(this),this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.shader=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.BumpToNormal.uniforms),vertexShader:THREE.BumpToNormal.vertexShader,fragmentShader:THREE.BumpToNormal.fragmentShader,depthTest:!1,transparent:!1}),this.quad.material=this.shader,this.fbo0=this.createBuffer(),this.buffer=this.outputs.buffer=this.fbo0,this.params={intensity:{value:1,step:.001,min:0,max:100}},this.inputs.buffer=null,this.destructables.push(this.shader,this.fbo0,this.buffer)};_.extend(e.prototype,Sandbox.Node.prototype,{name:"Bump To Normal",resize:function(e,t){var i=Math.min(1,1920/e);this.fbo0.dispose();var r=_.indexOf(this.destructables,this.fb0);return 0<=r&&this.destructables.splice(r,1),this.fbo0=this.createBuffer({width:e*i,height:t*i}),this.buffer=this.outputs.buffer=this.fbo0,this.shader.uniforms.resolution.value.set(e*i,t*i),this.destructables.push(this.fbo0),this},update:function(){return this.inputs.buffer&&(this.shader.uniforms.bumpBuffer.value!==this.inputs.buffer&&(this.shader.uniforms.bumpBuffer.value=this.inputs.buffer),this.shader.uniforms.intensity.value=this.getParam("intensity"),this.renderer.render(this.scene,this.camera,this.outputs.buffer,!0)),this.trigger("update")}})}(),function(){var e=Sandbox.Nodes.Refraction=function(){Sandbox.Node.call(this),this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.shader=this.quad.material=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.RefractionShader.uniforms),vertexShader:THREE.RefractionShader.vertexShader,fragmentShader:THREE.RefractionShader.fragmentShader,transparent:!1}),this.inputs.normal=null,this.inputs.video=null,this.buffer=this.outputs.buffer=this.createBuffer(),this.destructables.push(this.shader,this.buffer)};_.extend(e.prototype,Sandbox.Node.prototype,{name:"Refraction",resize:function(e,t){var i=Math.min(1,1920/e),r=_.indexOf(this.destructables,this.buffer);return 0<=r&&this.destructables.splice(r,1),this.buffer.dispose(),this.buffer=this.outputs.buffer=this.createBuffer({width:e*i,height:t*i}),this.destructables.push(this.buffer),this},update:function(){return this.inputs.normal&&this.inputs.video&&(this.shader.uniforms.normalBuffer.value!==this.inputs.normal&&(this.shader.uniforms.normalBuffer.value=this.inputs.normal),this.shader.uniforms.videoBuffer.value!==this.inputs.video&&(this.shader.uniforms.videoBuffer.value=this.inputs.video),this.renderer.render(this.scene,this.camera,this.outputs.buffer,!0)),this.trigger("update")}})}(),function(){var e=Sandbox.Nodes.VideoFeedback=function(){Sandbox.Node.call(this),this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.shader=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.VideoFeedback.uniforms),vertexShader:THREE.VideoFeedback.vertexShader,fragmentShader:THREE.VideoFeedback.fragmentShader,depthTest:!1,transparent:!1}),this.quad.material=this.shader,this.fbo0=this.createBuffer(),this.fbo1=this.createBuffer(),this.buffer=this.outputs.buffer=this.fbo0,this.inputs.video=null,this.inputs.mask=null,this.destructables.push(this.shader,this.fbo0,this.fbo1)};_.extend(e.prototype,Sandbox.Node.prototype,{name:"Video Feedback",resize:function(e,t){var i=Math.min(1,1920/e),r=_.indexOf(this.destructables,this.fbo0);return 0<=r&&this.destructables.splice(r,1),this.fbo0.dispose(),this.fbo0=this.createBuffer({width:e*i,height:t*i}),0<=(r=_.indexOf(this.destructables,this.fbo0))&&this.destructables.splice(r,1),this.fbo1.dispose(),this.fbo1=this.createBuffer({width:e*i,height:t*i}),this.buffer=this.outputs.buffer=this.fbo0,this.destructables.push(this.fbo0,this.fbo1),this},update:function(){var e=this.fbo1;return this.fbo1=this.fbo0,this.fbo0=this.outputs.buffer=e,this.inputs.mask&&this.inputs.video&&(this.shader.uniforms.maskBuffer.value!==this.inputs.mask&&(this.shader.uniforms.maskBuffer.value=this.inputs.mask),this.shader.uniforms.videoBuffer.value!==this.inputs.video&&(this.shader.uniforms.videoBuffer.value=this.inputs.video),this.shader.uniforms.previousBuffer.value=this.fbo1,this.renderer.render(this.scene,this.camera,this.outputs.buffer,!0)),this.trigger("update")}})}(),function(){var e=Sandbox.Nodes.Vibrance=function(){Sandbox.Node.call(this),this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.shader=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.Vibrance.uniforms),vertexShader:THREE.Vibrance.vertexShader,fragmentShader:THREE.Vibrance.fragmentShader,depthTest:!1,transparent:!1}),this.quad.material=this.shader,this.fbo0=this.createBuffer(),this.buffer=this.outputs.buffer=this.fbo0,this.params={effectAlpha:{value:.5,step:.001,min:0,max:1}},this.inputs.video=null,this.inputs.mask=null,this.destructables.push(this.shader,this.fbo0)};_.extend(e.prototype,Sandbox.Node.prototype,{name:"Vibrance",resize:function(e,t){var i=Math.min(1,1920/e),r=_.indexOf(this.destructables,this.fbo0);return 0<=r&&this.destructables.splice(r,1),this.fbo0.dispose(),this.fbo0=this.createBuffer({width:e*i,height:t*i}),this.buffer=this.outputs.buffer=this.fbo0,this.destructables.push(this.buffer),this},update:function(){return this.inputs.mask&&this.inputs.video&&(this.shader.uniforms.maskBuffer.value!==this.inputs.mask&&(this.shader.uniforms.maskBuffer.value=this.inputs.mask),this.shader.uniforms.videoBuffer.value!==this.inputs.video&&(this.shader.uniforms.videoBuffer.value=this.inputs.video),this.renderer.render(this.scene,this.camera,this.outputs.buffer,!0),this.shader.uniforms.timep.value=.01*performance.now(),this.shader.uniforms.effectAlpha.value=this.getParam("effectAlpha")),this.trigger("update")}})}(),function(){THREE.LinearFilter,THREE.LinearFilter,THREE.RGBFormat;var e=Sandbox.Nodes.Composite3=function(){Sandbox.Node.call(this),this.html=_.template(Sandbox.Graph.Templates.canvas,this)+_.template(Sandbox.Graph.Templates.description,this),this.shader=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(THREE.Composite3Shader.uniforms),vertexShader:THREE.Composite3Shader.vertexShader,fragmentShader:THREE.Composite3Shader.fragmentShader,transparent:!1}),this.params={opacity1:{value:1,min:0,max:1,step:.001},opacity2:{value:1,min:0,max:1,step:.001},blending:{options:e.BlendModes,onUpdate:_.bind(function(){var e=this.getParam("blending");this.shader.uniforms.mode.value=e},this)}},this.quad.material=this.shader,this.blankBuffer=this.createBuffer(),this.blankCamera=new THREE.OrthographicCamera(-1,1,1,-1,-1,1),this.blankScene=new THREE.Scene,this.blankScene.add(new THREE.Mesh(new THREE.PlaneGeometry(2,2))),this.inputs.buffer1=null,this.inputs.buffer2=null,this.buffer=this.outputs.buffer=this.createBuffer(),this.destructables.push(this.shader,this.buffer,this.blankBuffer,this.blankCamera,this.blankScene)};_.extend(e,{BlendModes:[{name:"Additive",value:0},{name:"Subtractive",value:1},{name:"Multiply",value:2}]}),_.extend(e.prototype,Sandbox.Node.prototype,{name:"Composite",resize:function(e,t){var i=Math.min(1,1920/e),r={width:e*i,height:t*i};return this.dispose(this.buffer),this.buffer=this.outputs.buffer=this.createBuffer(r),this.dispose(this.blankBuffer),this.blankBuffer=this.createBuffer(r),this},update:function(){var e=_.isNull(this.inputs.buffer1)?this.blankBuffer:this.inputs.buffer1;return this.shader.uniforms.texture1.value!==e&&(this.shader.uniforms.texture1.value=e),e=_.isNull(this.inputs.buffer2)?this.blankBuffer:this.inputs.buffer2,this.shader.uniforms.texture2.value!==e&&(this.shader.uniforms.texture2.value=e),this.shader.uniforms.opacity1.value=this.getParam("opacity1"),this.shader.uniforms.opacity2.value=this.getParam("opacity2"),this.renderer.render(this.scene,this.camera,this.outputs.buffer,!0),this.trigger("update")}})}();